<div id="Extended_Sturm">
<div class="head">
<h1>Theory Extended_Sturm</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹An alternative Sturm sequences›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Extended_Sturm <span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../Sturm_Tarski/Sturm_Tarski.html">Sturm_Tarski.Sturm_Tarski</a>"</span> 
  <span class="quoted">"<a href="../Winding_Number_Eval/Cauchy_Index_Theorem.html">Winding_Number_Eval.Cauchy_Index_Theorem</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The main purpose of this theory is to provide an effective way to compute 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span> <span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> when <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a rational function. The idea is similar to and based
  on the evaluation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">cindex_poly</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> through <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> cindex_poly_changes_itv_mods<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>   
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This alternative version of remainder sequences is inspired by the paper 
  "The Fundamental Theorem of Algebra made effective: 
  an elementary real-algebraic proof via Sturm chains" 
by Michael Eisermann.
›</span></span>  
  
<span class="keyword1"><span class="command">hide_const</span></span> Permutations.sign  
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>
   
<span class="keyword1" id="Extended_Sturm-is_unit_pCons_ex_iff"><span class="command">lemma</span></span> is_unit_pCons_ex_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="free">p</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">p</span><span class="main">=</span><span class="main">[:</span><span class="bound">a</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_unit_poly_iff is_unit_triv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Extended_Sturm-poly_gcd_iff"><span class="command">lemma</span></span> poly_gcd_iff<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span>
  
<span class="keyword1" id="Extended_Sturm-eventually_poly_nz_at_within"><span class="command">lemma</span></span> eventually_poly_nz_at_within<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>idom<span class="main">,</span>euclidean_space<span class="main">}</span> "</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>     
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>proots <span class="free">p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_subst<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> eventuallyI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>proots <span class="free">p</span><span class="main">.</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_ball_finite_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_at
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gt_ex not_less_iff_gr_or_eq zero_less_dist_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Extended_Sturm-sgn_power"><span class="command">lemma</span></span> sgn_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> even <span class="free">n</span> <span class="keyword1">then</span> <span class="main">¦</span>sgn <span class="free">x</span><span class="main">¦</span> <span class="keyword1">else</span> sgn <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_mult<span class="main">)</span>

<span class="keyword1" id="Extended_Sturm-poly_divide_filterlim_at_top"><span class="command">lemma</span></span> poly_divide_filterlim_at_top<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ll</span><span class="main">≡</span><span class="main">(</span> <span class="keyword1">if</span> degree <span class="free">q</span><span class="main">&lt;</span>degree <span class="free">p</span> <span class="keyword1">then</span> 
                    <span class="keyword1">at</span> <span class="main">0</span> 
                <span class="keyword1">else</span> <span class="keyword1">if</span> degree <span class="free">q</span><span class="main">=</span>degree <span class="free">p</span> <span class="keyword1">then</span> 
                    nhds <span class="main">(</span>lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span><span class="main">)</span>
                <span class="keyword1">else</span> <span class="keyword1">if</span> sgn_pos_inf <span class="free">q</span> <span class="main">*</span> sgn_pos_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> 
                    at_top
                <span class="keyword1">else</span> 
                    at_bot<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">ll</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>    
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dd</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="keyword1">if</span> degree <span class="free">p</span><span class="main">&gt;</span>degree <span class="free">q</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> degree <span class="free">q</span><span class="main">)</span> <span class="keyword1">else</span> 
                                <span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> divide_cong<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span><span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">≥</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="skolem">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">qq</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qq_def pp_def dd_def <span class="keyword1"><span class="command">using</span></span> assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> power_diff<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> qqpp_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qq</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qq_def <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>at_top_le_at_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pp</span> <span class="main">⤏</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>at_top_le_at_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">&lt;</span>degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_atI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_0_at_infinity<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>filterlim_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>at_top_le_at_infinity<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_eventually_not_zero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> poly_eventually_not_zero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
              filter_leD<span class="main">[</span><span class="operator">OF</span> at_top_le_at_infinity<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">=</span>degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divide_cong qqpp_tendsto that <span class="keyword1"><span class="command">unfolding</span></span> dd_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"sgn_pos_inf <span class="free">q</span> <span class="main">*</span> sgn_pos_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> at_top at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_tendsto_pos_mult_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> qqpp_tendsto<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_pos_inf_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_divide_iff zero_less_mult_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">dd</span> at_top at_top"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> dd_def <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_pow_at_top <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_ident<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> filterlim_cong<span class="main">[</span><span class="operator">OF</span> _ _ divide_cong<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sgn_pos_inf <span class="free">q</span> <span class="main">*</span> sgn_pos_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> at_bot at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_tendsto_neg_mult_at_bot_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> qqpp_tendsto<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_pos_inf_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_eq_0_iff divide_sgn leading_coeff_0_iff 
            linorder_neqE_linordered_idom sgn_divide sgn_greater<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">dd</span> at_top at_top"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> dd_def <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_pow_at_top <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_ident<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> filterlim_cong<span class="main">[</span><span class="operator">OF</span> _ _ divide_cong<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Sturm-poly_divide_filterlim_at_bot"><span class="command">lemma</span></span> poly_divide_filterlim_at_bot<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ll</span><span class="main">≡</span><span class="main">(</span> <span class="keyword1">if</span> degree <span class="free">q</span><span class="main">&lt;</span>degree <span class="free">p</span> <span class="keyword1">then</span> 
                    <span class="keyword1">at</span> <span class="main">0</span> 
                <span class="keyword1">else</span> <span class="keyword1">if</span> degree <span class="free">q</span><span class="main">=</span>degree <span class="free">p</span> <span class="keyword1">then</span> 
                    nhds <span class="main">(</span>lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span><span class="main">)</span>
                <span class="keyword1">else</span> <span class="keyword1">if</span> sgn_neg_inf <span class="free">q</span> <span class="main">*</span> sgn_neg_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> 
                    at_top
                <span class="keyword1">else</span> 
                    at_bot<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">ll</span> at_bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>    
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dd</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="keyword1">if</span> degree <span class="free">p</span><span class="main">&gt;</span>degree <span class="free">q</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> degree <span class="free">q</span><span class="main">)</span> <span class="keyword1">else</span> 
                                <span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> divide_cong<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span><span class="bound">x</span> <span class="keyword1">in</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_bot_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">≤</span><span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="skolem">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">qq</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qq_def pp_def dd_def <span class="keyword1"><span class="command">using</span></span> assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> power_diff<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> qqpp_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qq</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qq_def <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>at_bot_le_at_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pp</span> <span class="main">⤏</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>at_bot_le_at_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">&lt;</span>degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_atI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_0_at_infinity<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>filterlim_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>at_bot_le_at_infinity<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_bot<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_eventually_not_zero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> poly_eventually_not_zero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
              filter_leD<span class="main">[</span><span class="operator">OF</span> at_bot_le_at_infinity<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">=</span>degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divide_cong qqpp_tendsto that <span class="keyword1"><span class="command">unfolding</span></span> dd_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"sgn_neg_inf <span class="free">q</span> <span class="main">*</span> sgn_neg_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span><span class="main">=</span>lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cc</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> even <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">cc</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> odd <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> 
            <span class="main">(</span>even <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> even <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>odd <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> odd <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_neg_inf_def cc_def zero_less_mult_iff 
          divide_less_0_iff zero_less_divide_iff 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>if_split<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span> if_split<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(&gt;)</span> <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> at_top at_bot"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_tendsto_pos_mult_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> qqpp_tendsto<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cc</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">dd</span> at_top at_bot"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> dd_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>›</span></span> that<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_pow_at_bot_even <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_ident<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> at_top at_bot"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_tendsto_neg_mult_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> qqpp_tendsto<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cc</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">dd</span> at_bot at_bot"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> dd_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>›</span></span> that<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_pow_at_bot_odd <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_ident<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> at_top at_bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_cong<span class="main">[</span><span class="operator">OF</span> _ _ divide_cong<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sgn_neg_inf <span class="free">q</span> <span class="main">*</span> sgn_neg_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span><span class="main">=</span>lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cc</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> even <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">cc</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> 
            <span class="main">(</span>even <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> even <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>odd <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> odd <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_neg_inf_def cc_def zero_less_mult_iff 
          divide_less_0_iff zero_less_divide_iff
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>if_split<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span> if_split<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(&gt;)</span> <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leading_coeff_0_iff linorder_neqE_linordered_idom<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> at_bot at_bot"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_tendsto_neg_mult_at_bot_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> qqpp_tendsto<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cc</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">dd</span> at_top at_bot"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> dd_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>›</span></span> that<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_pow_at_bot_even <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_ident<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> at_bot at_bot"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> degree <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_tendsto_pos_mult_at_bot_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> qqpp_tendsto<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cc</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">dd</span> at_bot at_bot"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> dd_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>›</span></span> that<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_pow_at_bot_odd <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_ident<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">qq</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">pp</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> at_bot at_bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_cong<span class="main">[</span><span class="operator">OF</span> _ _ divide_cong<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>
        
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Alternative definition of cross›</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cross_alt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span>real poly <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cross_alt</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">=</span><span class="main">¦</span>sign <span class="main">(</span>poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">-</span> sign <span class="main">(</span>poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">¦</span> <span class="main">-</span> <span class="main">¦</span>sign <span class="main">(</span>poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">-</span> sign<span class="main">(</span>poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">¦</span>"</span></span>  

<span class="keyword1" id="Extended_Sturm-cross_alt_coprime_0"><span class="command">lemma</span></span> cross_alt_coprime_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span><span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_alt <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_unit_pCons_ex_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_unit_pCons_ex_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span><span class="free">q</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1" id="Extended_Sturm-cross_alt_0"><span class="command">lemma</span></span> cross_alt_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cross_alt <span class="main">0</span> <span class="main">0</span> <span class="free">a</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
<span class="keyword1" id="Extended_Sturm-cross_alt_poly_commute"><span class="command">lemma</span></span> cross_alt_poly_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cross_alt <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_alt <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Extended_Sturm-cross_alt_clear_n"><span class="command">lemma</span></span> cross_alt_clear_n<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cross_alt <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_alt <span class="main">1</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sign <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">-</span> sign <span class="main">(</span>poly <span class="free">q</span> <span class="free">a</span><span class="main">)</span><span class="main">¦</span>  <span class="main">=</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> sign <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> sign <span class="main">(</span>poly <span class="free">q</span> <span class="free">a</span><span class="main">)</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Sturm_Tarski.sign_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>sign <span class="main">(</span>poly <span class="free">p</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> sign <span class="main">(</span>poly <span class="free">q</span> <span class="free">b</span><span class="main">)</span><span class="main">¦</span>  <span class="main">=</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> sign <span class="main">(</span>poly <span class="free">p</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> sign <span class="main">(</span>poly <span class="free">q</span> <span class="free">b</span><span class="main">)</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Sturm_Tarski.sign_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cross_alt_def sign_times<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>   
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Alternative sign variation sequencse›</span></span>  
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">changes_alt</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>linordered_idom<span class="main">)</span> list <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_alt</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_alt</span> <span class="main">[</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_alt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> abs<span class="main">(</span>sign <span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="main">-</span> sign <span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="free">changes_alt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>  
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_alt_poly_at</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span>linordered_idom<span class="main">)</span> poly list <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_alt_poly_at</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">=</span> changes_alt <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">changes_alt_itv_smods</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span>real poly <span class="main">⇒</span> real poly <span class="main">⇒</span>  int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">changes_alt_itv_smods</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span><span class="main">=</span> smods <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> 
                                    <span class="keyword1">in</span> changes_alt_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> changes_alt_poly_at <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>  
 
<span class="keyword1" id="Extended_Sturm-changes_alt_itv_smods_rec"><span class="command">lemma</span></span> changes_alt_itv_smods_rec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes_alt_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span>  <span class="main">=</span> cross_alt <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> changes_alt_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cross_alt_coprime_0<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> changes_alt_itv_smods_def changes_alt_poly_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">p</span><span class="main">≠</span><span class="main">0</span><span class="main">;</span><span class="free">q</span><span class="main">≠</span><span class="main">0</span><span class="main">;</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> changes_alt_itv_smods_def changes_alt_poly_at_def cross_alt_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sign_times<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="free">q</span><span class="main">=</span><span class="free">p</span><span class="main">#</span><span class="free">q</span><span class="main">#</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"smods <span class="free">q</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span><span class="main">#</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">changes_diff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">changes_diff</span><span class="main">≡</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> changes_alt_poly_at <span class="main">(</span><span class="free">p</span><span class="main">#</span><span class="free">q</span><span class="main">#</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="bound">x</span> 
    <span class="main">-</span> changes_alt_poly_at <span class="main">(</span><span class="free">q</span><span class="main">#</span><span class="main">-</span><span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">changes_diff</span> <span class="free">a</span> <span class="main">-</span> <span class="skolem">changes_diff</span> <span class="free">b</span><span class="main">=</span>cross_alt <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> changes_diff_def changes_alt_poly_at_def cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_alt_itv_smods_def changes_diff_def changes_alt_poly_at_def ps 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹jumpF on polynomials›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jumpF_polyR</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">jumpF_polyR</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jumpF_polyL</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">jumpF_polyL</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jumpF_poly_top</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">jumpF_poly_top</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jumpF_poly_bot</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">jumpF_poly_bot</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span> at_bot"</span></span>

  
<span class="keyword1" id="Extended_Sturm-jumpF_polyR_0"><span class="command">lemma</span></span> jumpF_polyR_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="main">0</span> <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="main">0</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Extended_Sturm-jumpF_polyL_0"><span class="command">lemma</span></span> jumpF_polyL_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="main">0</span> <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="main">0</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Extended_Sturm-jumpF_polyR_mult_cancel"><span class="command">lemma</span></span> jumpF_polyR_mult_cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">ub</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="main">⟶</span> poly <span class="free">p'</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> next_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_right <span class="free">a</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> eventually_at_right<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ub</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Extended_Sturm-jumpF_polyL_mult_cancel"><span class="command">lemma</span></span> jumpF_polyL_mult_cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">lb</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p'</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> last_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">a</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> eventually_at_left<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">lb</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>  
      
<span class="keyword1" id="Extended_Sturm-jumpF_poly_noroot"><span class="command">lemma</span></span> jumpF_poly_noroot<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> jumpF_not_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> jumpF_not_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="keyword1" id="Extended_Sturm-jumpF_polyR_coprime"><span class="command">lemma</span></span> jumpF_polyR_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> 
                                <span class="keyword1">if</span> sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟷</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_poly_noroot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟷</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> add.inverse_neutral has_sgnx_imp_sgnx less_not_sym 
          neg_less_iff_less poly_has_sgnx_values<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sgn_if sign_r_pos_sgnx_iff that 
          trivial_limit_at_right_real zero_less_one<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="free">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free"><span class="free"><span class="free">q</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">x</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poly_tendsto<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟷</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> sign_r_pos <span class="free">p</span> <span class="free">x</span> 
          <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> False <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> add.inverse_inverse has_sgnx_imp_sgnx 
            neg_less_0_iff_less poly_has_sgnx_values<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sgn_if sgn_less sign_r_pos_sgnx_iff 
            that trivial_limit_at_right_real<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="free">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free"><span class="free"><span class="free">q</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">x</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poly_tendsto<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Sturm-jumpF_polyL_coprime"><span class="command">lemma</span></span> jumpF_polyL_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> 
                <span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟷</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_poly_noroot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>order <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟷</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>gt<span class="main">)</span> <span class="quoted"><span class="quoted">" poly <span class="free">q</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">cases</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that sign_r_pos_sgnx_iff poly_sgnx_values<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_sgnx_left_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that sign_r_pos_sgnx_iff poly_sgnx_values<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_sgnx_left_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sgnx_able_poly<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sgnx_able_sgnx<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="free">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free"><span class="free"><span class="free">q</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">x</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poly_tendsto<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>even <span class="main">(</span>order <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> sign_r_pos <span class="free">p</span> <span class="free">x</span> <span class="main">⟷</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>gt<span class="main">)</span> <span class="quoted"><span class="quoted">" poly <span class="free">q</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">cases</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that sign_r_pos_sgnx_iff poly_sgnx_values<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_sgnx_left_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that sign_r_pos_sgnx_iff poly_sgnx_values<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_sgnx_left_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sgnx_able_poly<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sgnx_able_sgnx<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="free">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free"><span class="free"><span class="free">q</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">x</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poly_tendsto<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>    
    
<span class="keyword1" id="Extended_Sturm-jumpF_times"><span class="command">lemma</span></span> jumpF_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span> <span class="main">=</span> sgn <span class="free">c</span> <span class="main">*</span> jumpF <span class="free">g</span> <span class="free">F</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> filterlim_tendsto_pos_mult_at_top_iff<span class="main">[</span><span class="operator">OF</span> tendsto <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> filterlim_tendsto_pos_mult_at_bot_iff<span class="main">[</span><span class="operator">OF</span> tendsto <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">atbot</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">atbot</span> <span class="main">=</span> filterlim <span class="free">g</span> at_bot <span class="free">F</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">attop</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">attop</span> <span class="main">=</span> filterlim <span class="free">g</span> at_top <span class="free">F</span>"</span></span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">atbot</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">attop</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">note</span></span> filterlim_tendsto_neg_mult_at_top_iff<span class="main">[</span><span class="operator">OF</span> tendsto <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> filterlim_tendsto_neg_mult_at_bot_iff<span class="main">[</span><span class="operator">OF</span> tendsto <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def atbot_def attop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">attop</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">atbot</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="skolem">atbot</span></span> <span class="quoted"><span class="skolem">attop</span></span>
        <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_at_bot<span class="main">[</span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">unfolding</span></span> atbot_def attop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>    
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sgn <span class="free">c</span> <span class="main">*</span> jumpF <span class="free">g</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def attop_def atbot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1" id="Extended_Sturm-jumpF_polyR_inverse_add"><span class="command">lemma</span></span> jumpF_polyR_inverse_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">+</span> jumpF_polyR <span class="free">p</span> <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> jumpF_polyR <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> jumpF_add<span class="main">:</span>
    <span class="quoted"><span class="quoted">"jumpF_polyR <span class="skolem">q</span> <span class="skolem">p</span> <span class="free">x</span><span class="main">=</span> jumpF_polyR <span class="main">1</span> <span class="main">(</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">q</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> sign_r_pos <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sign_r_pos_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_coprime<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p</span> <span class="skolem">q</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> jumpF_polyR_coprime<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">*</span><span class="skolem">p</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span> that coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">p</span> <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_poly_noroot<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹poly <span class="free"><span class="free">q</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_add<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_poly_noroot<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹poly <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_add<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> jumpF_poly_noroot<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Sturm-jumpF_polyL_inverse_add"><span class="command">lemma</span></span> jumpF_polyL_inverse_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">+</span> jumpF_polyL <span class="free">p</span> <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> jumpF_polyL <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> jumpF_add<span class="main">:</span>
    <span class="quoted"><span class="quoted">"jumpF_polyL <span class="skolem">q</span> <span class="skolem">p</span> <span class="free">x</span><span class="main">=</span> jumpF_polyL <span class="main">1</span> <span class="main">(</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> poly <span class="skolem">q</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> sign_r_pos <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sign_r_pos_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> sign_r_pos_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="skolem">p</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> add_cancel_right_left divisors_zero order_mult order_root<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_coprime<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p</span> <span class="skolem">q</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> jumpF_polyL_coprime<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">*</span><span class="skolem">p</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span> that coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">p</span> <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_poly_noroot<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹poly <span class="free"><span class="free">q</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_add<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_poly_noroot<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹poly <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_add<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> jumpF_poly_noroot that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>    
  

<span class="keyword1" id="Extended_Sturm-jumpF_polyL_smult_1"><span class="command">lemma</span></span> jumpF_polyL_smult_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF_polyL <span class="main">(</span>smult <span class="free">c</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> sgn <span class="free">c</span> <span class="main">*</span> jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_times<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="Extended_Sturm-jumpF_polyR_smult_1"><span class="command">lemma</span></span> jumpF_polyR_smult_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF_polyR <span class="main">(</span>smult <span class="free">c</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> sgn <span class="free">c</span> <span class="main">*</span> jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_def <span class="keyword1"><span class="command">using</span></span> False 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_times<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> jumpF_polyR_mod<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> jumpF_polyR <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        jumpF_polyL_mod<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> jumpF_polyL <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> jumpF_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">y</span> <span class="keyword1">within</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="skolem">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">y</span> <span class="keyword1">within</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="skolem">S</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="skolem">y</span> <span class="keyword1">within</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="keyword1">at</span> <span class="skolem">y</span> <span class="keyword1">within</span> <span class="skolem">S</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> eventually_poly_nz_at_within<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="main">(</span><span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">*</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">+</span> poly <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_add poly_mult f_def g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">*</span> poly <span class="free">p</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="skolem">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">g</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="var">?F</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">+</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="var">?F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> jumpF_cong<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="skolem">g</span> <span class="var">?F</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">y</span> <span class="keyword1">within</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> filterlim_tendsto_add_at_bot_iff<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> filterlim_tendsto_add_at_top_iff<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> jumpF_polyR <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_eq <span class="keyword1"><span class="command">unfolding</span></span> g_def jumpF_polyR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> jumpF_polyL <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_eq <span class="keyword1"><span class="command">unfolding</span></span> g_def jumpF_polyL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1" id="Extended_Sturm-jumpF_poly_top_0"><span class="command">lemma</span></span> jumpF_poly_top_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"jumpF_poly_top <span class="main">0</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF_poly_top <span class="free">q</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> jumpF_poly_top_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Extended_Sturm-jumpF_poly_bot_0"><span class="command">lemma</span></span> jumpF_poly_bot_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"jumpF_poly_bot <span class="main">0</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF_poly_bot <span class="free">q</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> jumpF_poly_bot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Extended_Sturm-jumpF_poly_top_code"><span class="command">lemma</span></span> jumpF_poly_top_code<span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF_poly_top <span class="free">q</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span> <span class="keyword1">then</span> 
          <span class="keyword1">if</span> sgn_pos_inf <span class="free">q</span> <span class="main">*</span> sgn_pos_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"sgn_pos_inf <span class="free">q</span> <span class="main">*</span> sgn_pos_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_divide_filterlim_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> True that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_top <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_poly_top_def <span class="keyword1"><span class="command">using</span></span> that True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sgn_pos_inf <span class="free">q</span> <span class="main">*</span> sgn_pos_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_divide_filterlim_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> True that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_top <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_poly_top_def <span class="keyword1"><span class="command">using</span></span> that True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">using</span></span> that 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_at_bot_nhds filterlim_at_top_nhds<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">&gt;</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="keyword1">at</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_divide_filterlim_at_top<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> that<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_at_bot_nhds filterlim_at_top_nhds <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_at<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_divide_filterlim_at_top<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_at_bot_nhds filterlim_at_top_nhds<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_top <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_poly_top_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Sturm-jumpF_poly_bot_code"><span class="command">lemma</span></span> jumpF_poly_bot_code<span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF_poly_bot <span class="free">q</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span> <span class="keyword1">then</span> 
          <span class="keyword1">if</span> sgn_neg_inf <span class="free">q</span> <span class="main">*</span> sgn_neg_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> degree <span class="free">q</span><span class="main">&gt;</span>degree <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"sgn_neg_inf <span class="free">q</span> <span class="main">*</span> sgn_neg_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_divide_filterlim_at_bot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> True that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_bot <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_poly_bot_def <span class="keyword1"><span class="command">using</span></span> that True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sgn_neg_inf <span class="free">q</span> <span class="main">*</span> sgn_neg_inf <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_divide_filterlim_at_bot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> True that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_bot <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_poly_bot_def <span class="keyword1"><span class="command">using</span></span> that True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">using</span></span> that 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_at_bot_nhds filterlim_at_top_nhds<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">&gt;</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="keyword1">at</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_divide_filterlim_at_bot<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> that<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_at_bot_nhds filterlim_at_top_nhds <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>filterlim_at<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span> <span class="main">/</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_divide_filterlim_at_bot<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_at_bot_nhds filterlim_at_top_nhds<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">P</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_bot <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_poly_bot_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The extended Cauchy index on polynomials›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cindex_polyE</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cindex_polyE</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> jumpF_polyR <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> cindex_poly <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> jumpF_polyL <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cindex_poly_ubd</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cindex_poly_ubd</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">x</span><span class="main">/</span>poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> of_int <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
   
<span class="keyword1" id="Extended_Sturm-cindex_polyE_0"><span class="command">lemma</span></span> cindex_polyE_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">0</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Extended_Sturm-cindex_polyE_mult_cancel"><span class="command">lemma</span></span> cindex_polyE_mult_cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">p'</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span><span class="main">≠</span> <span class="main">0</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">)</span> <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def
  <span class="keyword1"><span class="command">using</span></span> cindex_poly_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> jumpF_polyL_mult_cancel<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
    jumpF_polyR_mult_cancel<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Extended_Sturm-cindexE_eq_cindex_polyE"><span class="command">lemma</span></span> cindexE_eq_cindex_polyE<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cindexE_constI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span>gcd <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">=</span><span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="free">q</span> <span class="keyword1">div</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q'</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">have</span></span> pq_f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="skolem">g</span><span class="main">*</span><span class="skolem">p'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="skolem">g</span><span class="main">*</span><span class="skolem">q'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p'</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g_def p'_def q'_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> 
    <span class="keyword1"><span class="command">using</span></span> False div_gcd_coprime <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> cindexE <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q'</span> <span class="bound">x</span><span class="main">/</span>poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q'</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="skolem">f'</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">ub</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="main">⟶</span> poly <span class="skolem">g</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> next_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_right <span class="skolem">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="bound">x</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right f_def f'_def pq_f
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ub</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="skolem">f'</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">lb</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">⟶</span> poly <span class="skolem">g</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> last_non_root_interval<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="skolem">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="bound">x</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left f_def f'_def pq_f
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">lb</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>    
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_def f'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="skolem">f'</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">+</span> real_of_int <span class="main">(</span>cindex <span class="free">a</span> <span class="free">b</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="skolem">f'</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> f'_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_eq_cindexE_divide<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> False poly_roots_finite pq_f<span class="main">(</span>1<span class="main">)</span> pq_f<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p'</span> <span class="skolem">q'</span>›</span></span> poly_gcd_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="skolem">q'</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cindex_eq_cindex_poly <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def jumpF_polyR_def jumpF_polyL_def f'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cindex_polyE_mult_cancel<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> pq_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1" id="Extended_Sturm-cindex_polyE_cross"><span class="command">lemma</span></span> cindex_polyE_cross<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="free">p</span> <span class="main">=</span> cross_alt <span class="main">1</span> <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> induct<span class="main">:</span>1
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> noroot<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p</span> <span class="main">=</span> jumpF_polyR <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span>  <span class="main">-</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cross_alt <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ja</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>  
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">jb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jb</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="skolem">ja</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>continuous <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">R</span> <span class="main">(</span>poly <span class="skolem">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="skolem">jb</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>continuous <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="bound">R</span> <span class="main">(</span>poly <span class="skolem">p</span> <span class="free">b</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        
      <span class="keyword1"><span class="command">note</span></span> ja_alt<span class="main">=</span>jumpF_polyR_coprime<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span><span class="operator">unfolded</span> jumpF_polyR_def<span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">folded</span> f_def ja_def<span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> jb_alt<span class="main">=</span>jumpF_polyL_coprime<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span><span class="operator">unfolded</span> jumpF_polyL_def<span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">folded</span> f_def jb_def<span class="main">]</span>  
      
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ja</span> <span class="main">⟷</span> jumpF_polyR <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> <span class="skolem">ja</span> <span class="main">⟷</span> jumpF_polyR <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">jb</span> <span class="main">⟷</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> <span class="skolem">jb</span> <span class="main">⟷</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ja_def jb_def jumpF_polyR_def jumpF_polyL_def f_def jumpF_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>           
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
          <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> continuous <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
          <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">b</span> <span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> continuous <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>  
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="main">)</span>  
      <span class="keyword1"><span class="command">have</span></span> not_right_left<span class="main">:</span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">right</span> greater <span class="main">∧</span> <span class="skolem">left</span> less <span class="main">∨</span> <span class="skolem">right</span> less <span class="main">∧</span> <span class="skolem">left</span> greater<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
             <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">p</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
           <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="skolem">f</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> noroot <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> jumpF_IVT<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> right_def left_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> ja_def jb_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> noroot <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that jumpF_poly_noroot <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_right_left<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> right_def left_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p</span> <span class="free">b</span> <span class="main">&lt;</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ja_alt <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_right_left<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> right_def left_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that jumpF_poly_noroot <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that jumpF_poly_noroot <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p</span> <span class="free">a</span> <span class="main">&lt;</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jb</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">jb</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jb_alt <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jb</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">jb</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_right_left<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> right_def left_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jb</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">jb</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="free">a</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that jumpF_poly_noroot <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that jumpF_poly_noroot <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jb</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">jb</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jb_alt <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">ja</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ja_alt <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">jb</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">ja</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">jb</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_right_left<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> right_def left_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ja</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">jb</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">ja</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">jb</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that jumpF_poly_noroot <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> no_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">roots</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">roots</span><span class="main">≡</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">roots</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_def <span class="keyword1"><span class="command">using</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">max_r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">≡</span>Max <span class="skolem">roots</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">max_r</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">roots</span>›</span></span><span class="main">]</span> no_empty  <span class="keyword1"><span class="command">unfolding</span></span> roots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">max_rp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_rp</span><span class="main">≡</span><span class="main">[:</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span>order <span class="skolem">max_r</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">p'</span><span class="main">*</span><span class="skolem">max_rp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p'</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> mult.commute order_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> max_r_nz<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">≠</span><span class="main">0</span>"</span></span><span class="comment1">(*and "poly p' a≠0" and "poly p' b≠0" *)</span>
      <span class="comment1">(*and  "poly max_rp a≠0" and "poly max_rp b≠0"*)</span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_iff_poly_eq_0<span class="main">)</span>
        
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">max_r_sign</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r_sign</span><span class="main">≡</span><span class="keyword1">if</span> odd<span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">::</span>int"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">roots'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">roots'</span><span class="main">≡</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span>  <span class="free">a</span><span class="main">&lt;</span> <span class="bound">x</span><span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p</span> <span class="main">=</span> jumpF_polyR <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p</span> <span class="free">b</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def cindex_poly_def roots_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">meson</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p'</span> <span class="main">+</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span> 
        <span class="main">+</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> jumpF_polyR <span class="main">1</span> <span class="skolem">p'</span> <span class="free">a</span> <span class="main">-</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p'</span> <span class="main">+</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span>"</span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">+</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">roots</span> <span class="main">=</span> insert <span class="skolem">max_r</span> <span class="skolem">roots'</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> roots_def roots'_def p'_def 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">max_r</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> order_root
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> max_rp_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">roots'</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> roots'_def <span class="keyword1"><span class="command">using</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span> <span class="main">∉</span> <span class="skolem">roots'</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> roots'_def <span class="keyword1"><span class="command">using</span></span> max_r_nz
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sum.insert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">roots'</span></span> <span class="quoted"><span class="skolem">max_r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> jump_poly <span class="main">1</span> <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> refl<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">roots'</span>"</span></span> 
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">max_r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max_r_nz <span class="keyword1"><span class="command">unfolding</span></span> roots'_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_power_n_eq <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">max_rp</span><span class="main">=</span><span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_root<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">1</span> <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> jump_poly_not_root<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">roots</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">roots'</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_def roots'_def p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">max_r</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">roots</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="skolem">max_r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> max_r_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span>poly <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">max_r_sign</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_r_sign_def max_rp_def sign_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_power<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>linorder_class.not_less zero_less_power_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> jump_poly <span class="main">1</span> <span class="skolem">p'</span> <span class="skolem">x</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> jump_poly_1_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">max_rp</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">unfolding</span></span> p'_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">max_rp</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">roots'</span><span class="main">.</span> jump_poly <span class="main">1</span> <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span> 
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p'</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def roots'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> jumpF_polyR <span class="main">1</span> <span class="skolem">p'</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> poly <span class="skolem">max_rp</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_def f_def g_def p'_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> jumpF <span class="skolem">g</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_times<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">a</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>      
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> jumpF_polyR <span class="main">1</span> <span class="skolem">p'</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">max_r_sign</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> max_r_sign_def f_def max_rp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_power<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyR_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="main">1</span> <span class="skolem">p</span> <span class="free">b</span> <span class="main">=</span>  jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> poly <span class="skolem">max_rp</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="main">1</span> <span class="skolem">p</span> <span class="free">b</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_def f_def g_def p'_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> jumpF <span class="skolem">g</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_times<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">b</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>      
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> max_r_sign_def f_def max_rp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="skolem">max_r</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_power<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_polyL_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p'</span> <span class="main">+</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span> 
        <span class="main">+</span> <span class="main">(</span><span class="skolem">max_r_sign</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def roots'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">max_r_sign</span> <span class="main">*</span> cross_alt <span class="main">1</span> <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span> 
        <span class="main">+</span> <span class="main">(</span><span class="skolem">max_r_sign</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">max_rp</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def degree_linear_power
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">max_r</span><span class="main">=</span><span class="main">0</span>›</span></span> order_root <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span><span class="main">&lt;</span>degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def 
        <span class="keyword1"><span class="command">using</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> induct<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="skolem">p'</span> <span class="main">=</span> real_of_int <span class="main">(</span>cross_alt <span class="main">1</span> <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> real_of_int <span class="main">(</span>cross_alt <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> sjump_p<span class="main">:</span><span class="quoted"><span class="quoted">"jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> odd <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">then</span> sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">note</span></span> max_r_nz 
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="skolem">max_r</span><span class="main">=</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">max_r</span> <span class="main">=</span> <span class="main">0</span>›</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="main">1</span> <span class="skolem">p</span> <span class="skolem">max_r</span> <span class="main">=</span> sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">)</span> <span class="main">*</span> jump_poly <span class="main">1</span> <span class="skolem">max_rp</span> <span class="skolem">max_r</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">using</span></span> jump_poly_1_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">max_r</span></span> <span class="quoted"><span class="skolem">max_rp</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> odd <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">max_rp</span><span class="main">)</span> <span class="keyword1">then</span> sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="skolem">max_rp</span> <span class="skolem">max_r</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">using</span></span> sign_r_pos_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> odd <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">then</span> sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">max_r</span> <span class="skolem">p'</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="skolem">max_r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> order_0I<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">max_r</span> <span class="skolem">max_rp</span> <span class="main">=</span> order <span class="skolem">max_r</span> <span class="skolem">p</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_rp</span><span class="main">≠</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>  sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">max_r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span>poly <span class="skolem">max_rp</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹even <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> that 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sign_power <span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sturm_Tarski.sign_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sign_times<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>    
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_alt <span class="main">1</span> <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> cross_alt <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> max_r_sign_def sjump_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span>poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> cross_alt <span class="main">1</span> <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span> 
              <span class="main">=</span> cross_alt <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span>    
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">∨</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span><span class="main">=</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> jumpF_polyL_coprime<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> max_r_nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span><span class="main">=</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> 
                <span class="main">∨</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span><span class="main">=</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span> poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> noroots<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">max_r</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> poly <span class="skolem">p'</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">roots</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_def <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="skolem">max_r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">roots</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> max_r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="skolem">max_r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>  
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">max_r</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="skolem">f</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> noroots <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> max_r_nz
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span><span class="main">&lt;</span><span class="main">0</span> 
                <span class="main">∨</span> <span class="skolem">f</span> <span class="skolem">max_r</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> f_def jumpF_polyL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="skolem">max_r</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> jumpF_IVT<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> noroots <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span><span class="main">=</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>
              <span class="main">∨</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span><span class="main">=</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zero_less_power_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cross_alt <span class="main">1</span> <span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">-</span> cross_alt <span class="main">1</span> <span class="skolem">p'</span> <span class="free">a</span> <span class="free">b</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def p'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>›</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sign_times<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sturm_Tarski.sign_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_polyL <span class="main">1</span> <span class="skolem">p'</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> jumpF_polyL_coprime<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">max_rp</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> max_rp_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>order <span class="skolem">max_r</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zero_less_power_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> max_r_nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span> "</span></span>  
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def p'_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sign_times<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sturm_Tarski.sign_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>      
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> cross_alt_def p'_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sign_times<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sturm_Tarski.sign_def<span class="main">)</span>  
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∨</span> poly <span class="skolem">p'</span> <span class="free">b</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="skolem">max_r</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_IVT<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> that mult_less_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">roots</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">max_r</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="skolem">max_r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_r_def <span class="keyword1"><span class="command">using</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">roots</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_r_sign_def sjump_p <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>      
     
<span class="keyword1" id="Extended_Sturm-cindex_polyE_inverse_add"><span class="command">lemma</span></span> cindex_polyE_inverse_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> cp<span class="main">:</span><span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">+</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span><span class="main">=</span>cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">1</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def
  <span class="keyword1"><span class="command">using</span></span> cindex_poly_inverse_add<span class="main">[</span><span class="operator">OF</span> cp<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> jumpF_polyR_inverse_add<span class="main">[</span><span class="operator">OF</span> cp<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> 
    jumpF_polyL_inverse_add<span class="main">[</span><span class="operator">OF</span> cp<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    

<span class="keyword1" id="Extended_Sturm-cindex_polyE_inverse_add_cross"><span class="command">lemma</span></span> cindex_polyE_inverse_add_cross<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>  <span class="main">+</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> cross_alt <span class="free">p</span> <span class="free">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_polyE_inverse_add<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_polyE_cross<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cross_alt_clear_n<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
<span class="keyword1" id="Extended_Sturm-cindex_polyE_smult_1"><span class="command">lemma</span></span> cindex_polyE_smult_1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span>  <span class="main">(</span>sgn <span class="free">c</span><span class="main">)</span> <span class="main">*</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def jumpF_polyL_smult_1 jumpF_polyR_smult_1 cindex_poly_smult_1 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_sign_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>    

<span class="keyword1" id="Extended_Sturm-cindex_polyE_mod"><span class="command">lemma</span></span> cindex_polyE_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">=</span>  cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_poly_mod<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_polyR_mod<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_polyL_mod<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Extended_Sturm-cindex_polyE_rec"><span class="command">lemma</span></span> cindex_polyE_rec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>  <span class="main">=</span> cross_alt <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="free">b</span><span class="main">/</span><span class="numeral">2</span>  <span class="main">+</span>  cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> cindex_polyE_inverse_add_cross<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="main">-</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cindex_polyE_mod cindex_polyE_smult_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> cross_alt_poly_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>    
  
<span class="keyword1" id="Extended_Sturm-cindex_polyE_changes_alt_itv_mods"><span class="command">lemma</span></span> cindex_polyE_changes_alt_itv_mods<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">=</span> changes_alt_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="free">p</span> <span class="free">q</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"smods <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> smods_nil_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>changes_alt_itv_smods_def changes_alt_poly_at_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>changes_alt_itv_smods_def changes_alt_poly_at_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≡</span><span class="main">-</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span><span class="quoted"><span class="quoted">"smods <span class="skolem">p</span> <span class="skolem">q</span><span class="main">=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="quoted"><span class="quoted">"smods <span class="skolem">q</span> <span class="skolem">r</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">=</span> smods <span class="skolem">p</span> <span class="skolem">q</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.inject smods.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">q</span> <span class="skolem">r</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="skolem">r</span> <span class="skolem">q</span> <span class="main">=</span> real_of_int <span class="main">(</span>changes_alt_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="skolem">q</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> Cons.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ps <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span><span class="main">=</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes_alt_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> cross_alt <span class="skolem">p</span> <span class="skolem">q</span> <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> changes_alt_itv_smods <span class="free">a</span> <span class="free">b</span> <span class="skolem">q</span> <span class="skolem">r</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> changes_alt_itv_smods_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p</span> <span class="skolem">q</span>›</span></span><span class="main">,</span><span class="operator">folded</span> r_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="skolem">q</span> <span class="skolem">p</span> <span class="main">=</span> real_of_int <span class="main">(</span>cross_alt <span class="skolem">q</span> <span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> cindex_polyE <span class="free">a</span> <span class="free">b</span> <span class="skolem">r</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cindex_polyE_rec<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p</span> <span class="skolem">q</span>›</span></span><span class="main">,</span><span class="operator">folded</span> r_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> cross_alt_poly_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Extended_Sturm-cindex_poly_ubd_eventually"><span class="command">lemma</span></span> cindex_poly_ubd_eventually<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>cindex_poly_ubd <span class="free">q</span> <span class="free">p</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> R_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"proots <span class="free">p</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">-</span><span class="skolem">R</span><span class="main">&lt;..&lt;</span><span class="skolem">R</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> finite_ball_include<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r_ball<span class="main">:</span><span class="quoted"><span class="quoted">"proots <span class="free">p</span> <span class="main">⊆</span> ball <span class="main">0</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots <span class="free">p</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">-</span><span class="skolem">r</span><span class="main">&lt;..&lt;</span><span class="skolem">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>ball <span class="main">0</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mem_ball_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span> <span class="skolem">r</span><span class="main">&lt;..&lt;</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> False <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span>  <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> cindex_poly <span class="main">(</span><span class="main">-</span><span class="skolem">R</span><span class="main">)</span> <span class="skolem">R</span> <span class="free">q</span> <span class="free">p</span><span class="main">)</span>"</span></span>  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> of_int <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">l</span> "</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> "</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> P_def f_def l_def <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventuallyI cindexE_constI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">R</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">f</span> <span class="main">=</span>  cindex_polyE <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> R_def<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cindexE_eq_cindex_polyE<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="main">(</span>cindex_poly <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="free">q</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_poly_noroot<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span><span class="main">≤</span><span class="skolem">r</span>›</span></span> R_def<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_poly_noroot<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span><span class="main">≤</span><span class="skolem">r</span>›</span></span> R_def<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="main">(</span>cindex_poly <span class="main">(</span><span class="main">-</span> <span class="skolem">R</span><span class="main">)</span> <span class="skolem">R</span> <span class="free">q</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">-</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r</span><span class="main">}</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Rs</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">-</span> <span class="skolem">R</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">R</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span><span class="main">=</span><span class="skolem">Rs</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> R_def<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span><span class="main">≤</span><span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def Rs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>    
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> rs_def Rs_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">f</span> <span class="main">=</span> real_of_int <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> real_of_int <span class="skolem">x</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> real_of_int <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> eventually_conj<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span><span class="main">::</span>real <span class="keyword1">in</span> at_top<span class="main">.</span> real_of_int <span class="skolem">x</span> <span class="main">=</span> real_of_int <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">x</span> <span class="main">=</span> real_of_int <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> theI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def f_def cindex_poly_ubd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Extended_Sturm-cindex_poly_ubd_0"><span class="command">lemma</span></span> cindex_poly_ubd_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly_ubd <span class="free">q</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventuallyI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>cindexE_constI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eventually_conj<span class="main">[</span><span class="operator">OF</span> this cindex_poly_ubd_eventually<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span><span class="main">::</span>real <span class="keyword1">in</span> at_top<span class="main">.</span>  <span class="main">(</span>cindex_poly_ubd <span class="free">q</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Extended_Sturm-cindex_poly_ubd_code"><span class="command">lemma</span></span> cindex_poly_ubd_code<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_poly_ubd <span class="free">q</span> <span class="free">p</span> <span class="main">=</span> changes_R_smods <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cindex_poly_ubd_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">≡</span>smods <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ps_def <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> lb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&gt;</span><span class="skolem">lb</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> lb_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">lb</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_neg_inf <span class="bound">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_lb<span class="main">[</span><span class="operator">OF</span> no_0_in_smods<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">&lt;</span><span class="skolem">ub</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ub_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">ub</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn_pos_inf <span class="bound">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root_list_ub<span class="main">[</span><span class="operator">OF</span> no_0_in_smods<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">,</span><span class="operator">folded</span> ps_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">t</span><span class="main">/</span> poly <span class="free">p</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> of_int <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span>changes_R_smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"max <span class="main"><span class="main">¦</span></span><span class="skolem"><span class="skolem">lb</span></span><span class="main"><span class="main">¦</span></span> <span class="main"><span class="main">¦</span></span><span class="skolem"><span class="skolem">ub</span></span><span class="main"><span class="main">¦</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> r_asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≥</span>max <span class="main">¦</span><span class="skolem">lb</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">ub</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">f</span> <span class="main">=</span>  cindex_polyE <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="free">q</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> r_asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cindexE_eq_cindex_polyE<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="main">(</span>cindex_poly <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="free">q</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_poly_noroot<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> r_asm lb<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_poly_noroot<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> r_asm ub<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_polyE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="main">(</span>changes_itv_smods <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_poly_changes_itv_mods<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> arg_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> r_asm lb<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span><span class="main">]</span> ub<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span>set <span class="skolem">ps</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="main">(</span>changes_R_smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_neg_inf <span class="skolem">ps</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>sgn <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> map sgn_pos_inf <span class="skolem">ps</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> lb_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> ub_sgn<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> r_asm 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes_poly_at <span class="skolem">ps</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">=</span>changes_poly_neg_inf <span class="skolem">ps</span>
          <span class="main">∧</span> changes_poly_at <span class="skolem">ps</span> <span class="skolem">r</span><span class="main">=</span>changes_poly_pos_inf <span class="skolem">ps</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> changes_poly_neg_inf_def changes_poly_at_def changes_poly_pos_inf_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span>  changes_map_sgn_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> map_map<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> changes_R_smods_def changes_itv_smods_def ps_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">f</span> <span class="main">=</span>  of_int <span class="main">(</span>changes_R_smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> changes_R_smods <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> real_of_int <span class="main">(</span>changes_R_smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> real_of_int <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">(</span>changes_R_smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> eventually_conj<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">(</span><span class="bound">r</span><span class="main">::</span>real<span class="main">)</span> <span class="keyword1">in</span> at_top<span class="main">.</span> of_int <span class="skolem">x</span> <span class="main">=</span> of_int <span class="main">(</span>changes_R_smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">x</span> <span class="main">=</span> of_int <span class="main">(</span>changes_R_smods <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> eventually_const_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> of_int_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> changes_R_smods <span class="free">p</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> the_equality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="quoted">"changes_R_smods <span class="free">p</span> <span class="free">q</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_ubd_def P_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  


<span class="keyword1" id="Extended_Sturm-cindexE_ubd_poly"><span class="command">lemma</span></span> cindexE_ubd_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"cindexE_ubd <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> cindex_poly_ubd <span class="free">q</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cindex_poly_ubd_0 <span class="keyword1"><span class="command">unfolding</span></span> cindexE_ubd_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mx</span></span> <span class="skolem"><span class="skolem">mn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mx</span> <span class="main">=</span> Max <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mn</span> <span class="main">=</span> Min <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span><span class="main">=</span> <span class="main">1</span><span class="main">+</span> <span class="main">(</span>max <span class="main">¦</span><span class="skolem">mx</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">mn</span><span class="main">¦</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> rr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">rr</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">&lt;</span> <span class="skolem">rr</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> poly_roots_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mn</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="skolem">mx</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Max_ge Min_le that <span class="keyword1"><span class="command">unfolding</span></span> mn_def mx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> cindexE_ubd <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">rr</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≥</span><span class="skolem">rr</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">-</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r</span><span class="main">}</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L1</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">-</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">r</span><span class="main">}</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L2</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span><span class="main">=</span><span class="skolem">R2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> jumpF_polyR <span class="free">q</span> <span class="free">p</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> f_def jumpF_polyR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_poly_noroot<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span>  that <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≥</span><span class="skolem">rr</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>rr<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> R1_def R2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L1</span><span class="main">=</span><span class="skolem">L2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> jumpF_polyL <span class="free">q</span> <span class="free">p</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> f_def jumpF_polyL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_poly_noroot<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≥</span><span class="skolem">rr</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>rr<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> L1_def L2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">f</span> <span class="main">=</span> cindexE_ubd <span class="skolem">f</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def cindexE_ubd_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> R1_def R2_def L1_def L2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> cindex_poly_ubd <span class="free">q</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cindex_poly_ubd_eventually <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> cindexE_ubd <span class="skolem">f</span> 
                          <span class="main">∧</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="skolem">f</span> <span class="main">=</span> cindex_poly_ubd <span class="free">q</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_conj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">(</span><span class="bound">r</span><span class="main">::</span>real<span class="main">)</span> <span class="keyword1">in</span> at_top<span class="main">.</span> cindexE_ubd <span class="skolem">f</span> <span class="main">=</span> cindex_poly_ubd <span class="free">q</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="More_Polynomials">
<div class="head">
<h1>Theory More_Polynomials</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹More useful lemmas related polynomials›</span></span>

<span class="keyword1"><span class="command">theory</span></span> More_Polynomials <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Winding_Number_Eval/Missing_Algebraic.html">Winding_Number_Eval.Missing_Algebraic</a>
  <a href="../Winding_Number_Eval/Missing_Transcendental.html">Winding_Number_Eval.Missing_Transcendental</a>
  <a href="../Sturm_Tarski/PolyMisc.html">Sturm_Tarski.PolyMisc</a>
  <a href="../Budan_Fourier/BF_Misc.html">Budan_Fourier.BF_Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">order</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="More_Polynomials-order_normalize"><span class="command">lemma</span></span> order_normalize<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span> <span class="main">=</span> order <span class="free">x</span> <span class="free">p</span>"</span></span>      
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_normalize_iff normalize_eq_0_iff order_1 order_2 order_unique_lemma<span class="main">)</span>

<span class="keyword1" id="More_Polynomials-order_gcd"><span class="command">lemma</span></span> order_gcd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>order <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>order <span class="free">x</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xx</span></span> <span class="skolem"><span class="skolem">op</span></span> <span class="skolem"><span class="skolem">oq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">op</span> <span class="main">=</span> order <span class="free">x</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">oq</span> <span class="main">=</span> order <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> pp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="skolem">op</span> <span class="main">*</span> <span class="skolem">pp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">xx</span> <span class="keyword1">dvd</span> <span class="skolem">pp</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_decomp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span><span class="operator">folded</span> xx_def op_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qq</span></span> <span class="keyword2"><span class="keyword">where</span></span> qq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="skolem">oq</span> <span class="main">*</span> <span class="skolem">qq</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">xx</span> <span class="keyword1">dvd</span> <span class="skolem">qq</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_decomp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span><span class="operator">folded</span> xx_def oq_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq</span> <span class="main">=</span> gcd <span class="skolem">pp</span> <span class="skolem">qq</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> p_unfold<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pq</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">op</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"coprime <span class="skolem">xx</span> <span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">^</span> <span class="skolem">op</span> <span class="main">=</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">op</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span>power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> <span class="skolem">pq</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> pq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pq</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">op</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pq_def pp <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">xx</span> <span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> prime_elem_imp_coprime<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 
                    prime_elem_linear_poly<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> xx_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span> <span class="main">=</span> <span class="skolem">pq</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>›</span></span> pp<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> pp <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> q_unfold<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pq</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">oq</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"coprime <span class="skolem">xx</span> <span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">^</span> <span class="skolem">oq</span> <span class="main">=</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">oq</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span>power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span> <span class="main">=</span> <span class="skolem">pq</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> pq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pq</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">oq</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pq_def qq <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">xx</span> <span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> prime_elem_imp_coprime<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 
                    prime_elem_linear_poly<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> xx_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">qq</span> <span class="main">=</span> <span class="skolem">pq</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>›</span></span> qq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="free">q</span><span class="main">=</span>normalize <span class="main">(</span><span class="skolem">pq</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">op</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">oq</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">op</span><span class="main">&gt;</span><span class="skolem">oq</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">oq</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">op</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span> <span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_gcd_coprime<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">pp</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">qq</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> pq_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">op</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">oq</span> <span class="main">-</span> min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>coprime_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">pp</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span> <span class="main">(</span><span class="skolem">qq</span> <span class="keyword1">div</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> div_gcd_coprime<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">pp</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">qq</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> pq_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_unfold q_unfold
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> gcd_mult_left<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> order <span class="free">x</span> <span class="skolem">pq</span> <span class="main">+</span> order <span class="free">x</span> <span class="main">(</span><span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> p_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span><span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span>min <span class="skolem">op</span> <span class="skolem">oq</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pp<span class="main">(</span>2<span class="main">)</span> qq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> pq_def xx_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I poly_eq_0_iff_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> min <span class="skolem">op</span> <span class="skolem">oq</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> xx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_power_n_n<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> min <span class="main">(</span>order <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>order <span class="free">x</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> op_def oq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomials-pderiv_power"><span class="command">lemma</span></span> pderiv_power<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pderiv <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> pderiv_power_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*TODO: to replace the one (with the same name) in the library, as this version does 
  not require 'a to be a field?*)</span>
<span class="keyword1" id="More_Polynomials-order_pderiv"><span class="command">lemma</span></span> order_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>idom<span class="main">,</span>semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Suc <span class="main">(</span>order <span class="free">x</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xx</span></span> <span class="skolem"><span class="skolem">op</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">op</span> <span class="main">=</span> order <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">op</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> op_def <span class="keyword1"><span class="command">using</span></span> assms order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> pp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">xx</span> <span class="main">^</span> <span class="skolem">op</span> <span class="main">*</span> <span class="skolem">pp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">xx</span> <span class="keyword1">dvd</span> <span class="skolem">pp</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_decomp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span><span class="operator">folded</span> xx_def op_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> p_der<span class="main">:</span><span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>of_nat <span class="skolem">op</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xx</span><span class="main">^</span><span class="main">(</span><span class="skolem">op</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">pp</span> <span class="main">+</span> <span class="skolem">xx</span><span class="main">^</span><span class="skolem">op</span><span class="main">*</span>pderiv <span class="skolem">pp</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pderiv_mult pderiv_power xx_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> pderiv_pCons<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span><span class="main">^</span><span class="main">(</span><span class="skolem">op</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_der 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_pred assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dvd_add dvd_mult_right dvd_triv_left 
        neq0_conv op_def order_root power_Suc smult_dvd_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">xx</span><span class="main">^</span><span class="skolem">op</span> <span class="keyword1">dvd</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">^</span> <span class="skolem">op</span> <span class="keyword1">dvd</span> pderiv <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">^</span> <span class="skolem">op</span> <span class="keyword1">dvd</span> smult <span class="main">(</span>of_nat <span class="skolem">op</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xx</span><span class="main">^</span><span class="main">(</span><span class="skolem">op</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">pp</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_der <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_add_left_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">^</span> <span class="skolem">op</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">xx</span><span class="main">^</span><span class="main">(</span><span class="skolem">op</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">pp</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> dvd_monic<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">op</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>lead_coeff_power xx_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">op</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">xx</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">xx</span><span class="main">^</span><span class="main">(</span><span class="skolem">op</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">xx</span> <span class="keyword1">dvd</span> <span class="skolem">pp</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">op</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> mult.commute power_eq_if<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> pp<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> xx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dvd_trans one_dvd order_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">op</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_unique_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">op</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span>"</span></span><span class="main">,</span><span class="operator">folded</span> xx_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">op</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">op</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">rsquarefree</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="More_Polynomials-rsquarefree_0"><span class="command">lemma</span></span> rsquarefree_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rsquarefree <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Polynomials-rsquarefree_times"><span class="command">lemma</span></span> rsquarefree_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> order <span class="bound">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> order_0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">a</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> order <span class="skolem">a</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
       <span class="quoted"><span class="quoted">"order <span class="skolem">a</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> order <span class="skolem">a</span> <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
       <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rsquarefree <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pq</span></span> <span class="skolem"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pq</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">pq</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pq_def root.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aa_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aa_def order_power_n_n power_one_right<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span><span class="skolem">aa</span> <span class="main">*</span> <span class="skolem">pq</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> aa_def pq_def <span class="keyword1"><span class="command">using</span></span> root<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="skolem">pq</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> root<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> pq_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomials-rsquarefree_smult_iff"><span class="command">lemma</span></span> rsquarefree_smult_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span>smult <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> rsquarefree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_smult<span class="main">)</span>

<span class="keyword1" id="More_Polynomials-card_proots_within_rsquarefree"><span class="command">lemma</span></span> card_proots_within_rsquarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="free">s</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free">p</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">∈</span></span><span class="free"><span class="free">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_roots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_not_in_conv card.empty proots_count_def proots_within_iff sum.empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> proots_count <span class="skolem">p</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_times<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> root.prems rsquarefree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.inverse_inverse add.inverse_neutral 
                  minus_pCons proots_count_pCons_1_iff proots_count_uminus root.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rsquarefree <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> rsquarefree_times<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> root<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_within_times 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">1</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span><span class="main">)</span>
               <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">p</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">s</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_within_pCons_1_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly <span class="skolem">p</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">a</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.inverse_inverse add.inverse_neutral minus_pCons 
            order_power_n_n order_uminus power_one_right<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">a</span>  <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> root.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rsquarefree <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def <span class="keyword1"><span class="command">using</span></span> gr_implies_not0 less_not_refl2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" proots_within <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="free">s</span> <span class="main">∩</span> proots_within <span class="skolem">p</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> proots_within_pCons_1_iff<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomials-rsquarefree_gcd_pderiv"><span class="command">lemma</span></span> rsquarefree_gcd_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>factorial_ring_gcd<span class="main">,</span>semiring_gcd_mult_normalize<span class="main">,</span>semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>unit_factor <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">using</span></span> unit_factor_is_unit<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms dvd_trans order_decomp poly_eq_0_iff_dvd unit_factor_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">(</span>unit_factor <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> order_0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms dvd_div_eq_0_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> order_pq<span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="free">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="skolem">q</span> <span class="main">+</span> min <span class="main">(</span>order <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>order <span class="skolem">x</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_mult order_gcd<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> order <span class="skolem">x</span> <span class="skolem">q</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> order_pderiv<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="free">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> order_pq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> order_pq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def q_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomials-poly_gcd_pderiv_iff"><span class="command">lemma</span></span> poly_gcd_pderiv_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_char_0<span class="main">,</span>factorial_ring_gcd<span class="main">,</span>semiring_gcd_mult_normalize<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pderiv_iszero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_factor_poly_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pderiv_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> dvd_div_eq_0_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> order_pq<span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="free">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="skolem">q</span> <span class="main">+</span> min <span class="main">(</span>order <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>order <span class="skolem">x</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_mult order_gcd<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="skolem">q</span> <span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> order <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> order_pderiv<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> order <span class="free">x</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> order_pq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> order_pq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹order <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> order_root <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Composition of a polynomial and a circular path›</span></span>

<span class="keyword1" id="More_Polynomials-poly_circlepath_tan_eq"><span class="command">lemma</span></span> poly_circlepath_tan_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z0</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span><span class="main">≡</span> fcompose <span class="free">p</span> <span class="main">[:</span><span class="main">(</span><span class="free">z0</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">≡</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">≠</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span>circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="free">q1</span> <span class="main">(</span>tan <span class="main">(</span>pi<span class="main">*</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> poly <span class="free">q2</span> <span class="main">(</span>tan <span class="main">(</span>pi<span class="main">*</span><span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">z0</span><span class="main">+</span> <span class="free">r</span><span class="main">*</span>exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span>  <span class="main">*</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> circlepath <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">z0</span> <span class="main">+</span> <span class="free">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> poly <span class="free">q1</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="skolem">t</span>"</span></span> 
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">t</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">z0</span> <span class="main">+</span> <span class="free">r</span> <span class="main">*</span> <span class="main">(</span>cos <span class="skolem">t</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> sin <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> "</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> f_def exp_Euler  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_of_real sin_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="main">(</span><span class="free">z0</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tan <span class="main">(</span><span class="skolem">t</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">=</span>complex_of_real <span class="main">(</span>tan <span class="main">(</span><span class="skolem">t</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> complex_of_real <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">tt</span><span class="main">*</span><span class="skolem">tt</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">tt</span> <span class="main">*</span> <span class="skolem">tt</span><span class="main">)</span>"</span></span> 
             <span class="quoted"><span class="quoted">"sin <span class="skolem">t</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">tt</span>  <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">tt</span> <span class="main">*</span> <span class="skolem">tt</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sin_tan_half<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> cos_tan_half<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">,</span><span class="operator">OF</span> that<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> tt_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">tt</span> <span class="main">*</span> <span class="skolem">tt</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tt_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> of_real_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> mult_numeral_1 numeral_One of_real_add of_real_eq_0_iff
              of_real_numeral sum_squares_eq_zero_iff zero_neq_one<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z0</span> <span class="main">+</span>  <span class="free">r</span> <span class="main">*</span> <span class="main">(</span> <span class="main">(</span>cos <span class="skolem">t</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>
            <span class="main">=</span><span class="main">(</span><span class="free">z0</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">tt</span><span class="main">*</span><span class="skolem">tt</span><span class="main">)</span><span class="main">+</span><span class="skolem">rr</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">tt</span><span class="main">*</span><span class="skolem">tt</span><span class="main">)</span><span class="main">+</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="skolem">rr</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">tt</span> <span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">tt</span> <span class="main">*</span> <span class="skolem">tt</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> rr_def<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add_divide_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="skolem">rr</span><span class="main">)</span><span class="main">*</span><span class="skolem">tt</span><span class="main">+</span><span class="free">z0</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">+</span><span class="skolem">rr</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">tt</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> <span class="skolem">tt</span> <span class="main">*</span> <span class="skolem">tt</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i_squared neg_eq_iff_add_eq_0 square_eq_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> <span class="skolem">tt</span> <span class="main">*</span> <span class="skolem">tt</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z0</span> <span class="main">+</span>  <span class="free">r</span> <span class="main">*</span> <span class="main">(</span> <span class="main">(</span>cos <span class="skolem">t</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="skolem">rr</span><span class="main">)</span><span class="main">*</span><span class="skolem">tt</span><span class="main">+</span><span class="free">z0</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">+</span><span class="skolem">rr</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">tt</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tt_def rr_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="main">(</span><span class="free">z0</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>tan_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> poly <span class="free">q1</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">q2</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> q2_def q1_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> fcompose_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_complex_of_real add_cancel_right_left complex_i_not_zero imaginary_unit.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_complex.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rcis_zero_arg rcis_zero_mod<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>tan_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>pi <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cos_zero_iff_int2
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> pi <span class="main">*</span> <span class="free">t</span> <span class="main">=</span> real_of_int <span class="bound">i</span> <span class="main">*</span> pi <span class="main">+</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"pi <span class="main">*</span> <span class="free">t</span> <span class="main">=</span> real_of_int <span class="skolem">i</span> <span class="main">*</span> pi <span class="main">+</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pi <span class="main">*</span> <span class="free">t</span><span class="main">=</span>pi <span class="main">*</span> <span class="main">(</span>real_of_int <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">=</span>real_of_int <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">≤</span><span class="free">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">≤</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span><span class="main">≠</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> f_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">t</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">OF</span> this<span class="main">]</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Count_Complex_Roots">
<div class="head">
<h1>Theory Count_Complex_Roots</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Procedures to count the number of complex roots›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Count_Complex_Roots <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Winding_Number_Eval/Winding_Number_Eval.html">Winding_Number_Eval.Winding_Number_Eval</a> 
  <a href="Extended_Sturm.html">Extended_Sturm</a>
  <a href="More_Polynomials.html">More_Polynomials</a>
  <a href="../Budan_Fourier/Sturm_Multiple_Roots.html">Budan_Fourier.Sturm_Multiple_Roots</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>
    
<span class="comment1">(*refined version of the library one with the same name by dropping unnecessary assumptions*)</span> 
<span class="keyword1"><span class="command">corollary</span></span> path_image_part_circlepath_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≥</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_image<span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="main">⊆</span> sphere <span class="free">z</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">≤</span><span class="free">tt</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms path_image_part_circlepath sphere_def dist_norm <span class="dynamic"><span class="dynamic">algebra_simps</span></span> norm_mult<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image<span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">tt</span> <span class="free">st</span><span class="main">)</span> <span class="main">⊆</span> sphere <span class="free">z</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms path_image_part_circlepath sphere_def dist_norm <span class="dynamic"><span class="dynamic">algebra_simps</span></span> norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image<span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">tt</span> <span class="free">st</span><span class="main">)</span> <span class="main">=</span> path_image<span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_image_reversepath <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*refined version of the library one with the same name by dropping unnecessary assumptions*)</span>
<span class="keyword1"><span class="command">proposition</span></span> in_path_image_part_circlepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> path_image<span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm<span class="main">(</span><span class="free">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">c</span><span class="main">.</span> dist <span class="free">z</span> <span class="bound">c</span> <span class="main">=</span> <span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> path_image_part_circlepath_subset sphere_def subset_eq assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_minus_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="Count_Complex_Roots-infinite_ball"><span class="command">lemma</span></span> infinite_ball<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>ball <span class="free">a</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> uncountable_ball<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">THEN</span> uncountable_infinite<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Count_Complex_Roots-infinite_cball"><span class="command">lemma</span></span> infinite_cball<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>cball <span class="free">a</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> uncountable_cball<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">THEN</span> uncountable_infinite<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="comment1">(*FIXME: to generalise*)</span>
<span class="keyword1" id="Count_Complex_Roots-infinite_sphere"><span class="command">lemma</span></span> infinite_sphere<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>sphere <span class="free">a</span> <span class="free">r</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uncountable <span class="main">(</span>path_image <span class="main">(</span>circlepath <span class="free">a</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> simple_path_image_uncountable<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> simple_path_circlepath assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uncountable <span class="main">(</span>sphere <span class="free">a</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> uncountable_infinite<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-infinite_halfspace_Im_gt"><span class="command">lemma</span></span> infinite_halfspace_Im_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> connected_uncountable<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> uncountable_infinite<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="keyword1">𝗂</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>convex_connected <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> convex_halfspace_Im_gt<span class="main">)</span>
       
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_1<span class="main">)</span> Ints_minus2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ints_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Count_Complex_Roots-dvd_divide_Ints_iff"><span class="command">lemma</span></span> dvd_divide_Ints_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> of_int <span class="free">a</span> <span class="main">/</span> of_int <span class="free">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">ℤ</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>ring_char_0<span class="main">}</span> set<span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int <span class="free">a</span> <span class="main">/</span> of_int <span class="free">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">ℤ</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>ring_char_0<span class="main">}</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">a</span> <span class="main">/</span> of_int <span class="free">b</span> <span class="main">∈</span> <span class="main">(</span><span class="main">ℤ</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>ring_char_0<span class="main">}</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> Ints_cases<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>of_int<span class="main">::</span><span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="skolem">c</span><span class="main">=</span> of_int <span class="free">a</span> <span class="main">/</span> of_int <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int<span class="main">::</span><span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> of_int <span class="free">b</span> <span class="main">*</span> of_int <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> of_int_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1" id="Count_Complex_Roots-of_int_div_field"><span class="command">lemma</span></span> of_int_div_field<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int<span class="main">::</span><span class="main">_</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">::</span>field_char_0<span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> of_int <span class="free">n</span> <span class="main">/</span> of_int <span class="free">d</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dvd_mult_div_cancel<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Count_Complex_Roots-powr_eq_1_iff"><span class="command">lemma</span></span> powr_eq_1_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">b</span> <span class="main">=</span><span class="main">1</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="main">1</span> <span class="main">∨</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">powr</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> ln <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="keyword1">powr</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>›</span></span> ln_powr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> ln <span class="free">a</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Count_Complex_Roots-tan_inj_pi"><span class="command">lemma</span></span> tan_inj_pi<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> <span class="main">-</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">&lt;</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> tan <span class="free">x</span> <span class="main">=</span> tan <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arctan_tan<span class="main">)</span>

<span class="comment1">(*TODO: can we avoid fcompose in the proof?*)</span>
<span class="keyword1" id="Count_Complex_Roots-finite_ReZ_segments_poly_circlepath"><span class="command">lemma</span></span> finite_ReZ_segments_poly_circlepath<span class="main">:</span>
          <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>Re <span class="main">∘</span> poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>circlepath<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="main">∘</span> poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span><span class="main">─</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">→</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_le 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> dist_real_def abs_diff_le_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>True<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> comp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LIM_unique continuous_within<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> finite_ReZ_segments_constI<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> finite_ReZ_segments_congE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
   <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span><span class="main">=</span>fcompose <span class="free">p</span> <span class="main">[:</span><span class="main">(</span><span class="free">z0</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                      <span class="quoted"><span class="quoted">"<span class="skolem">q2</span><span class="main">=</span><span class="main">(</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> degree <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q1R</span></span> <span class="skolem"><span class="skolem">q1I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1R</span><span class="main">=</span>map_poly Re <span class="skolem">q1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1I</span><span class="main">=</span>map_poly Im <span class="skolem">q1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q2R</span></span> <span class="skolem"><span class="skolem">q2I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2R</span><span class="main">=</span>map_poly Re <span class="skolem">q2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2I</span><span class="main">=</span>map_poly Im <span class="skolem">q2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span><span class="main">=</span><span class="skolem">q1R</span><span class="main">*</span><span class="skolem">q2R</span> <span class="main">+</span> <span class="skolem">q1I</span><span class="main">*</span><span class="skolem">q2I</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> poly_eq<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">qq</span> <span class="main">(</span>tan <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≠</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">=</span>tan <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> Re <span class="main">(</span>poly <span class="skolem">q1</span> <span class="skolem">tt</span> <span class="main">/</span> poly <span class="skolem">q2</span> <span class="skolem">tt</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> comp_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_circlepath_tan_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">z0</span></span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> q1_def q2_def tt_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> poly <span class="skolem">q1R</span> <span class="skolem">tt</span> <span class="main">*</span> poly <span class="skolem">q2R</span> <span class="skolem">tt</span> <span class="main">+</span> poly <span class="skolem">q1I</span> <span class="skolem">tt</span> <span class="main">*</span> poly <span class="skolem">q2I</span> <span class="skolem">tt</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> q1I_def q1R_def q2R_def q2I_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Re_complex_div_eq_0 Re_poly_of_real Im_poly_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> poly <span class="skolem">qq</span> <span class="skolem">tt</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tt_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">::</span>real set<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="bound"><span class="bound">t</span></span><span class="main">∈</span><span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">qq</span> <span class="main">(</span>tan <span class="main">(</span>pi <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≠</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span><span class="main">{</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> tan <span class="main">(</span>pi <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>  <span class="main">-`</span>  <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">qq</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span> <span class="main">∩</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_vimage_IntI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"tan <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> tan <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span><span class="main">=</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span><span class="main">&lt;</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">=</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span><span class="main">&lt;</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span><span class="main">*</span>pi <span class="main">=</span> <span class="skolem">y'</span><span class="main">*</span>pi"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tan_inj_pi<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> x'_def y'_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x'</span>  <span class="main">*</span> pi"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span>  <span class="main">*</span> pi <span class="main">&lt;</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">y'</span>  <span class="main">*</span> pi"</span></span> 
                  <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">*</span>pi <span class="main">&lt;</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> mult_strict_right_mono<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted">pi</span><span class="main">]</span> 
                    mult_strict_right_mono<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted">pi</span><span class="main">]</span> 
                    mult_strict_right_mono<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted">pi</span><span class="main">]</span> 
                    mult_strict_right_mono<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted">pi</span><span class="main">]</span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="main">(</span><span class="skolem">x'</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> tan <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> x'_def <span class="keyword1"><span class="command">using</span></span> tan_periodic_int<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> tan <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹tan <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> tan <span class="main">(</span>pi <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> tan <span class="main">(</span><span class="skolem">y'</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> y'_def <span class="keyword1"><span class="command">using</span></span> tan_periodic_int<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tan <span class="main">(</span><span class="skolem">x'</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> tan <span class="main">(</span><span class="skolem">y'</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span><span class="main">=</span><span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> x'_def y'_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> tan <span class="main">(</span>pi <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">qq</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> circlepath <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">qq</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> rev_finite_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>A_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">qq</span> <span class="main">(</span>tan <span class="main">(</span>pi <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≠</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> S_def P_def A_def <span class="keyword1"><span class="command">using</span></span> poly_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">S</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">P</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">P</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">P</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">P</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">P</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">P</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">t</span></span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> S_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_divide_eq_numeral1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_neq_numeral<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> finite_imp_finite_ReZ_segments<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Some useful conformal/<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">bij_betw</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> properties›</span></span>

<span class="keyword1" id="Count_Complex_Roots-bij_betw_plane_ball"><span class="command">lemma</span></span> bij_betw_plane_ball<span class="main">:</span><span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="keyword1">𝗂</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">using</span></span> that 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_same_cancel2 add_uminus_conv_diff diff_0 diff_add_cancel 
        imaginary_unit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_one_less_zero uminus_complex.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Im <span class="skolem">x</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> cmod <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> norm_lt inner_complex_def <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> norm_divide <span class="keyword1"><span class="command">using</span></span> neq<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_mod_triangle_sub norm_one norm_zero not_le pth_7<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> complex_i_not_zero div_mult_self4 mult_2 
            mult_zero_right nonzero_mult_div_cancel_left nonzero_mult_div_cancel_right 
            one_add_one zero_neq_numeral<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>        
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Im_complex_div_gt_0 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> cmod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> ball <span class="main">0</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Count_Complex_Roots-bij_betw_axis_sphere"><span class="command">lemma</span></span> bij_betw_axis_sphere<span class="main">:</span><span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="keyword1">𝗂</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">using</span></span> that 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' imaginary_unit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> minus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
         right_minus_eq zero_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_neq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> cmod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> norm_divide <span class="keyword1"><span class="command">using</span></span> neq<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neq<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> complex_i_not_zero div_mult_self4 mult_2 
            mult_zero_right nonzero_mult_div_cancel_left nonzero_mult_div_cancel_right 
            one_add_one zero_neq_numeral<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>        
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> Im_complex_div_eq_0<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> cmod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> sphere <span class="main">0</span> <span class="main">1</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-bij_betw_ball_uball"><span class="command">lemma</span></span> bij_betw_ball_uball<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="free">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>ball <span class="free">z0</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="free">r</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">z0</span> <span class="main">(</span>complex_of_real <span class="free">r</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dist_norm norm_mult abs_of_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="free">r</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">`</span> ball <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">z0</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span><span class="main">/</span><span class="free">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_divide norm_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="free">r</span>  <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">`</span> ball <span class="main">0</span> <span class="main">1</span> <span class="main">=</span> ball <span class="free">z0</span> <span class="free">r</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-bij_betw_sphere_usphere"><span class="command">lemma</span></span> bij_betw_sphere_usphere<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="free">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>sphere <span class="free">z0</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="free">r</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">z0</span> <span class="main">(</span>complex_of_real <span class="free">r</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dist_norm norm_mult abs_of_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="free">r</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">`</span> sphere <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">z0</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span><span class="main">/</span><span class="free">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm norm_divide norm_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="free">r</span>  <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">z0</span><span class="main">)</span> <span class="main">`</span> sphere <span class="main">0</span> <span class="main">1</span> <span class="main">=</span> sphere <span class="free">z0</span> <span class="free">r</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_ball_plane_eq"><span class="command">lemma</span></span> proots_ball_plane_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span><span class="main">≡</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span><span class="main">≡</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> proots_count <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> q1_def q2_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> proots_fcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">.</span> poly <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_same_cancel2 imaginary_unit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_one_less_zero 
          plus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV<span class="main">::</span>complex set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_UNIV_char_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> bij_betw_plane_ball <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Count_Complex_Roots-proots_sphere_axis_eq"><span class="command">lemma</span></span> proots_sphere_axis_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span><span class="main">≡</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span><span class="main">≡</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> proots_count <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> q1_def q2_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> proots_fcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">.</span> poly <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Complex_eq_0 plus_complex.code<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV<span class="main">::</span>complex set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_UNIV_char_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> bij_betw_axis_sphere <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Count_Complex_Roots-proots_card_ball_plane_eq"><span class="command">lemma</span></span> proots_card_ball_plane_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span><span class="main">≡</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span><span class="main">≡</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> q1_def q2_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> proots_card_fcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">.</span> poly <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_same_cancel2 imaginary_unit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_one_less_zero 
          plus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> bij_betw_plane_ball infinite_UNIV_char_0 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Count_Complex_Roots-proots_card_sphere_axis_eq"><span class="command">lemma</span></span> proots_card_sphere_axis_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span><span class="main">≡</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span><span class="main">≡</span><span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span>fcompose <span class="free">p</span> <span class="free">q1</span> <span class="free">q2</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> q1_def q2_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> proots_card_fcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">.</span> poly <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Complex_eq_0 plus_complex.code<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> bij_betw_axis_sphere infinite_UNIV_char_0 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Count_Complex_Roots-proots_uball_eq"><span class="command">lemma</span></span> proots_uball_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z0</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≡</span><span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">(</span>ball <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> proots_count <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_pcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> bij_betw_ball_uball<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">z0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_card_uball_eq"><span class="command">lemma</span></span> proots_card_uball_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z0</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≡</span><span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>ball <span class="free">z0</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>ball <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>ball <span class="main">(</span><span class="main">0</span><span class="main">::</span>complex<span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_ball<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">z0</span></span><span class="main">]</span> infinite_ball<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>complex"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_card_pcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> bij_betw_ball_uball<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">z0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_card_usphere_eq"><span class="command">lemma</span></span> proots_card_usphere_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z0</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">≡</span><span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>sphere <span class="free">z0</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>sphere <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>sphere <span class="main">(</span><span class="main">0</span><span class="main">::</span>complex<span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_sphere<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">z0</span></span><span class="main">]</span> infinite_sphere<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>complex"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_card_pcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> bij_betw_sphere_usphere<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">z0</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>sphere <span class="free">z0</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Combining two real polynomials into a complex one›</span></span>  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cpoly_of</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real poly <span class="main">⇒</span> complex poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cpoly_of</span> <span class="free"><span class="bound"><span class="entity">pR</span></span></span> <span class="free"><span class="bound"><span class="entity">pI</span></span></span> <span class="main">=</span> map_poly of_real <span class="free"><span class="bound"><span class="entity">pR</span></span></span> <span class="main">+</span> smult <span class="keyword1">𝗂</span> <span class="main">(</span>map_poly of_real <span class="free"><span class="bound"><span class="entity">pI</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Count_Complex_Roots-cpoly_of_eq_0_iff"><span class="command">lemma</span></span> cpoly_of_eq_0_iff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cpoly_of <span class="free">pR</span> <span class="free">pI</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">pR</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">pI</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">pR</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">pI</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cpoly_of <span class="free">pR</span> <span class="free">pI</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>coeff <span class="free">pR</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real <span class="main">(</span>coeff <span class="free">pI</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_iff cpoly_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>coeff_map_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">pR</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> coeff <span class="free">pI</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Complex_eq Im_complex_of_real Re_complex_of_real complex.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> complex.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          of_real_0<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>cpoly_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-cpoly_of_decompose"><span class="command">lemma</span></span> cpoly_of_decompose<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> cpoly_of <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cpoly_of_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_poly_pCons map_poly_map_poly complex_eq<span class="main">)</span>

<span class="keyword1" id="Count_Complex_Roots-cpoly_of_dist_right"><span class="command">lemma</span></span> cpoly_of_dist_right<span class="main">:</span>
    <span class="quoted"><span class="quoted">"cpoly_of <span class="main">(</span><span class="free">pR</span><span class="main">*</span><span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">pI</span><span class="main">*</span><span class="free">g</span><span class="main">)</span> <span class="main">=</span> cpoly_of <span class="free">pR</span> <span class="free">pI</span> <span class="main">*</span> <span class="main">(</span>map_poly of_real <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cpoly_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
  
<span class="keyword1" id="Count_Complex_Roots-poly_cpoly_of_real"><span class="command">lemma</span></span> poly_cpoly_of_real<span class="main">:</span>
    <span class="quoted"><span class="quoted">"poly <span class="main">(</span>cpoly_of <span class="free">pR</span> <span class="free">pI</span><span class="main">)</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Complex <span class="main">(</span>poly <span class="free">pR</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>poly <span class="free">pI</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cpoly_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Complex_eq of_real_poly_map_poly<span class="main">)</span>
    
<span class="keyword1" id="Count_Complex_Roots-poly_cpoly_of_real_iff"><span class="command">lemma</span></span> poly_cpoly_of_real_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>cpoly_of <span class="free">pR</span> <span class="free">pI</span><span class="main">)</span> <span class="main">(</span>of_real <span class="free">t</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> poly <span class="free">pR</span> <span class="free">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">pI</span> <span class="free">t</span><span class="main">=</span><span class="main">0</span> "</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span>  poly_cpoly_of_real <span class="keyword1"><span class="command">using</span></span> Complex_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  

<span class="keyword1" id="Count_Complex_Roots-order_cpoly_gcd_eq"><span class="command">lemma</span></span> order_cpoly_gcd_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">pR</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="free">pI</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="free">t</span> <span class="main">(</span>cpoly_of <span class="free">pR</span> <span class="free">pI</span><span class="main">)</span> <span class="main">=</span> order <span class="free">t</span> <span class="main">(</span>gcd <span class="free">pR</span> <span class="free">pI</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> gcd <span class="free">pR</span> <span class="free">pI</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pr</span></span> <span class="skolem"><span class="skolem">pi</span></span> <span class="keyword2"><span class="keyword">where</span></span> pri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pR</span> <span class="main">=</span> <span class="skolem">pr</span> <span class="main">*</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pI</span> <span class="main">=</span> <span class="skolem">pi</span> <span class="main">*</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">pr</span> <span class="skolem">pi</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> gcd_coprime_exists <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pr</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">pi</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms mult_zero_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">t</span> <span class="main">(</span>cpoly_of <span class="free">pR</span> <span class="free">pI</span><span class="main">)</span> <span class="main">=</span> order <span class="free">t</span> <span class="main">(</span>cpoly_of <span class="skolem">pr</span> <span class="skolem">pi</span> <span class="main">*</span> <span class="main">(</span>map_poly of_real <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pri cpoly_of_dist_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> order <span class="free">t</span> <span class="main">(</span>cpoly_of <span class="skolem">pr</span> <span class="skolem">pi</span><span class="main">)</span> <span class="main">+</span> order <span class="free">t</span> <span class="skolem">g</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pr</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">pi</span> <span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>map_poly_order_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> order <span class="free">t</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>cpoly_of <span class="skolem">pr</span> <span class="skolem">pi</span><span class="main">)</span> <span class="free">t</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_cpoly_of_real_iff
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">pr</span> <span class="skolem">pi</span>›</span></span> coprime_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">t</span> <span class="main">(</span>cpoly_of <span class="skolem">pr</span> <span class="skolem">pi</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Number of roots on a (bounded or unbounded) segment›</span></span>

<span class="comment1">― ‹1 dimensional hyperplane›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unbounded_line</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">unbounded_line</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="bound">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_line_card</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_line_card</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">tt</span></span></span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>open_segment <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">tt</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_unbounded_line_card</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_unbounded_line_card</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">tt</span></span></span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>unbounded_line <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">tt</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_unbounded_line</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_unbounded_line</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">tt</span></span></span> <span class="main">=</span> proots_count <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>unbounded_line <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">tt</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Count_Complex_Roots-card_proots_open_segments"><span class="command">lemma</span></span> card_proots_open_segments<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">st</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">tt</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>open_segment <span class="free">st</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span><span class="main">;</span>
                     <span class="bound">pR</span> <span class="main">=</span> map_poly Re <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">pI</span> <span class="main">=</span> map_poly Im <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">g</span>  <span class="main">=</span> gcd <span class="bound">pR</span> <span class="bound">pI</span>
                 <span class="keyword1">in</span> changes_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pc</span></span> <span class="skolem"><span class="skolem">pR</span></span> <span class="skolem"><span class="skolem">pI</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span><span class="main">-</span><span class="free">st</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">pR</span> <span class="main">=</span> map_poly Re <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">pI</span> <span class="main">=</span> map_poly Im <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">g</span>  <span class="main">=</span> gcd <span class="skolem">pR</span> <span class="skolem">pI</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> poly_iff<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">pc</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">pR</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">pI</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> poly_gcd_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> poly <span class="skolem">pc</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cpoly_of <span class="skolem">pR</span> <span class="skolem">pI</span> <span class="main">=</span> <span class="skolem">pc</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pc_def pR_def pI_def <span class="keyword1"><span class="command">using</span></span> cpoly_of_decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_cpoly_of_real_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>      

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> changes_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pc_def g_def pI_def pR_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">g</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> poly_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> pc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> poly_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> pc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sturm_interval<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> poly <span class="skolem">pc</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">=</span><span class="free">tt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pc_def poly_pcompose <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">tt</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="free">st</span> <span class="main">+</span> <span class="bound">t</span><span class="main">*</span><span class="main">(</span><span class="free">tt</span><span class="main">-</span><span class="free">st</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ll</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ll</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">pc</span> <span class="main">(</span>complex_of_real <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">`</span> <span class="skolem">ll</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="main">(</span>open_segment <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">`</span> <span class="skolem">ll</span> <span class="main">⊆</span> proots_within <span class="free">p</span> <span class="main">(</span>open_segment <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ll_def ff_def pc_def poly_pcompose 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_segment False scaleR_conv_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">(</span>open_segment <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="free">p</span> <span class="main">(</span>open_segment <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">st</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">tt</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_segment<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">st</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ll_def pc_def poly_pcompose 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scaleR_conv_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ff</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="skolem">ll</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">ff</span> <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> False inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def 
      <span class="keyword1"><span class="command">using</span></span> card_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ff</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-unbounded_line_closed_segment"><span class="command">lemma</span></span> unbounded_line_closed_segment<span class="main">:</span> <span class="quoted"><span class="quoted">"closed_segment <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> unbounded_line <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> unbounded_line_def closed_segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Count_Complex_Roots-card_proots_unbounded_line"><span class="command">lemma</span></span> card_proots_unbounded_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">≠</span><span class="free">tt</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>unbounded_line <span class="free">st</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span><span class="main">;</span>
                     <span class="bound">pR</span> <span class="main">=</span> map_poly Re <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">pI</span> <span class="main">=</span> map_poly Im <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">g</span>  <span class="main">=</span> gcd <span class="bound">pR</span> <span class="bound">pI</span>
                 <span class="keyword1">in</span> nat <span class="main">(</span>changes_R_smods <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pc</span></span> <span class="skolem"><span class="skolem">pR</span></span> <span class="skolem"><span class="skolem">pI</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span><span class="main">-</span><span class="free">st</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">pR</span> <span class="main">=</span> map_poly Re <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">pI</span> <span class="main">=</span> map_poly Im <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">g</span>  <span class="main">=</span> gcd <span class="skolem">pR</span> <span class="skolem">pI</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> poly_iff<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">pc</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">pR</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">pI</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> poly_gcd_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> poly <span class="skolem">pc</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cpoly_of <span class="skolem">pR</span> <span class="skolem">pI</span> <span class="main">=</span> <span class="skolem">pc</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pc_def pR_def pI_def <span class="keyword1"><span class="command">using</span></span> cpoly_of_decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_cpoly_of_real_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>      

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> nat <span class="main">(</span>changes_R_smods <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pc_def g_def pI_def pR_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">g</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sturm_R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> poly <span class="skolem">pc</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">=</span><span class="free">tt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pc_def poly_pcompose unbounded_line_def <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_within_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="free">st</span> <span class="main">+</span> <span class="bound">t</span><span class="main">*</span><span class="main">(</span><span class="free">tt</span><span class="main">-</span><span class="free">st</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ll</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ll</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">pc</span> <span class="main">(</span>complex_of_real <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">`</span> <span class="skolem">ll</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="main">(</span>unbounded_line <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">`</span> <span class="skolem">ll</span> <span class="main">⊆</span> proots_within <span class="free">p</span> <span class="main">(</span>unbounded_line <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ll_def ff_def pc_def poly_pcompose 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unbounded_line_def False scaleR_conv_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">(</span>unbounded_line <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="free">p</span> <span class="main">(</span>unbounded_line <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">st</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">tt</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unbounded_line_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">st</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ll_def pc_def poly_pcompose 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scaleR_conv_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span> unbounded_line_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ff</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">ff</span> <span class="main">`</span> <span class="skolem">ll</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">ff</span> <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ff_def <span class="keyword1"><span class="command">using</span></span> False inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def 
      <span class="keyword1"><span class="command">using</span></span> card_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ff</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_unbounded_line"><span class="command">lemma</span></span> proots_unbounded_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">≠</span><span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>proots_count <span class="free">p</span> <span class="main">(</span>unbounded_line <span class="free">st</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span><span class="main">;</span>
                     <span class="bound">pR</span> <span class="main">=</span> map_poly Re <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">pI</span> <span class="main">=</span> map_poly Im <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">g</span>  <span class="main">=</span> gcd <span class="bound">pR</span> <span class="bound">pI</span>
                 <span class="keyword1">in</span> nat <span class="main">(</span>changes_R_smods_ext <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pc</span></span> <span class="skolem"><span class="skolem">pR</span></span> <span class="skolem"><span class="skolem">pI</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span><span class="main">-</span><span class="free">st</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">pR</span> <span class="main">=</span> map_poly Re <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">pI</span> <span class="main">=</span> map_poly Im <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">g</span>  <span class="main">=</span> gcd <span class="skolem">pR</span> <span class="skolem">pI</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pc</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pc</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> pc_def pcompose_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">pI</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pR_def pI_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpoly_of_decompose map_poly_0<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> order_eq<span class="main">:</span><span class="quoted"><span class="quoted">"order <span class="skolem">t</span> <span class="skolem">g</span> <span class="main">=</span> order <span class="skolem">t</span> <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_cpoly_gcd_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">pR</span></span> <span class="quoted"><span class="skolem">pI</span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> g_def<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pR_def pI_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cpoly_of_decompose<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> nat <span class="main">(</span>changes_R_smods_ext <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pc_def g_def pI_def pR_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="skolem">g</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sturm_ext_R<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="main">(</span>map_poly complex_of_real <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>of_real <span class="main">`</span> UNIV<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="main">(</span>map_poly complex_of_real <span class="skolem">g</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">proots_count</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Reals_def complex_is_Real_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="skolem">pc</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_count_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Im_complex_of_real Re_complex_of_real <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> complex_surj 
            map_poly_order_of_real mem_Collect_eq order_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">(</span>unbounded_line <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> unbounded_line <span class="free">st</span> <span class="free">tt</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> unbounded_line_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> _ x 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute scaleR_complex.code times_complex.code<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> _ u
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">u</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>scaleR_conv_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> pc_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">≠</span><span class="free">tt</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_unbounded_line_card_code"><span class="command">lemma</span></span> proots_unbounded_line_card_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_unbounded_line_card <span class="free">p</span> <span class="free">st</span> <span class="free">tt</span> <span class="main">=</span> 
              <span class="main">(</span><span class="keyword1">if</span> <span class="free">st</span><span class="main">≠</span><span class="free">tt</span> <span class="keyword1">then</span> 
                <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span><span class="main">;</span>
                     <span class="bound">pR</span> <span class="main">=</span> map_poly Re <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">pI</span> <span class="main">=</span> map_poly Im <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">g</span>  <span class="main">=</span> gcd <span class="bound">pR</span> <span class="bound">pI</span>
                 <span class="keyword1">in</span> nat <span class="main">(</span>changes_R_smods <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
              <span class="keyword1">else</span> 
                  Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_unbounded_line_card fails due to invalid hyperplanes.''</span><span class="main">)</span> 
                      <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_unbounded_line_card <span class="free">p</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_unbounded_line_card_def <span class="keyword1"><span class="command">using</span></span> card_proots_unbounded_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Count_Complex_Roots-proots_unbounded_line_code"><span class="command">lemma</span></span> proots_unbounded_line_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_unbounded_line <span class="free">p</span> <span class="free">st</span> <span class="free">tt</span> <span class="main">=</span> 
              <span class="main">(</span> <span class="keyword1">if</span> <span class="free">st</span><span class="main">≠</span><span class="free">tt</span> <span class="keyword1">then</span> 
                <span class="keyword1">if</span> <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="keyword1">then</span> 
                  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span><span class="main">;</span>
                     <span class="bound">pR</span> <span class="main">=</span> map_poly Re <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">pI</span> <span class="main">=</span> map_poly Im <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">g</span>  <span class="main">=</span> gcd <span class="bound">pR</span> <span class="bound">pI</span>
                  <span class="keyword1">in</span> nat <span class="main">(</span>changes_R_smods_ext <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="keyword1">else</span> 
                  Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_unbounded_line fails due to p=0''</span><span class="main">)</span> 
                      <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_unbounded_line <span class="free">p</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>
                <span class="keyword1">else</span> 
                  Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_unbounded_line fails due to invalid hyperplanes.''</span><span class="main">)</span> 
                      <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_unbounded_line <span class="free">p</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proots_unbounded_line_def <span class="keyword1"><span class="command">using</span></span> proots_unbounded_line <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Checking if there a polynomial root on a closed segment›</span></span>    
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">no_proots_line</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">no_proots_line</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">tt</span></span></span> <span class="main">=</span> <span class="main">(</span>proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>closed_segment <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">tt</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="comment1">(*TODO: the proof can probably be simplified using Lemma card_proots_open_segments*)</span>
<span class="keyword1" id="Count_Complex_Roots-no_proots_line_code"><span class="command">lemma</span></span> no_proots_line_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"no_proots_line <span class="free">p</span> <span class="free">st</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">st</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">tt</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> 
                <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span><span class="main">;</span>
                     <span class="bound">pR</span> <span class="main">=</span> map_poly Re <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">pI</span> <span class="main">=</span> map_poly Im <span class="bound">pc</span><span class="main">;</span>
                     <span class="bound">g</span>  <span class="main">=</span> gcd <span class="bound">pR</span> <span class="bound">pI</span>
                 <span class="keyword1">in</span> <span class="keyword1">if</span> changes_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> True <span class="keyword1">else</span> False<span class="main">)</span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">st</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">tt</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> no_proots_line_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">st</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">tt</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pc</span></span> <span class="skolem"><span class="skolem">pR</span></span> <span class="skolem"><span class="skolem">pI</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">pc</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span><span class="main">-</span><span class="free">st</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">pR</span> <span class="main">=</span> map_poly Re <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">pI</span> <span class="main">=</span> map_poly Im <span class="skolem">pc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">g</span>  <span class="main">=</span> gcd <span class="skolem">pR</span> <span class="skolem">pI</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> poly_iff<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">pc</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">pR</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span> <span class="main">∧</span> poly <span class="skolem">pI</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> poly_gcd_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> poly <span class="skolem">pc</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cpoly_of <span class="skolem">pR</span> <span class="skolem">pI</span> <span class="main">=</span> <span class="skolem">pc</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pc_def pR_def pI_def <span class="keyword1"><span class="command">using</span></span> cpoly_of_decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_cpoly_of_real_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> <span class="main">(</span>changes_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> pc_def g_def pI_def pR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span>      
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> poly_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> True <span class="keyword1"><span class="command">unfolding</span></span> pc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> poly_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> True <span class="keyword1"><span class="command">unfolding</span></span> pc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sturm_interval<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">pc</span> <span class="main">0</span> <span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> pc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">g</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> poly <span class="skolem">pc</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> closed_segment <span class="free">st</span> <span class="free">tt</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">pc</span> <span class="main">(</span>complex_of_real <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="skolem">pc</span> <span class="main">(</span>of_real <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>poly <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> closed_segment <span class="free">st</span> <span class="free">tt</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def in_segment
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> pc_def x_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> closed_segment <span class="free">st</span> <span class="free">tt</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> closed_segment <span class="free">st</span> <span class="free">tt</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> closed_segment <span class="free">st</span> <span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">st</span> <span class="main">+</span> <span class="skolem">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">tt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≤</span><span class="main">1</span>"</span></span>  
        <span class="keyword1"><span class="command">unfolding</span></span> in_segment <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>poly <span class="main">[:</span><span class="free">st</span><span class="main">,</span> <span class="free">tt</span> <span class="main">-</span> <span class="free">st</span><span class="main">:]</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">pc</span> <span class="main">(</span>complex_of_real <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≠</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True *  <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≤</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">pc</span> <span class="main">(</span>complex_of_real <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>        
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> no_proots_line_def proots_within_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Counting roots in a rectangle›</span></span>  
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_rectangle</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_rectangle</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">lb</span></span></span> <span class="free"><span class="bound"><span class="entity">ub</span></span></span> <span class="main">=</span> proots_count <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>box <span class="free"><span class="bound"><span class="entity">lb</span></span></span> <span class="free"><span class="bound"><span class="entity">ub</span></span></span><span class="main">)</span>"</span></span>  
  
<span class="keyword1" id="Count_Complex_Roots-closed_segment_imp_Re_Im"><span class="command">lemma</span></span> closed_segment_imp_Re_Im<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>closed_segment <span class="free">lb</span> <span class="free">ub</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span> <span class="main">⟹</span> Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">x</span> <span class="main">∧</span> Re <span class="free">x</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span> 
        <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span> <span class="main">⟹</span> Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">x</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_u<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">ub</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> closed_segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">ub</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_u <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Re <span class="main">(</span><span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">ub</span> <span class="main">-</span> <span class="free">lb</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Re <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≥</span> Re <span class="free">lb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">≥</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">=</span> Im <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">ub</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_u <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Im <span class="main">(</span><span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">ub</span> <span class="main">-</span> <span class="free">lb</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Im <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">*</span> <span class="main">(</span>Im <span class="free">ub</span> <span class="main">-</span> Im <span class="free">lb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≥</span> Im <span class="free">lb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">≥</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">ub</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_u <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">*</span> Re <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">ub</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">*</span> Re <span class="free">ub</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">≤</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Re <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">=</span> Im <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">ub</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_u <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> Im <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">*</span> Im <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> Im <span class="free">ub</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">*</span> Im <span class="free">ub</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">≤</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Im <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> 
      <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span> <span class="main">⟹</span> Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">x</span> <span class="main">∧</span> Re <span class="free">x</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span> 
      <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span> <span class="main">⟹</span> Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">x</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Count_Complex_Roots-closed_segment_degen_complex"><span class="command">lemma</span></span> closed_segment_degen_complex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Re <span class="free">lb</span> <span class="main">=</span> Re <span class="free">ub</span><span class="main">;</span> Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span> <span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> closed_segment <span class="free">lb</span> <span class="free">ub</span> <span class="main">⟷</span> Re <span class="free">x</span> <span class="main">=</span> Re <span class="free">lb</span> <span class="main">∧</span> Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">x</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">≤</span> Im <span class="free">ub</span> "</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Im <span class="free">lb</span> <span class="main">=</span> Im <span class="free">ub</span><span class="main">;</span> Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span> <span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> closed_segment <span class="free">lb</span> <span class="free">ub</span> <span class="main">⟷</span> Im <span class="free">x</span> <span class="main">=</span> Im <span class="free">lb</span> <span class="main">∧</span> Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">x</span> <span class="main">∧</span> Re <span class="free">x</span> <span class="main">≤</span> Re <span class="free">ub</span> "</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> closed_segment <span class="free">lb</span> <span class="free">ub</span> <span class="main">⟷</span> Re <span class="free">x</span> <span class="main">=</span> Re <span class="free">lb</span> <span class="main">∧</span> Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">x</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">=</span> Re <span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">=</span> Re <span class="free">lb</span> <span class="main">∧</span> Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">x</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> closed_segment <span class="free">lb</span> <span class="free">ub</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> closed_segment_imp_Re_Im<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">=</span> Re <span class="free">ub</span>›</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">=</span> Re <span class="free">lb</span> <span class="main">∧</span> Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">x</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">≤</span> Im <span class="free">ub</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="main">(</span>Im <span class="free">x</span> <span class="main">-</span> Im <span class="free">lb</span><span class="main">)</span><span class="main">/</span> <span class="main">(</span>Im <span class="free">ub</span> <span class="main">-</span> Im <span class="free">lb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">ub</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> asm <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">=</span> Re <span class="free">ub</span>›</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> complex_eqI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Im <span class="free">ub</span> <span class="main">-</span> Im <span class="free">lb</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">≤</span> Im <span class="free">ub</span>›</span></span> asm
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Im <span class="free">ub</span> <span class="main">-</span> Im <span class="free">lb</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> closed_segment <span class="free">lb</span> <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> closed_segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> closed_segment <span class="free">lb</span> <span class="free">ub</span> <span class="main">⟷</span> Im <span class="free">x</span> <span class="main">=</span> Im <span class="free">lb</span> <span class="main">∧</span> Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">x</span> <span class="main">∧</span> Re <span class="free">x</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">=</span> Im <span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">=</span> Im <span class="free">lb</span> <span class="main">∧</span> Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">x</span> <span class="main">∧</span> Re <span class="free">x</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> closed_segment <span class="free">lb</span> <span class="free">ub</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> closed_segment_imp_Re_Im<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">=</span> Im <span class="free">ub</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">=</span> Im <span class="free">lb</span> <span class="main">∧</span> Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">x</span> <span class="main">∧</span> Re <span class="free">x</span> <span class="main">≤</span> Re <span class="free">ub</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="main">(</span>Re <span class="free">x</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span><span class="main">/</span> <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">lb</span> <span class="main">+</span> <span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">ub</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> asm <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">=</span> Im <span class="free">ub</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> complex_eqI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">≤</span> Re <span class="free">ub</span>›</span></span> asm
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> closed_segment <span class="free">lb</span> <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> closed_segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>   
<span class="keyword1"><span class="command">qed</span></span>  
   
<span class="keyword1" id="Count_Complex_Roots-complex_box_ne_empty"><span class="command">lemma</span></span> complex_box_ne_empty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"cbox <span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">≤</span> Re <span class="free">b</span> <span class="main">∧</span> Im <span class="free">a</span> <span class="main">≤</span> Im <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"box <span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">&lt;</span> Re <span class="free">b</span> <span class="main">∧</span> Im <span class="free">a</span> <span class="main">&lt;</span> Im <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>box_ne_empty Basis_complex_def<span class="main">)</span>  
      
<span class="keyword1" id="Count_Complex_Roots-proots_rectangle_code1"><span class="command">lemma</span></span> proots_rectangle_code1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="free">ub</span> <span class="main">∧</span> Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="free">ub</span> <span class="keyword1">then</span> 
            <span class="keyword1">if</span> <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="keyword1">then</span> 
            <span class="keyword1">if</span> no_proots_line <span class="free">p</span> <span class="free">lb</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span> no_proots_line <span class="free">p</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span> <span class="free">ub</span>
            <span class="main">∧</span> no_proots_line <span class="free">p</span> <span class="free">ub</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span> no_proots_line <span class="free">p</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span> <span class="keyword1">then</span>  
            <span class="main">(</span>
            <span class="keyword1">let</span> <span class="bound">p1</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">lb</span><span class="main">,</span>  Complex <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span> <span class="main">0</span><span class="main">:]</span><span class="main">;</span>
                <span class="bound">pR1</span> <span class="main">=</span> map_poly Re <span class="bound">p1</span><span class="main">;</span> <span class="bound">pI1</span> <span class="main">=</span> map_poly Im <span class="bound">p1</span><span class="main">;</span> <span class="bound">gc1</span> <span class="main">=</span> gcd <span class="bound">pR1</span> <span class="bound">pI1</span><span class="main">;</span>
                <span class="bound">p2</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">(</span>Im <span class="free">ub</span> <span class="main">-</span> Im <span class="free">lb</span><span class="main">)</span><span class="main">:]</span><span class="main">;</span>
                <span class="bound">pR2</span> <span class="main">=</span> map_poly Re <span class="bound">p2</span><span class="main">;</span> <span class="bound">pI2</span> <span class="main">=</span> map_poly Im <span class="bound">p2</span><span class="main">;</span> <span class="bound">gc2</span> <span class="main">=</span> gcd <span class="bound">pR2</span> <span class="bound">pI2</span><span class="main">;</span>
                <span class="bound">p3</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">ub</span><span class="main">,</span> Complex <span class="main">(</span>Re <span class="free">lb</span> <span class="main">-</span> Re <span class="free">ub</span><span class="main">)</span> <span class="main">0</span><span class="main">:]</span><span class="main">;</span>
                <span class="bound">pR3</span> <span class="main">=</span> map_poly Re <span class="bound">p3</span><span class="main">;</span> <span class="bound">pI3</span> <span class="main">=</span> map_poly Im <span class="bound">p3</span><span class="main">;</span> <span class="bound">gc3</span> <span class="main">=</span> gcd <span class="bound">pR3</span> <span class="bound">pI3</span><span class="main">;</span>
                <span class="bound">p4</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">(</span>Im <span class="free">lb</span> <span class="main">-</span> Im <span class="free">ub</span><span class="main">)</span><span class="main">:]</span><span class="main">;</span>
                <span class="bound">pR4</span> <span class="main">=</span> map_poly Re <span class="bound">p4</span><span class="main">;</span> <span class="bound">pI4</span> <span class="main">=</span> map_poly Im <span class="bound">p4</span><span class="main">;</span> <span class="bound">gc4</span> <span class="main">=</span> gcd <span class="bound">pR4</span> <span class="bound">pI4</span>
            <span class="keyword1">in</span> 
              nat <span class="main">(</span><span class="main">-</span> <span class="main">(</span>changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="bound">pR1</span> <span class="keyword1">div</span> <span class="bound">gc1</span><span class="main">)</span> <span class="main">(</span><span class="bound">pI1</span> <span class="keyword1">div</span> <span class="bound">gc1</span><span class="main">)</span>
                <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="bound">pR2</span> <span class="keyword1">div</span> <span class="bound">gc2</span><span class="main">)</span> <span class="main">(</span><span class="bound">pI2</span> <span class="keyword1">div</span> <span class="bound">gc2</span><span class="main">)</span>
                <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="bound">pR3</span> <span class="keyword1">div</span> <span class="bound">gc3</span><span class="main">)</span> <span class="main">(</span><span class="bound">pI3</span> <span class="keyword1">div</span> <span class="bound">gc3</span><span class="main">)</span>
                <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="bound">pR4</span> <span class="keyword1">div</span> <span class="bound">gc4</span><span class="main">)</span> <span class="main">(</span><span class="bound">pI4</span> <span class="keyword1">div</span> <span class="bound">gc4</span><span class="main">)</span><span class="main">)</span>  <span class="keyword1">div</span> <span class="numeral">4</span><span class="main">)</span>
            <span class="main">)</span>
            <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_rectangle fails when there is a root on the border.''</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span>
            <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_rectangle fails when p=0.''</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="free">ub</span> <span class="main">∧</span> Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="free">ub</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"box <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> complex_box_ne_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">lb</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ub</span></span></span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_rectangle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>that<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="free">ub</span> <span class="main">∧</span> Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span>     
            <span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> no_proots<span class="main">:</span>
            <span class="quoted"><span class="quoted">"no_proots_line <span class="free">p</span> <span class="free">lb</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"no_proots_line <span class="free">p</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span> <span class="free">ub</span>"</span></span>
            <span class="quoted"><span class="quoted">"no_proots_line <span class="free">p</span> <span class="free">ub</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"no_proots_line <span class="free">p</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">=</span> linepath <span class="free">lb</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">=</span> linepath <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span> <span class="free">ub</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l3</span> <span class="main">=</span> linepath <span class="free">ub</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l4</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l4</span> <span class="main">=</span> linepath <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rec</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rec</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">+++</span> <span class="skolem">l2</span> <span class="main">+++</span> <span class="skolem">l3</span> <span class="main">+++</span> <span class="skolem">l4</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> valid<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="skolem">rec</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> loop<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"pathfinish <span class="skolem">rec</span> <span class="main">=</span> pathstart <span class="skolem">rec</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rec_def l1_def l2_def l3_def l4_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> path_no_proots<span class="main">:</span><span class="quoted"><span class="quoted">"path_image <span class="skolem">rec</span> <span class="main">∩</span> proots <span class="free">p</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> rec_def l1_def l2_def l3_def l4_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> path_image_join<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>Complex_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>  
      <span class="keyword1"><span class="command">using</span></span> no_proots<span class="main">[</span><span class="operator">unfolded</span> no_proots_line_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>Complex_eq<span class="main">)</span>
    
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">=</span> poly <span class="free">p</span> <span class="keyword1">o</span> <span class="skolem">l1</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">=</span> poly <span class="free">p</span> <span class="keyword1">o</span> <span class="skolem">l2</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g3</span> <span class="main">=</span> poly <span class="free">p</span> <span class="keyword1">o</span> <span class="skolem">l3</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g4</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g4</span> <span class="main">=</span> poly <span class="free">p</span> <span class="keyword1">o</span> <span class="skolem">l4</span>"</span></span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">g1</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g2</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g3</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g4</span>"</span></span>
      <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">g1</span> <span class="main">=</span> pathstart <span class="skolem">g2</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">g2</span> <span class="main">=</span> pathstart <span class="skolem">g3</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">g3</span> <span class="main">=</span> pathstart <span class="skolem">g4</span>"</span></span>
      <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">g4</span> <span class="main">=</span> pathstart <span class="skolem">g1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g1_def g2_def g3_def g4_def l1_def l2_def l3_def l4_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> path_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span> 
          <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pathfinish_compose pathstart_compose<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="skolem">g1</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="skolem">g2</span> <span class="main">0</span>"</span></span> 
         <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="skolem">g3</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="skolem">g4</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g1_def l1_def g2_def l2_def g3_def l3_def g4_def l4_def poly_linepath_comp 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_ReZ_segments_poly_of_real<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">pR1</span></span> <span class="skolem"><span class="skolem">pI1</span></span> <span class="skolem"><span class="skolem">gc1</span></span>
           <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">pR2</span></span> <span class="skolem"><span class="skolem">pI2</span></span> <span class="skolem"><span class="skolem">gc2</span></span>
           <span class="skolem"><span class="skolem">p3</span></span> <span class="skolem"><span class="skolem">pR3</span></span> <span class="skolem"><span class="skolem">pI3</span></span> <span class="skolem"><span class="skolem">gc3</span></span>
           <span class="skolem"><span class="skolem">p4</span></span> <span class="skolem"><span class="skolem">pR4</span></span> <span class="skolem"><span class="skolem">pI4</span></span> <span class="skolem"><span class="skolem">gc4</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">lb</span><span class="main">,</span>  Complex <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span> <span class="main">0</span><span class="main">:]</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR1</span> <span class="main">=</span> map_poly Re <span class="skolem">p1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI1</span> <span class="main">=</span> map_poly Im <span class="skolem">p1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc1</span> <span class="main">=</span> gcd <span class="skolem">pR1</span> <span class="skolem">pI1</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">(</span>Im <span class="free">ub</span> <span class="main">-</span> Im <span class="free">lb</span><span class="main">)</span><span class="main">:]</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR2</span> <span class="main">=</span> map_poly Re <span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI2</span> <span class="main">=</span> map_poly Im <span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc2</span> <span class="main">=</span> gcd <span class="skolem">pR2</span> <span class="skolem">pI2</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p3</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">ub</span><span class="main">,</span> Complex <span class="main">(</span>Re <span class="free">lb</span> <span class="main">-</span> Re <span class="free">ub</span><span class="main">)</span> <span class="main">0</span><span class="main">:]</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR3</span> <span class="main">=</span> map_poly Re <span class="skolem">p3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI3</span> <span class="main">=</span> map_poly Im <span class="skolem">p3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc3</span> <span class="main">=</span> gcd <span class="skolem">pR3</span> <span class="skolem">pI3</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p4</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">(</span>Im <span class="free">lb</span> <span class="main">-</span> Im <span class="free">ub</span><span class="main">)</span><span class="main">:]</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR4</span> <span class="main">=</span> map_poly Re <span class="skolem">p4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI4</span> <span class="main">=</span> map_poly Im <span class="skolem">p4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc4</span> <span class="main">=</span> gcd <span class="skolem">pR4</span> <span class="skolem">pI4</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc3</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc4</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc1</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">gc1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gc1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pI1_def pR1_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpoly_of_decompose map_poly_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p1_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="free">ub</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>pcompose_eq_0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Complex_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc2</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">gc2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gc2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pI2_def pR2_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpoly_of_decompose map_poly_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p2_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="free">ub</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>pcompose_eq_0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Complex_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc3</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">gc3</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gc3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pI3_def pR3_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpoly_of_decompose map_poly_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p3_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="free">ub</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>pcompose_eq_0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Complex_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc4</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">gc4</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI4</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR4</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gc4_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p4</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pI4_def pR4_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpoly_of_decompose map_poly_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p4_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="free">ub</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>pcompose_eq_0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Complex_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sms</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">sms</span> <span class="main">=</span> <span class="main">(</span>changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span>
                <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span>
                <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span>
                <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span>proots <span class="free">p</span><span class="main">.</span> winding_number <span class="skolem">rec</span> <span class="bound">r</span> <span class="main">*</span> <span class="main">(</span>order <span class="bound">r</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">rec</span> <span class="skolem">x</span> <span class="main">*</span> of_nat <span class="main">(</span>order <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>proots <span class="free">p</span> <span class="main">-</span> proots_within <span class="free">p</span> <span class="main">(</span>box <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"cbox <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> box <span class="free">lb</span> <span class="free">ub</span> <span class="main">∪</span> path_image <span class="skolem">rec</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>cbox <span class="free">lb</span> <span class="free">ub</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>box <span class="free">lb</span> <span class="free">ub</span> <span class="main">∪</span> path_image <span class="skolem">rec</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹Re <span class="free">lb</span><span class="main">&lt;</span>Re <span class="free">ub</span>›</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">lb</span><span class="main">&lt;</span>Im <span class="free">ub</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> box_def cbox_def Basis_complex_def rec_def l1_def l2_def l3_def l4_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_join closed_segment_degen_complex<span class="main">)</span>          
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> closed_segment_commute<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_segment_degen_complex<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>box <span class="free">lb</span> <span class="free">ub</span> <span class="main">∪</span> path_image <span class="skolem">rec</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>cbox <span class="free">lb</span> <span class="free">ub</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">using</span></span> that
            <span class="keyword1"><span class="command">unfolding</span></span> box_def cbox_def Basis_complex_def rec_def l1_def l2_def l3_def l4_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_join closed_segment_degen_complex<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> closed_segment_commute<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>closed_segment_degen_complex<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>path_image <span class="skolem">rec</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> path_no_proots that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>cbox <span class="free">lb</span> <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> winding_number_zero_outside<span class="main">[</span><span class="operator">OF</span> valid_path_imp_path<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid<span class="main"><span class="main">]</span></span> _ loop this<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> * 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">rec</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>order <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> winding_number <span class="skolem">rec</span> <span class="skolem">x</span> <span class="main">*</span> of_nat <span class="main">(</span>order <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="free">p</span> <span class="main">(</span>box <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>box <span class="free">lb</span> <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> order_asms<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> Re <span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">&lt;</span> Im <span class="free">ub</span>"</span></span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>box_def Basis_complex_def<span class="main">)</span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">rec</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> rec_def l1_def l2_def l3_def l4_def 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eval_winding</span> 
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="free">lb</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?l2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span> <span class="free">ub</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?l3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="free">ub</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?l4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> path_image <span class="var">?l1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> path_image <span class="var">?l2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
               l3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> path_image <span class="var">?l3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> path_image <span class="var">?l4</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> no_proots that <span class="keyword1"><span class="command">unfolding</span></span> no_proots_line_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> of_real <span class="main">(</span>cindex_pathE <span class="var">?l1</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>cindex_pathE <span class="var">?l2</span> <span class="skolem">x</span> <span class="main">+</span>
            <span class="main">(</span>cindex_pathE <span class="var">?l3</span> <span class="skolem">x</span> <span class="main">+</span> cindex_pathE <span class="var">?l4</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="skolem">x</span> <span class="main">-</span> Im <span class="free">ub</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> mult_less_0_iff order_asms<span class="main">(</span>1<span class="main">)</span> order_asms<span class="main">(</span>2<span class="main">)</span> order_asms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?l3</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> l3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> order_asms<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="free">lb</span> <span class="main">-</span> Im <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span> <span class="main">&lt;</span><span class="main">0</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> mult_less_0_iff order_asms<span class="main">(</span>1<span class="main">)</span> order_asms<span class="main">(</span>2<span class="main">)</span> order_asms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?l1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>    
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> l1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> order_asms<span class="main">)</span>  
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?l2</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>    
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> l2 order_asms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?l4</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> l4 order_asms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proots_rectangle_def proots_count_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.mono_neutral_cong_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"proots <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">(</span>box <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span>contour_integral <span class="skolem">rec</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="skolem">rec</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> 
              <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> winding_number <span class="skolem">rec</span> <span class="bound">x</span> <span class="main">*</span> of_int <span class="main">(</span>zorder <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> argument_principle<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">rec</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">(</span>UNIV<span class="main">::</span>complex set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> connected_UNIV<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted">complex</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">rec</span> <span class="main">⊆</span> UNIV <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> path_no_proots <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_roots_finite that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>proots <span class="free">p</span><span class="main">.</span> winding_number <span class="skolem">rec</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>order <span class="bound">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>sum.cong <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_zorder<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_eq_iff2 of_nat_nat order_root order_zorder that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> path_no_proots <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> winding_number_comp<span class="main">[</span><span class="operator">OF</span> _ poly_holomorphic_on _ _ this<span class="main">,</span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> winding_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">0</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_cindex_pathE<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rec_def path_compose_join 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> g1_def g2_def g3_def g4_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_ReZ_segments_joinpaths path_join_imp<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> valid_path_compose_holomorphic<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> path_no_proots <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rec_def pathstart_compose pathfinish_compose  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>l1_def l4_def<span class="main">)</span>   
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> cindex_pathE_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">sms</span><span class="main">)</span> <span class="main">/</span> of_int <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> cindex_pathE <span class="main">(</span><span class="skolem">g1</span><span class="main">+++</span><span class="skolem">g2</span><span class="main">+++</span><span class="skolem">g3</span><span class="main">+++</span><span class="skolem">g4</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rec_def path_compose_join g1_def g2_def g3_def g4_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_pathE <span class="skolem">g1</span> <span class="main">0</span> <span class="main">+</span> cindex_pathE <span class="skolem">g2</span> <span class="main">0</span> <span class="main">+</span> cindex_pathE <span class="skolem">g3</span> <span class="main">0</span> <span class="main">+</span> cindex_pathE <span class="skolem">g4</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_joinpaths<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>finite_ReZ_segments_joinpaths<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span>
                     <span class="main">+</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span>
                     <span class="main">+</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span>
                     <span class="main">+</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g1</span> <span class="main">0</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">=</span> poly <span class="skolem">p1</span> <span class="keyword1">o</span> of_real"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> g1_def p1_def l1_def poly_linepath_comp
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> complex_surj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g1</span> <span class="main">0</span>  <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">pI1</span> <span class="bound">t</span> <span class="main">/</span> poly <span class="skolem">pR1</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def pR1_def pI1_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Im_poly_of_real Re_poly_of_real<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="skolem">pI1</span> <span class="skolem">pR1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> cindexE_eq_cindex_polyE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gc1</span><span class="main">≠</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cindex_polyE_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">gc1</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gc1_def<span class="main">)</span>  
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g2</span> <span class="main">0</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">=</span> poly <span class="skolem">p2</span> <span class="keyword1">o</span> of_real"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> g2_def p2_def l2_def poly_linepath_comp
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> complex_surj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g2</span> <span class="main">0</span>  <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">pI2</span> <span class="bound">t</span> <span class="main">/</span> poly <span class="skolem">pR2</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def pR2_def pI2_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Im_poly_of_real Re_poly_of_real<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="skolem">pI2</span> <span class="skolem">pR2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> cindexE_eq_cindex_polyE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gc2</span><span class="main">≠</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cindex_polyE_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">gc2</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gc2_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g3</span> <span class="main">0</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g3</span> <span class="main">=</span> poly <span class="skolem">p3</span> <span class="keyword1">o</span> of_real"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> g3_def p3_def l3_def poly_linepath_comp
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> complex_surj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g3</span> <span class="main">0</span>  <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">pI3</span> <span class="bound">t</span> <span class="main">/</span> poly <span class="skolem">pR3</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def pR3_def pI3_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Im_poly_of_real Re_poly_of_real<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="skolem">pI3</span> <span class="skolem">pR3</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> cindexE_eq_cindex_polyE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gc3</span><span class="main">≠</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cindex_polyE_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">gc3</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gc3_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>     
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g4</span> <span class="main">0</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g4</span> <span class="main">=</span> poly <span class="skolem">p4</span> <span class="keyword1">o</span> of_real"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> g4_def p4_def l4_def poly_linepath_comp
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> complex_surj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g4</span> <span class="main">0</span>  <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">pI4</span> <span class="bound">t</span> <span class="main">/</span> poly <span class="skolem">pR4</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def pR4_def pI4_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Im_poly_of_real Re_poly_of_real<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="skolem">pI4</span> <span class="skolem">pR4</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> cindexE_eq_cindex_polyE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gc4</span><span class="main">≠</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cindex_polyE_mult_cancel<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">gc4</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gc4_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>      
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">sms</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> 
            <span class="main">=</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_polyE_changes_alt_itv_mods<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gc1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gc1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>div_gcd_coprime<span class="main">)</span> 
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> 
            <span class="main">=</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_polyE_changes_alt_itv_mods<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gc2</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gc2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>div_gcd_coprime<span class="main">)</span>    
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> 
            <span class="main">=</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_polyE_changes_alt_itv_mods<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gc3</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gc3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>div_gcd_coprime<span class="main">)</span>    
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_polyE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pI4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pR4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> 
            <span class="main">=</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_polyE_changes_alt_itv_mods<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">gc4</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gc4_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>div_gcd_coprime<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> real_of_int <span class="skolem">sms</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_nat<span class="main">::</span><span class="main">_</span><span class="main">⇒</span>complex<span class="main">)</span> <span class="main">(</span>proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">sms</span><span class="main">)</span> <span class="main">/</span> of_int <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="skolem">sms</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integer_winding_number<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>valid_path_compose_holomorphic<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span> valid_path_imp_path<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> rec_def path_compose_join
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>l1_def l4_def pathfinish_compose pathstart_compose<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rec</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> path_no_proots <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>         
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">sms</span><span class="main">)</span> <span class="main">/</span> of_int <span class="numeral">4</span> <span class="main">∈</span> <span class="main">(</span><span class="main">ℤ</span><span class="main">::</span>complex set<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> winding_eq cindex_pathE_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> dvd_divide_Ints_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> nat <span class="main">(</span><span class="main">-</span> <span class="skolem">sms</span> <span class="keyword1">div</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_div_field<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> nat_int of_int_eq_iff of_int_of_nat_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Let_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> p1_def p2_def p3_def p4_def pI1_def pR1_def pI2_def pR2_def pI3_def pR3_def
          pI4_def pR4_def gc1_def gc2_def gc3_def gc4_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> sms_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="comment1">(*further refinement*)</span>
<span class="keyword1" id="Count_Complex_Roots-proots_rectangle_code2"><span class="command">lemma</span></span> proots_rectangle_code2<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="free">ub</span> <span class="main">∧</span> Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="free">ub</span> <span class="keyword1">then</span> 
            <span class="keyword1">if</span> <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="keyword1">then</span> 
            <span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">lb</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span> 
               <span class="main">∧</span> poly <span class="free">p</span> <span class="free">ub</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span> 
            <span class="keyword1">then</span>
              <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p1</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">lb</span><span class="main">,</span>  Complex <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span> <span class="main">0</span><span class="main">:]</span><span class="main">;</span>
                <span class="bound">pR1</span> <span class="main">=</span> map_poly Re <span class="bound">p1</span><span class="main">;</span> <span class="bound">pI1</span> <span class="main">=</span> map_poly Im <span class="bound">p1</span><span class="main">;</span> <span class="bound">gc1</span> <span class="main">=</span> gcd <span class="bound">pR1</span> <span class="bound">pI1</span><span class="main">;</span>
                <span class="bound">p2</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">(</span>Im <span class="free">ub</span> <span class="main">-</span> Im <span class="free">lb</span><span class="main">)</span><span class="main">:]</span><span class="main">;</span>
                <span class="bound">pR2</span> <span class="main">=</span> map_poly Re <span class="bound">p2</span><span class="main">;</span> <span class="bound">pI2</span> <span class="main">=</span> map_poly Im <span class="bound">p2</span><span class="main">;</span> <span class="bound">gc2</span> <span class="main">=</span> gcd <span class="bound">pR2</span> <span class="bound">pI2</span><span class="main">;</span>
                <span class="bound">p3</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">ub</span><span class="main">,</span> Complex <span class="main">(</span>Re <span class="free">lb</span> <span class="main">-</span> Re <span class="free">ub</span><span class="main">)</span> <span class="main">0</span><span class="main">:]</span><span class="main">;</span>
                <span class="bound">pR3</span> <span class="main">=</span> map_poly Re <span class="bound">p3</span><span class="main">;</span> <span class="bound">pI3</span> <span class="main">=</span> map_poly Im <span class="bound">p3</span><span class="main">;</span> <span class="bound">gc3</span> <span class="main">=</span> gcd <span class="bound">pR3</span> <span class="bound">pI3</span><span class="main">;</span>
                <span class="bound">p4</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">(</span>Im <span class="free">lb</span> <span class="main">-</span> Im <span class="free">ub</span><span class="main">)</span><span class="main">:]</span><span class="main">;</span>
                <span class="bound">pR4</span> <span class="main">=</span> map_poly Re <span class="bound">p4</span><span class="main">;</span> <span class="bound">pI4</span> <span class="main">=</span> map_poly Im <span class="bound">p4</span><span class="main">;</span> <span class="bound">gc4</span> <span class="main">=</span> gcd <span class="bound">pR4</span> <span class="bound">pI4</span>
              <span class="keyword1">in</span>
                <span class="keyword1">if</span> changes_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="bound">gc1</span> <span class="main">(</span>pderiv <span class="bound">gc1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>
                   <span class="main">∧</span> changes_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="bound">gc2</span> <span class="main">(</span>pderiv <span class="bound">gc2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> 
                   <span class="main">∧</span> changes_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="bound">gc3</span> <span class="main">(</span>pderiv <span class="bound">gc3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>
                   <span class="main">∧</span> changes_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="bound">gc4</span> <span class="main">(</span>pderiv <span class="bound">gc4</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>
                <span class="keyword1">then</span> 
                   nat <span class="main">(</span><span class="main">-</span> <span class="main">(</span>changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="bound">pR1</span> <span class="keyword1">div</span> <span class="bound">gc1</span><span class="main">)</span> <span class="main">(</span><span class="bound">pI1</span> <span class="keyword1">div</span> <span class="bound">gc1</span><span class="main">)</span>
                    <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="bound">pR2</span> <span class="keyword1">div</span> <span class="bound">gc2</span><span class="main">)</span> <span class="main">(</span><span class="bound">pI2</span> <span class="keyword1">div</span> <span class="bound">gc2</span><span class="main">)</span>
                    <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="bound">pR3</span> <span class="keyword1">div</span> <span class="bound">gc3</span><span class="main">)</span> <span class="main">(</span><span class="bound">pI3</span> <span class="keyword1">div</span> <span class="bound">gc3</span><span class="main">)</span>
                    <span class="main">+</span> changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="bound">pR4</span> <span class="keyword1">div</span> <span class="bound">gc4</span><span class="main">)</span> <span class="main">(</span><span class="bound">pI4</span> <span class="keyword1">div</span> <span class="bound">gc4</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">4</span><span class="main">)</span>
                <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_rectangle fails when there is a root on the border.''</span><span class="main">)</span> 
                        <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_rectangle fails when there is a root on the border.''</span><span class="main">)</span> 
              <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span>  
            <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_rectangle fails when p=0.''</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_rectangle <span class="free">p</span> <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">pR1</span></span> <span class="skolem"><span class="skolem">pI1</span></span> <span class="skolem"><span class="skolem">gc1</span></span>
           <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">pR2</span></span> <span class="skolem"><span class="skolem">pI2</span></span> <span class="skolem"><span class="skolem">gc2</span></span>
           <span class="skolem"><span class="skolem">p3</span></span> <span class="skolem"><span class="skolem">pR3</span></span> <span class="skolem"><span class="skolem">pI3</span></span> <span class="skolem"><span class="skolem">gc3</span></span>
           <span class="skolem"><span class="skolem">p4</span></span> <span class="skolem"><span class="skolem">pR4</span></span> <span class="skolem"><span class="skolem">pI4</span></span> <span class="skolem"><span class="skolem">gc4</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">lb</span><span class="main">,</span>  Complex <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span> <span class="main">0</span><span class="main">:]</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR1</span> <span class="main">=</span> map_poly Re <span class="skolem">p1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI1</span> <span class="main">=</span> map_poly Im <span class="skolem">p1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc1</span> <span class="main">=</span> gcd <span class="skolem">pR1</span> <span class="skolem">pI1</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">(</span>Im <span class="free">ub</span> <span class="main">-</span> Im <span class="free">lb</span><span class="main">)</span><span class="main">:]</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR2</span> <span class="main">=</span> map_poly Re <span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI2</span> <span class="main">=</span> map_poly Im <span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc2</span> <span class="main">=</span> gcd <span class="skolem">pR2</span> <span class="skolem">pI2</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p3</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">ub</span><span class="main">,</span> Complex <span class="main">(</span>Re <span class="free">lb</span> <span class="main">-</span> Re <span class="free">ub</span><span class="main">)</span> <span class="main">0</span><span class="main">:]</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR3</span> <span class="main">=</span> map_poly Re <span class="skolem">p3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI3</span> <span class="main">=</span> map_poly Im <span class="skolem">p3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc3</span> <span class="main">=</span> gcd <span class="skolem">pR3</span> <span class="skolem">pI3</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p4</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">,</span> Complex <span class="main">0</span> <span class="main">(</span>Im <span class="free">lb</span> <span class="main">-</span> Im <span class="free">ub</span><span class="main">)</span><span class="main">:]</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR4</span> <span class="main">=</span> map_poly Re <span class="skolem">p4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI4</span> <span class="main">=</span> map_poly Im <span class="skolem">p4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc4</span> <span class="main">=</span> gcd <span class="skolem">pR4</span> <span class="skolem">pI4</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sms</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">sms</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span>changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI1</span> <span class="keyword1">div</span> <span class="skolem">gc1</span><span class="main">)</span> <span class="main">+</span>
                       changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI2</span> <span class="keyword1">div</span> <span class="skolem">gc2</span><span class="main">)</span> <span class="main">+</span>
                       changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI3</span> <span class="keyword1">div</span> <span class="skolem">gc3</span><span class="main">)</span> <span class="main">+</span>
                       changes_alt_itv_smods <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">pR4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pI4</span> <span class="keyword1">div</span> <span class="skolem">gc4</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span>
                    <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> more_folds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">lb</span><span class="main">,</span> Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span> <span class="main">-</span> <span class="free">lb</span><span class="main">:]</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">,</span> <span class="free">ub</span> <span class="main">-</span> Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">:]</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">p3</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">ub</span><span class="main">,</span> Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span> <span class="main">-</span> <span class="free">ub</span><span class="main">:]</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">p4</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">,</span> <span class="free">lb</span> <span class="main">-</span> Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p1_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> complex_surj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>minus_complex.code<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> complex_surj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> complex_surj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>minus_complex.code<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p4_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> complex_surj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_rectangle_code1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> no_proots_line_code Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> p1_def p2_def p3_def p4_def pI1_def pR1_def pI2_def pR2_def pI3_def pR3_def
          pI4_def pR4_def gc1_def gc2_def gc3_def gc4_def more_folds<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> sms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial roots on the upper half-plane›</span></span>

<span class="comment1">― ‹Roots counted WITH multiplicity›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_upper</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_upper</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">=</span> proots_count <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Im <span class="bound">z</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span>"</span></span>

<span class="comment1">― ‹Roots counted WITHOUT multiplicity›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_upper_card</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">proots_upper_card</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&gt;</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Count_Complex_Roots-Im_Ln_tendsto_at_top"><span class="command">lemma</span></span> Im_Ln_tendsto_at_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im <span class="main">(</span>Ln <span class="main">(</span>Complex <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top "</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> arctan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">a</span><span class="main">)</span> <span class="keyword1">else</span> arctan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">a</span><span class="main">)</span> <span class="main">+</span> pi<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im <span class="main">(</span>Ln <span class="main">(</span>Complex <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> arctan <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def field_class.field_divide_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span>arctan <span class="main">⤏</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_top_linear_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">a</span>"</span></span> <span class="quoted">arctan</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"nhds <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tendsto_arctan_at_top <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> arctan <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="free">a</span><span class="main">)</span> <span class="main">+</span> pi<span class="main">)</span> <span class="main">⤏</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def field_class.field_divide_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> arctan <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_add_const_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi"</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span>arctan <span class="main">⤏</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_top_linear_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">a</span>"</span></span> <span class="quoted">arctan</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tendsto_arctan_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Im_Ln_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> Complex_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> tendsto_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted">at_top</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eventually<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Im_Ln_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Complex_eq_0<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Count_Complex_Roots-Im_Ln_tendsto_at_bot"><span class="command">lemma</span></span> Im_Ln_tendsto_at_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im <span class="main">(</span>Ln <span class="main">(</span>Complex <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">-</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_bot "</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">a</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> arctan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">a</span><span class="main">)</span> <span class="keyword1">else</span> arctan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span> pi<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im <span class="main">(</span>Ln <span class="main">(</span>Complex <span class="free">a</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_bot <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> arctan <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def field_class.field_divide_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span>arctan <span class="main">⤏</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_bot_linear_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">a</span>"</span></span> <span class="quoted">arctan</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tendsto_arctan_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_bot <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> arctan <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="free">a</span><span class="main">)</span> <span class="main">-</span> pi<span class="main">)</span> <span class="main">⤏</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def field_class.field_divide_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> arctan <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> inverse <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_add_const_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi"</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span>arctan <span class="main">⤏</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_bot_linear_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">a</span>"</span></span> <span class="quoted">arctan</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tendsto_arctan_at_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_bot<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Im_Ln_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> Complex_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_bot_linorder <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> tendsto_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted">at_bot</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eventually<span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_bot_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Im_Ln_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Complex_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Count_Complex_Roots-Re_winding_number_tendsto_part_circlepath"><span class="command">lemma</span></span> Re_winding_number_tendsto_part_circlepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="bound">r</span> <span class="main">0</span> pi <span class="main">)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Im <span class="free">z0</span><span class="main">≤</span>Im <span class="free">a</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> part_circlepath <span class="free">z0</span> <span class="bound">r</span> <span class="main">0</span> pi<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> part_circlepath <span class="free">z0</span> <span class="bound">r</span> pi <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g1</span> <span class="bound">r</span> <span class="main">)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g2</span> <span class="bound">r</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f2</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Im <span class="main">(</span>Ln <span class="main">(</span>Complex <span class="main">(</span> Im <span class="free">a</span><span class="main">-</span>Im <span class="free">z0</span><span class="main">)</span> <span class="main">(</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">+</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span><span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Im <span class="main">(</span>Ln <span class="main">(</span>Complex <span class="main">(</span>  Im <span class="free">a</span> <span class="main">-</span>Im <span class="free">z0</span><span class="main">)</span> <span class="main">(</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">-</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="skolem">f2</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≥</span> cmod <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">p</span> <span class="main">≤</span> Im <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span>path_image <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">z0</span> <span class="main">+</span> of_real <span class="skolem">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pi<span class="main">≤</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span>pi"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">∈</span>path_image <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">r</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> g2_def path_image_part_circlepath<span class="main">[</span><span class="operator">of</span> <span class="quoted">pi</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>pi"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">p</span><span class="main">=</span>Im <span class="free">z0</span> <span class="main">+</span> sin <span class="skolem">t</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Im_exp<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Im <span class="free">z0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">t</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pi<span class="main">≤</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span>pi›</span></span> sin_le_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≥</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse add.left_neutral add_uminus_conv_diff
                diff_ge_0_iff_ge norm_ge_zero order_trans zero_le_one<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">t</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mult_le_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Im <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g2_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_on_circlepathI<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pathfinish <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h1</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h1_def g2_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>pathfinish_pathstart_partcirclepath_simps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>4 10<span class="main"><span class="main">)</span></span> complex_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> Complex_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pathstart <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h2_def g2_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>pathfinish_pathstart_partcirclepath_simps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>4 10<span class="main"><span class="main">)</span></span> complex_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> Complex_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h1</span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">h2</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> f2_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Re_winding_number_half_lower<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>exp_Euler <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">h1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span> <span class="main">⤏</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h1_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_top_linear_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span> <span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> Im_Ln_tendsto_at_top <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>Complex_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h2</span> <span class="main">⤏</span> <span class="main">-</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>  
        <span class="keyword1"><span class="command">unfolding</span></span> h2_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_bot_linear_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> Re <span class="free">a</span> <span class="main">+</span> Re <span class="free">z0</span>"</span></span> <span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command">using</span></span> Im_Ln_tendsto_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>Complex_eq<span class="main">)</span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h1</span> <span class="bound">x</span><span class="main">-</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> pi<span class="main">)</span> at_top"</span></span>    
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="skolem">f2</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">f1</span> <span class="bound">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≥</span> cmod <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">f2</span> <span class="skolem">r</span> <span class="main">=</span> Re<span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">r</span> <span class="main">+++</span> <span class="skolem">g2</span> <span class="skolem">r</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> f1_def f2_def g1_def g2_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_join<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>not_on_circlepathI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Re<span class="main">(</span>winding_number <span class="main">(</span>circlepath <span class="free">z0</span> <span class="skolem">r</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="skolem">r</span> <span class="main">+++</span> <span class="skolem">g2</span> <span class="skolem">r</span> <span class="main">=</span> circlepath <span class="free">z0</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> circlepath_def g1_def g2_def joinpaths_def part_circlepath_def linepath_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>circlepath <span class="free">z0</span> <span class="skolem">r</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_circlepath<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="skolem">r</span><span class="main">+</span><span class="skolem">f2</span> <span class="skolem">r</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">f2</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">f1</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">f1</span> <span class="bound">r</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f2</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">f1</span> <span class="bound">r</span>"</span></span> <span class="quoted">at_top</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f1</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> tendsto_minus_cancel<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_add_const_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f1_def g1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> part_circlepath <span class="free">z0</span> <span class="bound">r</span> <span class="main">0</span> pi<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Im <span class="main">(</span>Ln <span class="main">(</span>Complex <span class="main">(</span> Im <span class="free">z0</span><span class="main">-</span>Im <span class="free">a</span><span class="main">)</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">+</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span><span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Im <span class="main">(</span>Ln <span class="main">(</span>Complex <span class="main">(</span>  Im <span class="free">z0</span> <span class="main">-</span>Im <span class="free">a</span> <span class="main">)</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">-</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≥</span> cmod <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">p</span> <span class="main">≥</span> Im <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span>path_image <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">z0</span> <span class="main">+</span> of_real <span class="skolem">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≤</span>pi"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">∈</span>path_image <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> g_def path_image_part_circlepath<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted">pi</span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">p</span><span class="main">=</span>Im <span class="free">z0</span> <span class="main">+</span> sin <span class="skolem">t</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Im_exp<span class="main">)</span>    
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">t</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">≥</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">t</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≤</span>pi›</span></span> sin_ge_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≥</span><span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse add.left_neutral add_uminus_conv_diff
                diff_ge_0_iff_ge norm_ge_zero order_trans zero_le_one<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">t</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_on_circlepathI<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">a</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pathfinish <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h1</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h1_def g_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>pathfinish_pathstart_partcirclepath_simps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>4 9<span class="main"><span class="main">)</span></span> complex_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> Complex_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">a</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pathstart <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h2</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h2_def g_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>pathfinish_pathstart_partcirclepath_simps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>4 9<span class="main"><span class="main">)</span></span> complex_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> Complex_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h1</span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">h2</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> f_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Re_winding_number_half_upper<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>exp_Euler <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">h1</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h1</span> <span class="main">⤏</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h1_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_top_linear_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> Re <span class="free">a</span> <span class="main">+</span> Re <span class="free">z0</span>"</span></span> <span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> Im_Ln_tendsto_at_top <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>Complex_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h2</span> <span class="main">⤏</span> <span class="main">-</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>  
        <span class="keyword1"><span class="command">unfolding</span></span> h2_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_bot_linear_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span> <span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command">using</span></span> Im_Ln_tendsto_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>Complex_eq<span class="main">)</span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h1</span> <span class="bound">x</span><span class="main">-</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> pi<span class="main">)</span> at_top"</span></span>    
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Count_Complex_Roots-not_image_at_top_poly_part_circlepath"><span class="command">lemma</span></span> not_image_at_top_poly_part_circlepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="free">b</span><span class="main">∉</span>path_image <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> part_circlepath <span class="free">z0</span> <span class="bound">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">[:</span><span class="free">b</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_proots<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> finite_ball_include<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> R_ball<span class="main">:</span><span class="quoted"><span class="quoted">"proots <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">[:</span><span class="free">b</span><span class="main">:]</span><span class="main">)</span> <span class="main">⊆</span> ball <span class="free">z0</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">R</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≥</span><span class="skolem">R</span>"</span></span>    
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span>path_image <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> part_circlepath <span class="free">z0</span> <span class="skolem">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> poly <span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> path_image <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="skolem">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>proots <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">[:</span><span class="free">b</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>ball <span class="free">z0</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> R_ball <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≥</span><span class="skolem">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span><span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute dist_norm<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> in_path_image_part_circlepath <span class="quoted"><span class="quoted">‹<span class="skolem">R</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≥</span><span class="skolem">R</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="Count_Complex_Roots-not_image_poly_part_circlepath"><span class="command">lemma</span></span> not_image_poly_part_circlepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">r</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span>  <span class="free">b</span><span class="main">∉</span>path_image <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> part_circlepath <span class="free">z0</span> <span class="bound">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">[:</span><span class="free">b</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_proots<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> finite_ball_include<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r_ball<span class="main">:</span><span class="quoted"><span class="quoted">"proots <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">[:</span><span class="free">b</span><span class="main">:]</span><span class="main">)</span> <span class="main">⊆</span> ball <span class="free">z0</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span>path_image <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> part_circlepath <span class="free">z0</span> <span class="skolem">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> poly <span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> path_image <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="skolem">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>proots <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">[:</span><span class="free">b</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>ball <span class="free">z0</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span><span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute dist_norm<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> in_path_image_part_circlepath <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1" id="Count_Complex_Roots-Re_winding_number_poly_part_circlepath"><span class="command">lemma</span></span> Re_winding_number_poly_part_circlepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> part_circlepath <span class="free">z0</span> <span class="bound">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> degree <span class="free">p</span><span class="main">/</span><span class="numeral">2</span> <span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> 
    <span class="keyword1"><span class="command">using</span></span> Fundamental_Theorem_Algebra.fundamental_theorem_of_algebra constant_degree neq0_conv
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> part_circlepath <span class="free">z0</span> <span class="bound">r</span> <span class="main">0</span> pi<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> winding_number <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pc</span></span> <span class="keyword2"><span class="keyword">where</span></span> pc_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">pc</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> degree_eq_zeroE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pc</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> Re <span class="main">(</span><span class="skolem">w</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span> <span class="skolem">pc</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">pc</span> <span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="skolem">pc</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">pc</span> <span class="main">-</span> <span class="free">z0</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">r</span> <span class="main">=</span>  winding_number <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">pc</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">pc</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> w_def pc_def g_def q_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.right_neutral mult.commute mult_zero_right 
            poly_0 poly_pCons uminus_add_conv_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  winding_number <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">a</span> "</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_comp_linear<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">pc</span><span class="main">*</span><span class="skolem">a</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pc</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_on_circlepathI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pc</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">r</span> <span class="main">=</span> winding_number <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">a</span> "</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">w</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Re_winding_number_tendsto_part_circlepath <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">w</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pc_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pc</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def g_def comp_def q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">unfolding</span></span> g_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_image_at_top_poly_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> root.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> Re <span class="main">(</span><span class="skolem">w</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> 
              <span class="main">+</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="skolem">p</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span><span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>  
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pf</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">af</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">af</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">cc</span> <span class="main">*</span> contour_integral <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">q</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> poly <span class="skolem">q</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> w_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> g_def cc_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">cc</span> <span class="main">*</span> contour_integral <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="bound">w</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">q</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> poly <span class="skolem">q</span> <span class="bound">w</span><span class="main">)</span> 
            <span class="main">=</span> contour_integral <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="bound">w</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contour_integral_eq<span class="main">)</span>   
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> path_image <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span>poly <span class="skolem">q</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="main">+</span> poly <span class="skolem">p</span> <span class="skolem">x</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
              <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>    
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> deriv_mult<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">-</span> <span class="skolem">a</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">-</span><span class="skolem">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∈</span>poly <span class="skolem">q</span> <span class="main">`</span> path_image <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> path_image <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>›</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span>poly <span class="skolem">q</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> poly <span class="skolem">q</span> <span class="skolem">x</span> <span class="main">=</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">cc</span> <span class="main">*</span> contour_integral <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="bound">w</span><span class="main">)</span> 
          <span class="main">+</span> <span class="skolem">cc</span> <span class="main">*</span> contour_integral <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> contour_integral_add<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> deriv_pderiv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>path_image <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> q_def path_image_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="bound">w</span><span class="main">)</span> <span class="keyword1">contour_integrable_on</span> <span class="skolem">g</span> <span class="skolem">r</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> g_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> contour_integrable_continuous_part_circlepath <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">contour_integrable_on</span> <span class="skolem">g</span> <span class="skolem">r</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contour_integrable_inversediff<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> q_def path_image_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  winding_number <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">+</span>  winding_number <span class="main">(</span>poly <span class="skolem">p</span> <span class="keyword1">o</span> <span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>poly <span class="skolem">p</span> <span class="keyword1">o</span> <span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span>
            <span class="main">=</span> <span class="skolem">cc</span> <span class="main">*</span> contour_integral <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose q_def g_def cc_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">cc</span> <span class="main">*</span> contour_integral <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_valid_path<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose q_def g_def cc_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">w</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">+</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="skolem">p</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> 
              <span class="main">+</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="skolem">p</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> degree <span class="skolem">q</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_number_tendsto_part_circlepath<span class="main">)</span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="skolem">p</span> <span class="main">∘</span> <span class="skolem">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> degree <span class="skolem">p</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> root<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> degree <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> q_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_add add_divide_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">w</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> degree <span class="skolem">q</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def q_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>     

<span class="keyword1" id="Count_Complex_Roots-Re_winding_number_poly_linepth"><span class="command">lemma</span></span> Re_winding_number_poly_linepth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pp</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> poly <span class="free">pp</span> <span class="keyword1">o</span> linepath <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span> <span class="main">(</span>of_real <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">pp</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> no_real_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="free">pp</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> cindex_pathE <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span> <span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span> <span class="main">)</span> at_top"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>map_poly Re <span class="free">pp</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span>map_poly Im <span class="free">pp</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">t</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sgnx_top<span class="main">:</span><span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> at_top <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sgnx_poly_at_top sgn_pos_inf_def p_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="free">pp</span><span class="main">=</span><span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_map_poly_nz<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_g_image<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">pp</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>closed_segment <span class="main">(</span><span class="main">-</span> of_real <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def path_image_compose of_real_linepath <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>proots <span class="free">pp</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> closed_segment_imp_Re_Im<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="free">pp</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">have</span></span> arctan_f_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="bound">r</span><span class="main">)</span> <span class="main">-</span>  arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi<span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">&gt;</span>degree <span class="skolem">q</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">=</span>degree <span class="free">pp</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="free">pp</span><span class="main">=</span><span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>map_poly_degree_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span><span class="main">&lt;</span>degree <span class="free">pp</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="free">pp</span><span class="main">=</span><span class="main">1</span>›</span></span> True
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>map_poly_degree_less<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_0_at_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_bot"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>filterlim_mono <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>at_top_le_at_infinity at_bot_le_at_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_compose_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">uminus</span><span class="main"><span class="main">,</span></span><span class="operator">unfolded</span> comp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>at_bot_mirror<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span><span class="main">≤</span>degree <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">=</span>degree <span class="free">pp</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="free">pp</span><span class="main">=</span><span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>map_poly_degree_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span><span class="main">≤</span>degree <span class="free">pp</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pa</span></span> <span class="skolem"><span class="skolem">qa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">pa</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">[:</span><span class="skolem">qa</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> degree_eq_zeroE<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> valid_path_compose_holomorphic<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>of_real_linepath<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def of_real_linepath <span class="keyword1"><span class="command">using</span></span> finite_ReZ_segments_poly_linepath <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_f_eq<span class="main">:</span><span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span> <span class="skolem">t</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span><span class="main">(</span>poly <span class="free">pp</span> <span class="keyword1">o</span> of_real <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> 
        <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">pp</span> <span class="keyword1">o</span> of_real <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def linepath_def comp_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> comp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Im_poly_of_real diff_0_right Re_poly_of_real f_def q_def p_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"proots <span class="skolem">p</span><span class="main">=</span><span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span><span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> cindex_pathE <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span>
        <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="bound">r</span><span class="main">)</span> <span class="main">-</span>  arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≥</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> image_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">.</span>  <span class="main">0</span><span class="main">&lt;</span>Re <span class="bound">p</span> "</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">t</span><span class="main">≤</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> g_def path_image_compose of_real_linepath p_def 
          <span class="keyword1"><span class="command">using</span></span> Re_poly_of_real
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>closed_segment_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_less of_real_def real_vector.scale_scale scaleR_left_diff_distrib<span class="main">)</span>  
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">t</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>    
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> sgnx_poly_nz that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sgnx_at_top_IVT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> sgnx_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>proots <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹proots <span class="skolem">p</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹proots <span class="skolem">p</span><span class="main">=</span><span class="main">{}</span>›</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_number_half_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> image_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>not_g_image<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>pathfinish <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> image_pos<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">=</span> arctan <span class="main">(</span>Im <span class="main">(</span>pathfinish <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>pathfinish <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Im_Ln_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> g_f_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>pathstart <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> image_pos<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">=</span> arctan <span class="main">(</span>Im <span class="main">(</span>pathstart <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>pathstart <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Im_Ln_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> g_f_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> cindex_pathE <span class="main">(</span>poly <span class="free">pp</span> <span class="keyword1">o</span> of_real <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g_def linepath_def comp_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def comp_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Im_poly_of_real diff_0_right Re_poly_of_real f_def q_def p_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">f</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindexE_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≥</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="main">-</span><span class="skolem">r</span><span class="main">..</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹proots <span class="skolem">p</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> jumpF_not_infinity <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> cindex_pathE <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> 
          <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span>  arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>   
        <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> arctan_f_tendsto <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"proots <span class="skolem">p</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">max_r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">=</span>Max <span class="main">(</span>proots <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">min_r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span><span class="main">=</span>Min <span class="main">(</span>proots <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span><span class="main">≤</span><span class="skolem">max_r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      min_max_bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>proots <span class="skolem">p</span><span class="main">.</span> <span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="skolem">min_r</span><span class="main">..</span><span class="skolem">max_r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≡</span> map_poly Re <span class="free">pp</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coeff_0 coeff_map_poly one_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_complex.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> Min_in Max_in that <span class="keyword1"><span class="command">unfolding</span></span> max_r_def min_r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>proots <span class="skolem">p</span><span class="main">.</span> <span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="skolem">min_r</span><span class="main">..</span><span class="skolem">max_r</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Min_le Max_ge <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>proots <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_r_def min_r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span><span class="main">≤</span><span class="skolem">max_r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span><span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> cindex_pathE <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span> <span class="main">0</span>
        <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="bound">r</span><span class="main">)</span> <span class="main">-</span>  arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>norm <span class="skolem">max_r</span><span class="main">)</span> <span class="main">(</span>norm <span class="skolem">min_r</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> r_asm<span class="main">:</span><span class="quoted"><span class="quoted">"max <span class="main">(</span>norm <span class="skolem">max_r</span><span class="main">)</span> <span class="main">(</span>norm <span class="skolem">min_r</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span><span class="main">&gt;</span><span class="main">-</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">max_r</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="main">(</span><span class="skolem">min_r</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="main">(</span><span class="skolem">max_r</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">≤</span><span class="skolem">v</span>"</span></span>   
        <span class="keyword1"><span class="command">unfolding</span></span> u_def v_def <span class="keyword1"><span class="command">using</span></span> r_asm  <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span><span class="main">≤</span><span class="skolem">max_r</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span><span class="main">=</span>subpath <span class="main">0</span> <span class="skolem">u</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span><span class="main">=</span>subpath <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g3</span><span class="main">=</span>subpath <span class="skolem">v</span> <span class="main">1</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g1</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g2</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g3</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">g1</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">g2</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">g3</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g1_def g2_def g3_def <span class="keyword1"><span class="command">using</span></span> uv
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>path_subpath valid_path_subpath<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">wc_add</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="bound">g</span> <span class="main">0</span><span class="main">)</span>  <span class="main">+</span> cindex_pathE <span class="bound">g</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">wc_add</span> <span class="skolem">g1</span> <span class="main">+</span> <span class="skolem">wc_add</span> <span class="skolem">g2</span> <span class="main">+</span> <span class="skolem">wc_add</span> <span class="skolem">g3</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> winding_number <span class="skolem">g1</span> <span class="main">0</span> <span class="main">+</span> winding_number <span class="skolem">g2</span> <span class="main">0</span> <span class="main">+</span> winding_number <span class="skolem">g3</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g1_def g2_def g3_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> not_g_image
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_subpath_combine<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> cindex_pathE <span class="skolem">g1</span> <span class="main">0</span> <span class="main">+</span> cindex_pathE <span class="skolem">g2</span> <span class="main">0</span> <span class="main">+</span> cindex_pathE <span class="skolem">g3</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g1_def g2_def g3_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">≤</span><span class="skolem">v</span>›</span></span> not_g_image
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_subpath_combine<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wc_add_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="skolem">g2</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="skolem">g2</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g2</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g2_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_cindex_pathE_aux<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>finite_ReZ_segments_subpath<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>valid_path_subpath<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Path_Connected.path_image_subpath_subset <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> path <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span>›</span></span> not_g_image uv 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> subpath_def v_def g_def linepath_def <span class="keyword1"><span class="command">using</span></span> r_asm <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> Re_poly_of_real p_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> subpath_def u_def g_def linepath_def <span class="keyword1"><span class="command">using</span></span> r_asm <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> Re_poly_of_real p_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wc_add_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="skolem">g1</span><span class="main">=</span><span class="main">-</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> g1_pq<span class="main">:</span>
          <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span><span class="skolem">min_r</span><span class="main">*</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">t</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span><span class="skolem">min_r</span><span class="main">*</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">t</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span><span class="main">/</span>Re <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">min_r</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="skolem">t</span> <span class="main">=</span> poly <span class="free">pp</span> <span class="main">(</span>of_real <span class="main">(</span><span class="skolem">min_r</span><span class="main">*</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">t</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> g1_def g_def linepath_def subpath_def u_def p_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> 
              <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span><span class="skolem">min_r</span><span class="main">*</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">t</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span><span class="skolem">min_r</span><span class="main">*</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">t</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> p_def q_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Re_poly_of_real Im_poly_of_real<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span><span class="main">/</span>Re <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">min_r</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="skolem">g1</span> <span class="main">1</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>›</span></span> Re_poly_of_real <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span><span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> g1_def subpath_def u_def g_def linepath_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> p_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">g1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> path_image_subpath_subset <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> path <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span>›</span></span> 
              atLeastAtMost_iff g1_def le_less not_g_image subsetCE uv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_le_one<span class="main">)</span>
            
        <span class="keyword1"><span class="command">have</span></span> wc_add_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="skolem">h</span> <span class="main">=</span> <span class="main">-</span> arctan <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span> <span class="keyword2"><span class="keyword">when</span></span> 
          Re_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> hp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="main">(</span><span class="skolem">min_r</span><span class="main">*</span><span class="bound">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="bound">t</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> hq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="main">(</span><span class="skolem">min_r</span><span class="main">*</span><span class="bound">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="bound">t</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
          <span class="comment1">(*and hpq:"∀t. Im (h t)/Re (h t) = (f o (λx. (min_r+r)*x - r)) t"*)</span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">h</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> h_img<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">h</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span> <span class="skolem">c</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">farg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">farg</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_number_half_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_less<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h_img <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">farg</span> <span class="main">-</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">farg</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> farg_def path_defs
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Im_Ln_eq<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h_img <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> h_img 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pathstart_in_path_image<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span>Im <span class="main">(</span>pathstart <span class="skolem">h</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>pathstart <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Re_pos<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Im_Ln_eq path_defs<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> f_def path_defs hp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> hq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">farg</span> <span class="main">-</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">h</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">farg</span><span class="main">/</span>pi<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">h</span> <span class="main">0</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">min_r</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>hp hq f_def comp_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">min_r</span> <span class="skolem">f</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindexE_linear_comp<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> r_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">min_r</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">-</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">min_r</span><span class="main">}</span>"</span></span>
              <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">-</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">min_r</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="main">-</span><span class="skolem">r</span><span class="main">..&lt;</span><span class="skolem">min_r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≥</span><span class="skolem">min_r</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> min_max_bound<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="main">-</span><span class="skolem">r</span><span class="main">..&lt;</span><span class="skolem">min_r</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span>
                  <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>jumpF_not_infinity <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> 
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
                <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">min_r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="skolem">min_r</span><span class="main">}</span><span class="main">)</span>"</span></span>  
                <span class="keyword1"><span class="command">unfolding</span></span> left_def le_less <span class="keyword1"><span class="command">using</span></span> * r_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> left_def right_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">farg</span><span class="main">/</span>pi<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> p_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span> <span class="skolem">r</span><span class="main">&lt;..&lt;</span><span class="skolem">min_r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hh</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hh</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">min_r</span><span class="main">*</span><span class="bound">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="bound">t</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">min_r</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> that r_asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="main">(</span><span class="skolem">hh</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">min_r</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> Re_pos<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">unfolding</span></span> comp_def hp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>  hq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> hh_def <span class="keyword1"><span class="command">.</span></span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hh</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">min_r</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
                  <span class="keyword1"><span class="command">unfolding</span></span> hh_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span><span class="main">&gt;</span><span class="main">-</span><span class="skolem">r</span>›</span></span> 
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
              
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="skolem">min_r</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> no_real_zero <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Im_complex_of_real UNIV_I <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span> <span class="main">∈</span> proots <span class="skolem">p</span>›</span></span> cpoly_of_decompose 
                    mult_eq_0_iff p_def poly_cpoly_of_real_iff proots_within_iff q_def<span class="main">)</span>
                
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="skolem">min_r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> hp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">min_r</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">min_r</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> p_pos <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span><span class="main">&gt;</span><span class="main">-</span><span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">f</span> at_top <span class="main">(</span>at_left <span class="skolem">min_r</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">unfolding</span></span> f_def
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">*</span></span>poly <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">min_r</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span><span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> farg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="skolem">min_r</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> hp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">min_r</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">min_r</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> p_pos <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span><span class="main">&gt;</span><span class="main">-</span><span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">f</span> at_bot <span class="main">(</span>at_left <span class="skolem">min_r</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">unfolding</span></span> f_def
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">*</span></span>poly <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">min_r</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span><span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> farg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span> 
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wc_add_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command">qed</span></span>
        
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_def<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">=</span><span class="skolem">min_r</span><span class="main">*</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">t</span><span class="main">-</span><span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">m</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>poly <span class="free">pp</span> <span class="main">(</span>of_real <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> m_def g1_def g_def linepath_def subpath_def u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> t_def <span class="keyword1"><span class="command">unfolding</span></span> Re_poly_of_real p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="skolem">min_r</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_r</span><span class="main">+</span><span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">min_r</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">t</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>  
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> min_max_bound <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> continuous_on_neq_split<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">g1</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="main">(</span>uminus <span class="keyword1">o</span> <span class="skolem">g1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> f_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wc_add_pos<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> g1_pq that <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">g1</span>›</span></span>  
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_compose<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="main">(</span>uminus <span class="main">∘</span> <span class="skolem">g1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">wc_add</span> <span class="skolem">g1</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> wc_add_def cindex_pathE_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_uminus_comp<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">g1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> f_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wc_add_pos<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> g1_pq that <span class="quoted"><span class="quoted">‹<span class="skolem">min_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">g1</span>›</span></span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_compose<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="skolem">g3</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> pi"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> g3_pq<span class="main">:</span>
          <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span><span class="main">/</span>Re <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g3</span> <span class="skolem">t</span> <span class="main">=</span> poly <span class="free">pp</span> <span class="main">(</span>of_real <span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="skolem">r</span>›</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> g3_def g_def linepath_def subpath_def v_def p_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> 
              <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">q</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> p_def q_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Re_poly_of_real Im_poly_of_real<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span><span class="main">/</span>Re <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="skolem">g3</span> <span class="main">0</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>›</span></span> Re_poly_of_real <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> g3_def subpath_def v_def g_def linepath_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> p_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">g3</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> Path_Connected.path_image_subpath_subset <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> path <span class="main">(</span><span class="free">g</span> <span class="bound">r</span><span class="main">)</span>›</span></span> g3_def not_g_image uv<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
            
        <span class="keyword1"><span class="command">have</span></span> wc_add_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="skolem">h</span> <span class="main">=</span> arctan <span class="main">(</span>poly <span class="skolem">q</span> <span class="skolem">r</span> <span class="main">/</span> poly <span class="skolem">p</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> pi"</span></span> <span class="keyword2"><span class="keyword">when</span></span> 
          Re_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> hp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> hq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
          <span class="comment1">(*and hpq:"∀t. Im (h t)/Re (h t) = (f o (λx. (min_r+r)*x - r)) t"*)</span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">h</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> h_img<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">h</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span> <span class="skolem">c</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">farg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">farg</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_number_half_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_less<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h_img <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">farg</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">farg</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> farg_def path_defs
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Im_Ln_eq<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h_img <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> h_img 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pathfinish_in_path_image<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span>Im <span class="main">(</span>pathfinish <span class="skolem">h</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>pathfinish <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Re_pos<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Im_Ln_eq path_defs<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> f_def path_defs hp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> hq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">farg</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">h</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">farg</span><span class="main">/</span>pi"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">h</span> <span class="main">0</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>hp hq f_def comp_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="skolem">max_r</span> <span class="skolem">r</span> <span class="skolem">f</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindexE_linear_comp<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> r_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">max_r</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r</span><span class="main">}</span>"</span></span>
              <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">max_r</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">r</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">max_r</span><span class="main">&lt;..</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="skolem">max_r</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> min_max_bound<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">max_r</span><span class="main">&lt;..</span><span class="skolem">r</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span>
                  <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>jumpF_not_infinity <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> 
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
                <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="skolem">max_r</span><span class="main">}</span><span class="main">)</span>"</span></span>  
                <span class="keyword1"><span class="command">unfolding</span></span> right_def le_less <span class="keyword1"><span class="command">using</span></span> * r_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> left_def right_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">farg</span><span class="main">/</span>pi"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> p_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">max_r</span><span class="main">&lt;..&lt;</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hh</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hh</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span> <span class="main">+</span> <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> that r_asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="main">(</span><span class="skolem">hh</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> Re_pos<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
                  <span class="keyword1"><span class="command">unfolding</span></span> comp_def hp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>  hq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> hh_def <span class="keyword1"><span class="command">.</span></span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hh</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
                  <span class="keyword1"><span class="command">unfolding</span></span> hh_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="skolem">r</span>›</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
              
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="skolem">max_r</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> no_real_zero <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Im_complex_of_real UNIV_I <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span> <span class="main">∈</span> proots <span class="skolem">p</span>›</span></span> cpoly_of_decompose 
                    mult_eq_0_iff p_def poly_cpoly_of_real_iff proots_within_iff q_def<span class="main">)</span>
                
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="skolem">max_r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> hp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> p_pos <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">f</span> at_top <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">unfolding</span></span> f_def
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">*</span></span>poly <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">max_r</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> farg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">q</span> <span class="skolem">max_r</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> hp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">c</span><span class="main">*</span>poly <span class="skolem">p</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> p_pos <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">&lt;</span><span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">f</span> at_bot <span class="main">(</span>at_right <span class="skolem">max_r</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">unfolding</span></span> f_def
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">*</span></span>poly <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">max_r</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span><span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> farg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span> 
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wc_add_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command">qed</span></span>
        
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g3</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g3</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_def<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">=</span><span class="main">(</span><span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">max_r</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">m</span><span class="main">=</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g3</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>poly <span class="free">pp</span> <span class="main">(</span>of_real <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> m_def g3_def g_def linepath_def subpath_def v_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> t_def <span class="keyword1"><span class="command">unfolding</span></span> Re_poly_of_real p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="skolem">max_r</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">-</span><span class="skolem">max_r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">max_r</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span>›</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>  
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> min_max_bound <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g3</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g3</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> continuous_on_neq_split<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">g3</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g3</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="main">(</span>uminus <span class="keyword1">o</span> <span class="skolem">g3</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> f_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wc_add_pos<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> g3_pq that <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">g3</span>›</span></span>  
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_compose<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="main">(</span>uminus <span class="main">∘</span> <span class="skolem">g3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">wc_add</span> <span class="skolem">g3</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> wc_add_def cindex_pathE_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_uminus_comp<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">g3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">∘</span> <span class="skolem">g3</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> f_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wc_add_pos<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> g3_pq that <span class="quoted"><span class="quoted">‹<span class="skolem">max_r</span> <span class="main">∈</span>proots <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">g3</span>›</span></span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_compose<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wc_add</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi "</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> cindex_pathE <span class="main">(</span><span class="free">g</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> 
          <span class="main">=</span> <span class="main">(</span>arctan <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> arctan <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> wc_add_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> arctan_f_tendsto <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Count_Complex_Roots-proots_upper_cindex_eq"><span class="command">lemma</span></span> proots_upper_cindex_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> no_real_roots<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="free">p</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_upper <span class="free">p</span> <span class="main">=</span>
             <span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> cindex_poly_ubd <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span><span class="numeral">2</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_eq_zeroE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[:</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="free">p</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly_ubd <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_poly_ubd_code<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>map_poly_pCons changes_R_smods_def changes_poly_neg_inf_def 
        changes_poly_pos_inf_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> 
              <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span>linepath <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="main">(</span>of_real <span class="bound">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w2</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> part_circlepath <span class="main">0</span> <span class="bound">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cp</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> cindex_pathE <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> 
      of_real <span class="main">(</span>linepath <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">)</span> <span class="main">(</span>of_real <span class="bound">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ci</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ci</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> cindexE <span class="main">(</span><span class="main">-</span><span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">/</span>poly <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cubd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cubd</span> <span class="main">=</span>cindex_poly_ubd <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"proots <span class="free">p</span> <span class="main">⊆</span> ball <span class="main">0</span> <span class="skolem">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> finite_ball_include<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"proots <span class="free">p</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="skolem">w1</span> <span class="bound">r</span>  <span class="main">+</span><span class="skolem">w2</span> <span class="bound">r</span><span class="main">+</span> <span class="skolem">cp</span> <span class="bound">r</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span><span class="skolem">ci</span> <span class="bound">r</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>
       <span class="main">⤏</span> real <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> of_int <span class="skolem">cubd</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> t1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">w1</span> <span class="bound">r</span> <span class="main">+</span> <span class="skolem">cp</span> <span class="bound">r</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Re_winding_number_poly_linepth<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> w1_def cp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> t2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w2</span> <span class="main">⤏</span> real <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Re_winding_number_poly_part_circlepath<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹degree <span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> w2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> t3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ci</span> <span class="main">⤏</span> of_int <span class="skolem">cubd</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_eventually<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> cindex_poly_ubd_eventually<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map_poly Im <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"map_poly Re <span class="free">p</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> ci_def cubd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> tendsto_add<span class="main">[</span><span class="operator">OF</span> tendsto_add<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_mult_left<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> t3<span class="main"><span class="main"><span class="main">,</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span> 
         tendsto_mult_left<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> t1<span class="main"><span class="main"><span class="main">,</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
         t2<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="skolem">w1</span> <span class="bound">r</span>  <span class="main">+</span><span class="skolem">w2</span> <span class="bound">r</span><span class="main">+</span> <span class="skolem">cp</span> <span class="bound">r</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span><span class="skolem">ci</span> <span class="bound">r</span><span class="main">/</span><span class="numeral">2</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_top_linorderI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">R</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≥</span><span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r_ball<span class="main">:</span><span class="quoted"><span class="quoted">"proots <span class="free">p</span> <span class="main">⊆</span> ball <span class="main">0</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹proots <span class="free">p</span> <span class="main">⊆</span> ball <span class="main">0</span> <span class="skolem">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ll</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ll</span><span class="main">=</span>linepath <span class="main">(</span><span class="main">-</span> complex_of_real <span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span><span class="main">=</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> <span class="main">0</span> pi"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lr</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">+++</span> <span class="skolem">rr</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> img_ll<span class="main">:</span><span class="quoted"><span class="quoted">"path_image <span class="skolem">ll</span> <span class="main">⊆</span> <span class="main">-</span> proots <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> img_rr<span class="main">:</span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">rr</span> <span class="main">⊆</span> <span class="main">-</span> proots <span class="free">p</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> closed_segment_degen_complex<span class="main">(</span>2<span class="main">)</span> no_real_roots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">using</span></span> in_path_image_part_circlepath <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> r_ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> <span class="skolem">rr</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"valid_path <span class="skolem">ll</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">rr</span>"</span></span> 
        <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">rr</span><span class="main">=</span>pathstart <span class="skolem">ll</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">ll</span> <span class="main">=</span> pathstart <span class="skolem">rr</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> <span class="skolem">rr</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ll_def rr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>valid_path_compose_holomorphic<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">ll</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">rr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll_def rr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">rr</span><span class="main">=</span>pathstart <span class="skolem">ll</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">ll</span> <span class="main">=</span> pathstart <span class="skolem">rr</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ll_def rr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>proots <span class="free">p</span><span class="main">.</span> winding_number <span class="skolem">lr</span> <span class="bound">x</span> <span class="main">*</span> of_nat <span class="main">(</span>order <span class="bound">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_count_def of_nat_sum
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_cong_left<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> proots <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">lr</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>proots <span class="free">p</span> <span class="main">-</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">unfolding</span></span> lr_def ll_def rr_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">eval_winding</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> closed_segment <span class="main">(</span><span class="main">-</span> complex_of_real <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">r</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> img_ll that <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> path_image <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> <span class="main">0</span> pi<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> img_rr that <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> xr_facts<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> Im <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span><span class="main">&lt;</span>Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_real_roots that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> Im <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that r_ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abs_Re_le_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span><span class="main">&lt;</span>Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">ll</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_linepath<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> ll_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">rr</span> <span class="skolem">x</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">using</span></span> r_ball that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> cindex_pathE_circlepath_upper<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>cindex_pathE <span class="main">(</span>linepath <span class="main">(</span><span class="main">-</span> of_real <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
            cindex_pathE <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ll_def rr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>proots <span class="free">p</span> <span class="main">-</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">.</span> 
          winding_number <span class="skolem">lr</span> <span class="bound">i</span> <span class="main">*</span> of_nat <span class="main">(</span>order <span class="bound">i</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x_asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">lr</span> <span class="skolem">x</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lr_def ll_def rr_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">eval_winding</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> closed_segment <span class="main">(</span><span class="main">-</span> complex_of_real <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">r</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> img_ll x_asm <span class="keyword1"><span class="command">unfolding</span></span> ll_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> path_image <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> <span class="main">0</span> pi<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> img_rr x_asm <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> xr_facts<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Im <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span><span class="main">&lt;</span>Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Im <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_asm r_ball <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="skolem">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abs_Re_le_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span><span class="main">&lt;</span>Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">ll</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_linepath<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> ll_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">rr</span> <span class="skolem">x</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">using</span></span> r_ball x_asm
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> cindex_pathE_circlepath_upper<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> of_real <span class="main">(</span>cindex_pathE <span class="main">(</span>linepath <span class="main">(</span><span class="main">-</span> of_real <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span>
            of_real <span class="main">(</span>cindex_pathE <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="skolem">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>  
          <span class="keyword1"><span class="command">unfolding</span></span> ll_def rr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>order <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> winding_number <span class="skolem">lr</span> <span class="skolem">x</span> <span class="main">*</span> of_nat <span class="main">(</span>order <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> contour_integral <span class="skolem">lr</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> argument_principle_poly<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">lr</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> img_ll img_rr <span class="keyword1"><span class="command">unfolding</span></span> lr_def ll_def rr_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_join<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">lr</span><span class="main">)</span> <span class="main">0</span>"</span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span>"</span></span> <span class="quoted"><span class="skolem">lr</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> img_ll img_rr <span class="keyword1"><span class="command">unfolding</span></span> lr_def ll_def rr_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_join path_image_compose<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">lr</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">lr</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> Ints"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integer_winding_number<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> img_ll img_rr <span class="keyword1"><span class="command">unfolding</span></span> lr_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_image_join path_image_compose path_compose_join 
            pathstart_compose pathfinish_compose valid_path_imp_path<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eqI complex_is_Int_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> Re <span class="main">(</span>winding_number <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="skolem">rr</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lr_def path_compose_join <span class="keyword1"><span class="command">using</span></span> img_ll img_rr
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_join<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>valid_path_imp_path path_image_compose pathstart_compose pathfinish_compose<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">w1</span> <span class="skolem">r</span>  <span class="main">+</span><span class="skolem">w2</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> w1_def w2_def ll_def rr_def of_real_linepath <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> complex_of_real <span class="main">(</span><span class="skolem">w1</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">w2</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">w1</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">w2</span> <span class="skolem">r</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> of_real_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cp</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">ci</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cp</span> <span class="skolem">r</span> <span class="main">=</span> cindex_pathE <span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cp_def linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cp_def ci_def cindex_pathE_def f_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">r</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindexE_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">ci</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ci_def f_def Im_poly_of_real Re_poly_of_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">w2</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">cp</span> <span class="skolem">r</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">ci</span> <span class="skolem">r</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> real <span class="main">(</span>proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">::</span>real<span class="main">.</span> real <span class="main">(</span>proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⤏</span> real <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> of_int <span class="skolem">cubd</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> tendsto_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_const_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cubd_def proots_upper_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-cindexE_roots_on_horizontal_border"><span class="command">lemma</span></span> cindexE_roots_on_horizontal_border<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">≡</span>linepath <span class="free">a</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> of_real <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pqr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r_monic<span class="main">:</span><span class="quoted"><span class="quoted">"lead_coeff <span class="free">r</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r_proots<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="free">r</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">=</span>Im <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          cindexE <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span>poly <span class="free">q</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">q</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Im_complex_of_real UNIV_I imaginary_unit.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> proots_within_0 zero_neq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="main">[:</span><span class="skolem">b</span><span class="main">:]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_of_algebra_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="skolem">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">b</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cindexE_constI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qrg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qrg</span> <span class="main">=</span> poly <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span> <span class="main">∘</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span>poly <span class="skolem">p</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="skolem">p</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>
          <span class="main">=</span> cindexE <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">qrg</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="skolem">qrg</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qrg_def <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span>›</span></span> comp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="free">lb</span> <span class="free">ub</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Re <span class="free">a</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">s</span> <span class="main">-</span> Re <span class="skolem">b</span> <span class="main">)</span><span class="main">*</span> Im <span class="main">(</span><span class="skolem">qrg</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
           <span class="main">(</span><span class="main">(</span>Re <span class="free">a</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">s</span> <span class="main">-</span> Re <span class="skolem">b</span> <span class="main">)</span><span class="main">*</span> Re <span class="main">(</span><span class="skolem">qrg</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">b</span> <span class="main">=</span> Im <span class="free">a</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> Im <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def g_def linepath_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">qrg</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="skolem">qrg</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="free">a</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">s</span> <span class="main">-</span> Re <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="free">a</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">s</span> <span class="main">-</span> Re <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span> Re <span class="skolem">b</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="free">a</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">s</span> <span class="main">-</span> Re <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="free">a</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">s</span> <span class="main">-</span> Re <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>Re <span class="skolem">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="free">s</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="free">a</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="free">s</span> <span class="main">-</span> Re <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">=</span>Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">s</span> <span class="main">-</span> Re <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> tt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">qrg</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">tt</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">qrg</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span><span class="skolem">qrg</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="skolem">qrg</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span>poly <span class="free">q</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">q</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qrg_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> root<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lead_coeff_mult lead_coeff_pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_cancel_left2 one_poly_eq_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          root.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_neq_one<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> root <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Count_Complex_Roots-poly_decompose_by_proots"><span class="command">lemma</span></span> poly_decompose_by_proots<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span> <span class="main">∧</span> lead_coeff <span class="bound">q</span><span class="main">=</span><span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="bound">q</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="bound">r</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> pqr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> leadq<span class="main">:</span><span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q</span><span class="main">=</span><span class="main">1</span>"</span></span> 
                    <span class="keyword2"><span class="keyword">and</span></span> qball<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>proots <span class="skolem">q</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rball<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="skolem">r</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mult_zero_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> pqr qball rball that leadq <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_mult 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> pqr qball rball that leadq <span class="keyword1"><span class="command">unfolding</span></span> lead_coeff_mult 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_upper_cindex_eq'"><span class="command">lemma</span></span> proots_upper_cindex_eq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span><span class="main">=</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_upper <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span> 
              <span class="main">-</span> cindex_poly_ubd <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> poly_decompose_by_proots<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span><span class="main">]</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> pqr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> leadq<span class="main">:</span><span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q</span><span class="main">=</span><span class="main">1</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> qball<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="skolem">q</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rball<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>proots <span class="skolem">r</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>proots_upper <span class="free">p</span><span class="main">)</span> <span class="main">=</span> proots_upper <span class="skolem">q</span> <span class="main">+</span> proots_upper <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_def pqr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_count_times<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_upper <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">r</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rball <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_upper <span class="skolem">r</span> <span class="main">=</span><span class="main">0</span> "</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_def proots_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>degree <span class="skolem">q</span> <span class="main">-</span> cindex_poly_ubd <span class="main">(</span>map_poly Im <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>map_poly Re <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proots_upper_cindex_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> leadq qball<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span> 
                      <span class="main">-</span> cindex_poly_ubd <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">-</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">=</span> degree <span class="skolem">q</span> <span class="main">+</span> degree <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pqr
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> pqr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">=</span> proots_count <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> degree_proots_count proots_count_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> qball order_0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">r</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="free">p</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pqr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots <span class="skolem">r</span> <span class="main">=</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> pqr proots_within_times <span class="keyword1"><span class="command">using</span></span> qball rball <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly_ubd <span class="main">(</span>map_poly Im <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>map_poly Re <span class="skolem">q</span><span class="main">)</span> 
            <span class="main">=</span> cindex_poly_ubd <span class="main">(</span>map_poly Im <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">iq</span></span> <span class="skolem"><span class="skolem">rq</span></span> <span class="skolem"><span class="skolem">ip</span></span> <span class="skolem"><span class="skolem">rp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iq</span> <span class="main">=</span> map_poly Im <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rq</span><span class="main">=</span>map_poly Re <span class="skolem">q</span>"</span></span> 
                           <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ip</span><span class="main">=</span>map_poly Im <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rp</span> <span class="main">=</span> map_poly Re <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">iq</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="skolem">rq</span> <span class="bound">x</span><span class="main">)</span> 
              <span class="main">=</span> cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">ip</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="skolem">rp</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> pqr leadq <span class="quoted"><span class="quoted">‹lead_coeff <span class="free">p</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_degree_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                      cindexE <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>poly <span class="skolem">q</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cindexE_roots_on_horizontal_border<span class="main">[</span><span class="operator">OF</span> pqr<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span>
              <span class="main">,</span><span class="operator">unfolded</span> linepath_def comp_def<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> rball <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> scaleR_conv_of_real iq_def ip_def rq_def rp_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Im_poly_of_real Re_poly_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span><span class="main">::</span>real <span class="keyword1">in</span> at_top<span class="main">.</span>
        real_of_int <span class="main">(</span>cindex_poly_ubd <span class="skolem">iq</span> <span class="skolem">rq</span><span class="main">)</span> <span class="main">=</span> cindex_poly_ubd <span class="skolem">ip</span> <span class="skolem">rp</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_conj<span class="main">[</span><span class="operator">OF</span> cindex_poly_ubd_eventually<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">iq</span></span> <span class="quoted"><span class="skolem">rq</span></span><span class="main"><span class="main">]</span></span> 
                cindex_poly_ubd_eventually<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">ip</span></span> <span class="quoted"><span class="skolem">rp</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> iq_def rq_def ip_def rp_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*If we know that the polynomial p is squarefree, we can cope with the case when there're 
  roots on the border.*)</span>
<span class="keyword1" id="Count_Complex_Roots-proots_within_upper_squarefree"><span class="command">lemma</span></span> proots_within_upper_squarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&gt;</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
            <span class="bound">pp</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">;</span>
            <span class="bound">pI</span> <span class="main">=</span> map_poly Im <span class="bound">pp</span><span class="main">;</span>
            <span class="bound">pR</span> <span class="main">=</span> map_poly Re <span class="bound">pp</span><span class="main">;</span>
            <span class="bound">g</span> <span class="main">=</span> gcd <span class="bound">pR</span> <span class="bound">pI</span>
        <span class="keyword1">in</span>
            nat <span class="main">(</span><span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> changes_R_smods <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span> <span class="main">-</span> changes_R_smods <span class="bound">pR</span> <span class="bound">pI</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>  
      <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pI</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI</span> <span class="main">=</span> map_poly Im <span class="skolem">pp</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR</span> <span class="main">=</span> map_poly Re <span class="skolem">pp</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> gcd <span class="skolem">pR</span> <span class="skolem">pI</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&gt;</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> proots_upper <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_def <span class="keyword1"><span class="command">using</span></span> card_proots_within_rsquarefree<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_upper <span class="skolem">pp</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_def pp_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_smult<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>degree <span class="skolem">pp</span> <span class="main">-</span> proots_count <span class="skolem">pp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> cindex_poly_ubd <span class="skolem">pI</span> <span class="skolem">pR</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> proots_count <span class="skolem">pp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cpp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cpp</span> <span class="main">=</span> cindex_poly_ubd <span class="skolem">pI</span> <span class="skolem">pR</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"proots_upper <span class="skolem">pp</span> <span class="main">=</span> <span class="main">(</span>degree <span class="skolem">pp</span> <span class="main">-</span> <span class="skolem">rr</span> <span class="main">-</span> <span class="skolem">cpp</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_upper_cindex_eq'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">pp</span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> rr_def cpp_def pR_def pI_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>degree <span class="skolem">pp</span> <span class="main">-</span> <span class="skolem">rr</span> <span class="main">-</span> <span class="skolem">cpp</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> real_of_int_div<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">=</span>int <span class="main">(</span>degree <span class="skolem">pp</span> <span class="main">-</span> <span class="skolem">rr</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">cpp</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">tt</span><span class="main">=</span><span class="numeral">2</span><span class="main">*</span>proots_upper <span class="skolem">pp</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>*<span class="main"><span class="main">[</span></span><span class="operator">folded</span> tt_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_triv_left even_of_nat of_int_eq_iff of_int_of_nat_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr_def cpp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>degree <span class="skolem">pp</span> <span class="main">-</span> changes_R_smods <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span> 
                        <span class="main">-</span> cindex_poly_ubd <span class="skolem">pI</span> <span class="skolem">pR</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="skolem">pp</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms rsquarefree_smult_iff <span class="keyword1"><span class="command">unfolding</span></span> pp_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inverse_eq_imp_eq inverse_zero leading_coeff_neq_0 rsquarefree_0<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> card_proots_within_rsquarefree<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">pp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">pp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">pp</span> <span class="main">(</span>unbounded_line <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> unbounded_line <span class="main">0</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> unbounded_line_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_is_Real_iff of_real_Re of_real_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> changes_R_smods <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> card_proots_unbounded_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">pp</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">folded</span> pI_def pR_def<span class="main">]</span> g_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def sturm_R<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">pp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> changes_R_smods <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">pp</span> <span class="main">≥</span> proots_count <span class="skolem">pp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹rsquarefree <span class="skolem">pp</span>›</span></span> proots_count_leq_degree rsquarefree_0<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> changes_R_smods <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span> 
                        <span class="main">-</span> changes_R_smods <span class="skolem">pR</span> <span class="skolem">pI</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cindex_poly_ubd_code <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> changes_R_smods <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span> <span class="main">-</span>
                  changes_R_smods <span class="skolem">pR</span> <span class="skolem">pI</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Let_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pp_def pR_def pI_def g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Count_Complex_Roots-proots_upper_code1"><span class="command">lemma</span></span> proots_upper_code1<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_upper <span class="free">p</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span>
       <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pp</span><span class="main">=</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">;</span>
            <span class="bound">pI</span><span class="main">=</span>map_poly Im <span class="bound">pp</span><span class="main">;</span>
            <span class="bound">pR</span><span class="main">=</span>map_poly Re <span class="bound">pp</span><span class="main">;</span>
            <span class="bound">g</span> <span class="main">=</span> gcd <span class="bound">pI</span> <span class="bound">pR</span>
        <span class="keyword1">in</span>
            nat <span class="main">(</span><span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> nat <span class="main">(</span>changes_R_smods_ext <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> changes_R_smods <span class="bound">pR</span> <span class="bound">pI</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> 
        <span class="main">)</span>
    <span class="keyword1">else</span> 
      Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_upper fails when p=0.''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_upper <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pI</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI</span> <span class="main">=</span> map_poly Im <span class="skolem">pp</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR</span><span class="main">=</span>map_poly Re <span class="skolem">pp</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> gcd <span class="skolem">pI</span> <span class="skolem">pR</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span><span class="main">=</span>int <span class="main">(</span>degree <span class="skolem">pp</span> <span class="main">-</span> proots_count <span class="skolem">pp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> cindex_poly_ubd <span class="skolem">pI</span> <span class="skolem">pR</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_upper <span class="skolem">pp</span> <span class="main">=</span> <span class="skolem">rr</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> proots_upper_cindex_eq'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">pp</span></span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> pI_def pR_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> pp_def lead_coeff_smult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_upper <span class="skolem">pp</span> <span class="main">=</span> nat <span class="main">(</span><span class="skolem">rr</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">-</span> nat <span class="main">(</span>changes_R_smods_ext <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> changes_R_smods <span class="skolem">pR</span> <span class="skolem">pI</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">pp</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="skolem">pp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> nat <span class="main">(</span>changes_R_smods_ext <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> unbounded_line <span class="main">0</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> unbounded_line_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> proots_unbounded_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">pp</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">folded</span> pI_def pR_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Let_def g_def gcd.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly_ubd <span class="skolem">pI</span> <span class="skolem">pR</span> <span class="main">=</span> changes_R_smods <span class="skolem">pR</span> <span class="skolem">pI</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindex_poly_ubd_code <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_upper <span class="skolem">pp</span> <span class="main">=</span> proots_upper <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pp_def proots_upper_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_smult<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pp_def pI_def pR_def g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_upper_card_code"><span class="command">lemma</span></span> proots_upper_card_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_upper_card <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span>
      <span class="main">(</span><span class="keyword1">let</span>
            <span class="bound">pf</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
            <span class="bound">pp</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="bound">pf</span><span class="main">)</span><span class="main">)</span> <span class="bound">pf</span><span class="main">;</span>
            <span class="bound">pI</span> <span class="main">=</span> map_poly Im <span class="bound">pp</span><span class="main">;</span>
            <span class="bound">pR</span> <span class="main">=</span> map_poly Re <span class="bound">pp</span><span class="main">;</span>
            <span class="bound">g</span> <span class="main">=</span> gcd <span class="bound">pR</span> <span class="bound">pI</span>
        <span class="keyword1">in</span>
            nat <span class="main">(</span><span class="main">(</span>degree <span class="bound">pf</span> <span class="main">-</span> changes_R_smods <span class="bound">g</span> <span class="main">(</span>pderiv <span class="bound">g</span><span class="main">)</span> <span class="main">-</span> changes_R_smods <span class="bound">pR</span> <span class="bound">pI</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>  
      <span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_card_def <span class="keyword1"><span class="command">using</span></span> infinite_halfspace_Im_gt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pf</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="skolem"><span class="skolem">pI</span></span> <span class="skolem"><span class="skolem">pR</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">pf</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="skolem">pf</span><span class="main">)</span><span class="main">)</span> <span class="skolem">pf</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pI</span> <span class="main">=</span> map_poly Im <span class="skolem">pp</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pR</span> <span class="main">=</span> map_poly Re <span class="skolem">pp</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> gcd <span class="skolem">pR</span> <span class="skolem">pI</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_upper_card <span class="free">p</span> <span class="main">=</span> proots_upper_card <span class="skolem">pf</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> proots_within <span class="skolem">pf</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">using</span></span> poly_gcd_pderiv_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span><span class="operator">folded</span> pf_def<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_card_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nat <span class="main">(</span><span class="main">(</span>degree <span class="skolem">pf</span> <span class="main">-</span> changes_R_smods <span class="skolem">g</span> <span class="main">(</span>pderiv <span class="skolem">g</span><span class="main">)</span> <span class="main">-</span> changes_R_smods <span class="skolem">pR</span> <span class="skolem">pI</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> proots_within_upper_squarefree<span class="main">[</span><span class="operator">OF</span> rsquarefree_gcd_pderiv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span>
        <span class="main">,</span><span class="operator">unfolded</span> Let_def<span class="main">,</span><span class="operator">folded</span> pf_def<span class="main">,</span><span class="operator">folded</span> pp_def pI_def pR_def g_def<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_card_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Let_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pf_def<span class="main"><span class="keyword3">,</span></span><span class="operator">fold</span> pp_def pI_def pR_def g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial roots on a general half-plane›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹the number of roots of polynomial <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, counted with multiplicity,
   on the left half plane of the vector <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_half</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_half</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> proots_count <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>    
  
<span class="keyword1" id="Count_Complex_Roots-proots_half_empty"><span class="command">lemma</span></span> proots_half_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_half <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
<span class="keyword1"><span class="command">unfolding</span></span> proots_half_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

<span class="comment1">(*TODO: the proof can potentially simplified with some conformal properties.*)</span>
<span class="keyword1" id="Count_Complex_Roots-proots_half_proots_upper"><span class="command">lemma</span></span> proots_half_proots_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_half <span class="free">p</span> <span class="free">a</span> <span class="free">b</span><span class="main">=</span> proots_upper <span class="main">(</span>pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">:]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span>proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> order <span class="bound">r</span> <span class="free">p</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span>proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span><span class="main">.</span> order <span class="bound">r</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> f_def inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="main">(</span>proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> inj_on_subset<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x_asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span><span class="main">=</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">xx</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
        <span class="keyword1"><span class="command">unfolding</span></span> q_def xx_def poly_pcompose <span class="keyword1"><span class="command">using</span></span> assms x_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">xx</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> xx_def <span class="keyword1"><span class="command">using</span></span> x_asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">xx</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def xx_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="free">p</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="main">(</span><span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> f_def q_def <span class="keyword1"><span class="command">using</span></span> assms 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_0I<span class="main">)</span>        
        <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_0I<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> poly_pcompose q_def <span class="keyword1"><span class="command">using</span></span> no_proots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">c</span> <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">c</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">+</span> order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  order <span class="skolem">x</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">+</span>  order <span class="skolem">x</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">c</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> q_def f_def pcompose_pCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> order_smult<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> assms order_power_n_n<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True order_power_n_n<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_0I<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_0I<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> f_def q_def poly_pcompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> root<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="main">(</span><span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">q</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> pcompose_mult
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> pcompose_eq_0 root.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_half_def proots_upper_def proots_count_def q_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>    
     
<span class="keyword1" id="Count_Complex_Roots-proots_half_code1"><span class="command">lemma</span></span> proots_half_code1<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_half <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="keyword1">then</span> 
                        <span class="keyword1">if</span> <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="keyword1">then</span> proots_upper <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">:]</span><span class="main">)</span> 
                        <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_half fails when p=0.''</span><span class="main">)</span> 
                          <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_half <span class="free">p</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> 
                        <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> proots_half_empty that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> proots_half_proots_upper<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial roots within a circle (open ball)›</span></span>

<span class="comment1">― ‹Roots counted WITH multiplicity›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_ball</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> real <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_ball</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> proots_count <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>ball <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span> 

<span class="comment1">― ‹Roots counted WITHOUT multiplicity›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_ball_card</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> real <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_ball_card</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>ball <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_ball_code1"><span class="command">lemma</span></span> proots_ball_code1<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_ball <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="free">r</span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> 
                              <span class="main">0</span>
                          <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">p</span><span class="main">≠</span><span class="main">0</span> <span class="keyword1">then</span>
                              proots_upper <span class="main">(</span>fcompose <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> 
                          <span class="keyword1">else</span> 
                              Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''proots_ball fails when p=0.''</span><span class="main">)</span> 
                                <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> proots_ball <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span><span class="main">)</span>
                        <span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">r</span><span class="main">≤</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_ball <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span> <span class="main">=</span> proots_count <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_ball_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_uball_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> arg_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_upper <span class="main">(</span>fcompose <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_ball_plane_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> arg_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> False pcompose_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>proots_ball_def ball_empty<span class="main">)</span>

<span class="keyword1" id="Count_Complex_Roots-proots_ball_card_code1"><span class="command">lemma</span></span> proots_ball_card_code1<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_ball_card <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span> <span class="main">=</span> 
                <span class="main">(</span> <span class="keyword1">if</span> <span class="free">r</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> 
                      <span class="main">0</span>
                 <span class="keyword1">else</span> 
                    proots_upper_card <span class="main">(</span>fcompose <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> 
                        <span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">r</span><span class="main">≤</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≤</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">(</span>ball <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ball_empty that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_ball_card_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_ball_card_def <span class="keyword1"><span class="command">using</span></span> that infinite_ball<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">z0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_ball_card <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span>ball <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_ball_card_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proots_card_uball_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> arg_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_upper_card <span class="main">(</span>fcompose <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proots_upper_card_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_card_ball_plane_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> arg_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> False pcompose_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial roots on a circle (sphere)›</span></span>

<span class="comment1">― ‹Roots counted WITH multiplicity›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_sphere</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> real <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_sphere</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> proots_count <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>sphere <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span> 

<span class="comment1">― ‹Roots counted WITHOUT multiplicity›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_sphere_card</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> real <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_sphere_card</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>sphere <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Count_Complex_Roots-proots_sphere_card_code1"><span class="command">lemma</span></span> proots_sphere_card_code1<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_sphere_card <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span> <span class="main">=</span> 
                <span class="main">(</span> <span class="keyword1">if</span> <span class="free">r</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> 
                      <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">z0</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> 
                  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> 
                      <span class="main">0</span>
                  <span class="keyword1">else</span> 
                    <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span>
                    proots_unbounded_line_card <span class="main">(</span>fcompose <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>
                      <span class="main">0</span> <span class="main">1</span> 
                <span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="free">z0</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">z0</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_sphere_card_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">(</span>sphere <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ball_empty that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_sphere_card_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proots_sphere_card_def <span class="keyword1"><span class="command">using</span></span> that infinite_sphere<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">z0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ppp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ppp</span><span class="main">=</span>fcompose <span class="skolem">pp</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">using</span></span> that pcompose_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_sphere_card <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">pp</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proots_sphere_card_def pp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proots_card_usphere_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> arg_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">pp</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> proots_within <span class="skolem">pp</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb proots_within_union<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">pp</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">pp</span> <span class="main">(</span>sphere <span class="main">0</span> <span class="main">1</span> <span class="main">-</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_Un_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="skolem">pp</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="skolem">ppp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> proots_card_sphere_axis_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">pp</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">folded</span> ppp_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> proots_unbounded_line_card <span class="skolem">ppp</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="skolem">pp</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>poly_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">pp</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> unbounded_line <span class="main">0</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> unbounded_line_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_is_Real_iff of_real_Re of_real_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>proots_within <span class="skolem">ppp</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">)</span>
                        <span class="main">=</span> proots_unbounded_line_card <span class="skolem">ppp</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> proots_unbounded_line_card_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pp_def<span class="main"><span class="keyword3">,</span></span><span class="operator">fold</span> ppp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial roots on a closed ball›</span></span>

<span class="comment1">― ‹Roots counted WITH multiplicity›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_cball</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> real <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_cball</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> proots_count <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>cball <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span> 

<span class="comment1">― ‹Roots counted WITHOUT multiplicity›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proots_cball_card</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex <span class="main">⇒</span> real <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proots_cball_card</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>cball <span class="free"><span class="bound"><span class="entity">z0</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*FIXME: this surely can be optimised/refined.*)</span>
<span class="keyword1" id="Count_Complex_Roots-proots_cball_card_code1"><span class="command">lemma</span></span> proots_cball_card_code1<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"proots_cball_card <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span> <span class="main">=</span> 
                <span class="main">(</span> <span class="keyword1">if</span> <span class="free">r</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> 
                      <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">z0</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> 
                  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> 
                      <span class="main">0</span>
                  <span class="keyword1">else</span> 
                    <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">pp</span><span class="main">=</span>fcompose <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> 
                      <span class="keyword1">in</span> 
                        <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> 
                        <span class="main">+</span> proots_unbounded_line_card <span class="bound">pp</span> <span class="main">0</span> <span class="main">1</span> 
                        <span class="main">+</span> proots_upper_card <span class="bound">pp</span>
                    <span class="main">)</span>
                <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">{</span><span class="free">z0</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">z0</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_cball_card_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_within <span class="free">p</span> <span class="main">(</span>cball <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ball_empty that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_cball_card_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> proots_cball_card_def <span class="keyword1"><span class="command">using</span></span> that infinite_cball<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">z0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">=</span>fcompose <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">z0</span><span class="main">,</span> of_real <span class="free">r</span><span class="main">:]</span><span class="main">)</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_cball_card <span class="free">p</span> <span class="free">z0</span> <span class="free">r</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>sphere <span class="free">z0</span> <span class="free">r</span><span class="main">)</span> 
                                        <span class="main">∪</span> proots_within <span class="free">p</span> <span class="main">(</span>ball <span class="free">z0</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> proots_cball_card_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>proots_within_union<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_partition cball_diff_sphere sphere_cball<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>sphere <span class="free">z0</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>proots_within <span class="free">p</span> <span class="main">(</span>ball <span class="free">z0</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_Un_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> proots_unbounded_line_card <span class="skolem">pp</span> <span class="main">0</span> <span class="main">1</span> 
                        <span class="main">+</span> proots_upper_card <span class="skolem">pp</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> proots_sphere_card_code1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">z0</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">,</span><span class="operator">folded</span> pp_def<span class="main">,</span><span class="operator">unfolded</span> proots_sphere_card_def<span class="main">]</span> 
        proots_ball_card_code1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">z0</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">,</span><span class="operator">folded</span> pp_def<span class="main">,</span><span class="operator">unfolded</span> proots_ball_card_def<span class="main">]</span>
        that
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> pp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
  
</pre>
</div><div id="Count_Complex_Roots_Examples">
<div class="head">
<h1>Theory Count_Complex_Roots_Examples</h1>
</div>
<pre class="source"><span class="comment1">(*
Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some examples for complex root counting›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Count_Complex_Roots_Examples
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Count_Complex_Roots.html">Count_Complex_Roots</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*the result will be 1, as the polynomial P(x) = ii*x^2 - 2*ii has exactly one complex root 
  (i.e. sqrt(2)*ii) (counted with multiplicity) within the rectangle box (-1,2+2*ii)*)</span>  
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"proots_rectangle <span class="main">[:</span><span class="numeral">2</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="keyword1">𝗂</span><span class="main">:]</span> <span class="main">(</span>Complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Complex <span class="numeral">2</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
 
<span class="comment1">(*the result will be 2, as the polynomial P(x) = x^2 - 2*ii*x - 1 has exactly two complex roots (i.e. 
  ii with multiplicity 2) within the rectangle box (-1,2+2*ii)*)</span>  
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"proots_rectangle <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> 
          <span class="main">(</span>Complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Complex <span class="numeral">2</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>  
  
<span class="comment1">(*the result will be 2, as the polynomial P(x) = x^2 + (2-ii)*x + (1-ii) has exactly two complex 
  roots (i.e. -1 and -1+ii) within the left half plane of the vector (0,1) (i.e. left plane of
  the imaginary axis)*)</span>    
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"proots_half <span class="main">[:</span><span class="main">1</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="numeral">2</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> 
        <span class="main">0</span> <span class="main">(</span>Complex <span class="main">0</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
 
<span class="comment1">(*the result will be 0, as the polynomial P(x) = x^2 + (2-ii)*x + (1-ii) has no root 
  within the left half plane of the vector (0,-1) (i.e. right plane of the imaginary axis) *)</span>    
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"proots_half <span class="main">[:</span><span class="main">1</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="numeral">2</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">(</span>Complex <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">0</span>"</span></span>  
  
<span class="comment1">(*
The following two will fail, as our method fails when there is a root on the border. This is 
something I may want to improve in the future.
  
value [code] "proots_half [:i,1:] (Complex 0 1) 0"
value [code] "proots_rectangle [:0,1:] (Complex (-1) 0) (Complex 2 2)"  
*)</span>  

<span class="comment1">(*the result will be 3, as the polynomial P(x) = (x-2)^2*(x-3) has three complex roots counted 
  with multiplicity within the circle centered as 0 with radius 4.*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"proots_ball <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">*</span><span class="main">[:</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">*</span><span class="main">[:</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">0</span> <span class="numeral">4</span>"</span></span>

<span class="comment1">(*The following one will fail, as proots_ball cannot deal with the case when there is a root 
  on the border. This is something I may want to improve in the future.

value [code] "proots_ball ([:-2,1:]*[:-2,1:]*[:-3,1:]) 0 3"
*)</span>

<span class="comment1">(*However, for now, we can count DISTINCT complex roots even when there are roots on the border*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"proots_ball_card <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">*</span><span class="main">[:</span><span class="main">-</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">*</span><span class="main">[:</span><span class="main">-</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">0</span> <span class="numeral">3</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>