<div id="Missing_Topology">
<div class="head">
<h1>Theory Missing_Topology</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some useful lemmas in topology›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Missing_Topology <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>    
 
<span class="keyword1"><span class="command">lemma</span></span> open_times_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_normed_field set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"open <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="main">(</span><span class="main">(*)</span> <span class="free">c</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(*)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="var">?f</span> <span class="main">-`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹open <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>open_vimage<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">`</span> <span class="free">S</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">-`</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>   
 
<span class="keyword1"><span class="command">lemma</span></span> image_linear_greaterThan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span> <span class="main">&lt;..}</span> <span class="keyword1">else</span> <span class="main">{..&lt;</span> <span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>image_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">y</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">y</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_linear_lessThan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{..&lt;</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>image_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">y</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">y</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="free"><span class="free"><span class="free">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
 
<span class="keyword1"><span class="command">lemma</span></span> continuous_on_neq_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linear_continuum_topology <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>linorder_topology"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">&gt;</span><span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">aaa</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aa</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">aa</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">aaa</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">∨</span> <span class="free">f</span> <span class="skolem">aaa</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Topological_Spaces.connected_continuous_image assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
          connectedD_interval image_eqI linorder_not_le<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linorder_topology <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>topological_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> continuous_on_at_left<span class="main">:</span><span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> continuous_on_at_right<span class="main">:</span><span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="free">b</span> <span class="keyword1">within</span> <span class="main">{..</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> bot"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{..</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closure <span class="main">(</span><span class="main">{..</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{..</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span>closure <span class="main">(</span><span class="main">{..</span><span class="free">a</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> at_within_eq_bot_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">b</span> <span class="keyword1">within</span> <span class="main">{..</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">b</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> continuous_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">b</span> <span class="keyword1">within</span> <span class="main">{..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Lim_Un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">b</span> <span class="keyword1">within</span> <span class="main">{..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> tendsto_within_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> continuous_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">b</span><span class="main">..}</span> <span class="main">=</span> bot"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="free">b</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closure <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">..}</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∉</span>closure <span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">..}</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> at_within_eq_bot_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">b</span><span class="main">..}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> continuous_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">..}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Lim_Un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">..}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> tendsto_within_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> continuous_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">eventually</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>    
    
<span class="keyword1"><span class="command">lemma</span></span> eventually_comp_filtermap<span class="main">:</span>
    <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟷</span> eventually <span class="free">P</span> <span class="main">(</span>filtermap <span class="free">f</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">using</span></span> eventually_filtermap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> eventually_uminus_at_top_at_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ordered_ab_group_add<span class="main">,</span>linorder<span class="main">}</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> uminus<span class="main">)</span> at_bot <span class="main">⟷</span> eventually <span class="free">P</span> at_top"</span></span>
    <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> uminus<span class="main">)</span> at_top <span class="main">⟷</span> eventually <span class="free">P</span> at_bot"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_comp_filtermap
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> at_top_mirror at_bot_mirror<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> eventually_at_infinityI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_normed_vector <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">≤</span> norm <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="free">P</span> at_infinity"</span></span>  
<span class="keyword1"><span class="command">unfolding</span></span> eventually_at_infinity <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
<span class="keyword1"><span class="command">lemma</span></span> eventually_at_bot_linorderI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linorder"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="free">P</span> at_bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_bot_linorder<span class="main">)</span>     

<span class="keyword1"><span class="command">lemma</span></span> eventually_times_inverse_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span>t2_space<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms tendsto_imp_eventually_ne <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">filtermap</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> filtermap_linear_at_within<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"isCont <span class="free">f</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> open_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">⟹</span> open <span class="main">(</span><span class="free">f</span><span class="main">`</span><span class="bound">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">at</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">f</span><span class="main">`</span><span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filter_eq_iff
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>filtermap <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> impP<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="free">a</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">⟶</span> <span class="skolem">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_filtermap eventually_at_topological<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_topological
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span><span class="main"><span class="main">`</span></span><span class="skolem"><span class="skolem">T</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span> open_map <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_pointE imageE imageI<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">T1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">∈</span> <span class="skolem">T1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> impP<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">T1</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="free">f</span> <span class="free">a</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∈</span><span class="free">f</span><span class="main">`</span><span class="free">S</span><span class="main">⟶</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_topological <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">T2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">T2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span><span class="skolem">T2</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="skolem">T1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> cont<span class="main">[</span><span class="operator">unfolded</span> continuous_at_open<span class="main">,</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">T1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">T2</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="free">a</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">⟶</span> <span class="skolem">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> impP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bij_pointE imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>filtermap <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_filtermap eventually_at_topological 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">T2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹open <span class="skolem">T2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> <span class="skolem">T2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> filtermap_at_bot_linear_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> at_bot <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> at_bot <span class="keyword1">else</span> at_top<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> at_bot <span class="main">=</span> at_bot"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> filtermap_fun_inverse<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">/</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_bot_linorder filterlim_at_bot
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_bot_linorder filterlim_at_bot
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute real_affinity_le<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> at_bot <span class="main">=</span> at_top"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> filtermap_fun_inverse<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">/</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder filterlim_at_bot
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_diff_eq neg_divide_le_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_bot_linorder filterlim_at_top
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False diff_le_eq le_divide_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> filtermap_linear_at_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linordered_field<span class="main">,</span>linorder_topology<span class="main">,</span>real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> at_left <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="keyword1">else</span> at_right <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="var">?f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filtermap_linear_at_within<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> o_bij<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="free">c</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="var">?f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">⟹</span> open <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="bound">S</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> open_times_image<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">THEN</span> open_translation<span class="main">,</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>image_image add.commute<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="main">(</span><span class="var">?f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="keyword1">at</span> <span class="main">(</span><span class="var">?f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span>  <span class="main">{..&lt;</span><span class="var">?f</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> image_linear_lessThan<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span>  <span class="main">{</span><span class="var">?f</span> <span class="free">x</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> image_linear_lessThan<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> filtermap_linear_at_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linordered_field<span class="main">,</span>linorder_topology<span class="main">,</span>real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> at_right <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="keyword1">else</span> at_left <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="var">?f</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="var">?f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filtermap_linear_at_within<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> o_bij<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="free">c</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="var">?f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">⟹</span> open <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="bound">S</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> open_times_image<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">THEN</span> open_translation<span class="main">,</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>image_image add.commute<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="main">(</span><span class="var">?f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..}</span> <span class="main">=</span> <span class="keyword1">at</span> <span class="main">(</span><span class="var">?f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">`</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..}</span> <span class="main">=</span>  <span class="main">{</span><span class="var">?f</span> <span class="free">x</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> image_linear_greaterThan<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">`</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..}</span> <span class="main">=</span>  <span class="main">{..&lt;</span><span class="var">?f</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> image_linear_greaterThan<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> filtermap_at_top_linear_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> at_top <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> at_top <span class="keyword1">else</span> at_bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> at_top <span class="main">=</span> at_top"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> filtermap_fun_inverse<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">/</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder filterlim_at_top 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_diff_eq pos_le_divide_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder filterlim_at_top
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute real_le_affinity<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> at_top <span class="main">=</span> at_bot"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> filtermap_fun_inverse<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">/</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_bot_linorder filterlim_at_top
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder filterlim_at_bot
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_diff_eq neg_divide_le_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> filtermap_nhds_open_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"isCont <span class="free">f</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> open_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> open <span class="bound">S</span> <span class="main">⟹</span> open <span class="main">(</span><span class="free">f</span><span class="main">`</span><span class="bound">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="free">f</span> <span class="main">(</span>nhds <span class="free">a</span><span class="main">)</span> <span class="main">=</span> nhds <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filter_eq_iff
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>filtermap <span class="free">f</span> <span class="main">(</span>nhds <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_filtermap eventually_nhds<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>nhds <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_nhds 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span><span class="main"><span class="main">`</span></span><span class="skolem"><span class="skolem">S</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> open_map<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> filterlim_iff tendsto_at_iff_tendsto_nhds isCont_def eventually_filtermap cont<span class="main">)</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">filterlim</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_infinity_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_infinity <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">g</span> at_infinity <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> at_infinity <span class="free">F</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span> <span class="main">*</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult tendsto_inverse assms filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_inverse_0<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> filterlim_at_infinity_imp_eventually_ne tendsto_imp_eventually_ne eventually_conj<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_inverse_at_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>   
  
<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_top_at_bot<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>unbounded_dense_linorder"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> top<span class="main">:</span><span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bot<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted">True</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> top <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_top_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bot <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_bot_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_conj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_top_nhds<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>      
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>unbounded_dense_linorder<span class="main">,</span>order_topology<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> top<span class="main">:</span><span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">&gt;</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gt_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> top <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_top_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">c'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> order_tendstoD<span class="main">[</span><span class="operator">OF</span> tendsto<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c'</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span><span class="main">&gt;</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">c'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_conj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_bot_nhds<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>      
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>unbounded_dense_linorder<span class="main">,</span>order_topology<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> top<span class="main">:</span><span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">&lt;</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> top <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_bot_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">c'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> order_tendstoD<span class="main">[</span><span class="operator">OF</span> tendsto<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c'</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">c'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_conj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_top_linear_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_field <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">:&gt;</span> <span class="free">F2</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="free">F2</span><span class="main">)</span> 
            <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="free">F2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filterlim_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filtermap_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">c</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>filtermap_at_top_linear_eq<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_bot_linear_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_field <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">:&gt;</span> <span class="free">F2</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="free">F2</span><span class="main">)</span> 
            <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="free">F2</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filterlim_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filtermap_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">c</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>filtermap_at_bot_linear_eq<span class="main">)</span>      
  
  
<span class="keyword1"><span class="command">lemma</span></span> filterlim_tendsto_add_at_top_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>     
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">g</span> at_top <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_add_at_top 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>filterlim_tendsto_add_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span>    
    
  
<span class="keyword1"><span class="command">lemma</span></span> filterlim_tendsto_add_at_bot_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> 
        <span class="main">⟷</span>  <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>  <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_uminus_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_cong<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span>  <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_tendsto_add_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span>  <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_uminus_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_cong<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> tendsto_inverse_0_at_infinity<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_infinity <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> filterlim_at filterlim_inverse_at_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_infinity_divide_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_infinity<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_infinity"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_infinity"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_mult_filterlim_at_infinity<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"inverse <span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ asm<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tendsto_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_infinity"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_mono_eventually<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eventually_times_inverse_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_inverse_at_iff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_infinity <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filterlim_compose filterlim_inverse_at_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_infinity"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_mult_filterlim_at_infinity<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse<span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> filterlim_tendsto_pos_mult_at_top_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">g</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_pos_mult_at_top<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> inverse <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tendsto_inverse<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">c</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_pos_mult_at_top<span class="main">[</span><span class="operator">OF</span> _ _ asm<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_mono_eventually<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_times_inverse_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> eventually_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> filterlim_tendsto_pos_mult_at_bot_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">⟷</span> filterlim <span class="free">g</span> at_bot <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_pos_mult_at_top_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span>"</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> filterlim_uminus_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    

<span class="keyword1"><span class="command">lemma</span></span> filterlim_tendsto_neg_mult_at_top_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_tendsto_pos_mult_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> filterlim_uminus_at_bot<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_tendsto_neg_mult_at_bot_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> <span class="free">c</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">⟷</span> filterlim <span class="free">g</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_neg_mult_at_top_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span>"</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> filterlim_uminus_at_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    

<span class="keyword1"><span class="command">lemma</span></span> Lim_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>t2_space<span class="main">,</span>topological_monoid_add<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="bound">y</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="bound">y</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Lim <span class="free">F</span> <span class="free">f</span> <span class="main">+</span> Lim <span class="free">F</span> <span class="free">g</span> <span class="main">=</span> Lim <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">+</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_Lim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms tendsto_Lim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="comment1">(*
lemma filterlim_at_top_tendsto[elim]:
  fixes f::"'a ⇒ 'b::{unbounded_dense_linorder,order_topology}" and F::"'a filter"
  assumes top:"filterlim f at_top F" and tendsto: "(f ⤏ c) F" 
          and "F≠bot"
  shows False
proof -
  obtain cc where "cc&gt;c" using gt_ex by blast
  have "∀<span class="hidden">⇩</span><sub>F</sub> x in F. cc &lt; f x" 
    using top unfolding filterlim_at_top_dense by auto
  moreover have "∀<span class="hidden">⇩</span><sub>F</sub> x in F. f x &lt; cc" 
    using tendsto order_tendstoD(2)[OF _ ‹cc&gt;c›] by auto
  ultimately have "∀<span class="hidden">⇩</span><sub>F</sub> x in F. cc &lt; f x ∧ f x &lt; cc" 
    using eventually_conj by auto
  then have "∀<span class="hidden">⇩</span><sub>F</sub> x in F. False" by (auto elim:eventually_mono)
  then show False using ‹F≠bot› by auto
qed

lemma filterlim_at_bot_tendsto[elim]:
  fixes f::"'a ⇒ 'b::{unbounded_dense_linorder,order_topology}" and F::"'a filter"
  assumes top:"filterlim f at_bot F" and tendsto: "(f ⤏ c) F" 
          and "F≠bot"
  shows False
proof -
  obtain cc where "cc&lt;c" using lt_ex by blast
  have "∀<span class="hidden">⇩</span><sub>F</sub> x in F. cc &gt; f x" 
    using top unfolding filterlim_at_bot_dense by auto
  moreover have "∀<span class="hidden">⇩</span><sub>F</sub> x in F. f x &gt; cc" 
    using tendsto order_tendstoD(1)[OF _ ‹cc&lt;c›] by auto
  ultimately have "∀<span class="hidden">⇩</span><sub>F</sub> x in F. cc &lt; f x ∧ f x &lt; cc" 
    using eventually_conj by auto
  then have "∀<span class="hidden">⇩</span><sub>F</sub> x in F. False" by (auto elim:eventually_mono)
  then show False using ‹F≠bot› by auto
qed
*)</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Isolate and discrete›</span></span>  
  
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> topological_space<span class="main">)</span> <span class="entity">isolate</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">isolate</span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">isolate</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="bound">T</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>  
    
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> topological_space<span class="main">)</span> <span class="entity">discrete</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">discrete</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">isolate</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>  
    
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> metric_space<span class="main">)</span> <span class="entity">uniform_discrete</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uniform_discrete</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> uniformI1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">;</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">;</span>dist <span class="bound">x</span> <span class="bound">y</span><span class="main">&lt;</span><span class="free">e</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span><span class="bound">y</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span>"</span></span>  
<span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> uniformI2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">;</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">;</span><span class="bound">x</span><span class="main">≠</span><span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> dist <span class="bound">x</span> <span class="bound">y</span><span class="main">≥</span><span class="free">e</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span>"</span></span>  
<span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">using</span></span> assms not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1"><span class="command">lemma</span></span> isolate_islimpt_iff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">isolate</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">islimpt</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span><span class="main">∈</span><span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> isolate_def islimpt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> isolate_dist_Ex_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>metric_space"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">isolate</span> <span class="free">S</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span><span class="main">∈</span><span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> dist <span class="free">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">=</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> isolate_islimpt_iff islimpt_approachable <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dist_commute<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> discrete_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"discrete <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> discrete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> uniform_discrete_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gt_ex<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> isolate_insert<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>t1_space"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">isolate</span> <span class="main">(</span>insert <span class="free">a</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">isolate</span> <span class="free">S</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">islimpt</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insert_iff islimpt_insert isolate_islimpt_iff<span class="main">)</span>
    
<span class="comment1">(*
TODO. 
Other than 

  uniform_discrete S ⟶ discrete S
  uniform_discrete S ⟶ closed S

, we should be able to prove

  discrete S ∧ closed S ⟶ uniform_discrete S

but the proof (based on Tietze Extension Theorem) seems not very trivial to me. Informal proofs can be found in

http://topology.auburn.edu/tp/reprints/v30/tp30120.pdf
http://msp.org/pjm/1959/9-2/pjm-v9-n2-p19-s.pdf
*)</span>  
  
<span class="keyword1"><span class="command">lemma</span></span> uniform_discrete_imp_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span> <span class="main">⟹</span> closed <span class="free">S</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> discrete_imp_closed uniform_discrete_def<span class="main">)</span> 
    
<span class="keyword1"><span class="command">lemma</span></span> uniform_discrete_imp_discrete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span> <span class="main">⟹</span> discrete <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> discrete_def isolate_dist_Ex_iff uniform_discrete_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> isolate_subset<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">isolate</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∈</span><span class="free">T</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">isolate</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> isolate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> discrete_subset<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"discrete <span class="free">S</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> discrete <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> discrete_def <span class="keyword1"><span class="command">using</span></span> islimpt_subset isolate_islimpt_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1"><span class="command">lemma</span></span> uniform_discrete_subset<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span> <span class="main">⟹</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> uniform_discrete <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetD uniform_discrete_def<span class="main">)</span>
        
<span class="keyword1"><span class="command">lemma</span></span> continuous_on_discrete<span class="main">:</span> <span class="quoted"><span class="quoted">"discrete <span class="free">S</span> <span class="main">⟹</span> continuous_on <span class="free">S</span> <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> continuous_on_topological <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> discrete_def islimptI isolate_islimpt_iff<span class="main">)</span>
   
<span class="comment1">(* Is euclidean_space really necessary?*)</span>    
<span class="keyword1"><span class="command">lemma</span></span> uniform_discrete_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="main">(</span>insert <span class="free">a</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟷</span> uniform_discrete <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="main">(</span>insert <span class="free">a</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uniform_discrete_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e1_dist<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> dist <span class="bound">y</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">e1</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">≡</span> min <span class="main">(</span>setdist <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="free">S</span><span class="main">)</span> <span class="skolem">e1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm uniform_discrete_imp_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e1</span>›</span></span> e2_def setdist_gt_0_compact_closed that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>insert <span class="free">a</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>insert <span class="free">a</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">e2</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that setdist_le_dist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">e2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e2_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that setdist_le_dist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">e2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e2_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> e1_dist<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> that<span class="main">]</span> <span class="quoted"><span class="quoted">‹dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">e2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e2_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_insertI uniform_discrete_subset<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> discrete_compact_finite_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>t1_space set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discrete <span class="free">S</span> <span class="main">∧</span> compact <span class="free">S</span> <span class="main">⟷</span> finite <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compact <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imp_compact <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discrete <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> discrete_def <span class="keyword1"><span class="command">using</span></span> isolate_islimpt_iff islimpt_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"discrete <span class="free">S</span> <span class="main">∧</span> compact <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"discrete <span class="free">S</span> <span class="main">∧</span> compact <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> discrete_def Heine_Borel_imp_Bolzano_Weierstrass isolate_islimpt_iff order_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> uniform_discrete_finite_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>heine_borel set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span> <span class="main">∧</span> bounded <span class="free">S</span> <span class="main">⟷</span> finite <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span> <span class="main">∧</span> bounded <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discrete <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"compact <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uniform_discrete_imp_discrete uniform_discrete_imp_closed compact_eq_bounded_closed
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> discrete_compact_finite_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span> <span class="main">∧</span> bounded <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">≤</span> dist <span class="bound">x</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_set_avoid<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> f_dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">≤</span> dist <span class="skolem">x</span> <span class="bound">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f_min</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f_min</span> <span class="main">≡</span> Min <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f_min</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_min_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm f_pos that<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">f_min</span> <span class="main">&gt;</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">=</span><span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_dist <span class="keyword1"><span class="command">unfolding</span></span> f_min_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min_gr_iff all_not_in_conv asm dual_order.irrefl eq_iff finite_imageI imageI 
          less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> uniform_discrete_image_scale<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> dist <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≤</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">-</span><span class="main">{</span><span class="skolem">x1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{</span><span class="skolem">x1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uniform_discrete_insert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">-</span><span class="main">{</span><span class="skolem">x1</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">∈</span><span class="free">S</span><span class="main">-</span><span class="main">{</span><span class="skolem">x1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span><span class="main">-</span><span class="main">{</span><span class="skolem">x1</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">≠</span><span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> dist <span class="main">(</span><span class="free">f</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dist<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span><span class="main">∈</span><span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span><span class="main">∈</span><span class="free">S</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="free">f</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≤</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e1_dist<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> dist <span class="bound">y</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">e1</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹uniform_discrete <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span> <span class="skolem">e1</span><span class="main">/</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">x2</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">&lt;</span> <span class="skolem">e</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> y1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="free">f</span> <span class="skolem">y1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span><span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> y2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y2</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">=</span><span class="free">f</span> <span class="skolem">y2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span><span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">y1</span> <span class="skolem">y2</span> <span class="main">&lt;</span> <span class="skolem">e1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dist<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> y1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> y2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹dist <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> y1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> y2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> mult.commute<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">=</span><span class="skolem">y2</span>"</span></span>    
        <span class="keyword1"><span class="command">using</span></span> e1_dist<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> y2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> y1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y1<span class="main">(</span>2<span class="main">)</span> y2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e1</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>
 

  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Missing_Algebraic">
<div class="head">
<h1>Theory Missing_Algebraic</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some useful lemmas in algebra›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Missing_Algebraic <span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial_Factorial.html">HOL-Computational_Algebra.Polynomial_Factorial</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Fundamental_Theorem_Algebra.html">HOL-Computational_Algebra.Fundamental_Theorem_Algebra</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Complex_Analysis/Complex_Analysis.html">HOL-Complex_Analysis.Complex_Analysis</a>"</span>
  <a href="Missing_Topology.html">Missing_Topology</a>
  <span class="quoted">"<a href="../Budan_Fourier/BF_Misc.html">Budan_Fourier.BF_Misc</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_holomorphic_on<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> holomorphic_onI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> field_differentiable_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>has_field_derivative_at_within<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> order_zorder<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="free">z</span> <span class="free">p</span> <span class="main">=</span> nat <span class="main">(</span>zorder <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span>nat <span class="main">(</span>zorder <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">=</span>zor_poly <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms poly_all_0_iff_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"cball <span class="free">z</span> <span class="skolem">r</span> <span class="main">⊆</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      h_holo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">holomorphic_on</span> cball <span class="free">z</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      poly_prod<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>cball <span class="free">z</span> <span class="skolem">r</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">w</span> <span class="main">=</span> <span class="skolem">h</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="bound">w</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zorder_exist_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span>"</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="free">z</span></span><span class="main">,</span><span class="operator">folded</span> h_def<span class="main">]</span> poly_holomorphic_on
    <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">holomorphic_on</span> ball <span class="free">z</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>ball <span class="free">z</span> <span class="skolem">r</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">w</span> <span class="main">=</span> <span class="skolem">h</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="free">z</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">z</span> <span class="free">p</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">h</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">z</span><span class="main">=</span><span class="skolem">h</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="free">z</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sn</span><span class="main">=</span>Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span><span class="main">≡</span> <span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="skolem">h</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">+</span> <span class="skolem">sn</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="skolem">p</span> <span class="keyword1">has_field_derivative</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span>
      <span class="keyword1"><span class="command">using</span></span> poly_DERIV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="skolem">p</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="skolem">h'</span> <span class="skolem">w</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">w</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span> <span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span>ball <span class="free">z</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> DERIV_cong_ev<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="skolem"><span class="skolem">p</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">w</span></span><span class="main"><span class="main">.</span></span>  <span class="skolem"><span class="skolem">h</span></span> <span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">w</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">z</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">^</span></span> Suc <span class="skolem"><span class="skolem">n</span></span>"</span></span></span> <span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> nhds <span class="skolem">w</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_nhds <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span><span class="main">∈</span>ball <span class="free">z</span> <span class="skolem">r</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"ball <span class="free"><span class="free">z</span></span> <span class="skolem"><span class="skolem">r</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="keyword1">has_field_derivative</span> deriv <span class="skolem">h</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="keyword1">holomorphic_on</span> ball <span class="free">z</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span><span class="main">∈</span>ball <span class="free">z</span> <span class="skolem">r</span>›</span></span> holomorphic_on_imp_differentiable_at 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> holomorphic_derivI<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">sn</span><span class="main">)</span><span class="main">)</span> 
                      <span class="keyword1">has_field_derivative</span> <span class="skolem">h'</span> <span class="skolem">w</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">sn</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h'_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> sn_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> 
                      <span class="keyword1">has_field_derivative</span> <span class="skolem">h'</span> <span class="skolem">w</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">∈</span>ball <span class="free">z</span> <span class="skolem">r</span><span class="main">.</span> poly <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="bound">w</span> <span class="main">=</span> <span class="skolem">h'</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DERIV_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="keyword1">holomorphic_on</span> ball <span class="free">z</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> h'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="keyword1">holomorphic_on</span> ball <span class="free">z</span> <span class="skolem">r</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h'</span> <span class="free">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h'_def sn_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> of_nat_neq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> pderiv_iszero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">z</span> <span class="main">(</span>pderiv <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Suc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">z</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> order_root <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> order_pderiv<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹pderiv <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> pcompose_pCons_0<span class="main">:</span><span class="quoted"><span class="quoted">"pcompose <span class="free">p</span> <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pcompose_pCons <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>       
   
<span class="keyword1"><span class="command">lemma</span></span> pcompose_coeff_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>pcompose <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span>coeff <span class="free">q</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>pcompose_pCons coeff_mult<span class="main">)</span>  
    
<span class="keyword1"><span class="command">lemma</span></span> poly_field_differentiable_at<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="keyword1">field_differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> field_differentiable_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>has_field_derivative_at_within<span class="main">)</span>  
  
<span class="keyword1"><span class="command">lemma</span></span> deriv_pderiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"deriv <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_imp_deriv<span class="main">)</span>  
  <span class="keyword1"><span class="command">using</span></span> poly_DERIV <span class="keyword1"><span class="command">.</span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> lead_coeff_map_poly_nz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>Poly <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> antisym assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coeff_0_degree_minus_1 coeff_map_poly 
        degree_Poly degree_eq_length_coeffs le_degree length_map map_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_poly_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> filterlim_poly_at_infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_normed_field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> at_infinity at_infinity"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> degree_eq_zeroE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> degree <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>tendsto_add_filterlim_at_infinity<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>tendsto_mult_filterlim_at_infinity filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> at_infinity at_infinity"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>pCons<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>tendsto_add_filterlim_at_infinity filterlim_at_infinity_times filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
       
<span class="keyword1"><span class="command">lemma</span></span> poly_divide_tendsto_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_normed_field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">/</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> lead_coeff <span class="free">p</span><span class="main">)</span> at_infinity"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span><span class="main">/</span><span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">/</span><span class="bound">x</span><span class="main">^</span>degree <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span><span class="bound">x</span> <span class="keyword1">in</span> at_infinity<span class="main">.</span> poly <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> degree <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="skolem">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_infinityI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">x</span><span class="main">≥</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">^</span> degree <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">+</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span>  lead_coeff <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> at_infinity"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span>  <span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> filterlim_poly_at_infinity<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="main">(</span>Suc <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span> tendsto_divide_0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="main"><span class="main">(</span></span>monom <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">(</span></span>Suc <span class="main"><span class="main">(</span></span>degree <span class="skolem"><span class="skolem">p</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_monom<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span>  lead_coeff <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> at_infinity"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pCons <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>  
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> filterlim_power_at_infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>real_normed_field<span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> at_infinity at_infinity"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> filterlim_poly_at_infinity<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="free">n</span>"</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="main"><span class="main">(</span></span>monom <span class="main"><span class="main">1</span></span> <span class="free"><span class="free">n</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_monom degree_monom_eq<span class="main">)</span>
   
<span class="keyword1"><span class="command">lemma</span></span> poly_divide_tendsto_0_at_infinity<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_normed_field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> degree <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span> <span class="main">)</span> at_infinity"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>    
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dd</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> degree <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span><span class="bound">x</span> <span class="keyword1">in</span> at_infinity<span class="main">.</span>  poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">qq</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">pp</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_infinityI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">x</span><span class="main">≥</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="skolem">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">qq</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">pp</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qq_def pp_def dd_def <span class="keyword1"><span class="command">using</span></span> assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power_diff<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">qq</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">pp</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">dd</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qq</span> <span class="main">⤏</span> lead_coeff <span class="free">q</span><span class="main">)</span> at_infinity"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> qq_def <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pp</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">/</span>lead_coeff <span class="free">p</span><span class="main">)</span> at_infinity"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pp_def <span class="keyword1"><span class="command">using</span></span> poly_divide_tendsto_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> tendsto_inverse<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inverse_eq_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">dd</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> dd_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_divide_0<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_power_at_infinity <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>tendsto_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> lead_coeff_list_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span><span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> coeffs <span class="free">p</span><span class="main">=</span><span class="main">[]</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> last <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_coeffs_eq_coeff_degree<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> poly_linepath_comp<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>real_normed_vector<span class="main">,</span>comm_semiring_0<span class="main">,</span>real_algebra_1<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="keyword1">o</span> <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">:]</span><span class="main">)</span> <span class="keyword1">o</span> of_real"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_pcompose linepath_def scaleR_conv_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_eventually_not_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_infinityI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Max <span class="main"><span class="main">(</span></span>norm <span class="main"><span class="main">`</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> poly <span class="free"><span class="free">p</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">=</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"Max <span class="main">(</span>norm <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> norm <span class="skolem">x</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span>norm <span class="main">`</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">x</span><span class="main">∈</span><span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> poly_roots_finite <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">x</span><span class="main">≤</span>Max <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="skolem">S</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> norm <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">degree</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> degree_div_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">y</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"eucl_rel_poly <span class="free">x</span> <span class="free">y</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def r_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eucl_rel_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eucl_rel_poly_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * that <span class="keyword1"><span class="command">unfolding</span></span> eucl_rel_poly_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">y</span>›</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">x</span> <span class="main">=</span> degree <span class="skolem">q</span> <span class="main">+</span>degree <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span><span class="main">&lt;</span>degree <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">y</span><span class="main">&gt;</span>degree <span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> div_poly_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">x</span><span class="main">&gt;</span>degree <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">x</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_add_eq_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">-</span><span class="skolem">r</span> <span class="main">=</span> <span class="skolem">q</span><span class="main">*</span><span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> eucl_rel_poly_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">x</span> <span class="main">=</span> degree <span class="skolem">q</span> <span class="main">+</span>degree <span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  degree_mult_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">-</span><span class="skolem">r</span> <span class="main">=</span> <span class="skolem">q</span><span class="main">*</span><span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">x</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> map_poly_degree_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> map_poly_def degree_eq_length_coeffs coeffs_Poly lead_coeff_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> last_conv_nth_default length_map no_trailing_unfold nth_default_coeffs_eq 
      nth_default_map_eq strip_while_idem<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> map_poly_degree_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span><span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_eq_length_coeffs<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs_def<span class="main">:</span><span class="quoted"><span class="quoted">"coeffs <span class="free">p</span><span class="main">=</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add.commute add_diff_cancel_left' append_Nil assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        degree_eq_length_coeffs length_greater_0_conv list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> not_less_zero
        rev_exhaust<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_list_def xs_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>strip_while <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> map_poly_def degree_eq_length_coeffs coeffs_Poly
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> xs_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> length <span class="main">(</span>strip_while <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>   
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> length <span class="skolem">xs</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> length_strip_while_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_le_mono length_map<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xs_def<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> degree_eq_length_coeffs xs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> map_poly_degree_leq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_poly_def degree_eq_length_coeffs
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeffs_Poly diff_le_mono length_map length_strip_while_le<span class="main">)</span>  
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹roots / zeros of a univariate function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots_within</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots_within</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">roots</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> roots_within <span class="free"><span class="bound"><span class="entity">f</span></span></span> UNIV"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The argument principle specialised to polynomials.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> argument_principle_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> valid<span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> loop<span class="main">:</span> <span class="quoted"><span class="quoted">"pathfinish <span class="free">g</span> <span class="main">=</span> pathstart <span class="free">g</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> no_proots<span class="main">:</span><span class="quoted"><span class="quoted">"path_image <span class="free">g</span> <span class="main">⊆</span> <span class="main">-</span> proots <span class="free">p</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="free">g</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>proots <span class="free">p</span><span class="main">.</span> winding_number <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> of_nat <span class="main">(</span>order <span class="bound">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="free">g</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> deriv <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> winding_number <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> of_int <span class="main">(</span>zorder <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> argument_principle<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">UNIV</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free">p</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> _ valid loop<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> no_proots<span class="main">[</span><span class="operator">unfolded</span> proots_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly_roots_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>proots <span class="free">p</span><span class="main">.</span> winding_number <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> of_nat <span class="main">(</span>order <span class="bound">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>zorder <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>proots <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">using</span></span> order_zorder<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">unfolding</span></span> proots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>comm_monoid_add_class.sum.cong<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nat_eq_iff2 of_nat_nat order_root<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span> 
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Missing_Transcendental">
<div class="head">
<h1>Theory Missing_Transcendental</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some useful lemmas about transcendental functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Missing_Transcendental <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Missing_Topology.html">Missing_Topology</a>
  <a href="Missing_Algebraic.html">Missing_Algebraic</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Im_Ln_eq_pi_half<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>Im<span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">&lt;</span> Im<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">∧</span> Re<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>Im<span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">⟷</span> Im<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> Re<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>Im<span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">&lt;</span> Im<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">∧</span> Re<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Im_Ln_eq_pi Im_Ln_le_pi Im_Ln_pos_lt Re_Ln_pos_le Re_Ln_pos_lt
      abs_of_nonneg less_eq_real_def order_less_irrefl pi_half_gt_zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">⟹</span> Im <span class="free">z</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Im_Ln_pos_le Re_Ln_pos_le Re_Ln_pos_lt_imp <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> abs_if
     add.inverse_inverse divide_minus_left less_eq_real_def linorder_not_le minus_pi_half_less_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">=</span><span class="skolem">r</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹Im <span class="free">z</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>›</span></span> add.commute add.inverse_inverse add.right_neutral
          complex_eq complex_i_mult_minus diff_0 mult.commute mult.left_commute neg_0_less_iff_less
          of_real_0 of_real_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span>Ln <span class="main">(</span><span class="skolem">r</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Im <span class="main">(</span>Ln <span class="main">(</span>complex_of_real <span class="skolem">r</span><span class="main">)</span> <span class="main">+</span> Ln <span class="main">(</span><span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Ln_times_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im<span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">⟷</span> Im<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> Re<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Im_Ln_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Re <span class="free">z</span><span class="main">≠</span><span class="main">0</span> <span class="keyword1">then</span>
                        <span class="keyword1">if</span> Re <span class="free">z</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span>
                          arctan <span class="main">(</span>Im <span class="free">z</span><span class="main">/</span>Re <span class="free">z</span><span class="main">)</span>
                        <span class="keyword1">else</span> <span class="keyword1">if</span> Im <span class="free">z</span><span class="main">≥</span><span class="main">0</span> <span class="keyword1">then</span>
                           arctan <span class="main">(</span>Im <span class="free">z</span><span class="main">/</span>Re <span class="free">z</span><span class="main">)</span> <span class="main">+</span> pi
                        <span class="keyword1">else</span>
                           arctan <span class="main">(</span>Im <span class="free">z</span><span class="main">/</span>Re <span class="free">z</span><span class="main">)</span> <span class="main">-</span> pi
                      <span class="keyword1">else</span>
                        <span class="keyword1">if</span> Im <span class="free">z</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq_arctan_pos<span class="main">:</span><span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span>Im <span class="skolem">z</span><span class="main">/</span>Re <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">wR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wR</span><span class="main">=</span>Re <span class="main">(</span>Ln <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">=</span> arctan <span class="main">(</span>Im <span class="skolem">z</span><span class="main">/</span>Re <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span>Complex <span class="skolem">wR</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> complex_eqI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>exp <span class="main">(</span>Complex <span class="skolem">wR</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>exp <span class="skolem">wR</span> <span class="main">*</span> sin <span class="skolem">θ</span> "</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Im_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Im <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> wR_def Re_Ln<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> θ_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">z</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sin_arctan <span class="dynamic"><span class="dynamic">divide_simps</span></span> complex_neq_0 cmod_def real_sqrt_divide<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>exp <span class="main">(</span>Complex <span class="skolem">wR</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>exp <span class="main">(</span>Complex <span class="skolem">wR</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> exp <span class="skolem">wR</span> <span class="main">*</span> cos <span class="skolem">θ</span> "</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Re_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> wR_def Re_Ln<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> θ_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">z</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_arctan <span class="dynamic"><span class="dynamic">divide_simps</span></span> complex_neq_0 cmod_def real_sqrt_divide<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>exp <span class="main">(</span>Complex <span class="skolem">wR</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">&lt;</span><span class="skolem">θ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span><span class="main">≤</span>pi"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> θ_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_class.order.strict_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ arctan_lbound<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> preorder_class.less_imp_le<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_class.order.strict_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> arctan_ubound<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ln <span class="skolem">z</span> <span class="main">=</span> Complex <span class="skolem">wR</span> <span class="skolem">θ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ln_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> θ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">z</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> that
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> assms complex.expand <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_arctan_pos<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span><span class="main">≥</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span>Im <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_arctan_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ln <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> Ln <span class="free">z</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real pi"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Ln_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arctan <span class="main">(</span>Im <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_arctan_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ln <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> Ln <span class="free">z</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real pi"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Ln_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exp_Arg2pi2pi_multivalue<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span> of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="free">x</span> <span class="main">=</span> Arg2pi <span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span>floor<span class="main">(</span> <span class="free">x</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span><span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">≥</span><span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> x'_def k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def x'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">*</span>pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real <span class="skolem">x'</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms x'_def <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Arg2pi <span class="free">z</span> <span class="main">=</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Arg2pi_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">x'</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">=</span> Arg2pi <span class="free">z</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span>pi"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cos_eq_neg_periodic_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">=</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span>pi <span class="main">+</span> pi <span class="main">∨</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span>pi <span class="main">+</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">+</span> pi"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">(</span><span class="free">y</span><span class="main">+</span> pi<span class="main">)</span> <span class="main">+</span> <span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span><span class="free">y</span><span class="main">+</span>pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cos.periodic_simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">y</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">+</span></span></span></span></span></span></span></span>pi"</span></span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> real_of_int <span class="free">k</span> <span class="main">*</span> pi <span class="main">+</span> pi "</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="free">y</span><span class="main">+</span> pi<span class="main">)</span> <span class="main">+</span> <span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">cos</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">-</span> <span class="free">y</span> <span class="main">+</span>pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cos.periodic_simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">-</span></span></span></span></span></span></span></span><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">y</span></span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">+</span></span></span></span></span></span></span></span>pi"</span></span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cos_eq_periodic_intro<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">=</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span>pi <span class="main">∨</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span>pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span> <span class="main">*</span> pi "</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cos.periodic_simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">y</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_int <span class="free">k</span> <span class="main">*</span> pi"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">-</span> <span class="free">y</span> <span class="main">+</span> <span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">cos</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cos.periodic_simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">-</span></span></span></span></span></span></span></span><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">y</span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sin_tan_half<span class="main">:</span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> tan <span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sin_double tan_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cos_tan_half<span class="main">:</span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span>  cos <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span> <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cos_double tan_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tan_eq_arctan_Ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tan <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="free">x</span> <span class="main">=</span> arctan <span class="free">y</span> <span class="main">+</span> <span class="bound">k</span><span class="main">*</span>pi <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">k</span><span class="main">*</span>pi <span class="main">∧</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"tan <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span>pi"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span>pi <span class="main">≤</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span>ceiling <span class="main">(</span><span class="free">x</span><span class="main">/</span>pi <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">/</span>pi <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span>pi <span class="main">≤</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">/</span>pi <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span>pi"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> arctan <span class="free">y</span> <span class="main">+</span> of_int <span class="skolem">k</span> <span class="main">*</span> pi"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span>pi"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm tan_periodic_int<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> real_of_int <span class="skolem">k</span> <span class="main">*</span> pi"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> arctan_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> k that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span>pi"</span></span>
    <span class="keyword1"><span class="command">using</span></span> asm that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tan_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> arctan <span class="free">y</span> <span class="main">+</span> of_int <span class="bound">k</span> <span class="main">*</span> pi <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">k</span><span class="main">*</span>pi <span class="main">∧</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="free">x</span> <span class="main">=</span> arctan <span class="free">y</span> <span class="main">+</span>  <span class="bound">k</span> <span class="main">*</span> pi <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> pi <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tan <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arctan_unique cos_pi_half division_ring_divide_zero tan_def tan_periodic_int tan_total<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arccos_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> pi"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arccos <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> arccos_cos assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> cos_eq_arccos_Ex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">1</span><span class="main">≤</span><span class="free">y</span> <span class="main">∧</span> <span class="free">y</span><span class="main">≤</span><span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="free">x</span> <span class="main">=</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">≤</span><span class="free">y</span> <span class="main">∧</span> <span class="free">y</span><span class="main">≤</span><span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="free">x</span> <span class="main">=</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span>pi <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span>pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span>pi"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="main">(</span>arccos <span class="free">y</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span>arccos <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cos.periodic_simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"arccos <span class="free">y</span>"</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">-</span>arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span>pi"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">-</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span>arccos <span class="free">y</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cos_minus minus_diff_eq uminus_add_conv_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span>arccos <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cos.periodic_simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"arccos <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="free">x</span> <span class="main">=</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> arccos <span class="free">y</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span>pi <span class="main">&lt;</span> <span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>pi"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>pi <span class="main">≤</span> pi"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span>ceiling <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">≤</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>pi <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi <span class="main">&lt;</span> <span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>pi"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">≥</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cos.periodic_simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span>"</span></span><span class="main">]</span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">*</span>pi"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> arccos_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> k that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span><span class="main">-</span><span class="skolem">k</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>pi <span class="main">≥</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cos.periodic_simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span>"</span></span><span class="main">]</span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">*</span>pi <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cos_minus minus_diff_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="free">y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">*</span>pi <span class="main">-</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> arccos_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> k that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">≤</span><span class="free">y</span> <span class="main">∧</span> <span class="free">y</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">≤</span><span class="free">y</span> <span class="main">∧</span> <span class="free">y</span><span class="main">≤</span><span class="main">1</span> <span class="main">∧</span> <span class="var">?goal</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uniform_discrete_tan_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uniform_discrete <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> tan <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="skolem">x2</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> dist<span class="main">:</span><span class="quoted"><span class="quoted">"dist <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">x1</span><span class="main">=</span><span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">x2</span><span class="main">=</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> x1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> arctan <span class="free">y</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">*</span>pi <span class="main">∨</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">*</span>pi <span class="main">∧</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tan_eq_arctan_Ex <span class="quoted"><span class="quoted">‹tan <span class="skolem">x1</span><span class="main">=</span><span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> x2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> arctan <span class="free">y</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span>pi <span class="main">∨</span> <span class="main">(</span><span class="skolem">x2</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span>pi <span class="main">∧</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tan_eq_arctan_Ex <span class="quoted"><span class="quoted">‹tan <span class="skolem">x2</span><span class="main">=</span><span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xk1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> arctan <span class="free">y</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">*</span>pi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?xk1'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">*</span>pi <span class="main">∧</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xk2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> arctan <span class="free">y</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span>pi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?xk2'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span>pi <span class="main">∧</span> <span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?xk1</span> <span class="main">∧</span> <span class="var">?xk2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="var">?xk1'</span> <span class="main">∧</span> <span class="var">?xk2'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">-</span><span class="skolem">x2</span><span class="main">=</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span>pi"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="var"><span class="quoted"><span class="var">?xk1</span></span></span> <span class="var"><span class="quoted"><span class="var">?xk2</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> arg_cong2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">minus</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?xk1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?xk2</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">-</span><span class="skolem">x2</span><span class="main">=</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span>pi"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="var"><span class="quoted"><span class="var">?xk1'</span></span></span> <span class="var"><span class="quoted"><span class="var">?xk2'</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> arg_cong2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">minus</span><span class="main">,</span><span class="operator">OF</span> conjunct1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?xk1'</span>›</span></span><span class="main"><span class="main">]</span></span> conjunct1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?xk2'</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">-</span><span class="skolem">x2</span><span class="main">=</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span>pi"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dist<span class="main">[</span><span class="operator">unfolded</span> dist_real_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span><span class="main">=</span><span class="skolem">k2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="var"><span class="quoted"><span class="var">?xk1</span></span></span> <span class="var"><span class="quoted"><span class="var">?xk2'</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">k1</span><span class="main">*</span>pi"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?xk2'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?xk1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> arg_cong2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">minus</span><span class="main">,</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">&lt;</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist<span class="main">[</span><span class="operator">unfolded</span> dist_real_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">&lt;</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs_less_iff  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="var"><span class="quoted"><span class="var">?xk1'</span></span></span> <span class="var"><span class="quoted"><span class="var">?xk2</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">*</span>pi"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?xk2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?xk1'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> arg_cong2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">minus</span><span class="main">,</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">+</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> pi <span class="main">+</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">&lt;</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist<span class="main">[</span><span class="operator">unfolded</span> dist_real_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span>pi<span class="main">¦</span> <span class="main">&lt;</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">&lt;</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span> <span class="main">∧</span> <span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x1 x2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"pi<span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_norm_value<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>floor_ceiling<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">pp</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a1</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">(</span>of_int <span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">pp</span><span class="main">+</span><span class="free">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a0</span><span class="main">≤</span><span class="free">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span><span class="main">&lt;</span><span class="free">a0</span><span class="main">+</span><span class="free">pp</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span>floor <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">a0</span><span class="main">)</span><span class="main">/</span><span class="free">pp</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">=</span><span class="free">a</span><span class="main">-</span><span class="main">(</span>of_int <span class="skolem">k</span><span class="main">)</span><span class="main">*</span><span class="free">pp</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">⌊</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">a0</span><span class="main">)</span> <span class="main">/</span> <span class="free">pp</span><span class="main">⌋</span> <span class="main">*</span> <span class="free">pp</span> <span class="main">≤</span> <span class="free">a</span><span class="main">-</span> <span class="free">a0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_divide_eq of_int_floor_le<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">-</span><span class="free">a0</span> <span class="main">&lt;</span> of_int <span class="main">(</span><span class="main">⌊</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">a0</span><span class="main">)</span> <span class="main">/</span> <span class="free">pp</span><span class="main">⌋</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">pp</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> divide_less_eq floor_correct<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> k_def a1_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*Is it possible to generalise or simplify this messy proof?*)</span>
<span class="keyword1"><span class="command">lemma</span></span> filtermap_tan_at_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> at_right <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="skolem">k</span><span class="main">*</span>pi<span class="main">+</span><span class="skolem">a1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">≤</span><span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_norm_value<span class="main">[</span><span class="operator">of</span> <span class="quoted">pi</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">a1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">a1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">=</span><span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">≤</span><span class="skolem">a1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.commute add_0_left cos_pi_half 
              diff_eq_eq mult.left_neutral mult_minus_right mult_zero_left 
              sin_add sin_pi_half sin_zero_iff_int2 times_divide_eq_left uminus_add_conv_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>at_right <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b1_imp<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">b1</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="main">(</span>tan <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eventually <span class="skolem">P</span> <span class="main">(</span>filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_filtermap eventually_at_right 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eventually_at_right_field<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span><span class="main">=</span>min <span class="skolem">b1</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span>pi<span class="main">+</span>pi<span class="main">/</span><span class="numeral">4</span><span class="main">+</span><span class="skolem">a1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>  
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b3</span><span class="main">=</span><span class="skolem">b2</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">*</span>pi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">b3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b3</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">&lt;</span><span class="skolem">b3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b1</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> aa1 <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b2_def b3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">b3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">≤</span><span class="skolem">a1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b3</span> <span class="main">&lt;</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> b2_def b3_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> min_diff_distrib_left<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> min.strict_coboundedI2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b1</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> aa1 <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">&lt;</span><span class="skolem">a1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">b2</span> <span class="main">&gt;</span> tan <span class="free">a</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="free">a</span> <span class="main">=</span> tan <span class="skolem">a1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aa1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> tan <span class="skolem">b3</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">&lt;</span><span class="skolem">b3</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b1</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> aa1 <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b2_def b3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> tan_monotone <span class="quoted"><span class="quoted">‹<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">a1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b3</span> <span class="main">&lt;</span> pi<span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> tan <span class="skolem">b2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b3_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Groups.mult_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_uminus_conv_diff mult_minus_right of_int_minus 
          tan_periodic_int<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&gt;</span>tan <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> tan <span class="skolem">b2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">=</span>arctan <span class="skolem">y</span><span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> pi"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">y1</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> arctan <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">&gt;</span>tan <span class="free">a</span>›</span></span> arctan_monotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">&lt;</span>arctan <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> arctan_tan <span class="quoted"><span class="quoted">‹<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">a1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> y1_def aa1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">&lt;</span><span class="skolem">b2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="skolem">y</span> <span class="main">&lt;</span> arctan <span class="main">(</span>tan <span class="skolem">b2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">&lt;</span> tan <span class="skolem">b2</span>›</span></span> arctan_monotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="main">(</span>tan <span class="skolem">b2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b3</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> arctan_tan<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b3</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">b3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b3</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b3_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse diff_minus_eq_add divide_minus_left mult.commute 
            mult_minus_right of_int_minus tan_periodic_int<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">b3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> y1_def b3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">b2</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="main">(</span>tan <span class="bound">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b1_imp <span class="keyword1"><span class="command">unfolding</span></span> b2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">y1</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tan_arctan<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>at_right <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eventually_at_right_field<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>at_right <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span><span class="main">&gt;</span>tan <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b1_imp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span>tan <span class="free">a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">b1</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="bound">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eventually <span class="skolem">P</span> <span class="main">(</span>at_right <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eventually_at_right_field<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span><span class="main">=</span>arctan <span class="skolem">b1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span>pi"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">&lt;</span> arctan <span class="skolem">b1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">a1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span> <span class="main">&lt;</span> pi <span class="main">/</span> <span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹tan <span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">b1</span>›</span></span> aa1 add.commute arctan_less_iff 
            arctan_tan divide_minus_left tan_periodic_int<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa1 b2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span>tan <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">b2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">*</span>pi"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">&lt;</span> <span class="skolem">y1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">&lt;</span> arctan <span class="skolem">b1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y1_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aa1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> b2_def that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">a1</span> <span class="main">&lt;</span> tan <span class="skolem">y1</span>"</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">y1</span><span class="main">&lt;</span> <span class="skolem">b1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span><span class="main">&gt;</span><span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> tan_monotone<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> arctan_ubound less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">-</span> pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">a1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span> <span class="main">&lt;</span> <span class="skolem">y1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y1</span> <span class="main">&lt;</span> arctan <span class="skolem">b1</span>›</span></span> arctan_less_iff arctan_tan 
              arctan_ubound divide_minus_left less_trans<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">y</span><span class="main">&gt;</span>tan <span class="free">a</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹tan <span class="skolem">a1</span> <span class="main">&lt;</span> tan <span class="skolem">y1</span>›</span></span> aa1 add.commute add_uminus_conv_diff mult.commute 
            mult_minus_right of_int_minus tan_periodic_int y1_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">y</span><span class="main">&lt;</span><span class="skolem">b1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹tan <span class="skolem">y1</span> <span class="main">&lt;</span> <span class="skolem">b1</span>›</span></span> add_uminus_conv_diff mult.commute mult_minus_right 
            of_int_minus tan_periodic_int y1_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b1_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_filtermap eventually_at_right 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eventually_at_right_field<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> filter_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filtermap_tan_at_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap tan <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> at_left <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap tan <span class="main">(</span>at_right <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> at_right <span class="main">(</span>tan <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> filtermap_tan_at_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span>uminus <span class="keyword1">o</span> tan<span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> filtermap uminus <span class="main">(</span>at_left <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> at_right_minus filtermap_filtermap comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap uminus <span class="main">(</span>filtermap <span class="main">(</span>uminus <span class="keyword1">o</span> tan<span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> filtermap uminus <span class="main">(</span>filtermap uminus <span class="main">(</span>at_left <span class="main">(</span>tan <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> filtermap_filtermap comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cos_zero_iff_int2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">::</span>int<span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">*</span> pi <span class="main">+</span>  pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sin_zero_iff_int2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sin_cos_eq 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> filtermap_tan_at_right_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> at_bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> ak<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="skolem">k</span><span class="main">*</span>pi <span class="main">+</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cos_zero_iff_int2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> at_bot"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b1_imp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">b1</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="main">(</span>tan <span class="bound">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eventually <span class="skolem">P</span> <span class="main">(</span>filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_filtermap eventually_at_right 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eventually_at_right_field<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span><span class="main">=</span>min <span class="main">(</span><span class="skolem">k</span><span class="main">*</span>pi<span class="main">+</span>pi<span class="main">)</span> <span class="skolem">b1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span>tan <span class="skolem">b2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">=</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span>pi<span class="main">+</span>arctan <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">y1</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> ak y1_def <span class="keyword1"><span class="command">using</span></span> arctan_lbound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">&lt;</span> <span class="skolem">b2</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b3</span><span class="main">=</span><span class="skolem">b2</span><span class="main">-</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">b3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b3</span><span class="main">&lt;</span>pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b1</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b3_def b2_def ak 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> min_mult_distrib_left <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>min.strict_coboundedI1<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="main">(</span>tan <span class="skolem">b3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b3</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arctan_tan<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="main">(</span>tan <span class="skolem">b2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b3</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> b3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_eq_eq tan_periodic_int<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">b3</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> arctan_monotone<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">&lt;</span>tan <span class="skolem">b2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> y1_def b3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">&lt;</span><span class="skolem">b1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">P</span> <span class="main">(</span>tan <span class="skolem">y1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1_imp<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y1</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> y1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute arctan tan_periodic_int<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_bot_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> at_bot"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> b1_imp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="skolem">b1</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eventually <span class="skolem">P</span> at_bot›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_bot_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span><span class="main">=</span>arctan <span class="skolem">b1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span>pi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ak b2_def <span class="keyword1"><span class="command">using</span></span> arctan_lbound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span>tan <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">b2</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">=</span><span class="skolem">y</span><span class="main">-</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span>pi"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">y1</span> <span class="main">&lt;</span> tan <span class="main">(</span>arctan <span class="skolem">b1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tan_monotone<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y1_def ak <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">b2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y1_def b2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> arctan_ubound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">y1</span><span class="main">&lt;</span><span class="skolem">b1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arctan<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">b1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y1_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_eq_eq tan_periodic_int<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b1_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>filtermap tan <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_filtermap eventually_at_right 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eventually_at_right_field<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> filter_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filtermap_tan_at_left_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filtermap tan <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap tan <span class="main">(</span>at_right <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filtermap_tan_at_right_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span>uminus <span class="keyword1">o</span> tan<span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> at_right_minus filtermap_filtermap comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap uminus <span class="main">(</span>filtermap <span class="main">(</span>uminus <span class="keyword1">o</span> tan<span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> filtermap uminus at_bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> filtermap_filtermap comp_def <span class="keyword1"><span class="command">using</span></span> at_top_mirror<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted">real</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Periodic set›</span></span>

<span class="comment1">(*Devised to characterize roots of Trigonometric equations, which are usually uniformly discrete.*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">periodic_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real set <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">periodic_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> finite <span class="bound">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">=</span><span class="bound">b</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">δ</span></span></span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_multiple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="free">δ</span> <span class="main">⟷</span> periodic_set <span class="free">S</span> <span class="main">(</span>of_int <span class="free">k</span><span class="main">*</span><span class="free">δ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="free">δ</span> "</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B1_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="skolem">B1</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">b</span><span class="main">+</span><span class="bound">i</span><span class="main">*</span><span class="free">δ</span> <span class="main">|</span> <span class="bound">b</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">b</span><span class="main">∈</span><span class="skolem">B1</span> <span class="main">∧</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">¦</span><span class="free">k</span><span class="main">¦</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k'</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">+</span> real_of_int <span class="bound">k'</span> <span class="main">*</span> <span class="main">(</span>real_of_int <span class="free">k</span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">k1</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span><span class="main">∈</span><span class="skolem">B1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_δ<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b1</span> <span class="main">+</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B1_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span> <span class="skolem">k1</span> <span class="keyword1">mod</span> <span class="main">¦</span><span class="free">k</span><span class="main">¦</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="keyword1">div</span> <span class="main">¦</span><span class="free">k</span><span class="main">¦</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">kk</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="skolem">b1</span><span class="main">+</span><span class="skolem">r</span><span class="main">*</span><span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kk</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">d</span> <span class="keyword1">else</span> <span class="main">-</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">r</span><span class="main">+</span><span class="main">¦</span><span class="free">k</span><span class="main">¦</span><span class="main">*</span><span class="skolem">d</span><span class="main">)</span><span class="main">*</span><span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_δ <span class="keyword1"><span class="command">unfolding</span></span> r_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">kk</span><span class="main">*</span><span class="main">(</span><span class="free">k</span><span class="main">*</span><span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def kk_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">¦</span><span class="free">k</span><span class="main">¦</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def B_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b1</span><span class="main">∈</span><span class="skolem">B1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">B1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_image_set2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="main">(</span>real_of_int <span class="free">k</span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="main">(</span>real_of_int <span class="free">k</span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="free">δ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute mult.left_commute of_int_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">{}</span> <span class="free">δ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="free">δ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">using</span></span> assms mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_subset<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">T</span> <span class="free">δ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetCE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="free">δ</span>"</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">T</span> <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="free">δ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff infinite_Un<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_imp_uniform_discrete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="free">S</span> <span class="free">δ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">δ</span><span class="main">)</span> <span class="main">`</span> Ints"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B_diff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B_diff</span> <span class="main">=</span> <span class="main">{</span><span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="bound">y</span><span class="main">¦</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>  <span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">∈</span><span class="skolem">B</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B_diff</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_diff_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_image_set2<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> setdist <span class="skolem">B_diff</span> <span class="skolem">P</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">¦</span><span class="free">δ</span><span class="main">¦</span> <span class="keyword1">else</span> min <span class="main">(</span>setdist <span class="skolem">B_diff</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">(</span><span class="main">¦</span><span class="free">δ</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">using</span></span> setdist_pos_le<span class="main">[</span><span class="operator">unfolded</span> order_class.le_less<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x</span> <span class="skolem">y</span><span class="main">&lt;</span><span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="free">δ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">y</span><span class="main">∈</span><span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_def <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">∈</span>Ints"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">=</span> <span class="free">δ</span> <span class="main">*</span> <span class="skolem">k'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> of_int <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ints_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span>"</span></span><span class="main">]</span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="free">δ</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> dist_real_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> k1<span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> k2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="free">δ</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> k<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="free">δ</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="free">δ</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="free">δ</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹dist <span class="skolem">x</span> <span class="skolem">y</span><span class="main">&lt;</span><span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="free">δ</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">¦</span><span class="free">δ</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> order_class.dual_order.strict_trans1<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">¦</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δ</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x</span> <span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">∉</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">∈</span> <span class="skolem">B_diff</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_diff_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">y</span><span class="main">∈</span><span class="skolem">B</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">¦</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">-</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="free">δ</span><span class="main">¦</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">∈</span> <span class="skolem">B_diff</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_diff_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">y</span><span class="main">∈</span><span class="skolem">B</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="free">δ</span><span class="main">¦</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">if</span></span> <span class="free"><span class="free">δ</span></span><span class="main"><span class="main">≥</span></span><span class="main"><span class="main">0</span></span> <span class="keyword1"><span class="keyword1">then</span></span> <span class="main"><span class="main">¦</span></span>of_int<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">k1</span></span><span class="main"><span class="main">-</span></span><span class="skolem"><span class="skolem">k2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">¦</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">¦</span></span>of_int<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">k1</span></span><span class="main"><span class="main">-</span></span><span class="skolem"><span class="skolem">k2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">¦</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Ints_minus Ints_of_int of_int_abs<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">¦</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">-</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="free">δ</span><span class="main">¦</span><span class="main">¦</span> <span class="main">≥</span> setdist <span class="skolem">B_diff</span> <span class="skolem">P</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> setdist_le_dist<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">B_diff</span></span>  <span class="main">_</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> dist_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"setdist <span class="skolem">B_diff</span> <span class="skolem">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compact <span class="skolem">B_diff</span> "</span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹finite <span class="skolem">B_diff</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imp_compact <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="skolem">P</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">using</span></span> closed_scaling<span class="main">[</span><span class="operator">OF</span> closed_Ints<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">real</span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">δ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ints_0 <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B_diff</span> <span class="main">∩</span> <span class="skolem">P</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_diff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B_diff</span> <span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_diff_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">y</span><span class="main">∈</span><span class="skolem">B</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> setdist_eq_0_compact_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B_diff</span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">-</span><span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="free">δ</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">=</span><span class="skolem">g</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">k1</span> <span class="main">-</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> <span class="free">δ</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> t1_def t2_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> dist <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> dist_real_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> k1<span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> k2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">x</span> <span class="skolem">y</span><span class="main">≥</span><span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹dist <span class="skolem">x</span> <span class="skolem">y</span><span class="main">&lt;</span><span class="skolem">e</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> uniform_discrete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">δ</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">δ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">g</span> <span class="main">`</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uniform_discrete_finite_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_tan_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">*</span>tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span> <span class="free">c</span><span class="main">*</span>arctan <span class="main">(</span><span class="main">-</span> <span class="free">b</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="free">c</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span><span class="main">*</span>arctan <span class="main">(</span><span class="main">-</span> <span class="free">b</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span><span class="main">*</span>pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">k</span>  <span class="main">*</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">∧</span> <span class="main">-</span> <span class="free">b</span> <span class="main">/</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tan <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">b</span><span class="main">/</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_within_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">∨</span> <span class="skolem">C2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C1_def C2_def <span class="keyword1"><span class="command">using</span></span> tan_eq_arctan_Ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b</span><span class="main">/</span><span class="free">a</span>"</span></span><span class="main">]</span>  <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="skolem">C1</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> C1_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="skolem">C2</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> C2_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_cos_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">*</span>cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{</span> <span class="free">c</span><span class="main">*</span>arccos <span class="main">(</span><span class="main">-</span> <span class="free">b</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="free">c</span><span class="main">*</span>arccos <span class="main">(</span><span class="main">-</span> <span class="free">b</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span><span class="main">*</span>arccos <span class="main">(</span><span class="main">-</span> <span class="free">b</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span> <span class="free">c</span><span class="main">*</span>arccos <span class="main">(</span><span class="main">-</span> <span class="free">b</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">b</span><span class="main">/</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_within_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">∨</span> <span class="skolem">C2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cos_eq_arccos_Ex ex_disj_distrib C1_def C2_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="skolem">C1</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> C1_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="skolem">C2</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> C2_def B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> periodic_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_tan_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="main">(</span>tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>poly_root_induct_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_proots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>
          <span class="main">∪</span> roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="main">(</span>tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> roots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> periodic_set_tan_linear<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="main">(</span>tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span>pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> periodic_set_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> periodic_set_sin_cos_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="free">b</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> cos <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> sin <span class="bound">x</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span><span class="main">=</span> <span class="free">a</span> <span class="main">*</span> cos <span class="skolem">x</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> sin <span class="skolem">x</span> <span class="main">+</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"roots <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span>roots <span class="skolem">f</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>roots <span class="skolem">f</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="skolem">f</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> periodic_set_cos_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span><span class="operator">unfolded</span> roots_within_def<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="skolem">f</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[:</span><span class="free">a</span><span class="main">+</span><span class="free">c</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">-</span><span class="free">a</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="main">(</span>tan <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>tan <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">=</span> <span class="main">1</span><span class="main">+</span><span class="skolem">t</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tt_def t_def
        <span class="keyword1"><span class="command">using</span></span> cos_tan_half<span class="main">[</span><span class="operator">OF</span> that<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">x</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">t</span> <span class="main">/</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tt_def t_def
        <span class="keyword1"><span class="command">using</span></span> sin_tan_half<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tt_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power_one sum_power2_eq_zero_iff zero_neq_one<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def p_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> t_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> tt_def power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"roots <span class="skolem">f</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="main">(</span>tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> roots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="main">(</span>tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="main">(</span>tan <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> periodic_set_tan_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
          periodic_set_multiple<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>pi"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> periodic_set_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Missing_Analysis">
<div class="head">
<h1>Theory Missing_Analysis</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some useful lemmas in analysis›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Missing_Analysis
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Complex_Analysis/Complex_Analysis.html">HOL-Complex_Analysis.Complex_Analysis</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>  

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about paths›</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> pathfinish_offset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> pathfinish <span class="free">g</span> <span class="main">-</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pathfinish_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    
<span class="keyword1"><span class="command">lemma</span></span> pathstart_offset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="free">g</span> <span class="main">-</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pathstart_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">lemma</span></span> pathimage_offset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>topological_group_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> path_image <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">p</span><span class="main">+</span><span class="free">z</span> <span class="main">∈</span> path_image <span class="free">g</span> "</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> path_offset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>topological_group_add"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟷</span> path <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> path_def
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>   
  
<span class="keyword1"><span class="command">lemma</span></span> not_on_circlepathI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">¦</span><span class="free">r</span><span class="main">¦</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">z</span> <span class="main">∉</span> path_image <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span>path_image <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">+</span> <span class="free">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> path_image_def image_def part_circlepath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">=</span> linepath <span class="free">st</span> <span class="free">tt</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">-</span><span class="free">z0</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span><span class="free">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">¦</span><span class="free">r</span><span class="main">¦</span> <span class="main">*</span> cmod <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">¦</span><span class="free">r</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="free">r</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> circlepath_inj_on<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>circlepath <span class="free">z</span> <span class="free">r</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"circlepath <span class="free">z</span> <span class="free">r</span> <span class="skolem">x</span> <span class="main">=</span> circlepath <span class="free">z</span> <span class="free">r</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> asm<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>exp <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> circlepath c_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> of_int <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>exp_eq c_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span><span class="main">+</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_cancel_left of_real_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More lemmas related to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">winding_number</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> winding_number_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"open <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"path_image <span class="free">γ</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span>  
    <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span><span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="free">f</span> <span class="bound">w</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">spikes</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">spikes</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> γ_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">spikes</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_path_def piecewise_C1_differentiable_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_path_compose_holomorphic assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contour_integral <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="free">f</span> <span class="bound">w</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> contour_integral_integral
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_spike<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> negligible_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">spikes</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">spikes</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="skolem">t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> γ_diff <span class="keyword1"><span class="command">unfolding</span></span> C1_differentiable_on_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="main">(</span><span class="free">γ</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path_image <span class="free">γ</span> <span class="main">⊆</span> <span class="free">s</span>›</span></span> t <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹open <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">s</span>›</span></span>  holomorphic_on_imp_differentiable_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" deriv <span class="free">f</span> <span class="main">(</span><span class="free">γ</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">γ</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> vector_derivative <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> vector_derivative_chain_at_general<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span>›</span></span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_valid_path<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> winding_number_uminus_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">z</span> <span class="main">∉</span> path_image <span class="free">γ</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>uminus <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>uminus <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">c</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv uminus <span class="bound">w</span> <span class="main">/</span> <span class="main">(</span><span class="main">-</span><span class="bound">w</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> c_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open UNIV"</span></span> <span class="quoted"><span class="quoted">"uminus <span class="keyword1">holomorphic_on</span> UNIV"</span></span> <span class="quoted"><span class="quoted">"path_image <span class="free">γ</span> <span class="main">⊆</span> UNIV"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="main">(</span>uminus <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span> <span class="free">z</span> <span class="main">∉</span> path_image <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">c</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">w</span><span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>contour_integral_eq <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> minus_divide_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> winding_number_valid_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span> <span class="free">z</span> <span class="main">∉</span> path_image <span class="free">γ</span>›</span></span><span class="main">,</span><span class="operator">folded</span> c_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> winding_number_comp_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> not_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="free">c</span> <span class="main">∉</span> path_image <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span><span class="main">=</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span><span class="main">=</span><span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="skolem">cc</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="bound">w</span> <span class="main">/</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="bound">w</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> not_image <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">cc</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="skolem">zz</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> zz_def cc_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="skolem">zz</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> winding_number_valid_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> not_image<span class="main">,</span><span class="operator">folded</span> zz_def cc_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="skolem">zz</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>  
 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Cauchy_Index_Theorem">
<div class="head">
<h1>Theory Cauchy_Index_Theorem</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cauchy's index theorem›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cauchy_Index_Theorem <span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../HOL/HOL-Complex_Analysis/Complex_Analysis.html">HOL-Complex_Analysis.Complex_Analysis</a>"</span>
  <span class="quoted">"<a href="../Sturm_Tarski/Sturm_Tarski.html">Sturm_Tarski.Sturm_Tarski</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Fundamental_Theorem_Algebra.html">HOL-Computational_Algebra.Fundamental_Theorem_Algebra</a>"</span>
  <a href="Missing_Transcendental.html">Missing_Transcendental</a>
  <a href="Missing_Algebraic.html">Missing_Algebraic</a>
  <a href="Missing_Analysis.html">Missing_Analysis</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory formalises Cauchy indices on the complex plane and relate them to winding numbers›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>
  
<span class="comment1">(*refined version of the library one with the same name by dropping unnecessary assumptions*)</span> 
<span class="keyword1"><span class="command">lemma</span></span> atMostAtLeast_subset_convex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"convex <span class="free">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span> <span class="main">..</span> <span class="free">y</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span> <span class="main">..</span> <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?μ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?μ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?μ</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> comb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?μ</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?μ</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms iffD1<span class="main">[</span><span class="operator">OF</span> convex_alt<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span> <span class="var"><span class="quoted"><span class="var">?μ</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?μ</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?μ</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> add_divide_distrib<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> comb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> arg_elim<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> arg_elim2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">⟹</span> <span class="free">x1</span><span class="main">=</span> <span class="free">y1</span> <span class="main">⟹</span><span class="free">x2</span><span class="main">=</span><span class="free">y2</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">y1</span> <span class="free">y2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> arg_elim3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="free">x1</span> <span class="free">x2</span> <span class="free">x3</span><span class="main">;</span><span class="free">x1</span><span class="main">=</span> <span class="free">y1</span><span class="main">;</span><span class="free">x2</span><span class="main">=</span><span class="free">y2</span><span class="main">;</span><span class="free">x3</span><span class="main">=</span><span class="free">y3</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">y1</span> <span class="free">y2</span> <span class="free">y3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    
<span class="keyword1"><span class="command">lemma</span></span> IVT_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linear_continuum_topology <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>linorder_topology"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IVT' IVT2' assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> linorder_neq_iff order_le_less order_less_imp_le<span class="main">)</span>    
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dense_linorder<span class="main">)</span> atLeastAtMost_subseteq_greaterThanLessThan_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span> <span class="free">c</span> <span class="main">&lt;..&lt;</span> <span class="free">d</span> <span class="main">}</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dense<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"min <span class="free">c</span> <span class="free">b</span>"</span></span><span class="main">]</span> dense<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="free">a</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq Ball_def not_less<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>    

<span class="keyword1"><span class="command">lemma</span></span> Re_winding_number_half_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="free">γ</span><span class="main">.</span> Re <span class="bound">p</span> <span class="main">≥</span> Re <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>winding_number <span class="free">γ</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="free">γ</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="free">γ</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">fi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">st</span><span class="main">≡</span>pathstart <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fi</span><span class="main">≡</span>pathfinish <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∉</span>path_image <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pos_img<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="skolem">g</span><span class="main">.</span> Re <span class="bound">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="keyword1">has_contour_integral</span> Ln <span class="skolem">fi</span> <span class="main">-</span> Ln <span class="skolem">st</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fi_def st_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contour_integral_primitive<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">" <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Ln <span class="keyword1">has_field_derivative</span> inverse <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> has_field_derivative_Ln
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Ln <span class="keyword1">has_field_derivative</span> inverse <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">-</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_field_derivative_at_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">g</span> <span class="main">⊆</span> <span class="main">-</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_img <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">∉</span>path_image <span class="skolem">g</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ComplI antisym assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> complex_nonpos_Reals_iff complex_surj
          subsetI zero_complex.code<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> winding_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="keyword1">𝗂</span><span class="main">*</span>winding_number <span class="skolem">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>Ln <span class="skolem">fi</span> <span class="main">-</span> Ln <span class="skolem">st</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_contour_integral_winding_number<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">∉</span>path_image <span class="skolem">g</span>›</span></span>
        <span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">folded</span> inverse_eq_divide<span class="main">]</span> has_contour_integral_unique 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>winding_number <span class="skolem">g</span> <span class="main">0</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="skolem">fi</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="skolem">st</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> Re<span class="main">(</span><span class="main">(</span>Ln <span class="skolem">fi</span> <span class="main">-</span> Ln <span class="skolem">st</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> winding_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Im_divide_of_real Im_i_times complex_i_not_zero minus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          mult.commute mult_divide_mult_cancel_left_if times_divide_eq_right<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def fi_def st_def <span class="keyword1"><span class="command">using</span></span> winding_number_offset <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>      
  
<span class="keyword1"><span class="command">lemma</span></span> Re_winding_number_half_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pimage<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="free">γ</span><span class="main">.</span> Im <span class="bound">p</span> <span class="main">≥</span> Im <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>winding_number <span class="free">γ</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">z</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span>pathfinish <span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">z</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span>pathstart <span class="free">γ</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ'</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="skolem">γ'</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="skolem">γ'</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="skolem">γ'</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> γ'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_number_half_right<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pimage <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> valid_path_compose_holomorphic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">-</span></span><span class="keyword1"><span class="keyword1">𝗂</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">z</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">z</span></span>"</span></span></span> <span class="quoted"><span class="quoted">UNIV</span></span>
            <span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> comp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ'</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ'</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="free">γ</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> γ'_def comp_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="skolem">f</span> <span class="bound">w</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_def <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span>  <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> DERIV_imp_deriv<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>    
        <span class="keyword1"><span class="command">unfolding</span></span> f_def c_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">contour_integral</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> winding_number_valid_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span><span class="main">,</span><span class="operator">folded</span> c_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">γ'</span> <span class="main">=</span> <span class="free">z</span><span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="free">z</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span> pathfinish <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="skolem">γ'</span> <span class="main">=</span> <span class="free">z</span><span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="free">z</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>pathstart <span class="free">γ</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> γ'_def path_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> Re_winding_number_half_lower<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pimage<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="free">γ</span><span class="main">.</span> Im <span class="bound">p</span> <span class="main">≤</span> Im <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>winding_number <span class="free">γ</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span> <span class="keyword1">𝗂</span><span class="main">*</span>pathfinish <span class="free">γ</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span>pathstart <span class="free">γ</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ'</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="skolem">γ'</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="skolem">γ'</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="skolem">γ'</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> γ'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_number_half_right<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pimage <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> valid_path_compose_holomorphic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">𝗂</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">z</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">z</span></span>"</span></span></span> <span class="quoted"><span class="quoted">UNIV</span></span>
            <span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> comp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ'</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ'</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="free">γ</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> γ'_def comp_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="skolem">f</span> <span class="bound">w</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_def <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span>  <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">𝗂</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> DERIV_imp_deriv<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>    
        <span class="keyword1"><span class="command">unfolding</span></span> f_def c_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">contour_integral</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> winding_number_valid_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span><span class="main">,</span><span class="operator">folded</span> c_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">γ'</span> <span class="main">=</span> <span class="free">z</span><span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span> pathfinish <span class="free">γ</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="skolem">γ'</span> <span class="main">=</span> <span class="free">z</span><span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span>pathstart <span class="free">γ</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="free">z</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> γ'_def path_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>    
    
      
<span class="keyword1"><span class="command">lemma</span></span> Re_winding_number_half_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neg_img<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="free">γ</span><span class="main">.</span> Re <span class="bound">p</span> <span class="main">≤</span> Re <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>winding_number <span class="free">γ</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span><span class="free">z</span> <span class="main">-</span> pathfinish <span class="free">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span><span class="free">z</span> <span class="main">-</span> pathstart <span class="free">γ</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ'</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="free">z</span> <span class="main">-</span> <span class="free">γ</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="skolem">γ'</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="skolem">γ'</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="skolem">γ'</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> γ'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_number_half_right<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> neg_img <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> valid_path_compose_holomorphic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> <span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="free"><span class="free">z</span></span><span class="main"><span class="main">-</span></span><span class="bound"><span class="bound">t</span></span>"</span></span></span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">,</span></span>
            <span class="operator">unfolded</span> comp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ'</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="free">z</span><span class="main">-</span><span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">γ'</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="free">γ</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> γ'_def comp_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> deriv <span class="skolem">f</span> <span class="bound">w</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_comp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="free">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_def <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> contour_integral <span class="free">γ</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span>  <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">w</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> f_def c_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">contour_integral</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> winding_number <span class="free">γ</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> winding_number_valid_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">γ</span>›</span></span><span class="main">,</span><span class="operator">folded</span> c_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="skolem">γ'</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">z</span> <span class="main">-</span> pathfinish <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="skolem">γ'</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">z</span> <span class="main">-</span> pathstart <span class="free">γ</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> γ'_def path_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1"><span class="command">lemma</span></span> continuous_on_open_Collect_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>t2_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">S</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">S</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"open <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">g</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> topological_space_class.openI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">g</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U0</span></span> <span class="skolem"><span class="skolem">V0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U0</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">V0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">U0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">V0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U0</span> <span class="main">∩</span> <span class="skolem">V0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> separation_t2<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">U1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="skolem">U1</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f<span class="main">[</span><span class="operator">unfolded</span> continuous_on_topological<span class="main">,</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">∈</span><span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹open <span class="skolem">U0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">t</span> <span class="main">∈</span><span class="skolem">U0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">V1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">V1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="skolem">V1</span><span class="main">)</span><span class="main">.</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">V0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g<span class="main">[</span><span class="operator">unfolded</span> continuous_on_topological<span class="main">,</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">∈</span><span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹open <span class="skolem">V0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">t</span> <span class="main">∈</span><span class="skolem">V0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span><span class="main">=</span><span class="skolem">V1</span> <span class="main">∩</span> <span class="skolem">U1</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹open <span class="skolem">U1</span>›</span></span> <span class="quoted"><span class="quoted">‹open <span class="skolem">V1</span>›</span></span> <span class="quoted"><span class="quoted">‹open <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">∈</span><span class="skolem">U1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">∈</span><span class="skolem">V1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">∈</span><span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">g</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U0</span> <span class="main">∩</span> <span class="skolem">V0</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span> <span class="main">∩</span> <span class="skolem">U1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span> <span class="main">∩</span> <span class="skolem">V1</span><span class="main">.</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">V0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> open <span class="bound">T</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="bound">T</span> <span class="main">∧</span> <span class="bound">T</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">g</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sign at a filter›</span></span>    
 
<span class="comment1">(*Relaxation in types could be done in the future.*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_sgnx</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> real filter <span class="main">⇒</span> bool"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">has'_sgnx</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1"><span class="free">has_sgnx</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">=</span> <span class="main">(</span>eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>    
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sgnx_able</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">sgnx'_able</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1"><span class="free">sgnx_able</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">has_sgnx</span> <span class="bound">c</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sgnx</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sgnx</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">has_sgnx</span> <span class="bound">c</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_eq_rhs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">y</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">named_theorems</span></span> sgnx_intros <span class="quoted">"introduction rules for has_sgnx"</span>
<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹
  Global_Theory.add_thms_dynamic <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> sgnx_eq_intros<span class="antiquote">}</span></span></span><span class="main">,</span>
    <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">context</span> <span class="main">=&gt;</span>
      <span class="entity">Named_Theorems.get</span> <span class="main">(</span>Context.proof_of <span class="entity">context</span><span class="main">)</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">named_theorems</span> sgnx_intros<span class="antiquote">}</span></span>
      |&gt; map_filter <span class="main">(</span>try <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> has_sgnx_eq_rhs<span class="antiquote">}</span></span></span> OF <span class="main">[</span><span class="entity">thm</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
›</span>  

<span class="keyword1"><span class="command">lemma</span></span> sgnx_able_sgnx<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="main">(</span>sgnx <span class="free">f</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def sgnx_def <span class="keyword1"><span class="command">using</span></span> someI_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>    

<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_imp_sgnx_able<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span><span class="main">=</span><span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">≠</span> <span class="free">c2</span> "</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c1</span> <span class="main">∧</span> sgn<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_conj_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c1</span> <span class="main">=</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c1</span> <span class="main">≠</span> <span class="free">c2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">≠</span> bot›</span></span> eventually_False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_imp_sgnx<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span><span class="free">F</span><span class="main">≠</span>bot <span class="main">⟹</span> sgnx <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_sgnx_unique sgnx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_const<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">sgnx_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_sgnx_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_sgnx_at_left_at_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ls</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ls</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">t</span><span class="main">∈</span><span class="free">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">ls</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">x</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">(</span>Max <span class="skolem">ls</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">ls</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span><span class="free">s</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ls</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span><span class="free">s</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ls_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="skolem">l</span> <span class="main">∧</span> <span class="skolem">l</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ls</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="skolem">l</span> <span class="main">∧</span> <span class="skolem">l</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ls</span> <span class="main">≠</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="skolem">ls</span> <span class="main">∈</span> <span class="skolem">ls</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> that <span class="quoted"><span class="quoted">‹finite <span class="skolem">ls</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> linorder_class.Max_in<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span>Max <span class="skolem">ls</span> <span class="main">∧</span> Max <span class="skolem">ls</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ls_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">have</span></span> noroot<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">l</span><span class="main">..&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ls</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atLeastLessThan_iff less_le_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="skolem">ls</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that t <span class="keyword1"><span class="command">unfolding</span></span> ls_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&gt;</span>Max <span class="skolem">ls</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that False <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atLeastLessThan_iff less_le_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="skolem">ls</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that t <span class="keyword1"><span class="command">unfolding</span></span> ls_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≤</span>Max <span class="skolem">ls</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">ls</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span>Max <span class="skolem">ls</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_leftI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&lt;</span><span class="free">x</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> x 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> greaterThanLessThan_iff less_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> noroot t that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">l</span><span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> noroot t that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">l</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">t</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∨</span> <span class="free">f</span> <span class="skolem">l</span> <span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">t</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span> <span class="main">∩</span> <span class="free">s</span> <span class="main">≠</span><span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="skolem">l</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="free">s</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">l</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span> <span class="main">∩</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">t'</span><span class="main">&lt;</span><span class="free">x</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">l</span>›</span></span> atLeastAtMost_iff greaterThanLessThan_iff le_less less_trans t<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="skolem">ls</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ls_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span><span class="main">∈</span><span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≤</span>Max <span class="skolem">ls</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">ls</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="skolem">ls</span><span class="main">&lt;</span><span class="skolem">l</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span><span class="main">∈</span><span class="skolem">ls</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">ls</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ls_def <span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> t'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">l</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> atMostAtLeast_subset_convex<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">l</span><span class="main">..</span><span class="skolem">t</span><span class="main">}</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> continuous_on_subset<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="skolem">l</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> IVT_strict<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that t assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">&lt;</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t'</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="skolem">l</span><span class="main">..&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ls_def <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> noroot <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">t'</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="free">f</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less not_less sgn_if<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> noroot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_sgnx_imp_sgnx sgn_if<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">t</span><span class="main">∈</span><span class="free">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">if</span> <span class="skolem">rs</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">(</span>Min <span class="skolem">rs</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">rs</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span><span class="free">s</span> <span class="main">∧</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span><span class="free">s</span> <span class="main">∧</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="free">x</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="skolem">r</span> <span class="main">∧</span> <span class="skolem">r</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="free">x</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="skolem">r</span> <span class="main">∧</span> <span class="skolem">r</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">≠</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Min <span class="skolem">rs</span> <span class="main">∈</span> <span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> that <span class="quoted"><span class="quoted">‹finite <span class="skolem">rs</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> linorder_class.Min_in<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&lt;</span>Min <span class="skolem">rs</span> <span class="main">∧</span> Min <span class="skolem">rs</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&gt;</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>   
  <span class="keyword1"><span class="command">have</span></span> noroot<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">&lt;..</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> 
        <span class="keyword1"><span class="command">using</span></span> greaterThanAtMost_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that t <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span>Min <span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that False <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greaterThanAtMost_iff le_less less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that t <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≥</span>Min <span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">rs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span>Min <span class="skolem">rs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="free">f</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_at_rightI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="free">x</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">&lt;..&lt;</span><span class="skolem">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> x 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> greaterThanLessThan_iff less_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> noroot t that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">r</span><span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> noroot t that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">r</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">t</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∨</span> <span class="free">f</span> <span class="skolem">r</span> <span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">t</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">t</span><span class="main">..</span><span class="skolem">r</span><span class="main">}</span> <span class="main">∩</span> <span class="free">s</span> <span class="main">≠</span><span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="skolem">t</span><span class="main">..</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="free">s</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">t</span><span class="main">..</span><span class="skolem">r</span><span class="main">}</span> <span class="main">∩</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&lt;</span><span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">t'</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> atLeastAtMost_iff greaterThanLessThan_iff less_le_trans not_le t<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">using</span></span> t <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span><span class="main">∈</span><span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≥</span>Min <span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">rs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Min <span class="skolem">rs</span><span class="main">&gt;</span><span class="skolem">r</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span><span class="main">&gt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span><span class="main">∈</span><span class="skolem">rs</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">rs</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rs_def <span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> t'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">t</span><span class="main">..</span><span class="skolem">r</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> atMostAtLeast_subset_convex<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">t</span><span class="main">..</span><span class="skolem">r</span><span class="main">}</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> continuous_on_subset<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="skolem">t</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">r</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> IVT_strict<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that t assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">t'</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">&lt;..</span><span class="skolem">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> noroot <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">t'</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="free">f</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="free">f</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less not_less sgn_if<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> noroot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="free">f</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_sgnx_imp_sgnx sgn_if<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgnx_able_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> at_top"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> at_bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_sgnx_def poly_sgn_eventually_at_top sgnx_able_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_sgnx_def poly_sgn_eventually_at_bot sgnx_able_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def has_sgnx_def eventually_at_right
      <span class="keyword1"><span class="command">using</span></span> linordered_field_no_ub <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">≤</span><span class="skolem">ub</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> next_non_root_interval<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">≤</span><span class="skolem">ub</span><span class="main">⟶</span>sgn<span class="main">(</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">ub</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≤</span><span class="skolem">ub</span>"</span></span> <span class="quoted"><span class="quoted">"sgn<span class="main">(</span>poly <span class="free">p</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≠</span><span class="skolem">ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ub <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="skolem">z</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">z</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="skolem">ub</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_neqE_linordered_idom sgn_neg sgn_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="skolem">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">ub</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> poly_IVT_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">ub</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> poly_IVT_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">ub</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">≤</span><span class="skolem">ub</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">≠</span><span class="skolem">ub</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ub <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def has_sgnx_def eventually_at_right
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"sgn<span class="main"><span class="main">(</span></span>poly <span class="free"><span class="free">p</span></span> <span class="skolem"><span class="skolem">ub</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">ub</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def has_sgnx_def eventually_at_right
      <span class="keyword1"><span class="command">using</span></span> linordered_field_no_ub <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">lb</span><span class="main">≤</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">a</span><span class="main">⟶</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> last_non_root_interval<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">lb</span><span class="main">≤</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">a</span><span class="main">⟶</span>sgn<span class="main">(</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">lb</span><span class="main">≤</span><span class="bound">z</span><span class="main">∧</span><span class="bound">z</span><span class="main">&lt;</span><span class="free">a</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">≤</span><span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">&lt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"sgn<span class="main">(</span>poly <span class="free">p</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≠</span><span class="skolem">lb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ub <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="skolem">z</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">z</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="skolem">lb</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_neqE_linordered_idom sgn_neg sgn_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="skolem">lb</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">z</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> poly_IVT_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> poly_IVT_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">lb</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">≤</span><span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">≠</span><span class="skolem">lb</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ub <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">&lt;</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def has_sgnx_def eventually_at_left
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"sgn<span class="main"><span class="main">(</span></span>poly <span class="free"><span class="free">p</span></span> <span class="skolem"><span class="skolem">lb</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">lb</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_identity<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">sgnx_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≥</span><span class="main">0</span> <span class="main">⟹</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≤</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≥</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≤</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_divide<span class="main">[</span><span class="operator">sgnx_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="free">c1</span> <span class="main">/</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> sgn <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c1</span> <span class="main">∧</span> sgn <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_conj<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> sgn <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c1</span> <span class="main">/</span> <span class="free">c2</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult sgn_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="free">c1</span> <span class="main">/</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgnx_able_divide<span class="main">[</span><span class="operator">sgnx_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span>  
<span class="keyword1"><span class="command">using</span></span> has_sgnx_divide <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sgnx_able_def<span class="main">)</span>   

<span class="keyword1"><span class="command">lemma</span></span> sgnx_divide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span> <span class="main">=</span>sgnx <span class="free">f</span> <span class="free">F</span> <span class="main">/</span> sgnx <span class="free">g</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="free">F</span><span class="main">=</span><span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">g</span> <span class="free">F</span><span class="main">=</span><span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c1</span> <span class="main">/</span> <span class="skolem">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> has_sgnx_divide<span class="main">[</span><span class="operator">OF</span> c1 c2<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> has_sgnx_imp_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_times<span class="main">[</span><span class="operator">sgnx_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="free">c1</span> <span class="main">*</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> sgn <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c1</span> <span class="main">∧</span> sgn <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_conj<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> sgn <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c1</span> <span class="main">*</span> <span class="free">c2</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="free">c1</span> <span class="main">*</span> <span class="free">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgnx_able_times<span class="main">[</span><span class="operator">sgnx_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span>  
<span class="keyword1"><span class="command">using</span></span> has_sgnx_times <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sgnx_able_def<span class="main">)</span>   

<span class="keyword1"><span class="command">lemma</span></span> sgnx_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span> <span class="main">=</span>sgnx <span class="free">f</span> <span class="free">F</span> <span class="main">*</span> sgnx <span class="free">g</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="free">F</span><span class="main">=</span><span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">g</span> <span class="free">F</span><span class="main">=</span><span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">c2</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> has_sgnx_times<span class="main">[</span><span class="operator">OF</span> c1 c2<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> has_sgnx_imp_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_nonzero_has_sgnx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_topology_class.order_tendstoD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> equal
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> greater
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_topology_class.order_tendstoD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> greater <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_nonzero_sgnx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> sgn <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tendsto_nonzero_has_sgnx
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms has_sgnx_imp_sgnx<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">)</span>  
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> filterlim_at_infinity_divide_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> 
      at_bot_le_at_infinity filterlim_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="free">c</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> sgn <span class="free">c</span> <span class="main">*</span> inverse <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> sgn <span class="free">c</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_bot"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_tendsto_pos_mult_at_bot<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ asm<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> sgn_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> sgn <span class="free">c</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_mono_eventually<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> eventually_times_inverse_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> sgn <span class="free">c</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> filterlim_at_bot_dense<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="free">c</span><span class="main">/</span><span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse divide_less_0_iff sgn_neg sgn_pos sgn_sgn<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">:&gt;</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_inverse_at_bot<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_mult_left_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> linorder_neqE_linordered_idom mult_less_0_iff 
            neg_0_less_iff_less sgn_greater sgn_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">c</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> sgn <span class="free">c</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def<span class="main">)</span>    
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">*</span>inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">:&gt;</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_pos_mult_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> sgn_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">)</span>  
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> filterlim_at_infinity_divide_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> 
      at_top_le_at_infinity filterlim_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="free">c</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> sgn <span class="free">c</span> <span class="main">*</span> inverse <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> sgn <span class="free">c</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_tendsto_pos_mult_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ asm<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> sgn_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> sgn <span class="free">c</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> filterlim_mono_eventually<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> eventually_times_inverse_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> sgn <span class="free">c</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_dense<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="free">c</span><span class="main">/</span><span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sgn_greater sgn_less sgn_neg sgn_pos zero_less_divide_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">∧</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_inverse_at_top<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_mult_left_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">F</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sgn_1_neg sgn_greater sgn_if zero_less_mult_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">c</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> sgn <span class="free">c</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def<span class="main">)</span>    
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">*</span>inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="main">*</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_pos_mult_at_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> sgn_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>    
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">lemma</span></span> poly_sgnx_left_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">a</span> <span class="free">p</span><span class="main">)</span> 
            <span class="keyword1">then</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">-</span>sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_sgnx_imp_sgnx tendsto_nonzero_has_sgnx that<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_sgnx_imp_sgnx tendsto_nonzero_has_sgnx that<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dvdE poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sgnx <span class="main">(</span>poly <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> 
          <span class="main">=</span> sgnx <span class="main">(</span>poly <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">*</span> sgnx <span class="main">(</span>poly <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pq
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_mult<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sgnx_times<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> has_sgnx_imp_sgnx<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linordered_field_no_lb<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgnx <span class="main">(</span>poly <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> 
          <span class="main">=</span> sgnx <span class="main">(</span>poly <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">*</span> sgnx <span class="main">(</span>poly <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pq
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_mult<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sgnx_times<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">[:</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> has_sgnx_imp_sgnx<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linordered_field_no_ub<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>order <span class="free">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟷</span> odd <span class="main">(</span>order <span class="free">a</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pq 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> pq<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_power_n_n<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> less.hyps<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_has_sgnx_left_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>order <span class="free">a</span> <span class="free">p</span><span class="main">)</span> 
            <span class="keyword1">then</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="free">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> poly_sgnx_left_right 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.inverse_inverse assms has_sgnx_unique 
     sgnx_able_poly sgnx_able_sgnx trivial_limit_at_left_real trivial_limit_at_right_real<span class="main">)</span>    
    
    
<span class="keyword1"><span class="command">lemma</span></span> sign_r_pos_sgnx_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">a</span> <span class="main">⟷</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sgnx_able_poly<span class="main">(</span>1<span class="main">)</span> sgnx_able_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm 
    <span class="keyword1"><span class="command">using</span></span> has_sgnx_imp_sgnx trivial_limit_at_right_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">unfolding</span></span> sign_r_pos_def has_sgnx_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"sign_r_pos <span class="free">p</span> <span class="free">a</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgnx_able_sgnx<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def sign_r_pos_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>eventually_conj_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgnx_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sgnx_able</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> sgnx <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> sgnx <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> sgnx_able_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sgn<span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> eventually_happens 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> has_sgnx_imp_sgnx<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_poly_at_top<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span>  sgn_pos_inf <span class="free">p</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_sgnx_def poly_sgn_eventually_at_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_poly_at_bot<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span>  sgn_neg_inf <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_sgnx_def poly_sgn_eventually_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1"><span class="command">lemma</span></span> sgnx_poly_at_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> at_top <span class="main">=</span> sgn_pos_inf <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_sgnx_def has_sgnx_imp_sgnx poly_sgn_eventually_at_top<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> sgnx_poly_at_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> at_bot <span class="main">=</span> sgn_neg_inf <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_sgnx_def has_sgnx_imp_sgnx poly_sgn_eventually_at_bot<span class="main">)</span>  
  
<span class="keyword1"><span class="command">lemma</span></span> poly_has_sgnx_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_top <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_bot <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> at_bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn_pos_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> sgn_pos_inf <span class="free">p</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sgn_pos_inf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sgn_if<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_top <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_sgnx_poly_at_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> sgn_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sgn_neg_inf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sgn_if<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_bot <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_sgnx_poly_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sgnx_able_poly<span class="main">(</span>2<span class="main">)</span> sgnx_able_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sgnx_values sgnx_able_poly<span class="main">(</span>2<span class="main">)</span> trivial_limit_at_left_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="skolem">lb</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left sgn_if
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_neq_zero zero_neq_neg_one<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">lb</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> proots <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>proots <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> infinite_super<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lb</span><span class="main">&lt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_proots<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sgnx_able_poly<span class="main">(</span>1<span class="main">)</span> sgnx_able_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sgnx_values sgnx_able_poly<span class="main">(</span>1<span class="main">)</span> trivial_limit_at_right_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">ub</span><span class="main">)</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right sgn_if
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_neq_zero zero_neq_neg_one<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">ub</span><span class="main">}</span> <span class="main">⊆</span> proots <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> proots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>proots <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> infinite_super<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ub</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>proots <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_proots<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">c</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_sgnx_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> poly_has_sgnx_values<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free"><span class="free">p</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">≠</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>›</span></span></span></span></span><span class="main">]</span> has_sgnx_imp_sgnx trivial_limit_at_left_real 
    trivial_limit_at_right_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span>inverse <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def comp_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_subst<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> always_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inverse_inverse_eq sgn_inverse<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_derivative_at_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_deriv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d1_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">h</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d1</span> <span class="main">⟶</span> <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DERIV_pos_inc_left<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span><span class="main"><span class="main">-</span></span><span class="skolem"><span class="skolem">d1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d1</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> d1_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.commute add_uminus_conv_diff assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_add_cancel 
          diff_strict_left_mono diff_zero minus_diff_eq sgn_neg<span class="main">)</span>  
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d1_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">h</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d1</span> <span class="main">⟶</span> <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DERIV_neg_dec_left<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span><span class="main"><span class="main">-</span></span><span class="skolem"><span class="skolem">d1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d1</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> d1_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.commute add_uminus_conv_diff assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_add_cancel
            diff_zero less_diff_eq minus_diff_eq sgn_pos<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_derivative_at_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_deriv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="free">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d2_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">h</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d2</span> <span class="main">⟶</span> <span class="free">g</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DERIV_pos_inc_right<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span><span class="main"><span class="main">+</span></span><span class="skolem"><span class="skolem">d2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d2</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> d2_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_add_cancel diff_less_eq less_add_same_cancel1 sgn_pos<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d2_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">h</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d2</span> <span class="main">⟶</span> <span class="free">g</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DERIV_neg_dec_right<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span><span class="main"><span class="main">+</span></span><span class="skolem"><span class="skolem">d2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d2</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> d2_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.commute add.right_inverse add_uminus_conv_diff assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          diff_add_cancel diff_less_eq sgn_neg<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> has_sgnx_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def <span class="keyword1"><span class="command">using</span></span> eventually_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
        
<span class="keyword1"><span class="command">lemma</span></span> sgnx_at_top_IVT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> gt_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> poly_has_sgnx_values<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_top <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> has_r<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> has_top<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">a'</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_r<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_right<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="skolem">a'</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">b'</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_top<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_top_linorder<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">1</span><span class="main">+</span>max <span class="skolem">b</span> <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≥</span><span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">≤</span><span class="skolem">c</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_IVT_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> has_r<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> has_top<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">a'</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_r<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_right<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="skolem">a'</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">b'</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_top<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_top_linorder<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">1</span><span class="main">+</span>max <span class="skolem">b</span> <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≥</span><span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">≤</span><span class="skolem">c</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_IVT_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_top
     <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> at_top"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that has_sgnx_imp_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> sgnx_at_left_at_right_IVT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> poly_has_sgnx_values<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> has_r<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> has_l<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">a'</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_r<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_right<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">+</span>min <span class="skolem">a'</span> <span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">d</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="skolem">b'</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_l<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_left<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span><span class="main">(</span><span class="free">b</span><span class="main">+</span>max <span class="skolem">b'</span> <span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&gt;</span><span class="skolem">c</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">d</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_IVT_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> has_r<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> has_l<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">&gt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">a'</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_r<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_right<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">+</span>min <span class="skolem">a'</span> <span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="skolem">b'</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_l<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_left<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span><span class="main">(</span><span class="free">b</span><span class="main">+</span>max <span class="skolem">b'</span> <span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&gt;</span><span class="skolem">c</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="skolem">b'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="free">b</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_IVT_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>
     <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that has_sgnx_imp_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> sgnx_at_bot_IVT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lt_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> poly_has_sgnx_values<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_bot <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> has_l<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> has_bot<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> at_bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">&lt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="skolem">a'</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_l<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_left<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="skolem">a'</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&gt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&lt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&lt;</span><span class="free">a</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span><span class="skolem">b'</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_bot<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_bot_linorder<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span>min <span class="skolem">b</span> <span class="skolem">b'</span><span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≤</span><span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&lt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">≥</span><span class="skolem">c</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_IVT_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> has_l<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> has_bot<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_bot"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&lt;</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">&lt;</span><span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&gt;</span><span class="skolem">a'</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_l<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_left<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="skolem">a'</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&gt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">&lt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&lt;</span><span class="free">a</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≤</span><span class="skolem">b'</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_bot<span class="main">[</span><span class="operator">unfolded</span> has_sgnx_def eventually_at_bot_linorder<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span>min <span class="skolem">b</span> <span class="skolem">b'</span><span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≤</span><span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&lt;</span><span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">≥</span><span class="skolem">c</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_IVT_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> at_bot
     <span class="main">∨</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> at_bot"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that has_sgnx_imp_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> sgnx_poly_nz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> sgn<span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_nonzero_has_sgnx<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite predicate segments over an interval›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">finite_Psegments</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">P</span> <span class="keyword2"><span class="keyword">where</span></span>
  emptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span> <span class="free">finite_Psegments</span> <span class="free">P</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span><span class="main">|</span>
  insertI_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">∨</span><span class="free">P</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">&lt;..&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span><span class="main">;</span> <span class="free">finite_Psegments</span> <span class="free">P</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⟧</span> 
        <span class="main">⟹</span> <span class="free">finite_Psegments</span> <span class="free">P</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span><span class="main">|</span>
  insertI_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">∨</span><span class="free">P</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span><span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">&lt;..&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">t</span><span class="main">)</span><span class="main">;</span><span class="free">finite_Psegments</span> <span class="free">P</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⟧</span> 
        <span class="main">⟹</span> <span class="free">finite_Psegments</span> <span class="free">P</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> finite_Psegments_pos_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">lb</span><span class="main">+</span><span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">ub</span><span class="main">+</span><span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">b</span><span class="main">*</span><span class="bound">t</span><span class="main">+</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">lb'</span></span> <span class="bound"><span class="bound">ub'</span></span><span class="main"><span class="main">.</span></span> finite_Psegments <span class="main"><span class="main">(</span></span><span class="free"><span class="free">P</span></span> <span class="keyword1"><span class="keyword1">o</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">b</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">+</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">lb'</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">ub'</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="comment1">(*really weird application of the induction rule, is there an alternative?*)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lb</span><span class="main">::</span>real<span class="main">)</span><span class="main">≤</span><span class="skolem">ub</span>"</span></span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lb</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">ub</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ub</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">lb</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.emptyI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">ub</span>"</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">ub</span><span class="main">}</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span>"</span></span> 
       <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="skolem">P</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">lb</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">lb</span> <span class="main">∨</span> <span class="skolem">P</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="skolem">P</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">lb</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ub</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lb</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">ub</span>"</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">ub</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="bound">t</span>"</span></span> 
       <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="skolem">P</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">lb</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
       <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">lb</span> <span class="main">∨</span> <span class="skolem">P</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="skolem">P</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">lb</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ub</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> finite_Psegments_congE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">Q</span> <span class="free">lb</span> <span class="free">ub</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span><span class="free">lb</span><span class="main">&lt;</span><span class="bound">t</span><span class="main">;</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">ub</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">⟷</span> <span class="free">P</span> <span class="bound">t</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">lb</span> <span class="free">ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_Psegments.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>emptyI <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_Psegments.emptyI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_1 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="skolem">a</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_2 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="skolem">a</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>   
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> finite_Psegments_constI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span><span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span><span class="main">;</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≥</span><span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that finite_Psegments.emptyI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_Psegments.emptyI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_Psegments.emptyI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_congE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">context</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span>  

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> finite_Psegments_less_eq1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≤</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_Psegments.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>emptyI <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_Psegments.emptyI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_1 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≤</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">s</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">c</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">c</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>›</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> finite_Psegments.insertI_1<span class="main">[</span><span class="operator">OF</span> _ _ _ <span class="quoted"><span class="quoted">‹finite_Psegments <span class="free">P</span> <span class="skolem">a</span> <span class="skolem">s</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹ <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_2 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≤</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">s</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">c</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">c</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span>›</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> finite_Psegments.insertI_2<span class="main">[</span><span class="operator">OF</span> _ _ _ <span class="quoted"><span class="quoted">‹finite_Psegments <span class="free">P</span> <span class="skolem">a</span> <span class="skolem">s</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹ <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>  
 
  
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> finite_Psegments_less_eq2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_Psegments.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>emptyI <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_Psegments.emptyI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_1 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">b</span><span class="main">&lt;..&lt;</span><span class="skolem">c</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Psegments_constI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&gt;</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_1<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> s<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> insertI_1 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_2 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≤</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="free">b</span><span class="main">&lt;..&lt;</span><span class="skolem">c</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_Psegments_constI greaterThanLessThan_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&gt;</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> s<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> insertI_2 that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>  


<span class="keyword1"><span class="command">lemma</span></span> finite_Psegments_included<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≤</span><span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">b</span> <span class="free">c</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> finite_Psegments_less_eq2 finite_Psegments_less_eq1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
<span class="keyword2"><span class="keyword">end</span></span>      

<span class="keyword1"><span class="command">lemma</span></span> finite_Psegments_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="free">c</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_Psegments.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>emptyI <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_Psegments_included <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_1 <span class="skolem">s</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">s</span><span class="main">..</span><span class="main">(</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">s</span><span class="main">..</span><span class="main">(</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insertI_1<span class="main">(</span>1<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> closed_Int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">s</span><span class="main">..</span><span class="main">(</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> dist <span class="bound">y</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> min <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">..</span><span class="main">(</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>min_mult_distrib_left <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> insertI_1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> y_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">c</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> min_mult_distrib_left min_less_iff_disj<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">y</span> <span class="skolem">s</span> <span class="main">&lt;</span><span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">c</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> min_mult_distrib_left min_less_iff_disj dist_real_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closed_approachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">c</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insertI_1 <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> closed_Int<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> arg_elim<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">closed</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">b</span><span class="main">..&lt;</span><span class="skolem">c</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_2 <span class="skolem">s</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">c</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that insertI_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> closed_Int<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> arg_elim<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">closed</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">b</span><span class="main">..&lt;</span><span class="skolem">c</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="skolem">b</span>›</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_Psegments.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> emptyI
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2 that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym_conv atLeastAtMost_iff finite_Psegments.insertI_2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_1 <span class="skolem">s0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s0</span><span class="main">&lt;</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1 atLeastLessThan_iff that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s0</span><span class="main">+</span><span class="skolem">s</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> closed_Int<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹closed <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span><span class="main">)</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">s0</span><span class="main">+</span><span class="skolem">s</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> arg_elim<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">closed</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s0</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹ <span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">b</span><span class="main">..&lt;</span><span class="skolem">c</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> dist <span class="bound">y</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> max <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">s0</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span><span class="main">-</span><span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="skolem">s0</span><span class="main">+</span><span class="skolem">s</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y_def
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s0</span><span class="main">&lt;</span><span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> min_mult_distrib_left<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y</span>"</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> insertI_1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> y_def
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s0</span><span class="main">&lt;</span><span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">=</span><span class="skolem">b</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> max_mult_distrib_left less_max_iff_disj<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">y</span> <span class="skolem">s</span> <span class="main">&lt;</span><span class="skolem">e</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s0</span><span class="main">&lt;</span><span class="skolem">s</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> max_mult_distrib_left less_max_iff_disj dist_real_def 
              max_add_distrib_right<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> closed_approachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">P</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_2 <span class="skolem">s0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s0</span><span class="main">&lt;..&lt;</span><span class="skolem">c</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">c</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span>›</span></span> that <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s0</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">t</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2.prems<span class="main">(</span>2<span class="main">)</span> local.insertI_2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="skolem">s0</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite_Psegments <span class="free">P</span> <span class="free">a</span> <span class="skolem">s0</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∨</span> <span class="free">P</span> <span class="skolem">s</span>›</span></span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite segment intersection of a path with the imaginary axis›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finite_ReZ_segments</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_ReZ_segments</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_joinpaths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g1</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g2</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"path <span class="free">g1</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g2</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="free">g1</span><span class="main">=</span>pathstart <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">t</span><span class="main">=</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="skolem">P</span> <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> g1 <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> finite_Psegments_pos_linear<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> P_def joinpaths_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_congE<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="skolem">P</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> g2 <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">t</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">1</span>"</span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> finite_Psegments_pos_linear<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> P_def joinpaths_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_congE<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> path_join_imp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g1</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g2</span>›</span></span> <span class="quoted"><span class="quoted">‹pathfinish <span class="free">g1</span><span class="main">=</span>pathstart <span class="free">g2</span>›</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> path_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> continuous_on_Re<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> continuous_on_open_Collect_neq<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> Re <span class="free">z</span>"</span></span><span class="main">,</span><span class="operator">OF</span> continuous_on_const<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> arg_elim<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"open"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> closed_Diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">::</span>real<span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main">,</span><span class="operator">OF</span> _ this<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> arg_elim<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">closed</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="skolem">P</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_Psegments_combine<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def P_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_congE<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_congE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">p1</span> <span class="free">z1</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span><span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span><span class="main">;</span><span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span>  Re<span class="main">(</span><span class="free">p1</span> <span class="bound">t</span><span class="main">-</span> <span class="free">z1</span><span class="main">)</span> <span class="main">=</span> Re<span class="main">(</span><span class="free">p2</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">p2</span> <span class="free">z2</span>"</span></span>      
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_congE<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
       
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_constI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span><span class="main">∧</span><span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments_constI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> finite_ReZ_segments_congE<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segment_cases <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> subEq subNEq<span class="main">,</span><span class="operator">cases</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">pred</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span>finite_ReZ_segments<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> subEq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">;</span><span class="bound">s</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span>Re <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span><span class="main">;</span>
          <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="bound">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span><span class="main">;</span>finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="bound">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> subNEq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">;</span><span class="bound">s</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span>Re <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span><span class="main">;</span>
          <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="bound">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span><span class="main">;</span>finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="bound">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>  
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_Psegments.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> emptyI
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_1 <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_ReZ_segments_constI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> finite_Psegments_pos_linear<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">,</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> insertI_1<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def comp_def subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subEq insertI_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_2 <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_ReZ_segments_constI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> finite_Psegments_pos_linear<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">,</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> insertI_2<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def comp_def subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subNEq insertI_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>         
  
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_induct <span class="main">[</span><span class="operator">case_names</span> sub0 subEq subNEq<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">pred</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span>finite_ReZ_segments<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  sub0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span>subpath <span class="main">0</span> <span class="main">0</span> <span class="bound">g</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> subEq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span> <span class="bound">g</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">;</span><span class="bound">s</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span>Re <span class="main">(</span><span class="bound">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="bound">z</span><span class="main">;</span>
          <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="bound">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="bound">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="bound">z</span><span class="main">;</span>finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="bound">s</span> <span class="bound">g</span><span class="main">)</span> <span class="bound">z</span><span class="main">;</span> 
          <span class="free">P</span> <span class="main">(</span>subpath <span class="main">0</span> <span class="bound">s</span> <span class="bound">g</span><span class="main">)</span> <span class="bound">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> subNEq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span> <span class="bound">g</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">;</span><span class="bound">s</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span>Re <span class="main">(</span><span class="bound">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="bound">z</span><span class="main">;</span>
          <span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="bound">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="bound">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="bound">z</span><span class="main">;</span>finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="bound">s</span> <span class="bound">g</span><span class="main">)</span> <span class="bound">z</span><span class="main">;</span>
          <span class="free">P</span> <span class="main">(</span>subpath <span class="main">0</span> <span class="bound">s</span> <span class="bound">g</span><span class="main">)</span> <span class="bound">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">g</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">g</span> <span class="free">z</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">≤</span><span class="main">1</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span>subpath <span class="main">0</span> <span class="main">1</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_Psegments.induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">a</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">≥</span></span><span class="bound"><span class="bound">a</span></span> <span class="main"><span class="main">⟶</span></span> <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">(</span></span>subpath <span class="bound"><span class="bound">a</span></span> <span class="bound"><span class="bound">b</span></span> <span class="free"><span class="free">g</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>emptyI <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sub0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_1 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sub0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s'</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="main">(</span><span class="skolem">s</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subEq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s'</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"subpath <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="free"><span class="free">g</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s'</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">s'</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> s'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * (A&lt;1 * A&lt;2)) * R&lt;1) + (((A&lt;=1 * (A&lt;0 * R&lt;1)) * (R&lt;1 * [1]^2))
               + ((A&lt;=0 * (A&lt;0 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [1]^2)))))"</span><span class="main">)</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insertI_1<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s'</span> <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> s'_def subpath_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>finite_ReZ_segments_constI<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insertI_1<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_pos_linear<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">-</span></span><span class="skolem"><span class="skolem">a</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def subpath_def s'_def comp_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s'_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s'</span> <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s'_def subpath_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> s'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> s'_def subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_2 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sub0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s'</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="main">(</span><span class="skolem">s</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subNEq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s'</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"subpath <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="free"><span class="free">g</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s'</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">s'</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> s'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * (A&lt;1 * A&lt;2)) * R&lt;1) + (((A&lt;=1 * (A&lt;0 * R&lt;1)) * (R&lt;1 * [1]^2)) + 
              ((A&lt;=0 * (A&lt;0 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [1]^2)))))"</span><span class="main">)</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insertI_2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s'</span> <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> s'_def subpath_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>finite_ReZ_segments_constI<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insertI_2<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_pos_linear<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">-</span></span><span class="skolem"><span class="skolem">a</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def subpath_def s'_def comp_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s'_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s'</span> <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s'_def subpath_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="main">(</span>subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="free">g</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> s'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> s'_def subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">&gt;</span><span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_shiftpah<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> loop<span class="main">:</span><span class="quoted"><span class="quoted">"pathfinish <span class="free">g</span> <span class="main">=</span> pathstart <span class="free">g</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span><span class="main">)</span> <span class="free">s</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms finite_Psegments_included<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> finite_Psegments_pos_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="free">s</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> shiftpath_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_congE<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">1</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">0</span> <span class="free">s</span> "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms finite_Psegments_included <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> finite_Psegments_pos_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> shiftpath_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> finite_Psegments_congE<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="var">?f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> path_shiftpath<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> loop <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> path_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> continuous_closed_preimage_constant<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> arg_elim<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">closed</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments_combine<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="free"><span class="free"><span class="free">s</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>
     
<span class="keyword1"><span class="command">lemma</span></span> finite_imp_finite_ReZ_segments<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="skolem">P</span> <span class="main">0</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> ind<span class="main">:</span>1
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="skolem">b</span><span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>finite_Psegments.intros<span class="main">)</span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rs</span> <span class="skolem">b</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lj</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lj</span> <span class="main">=</span> Max <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">lj</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lj</span><span class="main">&lt;</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">lj</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rs</span> <span class="skolem">b</span><span class="main">≠</span><span class="main">{}</span>›</span></span><span class="main">,</span><span class="operator">folded</span> lj_def<span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">lj</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lj</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">lj</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">P</span> <span class="skolem">lj</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">lj</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lj</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="skolem">lj</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">lj</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="bound">t</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">lj</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="bound">t</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lj</span> <span class="main">&lt;</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="skolem">rs</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lj</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≤</span><span class="skolem">lj</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">b</span><span class="main">)</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="skolem">lj</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="skolem">P</span> <span class="main">0</span> <span class="skolem">lj</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ind.hyps<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"card <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">rs</span></span> <span class="skolem"><span class="skolem">lj</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">lj</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">lj</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rs_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lj</span><span class="main">&lt;</span><span class="skolem">b</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>rev_finite_subset <span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">lj</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> psubset_card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">b</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Max_in <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">rs</span> <span class="skolem">lj</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lj</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> lj_def rs_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">lj</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">lj</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">rs</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> rs_def P_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="skolem">P</span> <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def finite_ReZ_segments_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_poly_linepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span>map_poly Re <span class="main">(</span>pcompose <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">[:</span><span class="free">z</span><span class="main">:]</span><span class="main">)</span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">P</span> <span class="skolem">t</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_complex_def P_def linepath_def comp_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Re_poly_of_real<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> poly_pcompose scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> poly <span class="skolem">P</span> <span class="bound">t</span><span class="main">=</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that poly_roots_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span>poly <span class="free">p</span> <span class="main">∘</span> linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   
      <span class="keyword1"><span class="command">using</span></span> finite_imp_finite_ReZ_segments<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="keyword1">o</span> linepath <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments_constI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">True</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> part_circlepath_half_finite_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">≠</span><span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?T</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">θ</span><span class="main">.</span> <span class="main">(</span><span class="free">z0</span><span class="main">+</span><span class="free">r</span><span class="main">*</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">θ</span> <span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="bound">θ</span> <span class="main">∈</span> closed_segment <span class="free">st</span> <span class="free">tt</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">θ</span><span class="main">.</span> <span class="main">(</span><span class="free">z0</span><span class="main">+</span><span class="free">r</span><span class="main">*</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="bound">θ</span> <span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="bound">θ</span> <span class="main">∈</span> closed_segment <span class="free">st</span> <span class="free">tt</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="var">?T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>   
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">-</span><span class="free">st</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">tt</span> <span class="main">-</span><span class="free">st</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">g</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">t</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> closed_segment <span class="free">st</span> <span class="free">tt</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">≠</span><span class="free">tt</span>›</span></span> closed_segment_eq_real_ivl <span class="keyword1"><span class="command">unfolding</span></span>  g_def real_scaleR_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
      <span class="keyword1"><span class="command">unfolding</span></span> linepath_def g_def real_scaleR_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">≠</span><span class="free">tt</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="var">?T</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> S_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>image_eqI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>part_circlepath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="var">?T</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> part_circlepath_def S_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linepath_in_path<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="var">?T</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">=</span><span class="free">r</span> <span class="main">*</span> Re <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="free">r</span><span class="main">*</span> Im <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">=</span>Im <span class="free">c</span> <span class="main">*</span> Im <span class="free">z0</span> <span class="main">+</span> Re <span class="free">z0</span> <span class="main">*</span> Re <span class="free">c</span> <span class="main">-</span> <span class="free">d</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">θ</span><span class="main">=</span> <span class="skolem">a'</span> <span class="main">*</span> cos <span class="skolem">θ</span> <span class="main">+</span> <span class="skolem">b'</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">+</span> <span class="skolem">c'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">θ</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z0</span><span class="main">+</span><span class="free">r</span><span class="main">*</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="skolem">θ</span> <span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">⟷</span> <span class="skolem">f</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">θ</span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_Euler inner_complex_def f_def a'_def b'_def c'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> cos_of_real sin_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> roots <span class="skolem">f</span> <span class="main">∩</span> closed_segment <span class="free">st</span> <span class="free">tt</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> S_def roots_within_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">c'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms complex_eq_iff <span class="keyword1"><span class="command">unfolding</span></span> a'_def b'_def c'_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"periodic_set <span class="main">(</span>roots <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> periodic_set_sin_cos_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a'</span></span> <span class="quoted"><span class="skolem">b'</span></span> <span class="quoted"><span class="skolem">c'</span></span><span class="main">,</span><span class="operator">folded</span> f_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uniform_discrete <span class="main">(</span>roots <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> periodic_imp_uniform_discrete <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> * 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_Int bounded_closed_segment<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uniform_discrete_finite_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="var">?T</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">using</span></span> assms inj_segment <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>subset_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_imageD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> linepath_half_finite_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="var">?S</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> u1u2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">≠</span><span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">∈</span><span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">∈</span><span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">∈</span><span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_finite_existsD asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u2</span><span class="main">.</span> <span class="bound">u2</span><span class="main">∈</span><span class="var">?S</span><span class="main">-</span><span class="main">{</span><span class="skolem">t1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> infinite_remove<span class="main">[</span><span class="operator">OF</span> asm<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite.emptyI rev_finite_subset subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> t1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t1</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">∈</span><span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_left_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> t2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t2</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t2</span><span class="main">∈</span><span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_left_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t1</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t2</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span><span class="main">-</span><span class="skolem">t1</span><span class="main">*</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t1</span><span class="main">*</span><span class="skolem">t2</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t2</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t2</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t1</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">*</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t1</span><span class="main">*</span><span class="skolem">t2</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t1</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t2</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> arg_cong2<span class="main">[</span><span class="operator">OF</span> * **<span class="main">,</span><span class="operator">of</span> <span class="quoted">minus</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">≠</span><span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t1</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">t1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">*</span><span class="skolem">t2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t2</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">t2</span><span class="main">-</span><span class="skolem">t1</span><span class="main">*</span><span class="skolem">t2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">b</span> <span class="main">∙</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t2</span><span class="main">-</span><span class="skolem">t1</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> arg_cong2<span class="main">[</span><span class="operator">OF</span> ** *<span class="main">,</span><span class="operator">of</span> <span class="quoted">minus</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">≠</span><span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> finite_half_joinpaths_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">l1</span> <span class="bound">t</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">l2</span> <span class="bound">t</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">l1</span><span class="main">+++</span><span class="free">l2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l1s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">l1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l2s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">l2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">l</span> <span class="bound">t</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">l1</span><span class="main">+++</span><span class="free">l2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">∙</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="var">?l1s</span> <span class="main">∪</span> <span class="var">?l2s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> joinpaths_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?l1s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l1s</span> <span class="main">=</span> <span class="main">(</span><span class="main">(*)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="var">?ls</span> <span class="free">l1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rev_image_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?l2s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l2s</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">`</span> <span class="var">?ls</span> <span class="free">l2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rev_image_eqI <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_linepath<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">≠</span>Re <span class="free">z</span> <span class="main">∨</span> Re <span class="free">b</span> <span class="main">≠</span>Re <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> linepath_half_finite_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">1</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> that 
      <span class="keyword1"><span class="command">using</span></span> one_complex.code <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> finite_imp_finite_ReZ_segments<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span>Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>finite_Psegments.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_part_circlepath<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">≠</span> <span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> part_circlepath_half_finite_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">1</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">z0</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span>"</span></span><span class="main">]</span> that one_complex.code
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inner_complex_def <span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> finite_imp_finite_ReZ_segments<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">=</span><span class="free">tt</span> <span class="main">∨</span> <span class="free">r</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">+</span> <span class="free">r</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span>  <span class="free">tt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> part_circlepath_def c_def <span class="keyword1"><span class="command">using</span></span> that linepath_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> finite_ReZ_segments_linepath<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> linepath_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_poly_of_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">o</span> of_real<span class="main">)</span> <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> finite_ReZ_segments_poly_linepath<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> linepath_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scaleR_conv_of_real<span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_subpath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">≤</span><span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">≤</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="free">u</span> <span class="free">v</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span><span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>finite_ReZ_segments_constI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">&lt;</span><span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span><span class="main">≤</span><span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="free">u</span> <span class="free">v</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> 
      <span class="main">=</span> finite_Psegments <span class="main">(</span><span class="skolem">P</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def subpath_def P_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments_pos_linear<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms False <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> P_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>finite_Psegments_included<span class="main">)</span>        
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>   
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹jump and jumpF›</span></span> 
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jump</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">jump</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> 
        <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_right <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> 
      <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> 
        <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_right <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> 
      <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jumpF</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real filter <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">jumpF</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> filterlim <span class="free"><span class="bound"><span class="entity">f</span></span></span> at_top <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> 
    <span class="keyword1">if</span> filterlim <span class="free"><span class="bound"><span class="entity">f</span></span></span> at_bot <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> jumpF_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">c</span> <span class="main">:&gt;</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filterlim_at_bot_nhds<span class="main">[</span><span class="operator">OF</span> that _ <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">c</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_nhds<span class="main">[</span><span class="operator">OF</span> that _ <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> jumpF_not_infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous <span class="free">F</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">g</span> <span class="free">F</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="free">g</span> at_infinity <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_tendsto_and_filterlim_at_infinity<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">≠</span>bot›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> continuous_def<span class="main"><span class="main">]</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="free">g</span> at_bot <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="free">g</span> at_top <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> at_bot_le_at_infinity at_top_le_at_infinity filterlim_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_linear_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?case1</span></span></span><span class="main">)</span>
    <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?case2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case1</span></span></span> <span class="var"><span class="quoted"><span class="var">?case2</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="var">?g</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at_right <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"filtermap <span class="var">?g</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at_left <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> 
      filtermap_linear_at_left<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> 
      filtermap_linear_at_right<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def filterlim_def comp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filtermap_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case1</span></span></span> <span class="var"><span class="quoted"><span class="var">?case2</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case1</span></span></span> <span class="var"><span class="quoted"><span class="var">?case2</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="var">?g</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at_left <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"filtermap <span class="var">?g</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at_right <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that 
      filtermap_linear_at_left<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> 
      filtermap_linear_at_right<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def filterlim_def comp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filtermap_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case1</span></span></span> <span class="var"><span class="quoted"><span class="var">?case2</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case1</span></span></span> <span class="var"><span class="quoted"><span class="var">?case2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> jump_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="free">c</span> <span class="main">:&gt;</span> at_bot"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_tendsto_and_filterlim_at_infinity<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"at_left <span class="free"><span class="free">a</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> at_bot_le_at_infinity filterlim_mono that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="free">c</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_tendsto_and_filterlim_at_infinity<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"at_left <span class="free"><span class="free">a</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">c</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> at_top_le_at_infinity filterlim_mono that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> jump_not_infinity<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isCont <span class="free">f</span> <span class="free">a</span> <span class="main">⟹</span> jump <span class="free">f</span> <span class="free">a</span> <span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> at_bot_le_at_infinity at_top_le_at_infinity filterlim_at_split 
      filterlim_def isCont_def jump_def not_tendsto_and_filterlim_at_infinity 
      order_trans trivial_limit_at_left_real<span class="main">)</span> 
  
<span class="keyword1"><span class="command">lemma</span></span> jump_jump_poly_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coprime_poly_0<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹coprime <span class="free">p</span> <span class="free">q</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">f</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jump_not_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> jump_poly_not_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even<span class="main">(</span>order <span class="free">a</span> <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≡</span>sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> 
      filterlim_divide_at_bot_at_top_iff
        <span class="main">[</span><span class="operator">OF</span> _ that<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free">q</span></span>"</span></span></span>  <span class="quoted"><span class="quoted"><span class="quoted">"at_left <span class="free"><span class="free">a</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free">p</span></span>"</span></span></span><span class="main">,</span><span class="operator">folded</span> f_def c_def<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
      filterlim_divide_at_bot_at_top_iff
        <span class="main">[</span><span class="operator">OF</span> _ that<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free">q</span></span>"</span></span></span>  <span class="quoted"><span class="quoted"><span class="quoted">"at_right <span class="free"><span class="free">a</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free">p</span></span>"</span></span></span><span class="main">,</span><span class="operator">folded</span> f_def c_def<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_has_sgnx_left_right<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def sgn_if that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_unique<span class="main">[</span><span class="operator">OF</span> _ that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">f</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_0I that<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≡</span>sgn <span class="main">(</span>poly <span class="free">q</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> even_zero order_0I poly_tendsto<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_split<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> 
      filterlim_divide_at_bot_at_top_iff
        <span class="main">[</span><span class="operator">OF</span> _ that<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free">q</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="free"><span class="free">p</span></span>"</span></span></span><span class="main">,</span><span class="operator">folded</span> f_def c_def<span class="main">]</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_has_sgnx_left_right<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">f</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span>
        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sign_r_pos <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span>  sign_r_pos <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span> "</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">q</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tendsto_nonzero_sgnx<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgnx_times<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def sgn_if that<span class="main">)</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> not_real_square_gt_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sign_r_pos_sgnx_iff 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"sign_r_pos <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">q</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sgnx <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> asm sign_r_pos_sgnx_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c2</span> <span class="main">*</span> <span class="var">?c1</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> poly_mult<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sgnx_times<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c2</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="var">?c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∨</span> <span class="var">?c2</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="var">?c1</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c1</span><span class="main">=</span><span class="var">?c2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sgnx_values<span class="main">[</span><span class="operator">OF</span> sgnx_able_poly<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_neutral less_minus_iff less_not_sym<span class="main">)</span>    
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="main">(</span>poly <span class="free">q</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tendsto_nonzero_sgnx<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c1</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sgnx_able_poly<span class="main">(</span>1<span class="main">)</span> sgnx_able_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">using</span></span> poly_has_sgnx_values<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free"><span class="free">p</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">≠</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>›</span></span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse c_def sgn_if that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jump_poly_def <span class="keyword1"><span class="command">using</span></span> False order_root that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_root assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> jump_jumpF<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span><span class="quoted"><span class="quoted">"isCont <span class="main">(</span>inverse <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      sgnxl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">l</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sgnxr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">≠</span><span class="main">0</span> "</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump <span class="free">f</span> <span class="free">a</span> <span class="main">=</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jump_def jumpF_def 
    <span class="keyword1"><span class="command">using</span></span> that filterlim_at_top_at_bot<span class="main">[</span><span class="operator">OF</span> _ _ trivial_limit_at_left_real<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jump_def jumpF_def 
    <span class="keyword1"><span class="command">using</span></span> that filterlim_at_top_at_bot<span class="main">[</span><span class="operator">OF</span> _ _ trivial_limit_at_right_real<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> filterlim <span class="free">f</span> at_top <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="free">f</span> at_top <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>inverse <span class="keyword1">o</span> inverse <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cont False <span class="keyword1"><span class="command">unfolding</span></span> comp_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> continuous_at_within_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="free">f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> continuous_at_split <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>continuous_within<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> trivial_limit_at_left_real trivial_limit_at_right_real
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">using</span></span> filterlim_at_bot_nhds filterlim_at_top_nhds
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tends0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> cont <span class="keyword1"><span class="command">unfolding</span></span> isCont_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> r_lim<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="free">r</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> filterlim <span class="free">f</span> at_top <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="keyword1">else</span> filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> sgnxr <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> filterlim_inverse_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> tends0
        <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> sgnxr <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">≠</span><span class="main">0</span>›</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> linorder_neqE_linordered_idom sgn_less<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> filterlim_inverse_at_bot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> tends0
        <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> l_lim<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="free">l</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> filterlim <span class="free">f</span> at_top <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="keyword1">else</span> filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> sgnxl <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> filterlim_inverse_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> tends0
        <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> sgnxl <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">≠</span><span class="main">0</span>›</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> linorder_neqE_linordered_idom sgn_less<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> filterlim_inverse_at_bot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> tends0
        <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that l_lim r_lim <span class="quoted"><span class="quoted">‹jump <span class="free">f</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r_lim l_lim that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="free">f</span> at_top <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="free">f</span> at_top <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> filterlim_at_top_at_bot<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> "</span></span>  <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹jump <span class="free">f</span> <span class="free">a</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> filterlim <span class="free">f</span> at_top <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r_lim l_lim that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> filterlim <span class="free">f</span> at_top <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r_lim l_lim that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> jump_linear_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> jump <span class="free">f</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span>jump <span class="free">f</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="var">?g</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at_right <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"filtermap <span class="var">?g</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at_left <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> 
      filtermap_linear_at_left<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> 
      filtermap_linear_at_right<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> jump <span class="free">f</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jump_def filterlim_def comp_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filtermap_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> filterlim_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>filterlim_at_top_at_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="var">?g</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at_left <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"filtermap <span class="var">?g</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> at_right <span class="main">(</span><span class="var">?g</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> True 
      filtermap_linear_at_left<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> 
      filtermap_linear_at_right<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> jump <span class="free">f</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jump_def filterlim_def comp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filtermap_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1"><span class="command">lemma</span></span> jump_divide_derivative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isCont <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> g_deriv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">/</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sgn <span class="free">c</span> <span class="main">=</span> sgn <span class="main">(</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> g_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DERIV_isCont Lim_at_imp_Lim_at_within assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> continuous_at<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lim_at_imp_Lim_at_within assms<span class="main">(</span>1<span class="main">)</span> continuous_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_right<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_left <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_right <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> f_tendsto<span class="main">(</span>1<span class="main">)</span> f_tendsto<span class="main">(</span>2<span class="main">)</span> g_tendsto<span class="main">(</span>1<span class="main">)</span> g_tendsto<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">c</span> <span class="main">=</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_right<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_left <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_right <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> f_tendsto<span class="main">(</span>1<span class="main">)</span> f_tendsto<span class="main">(</span>2<span class="main">)</span> g_tendsto<span class="main">(</span>1<span class="main">)</span> g_tendsto<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_left <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">c</span> <span class="main">≠</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_right<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_left <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_top<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_right <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> f_tendsto<span class="main">(</span>1<span class="main">)</span> f_tendsto<span class="main">(</span>2<span class="main">)</span> g_tendsto<span class="main">(</span>1<span class="main">)</span> g_tendsto<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_left <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">c</span> <span class="main">≠</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_right<span class="main">[</span><span class="operator">OF</span> g_deriv <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_left <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">t</span> at_right <span class="free">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">t</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> f_tendsto<span class="main">(</span>1<span class="main">)</span> f_tendsto<span class="main">(</span>2<span class="main">)</span> g_tendsto<span class="main">(</span>1<span class="main">)</span> g_tendsto<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">c</span> <span class="main">=</span>sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>   
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> jump_jump_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span> <span class="skolem">p'</span><span class="main">*</span>gcd <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">=</span><span class="skolem">q'</span><span class="main">*</span>gcd <span class="free">p</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> gcd_dvd1 gcd_dvd2 dvd_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="free">q</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> mult.commute<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p'</span> <span class="skolem">q'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="free">q</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gcd_coprime <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q'</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="skolem">p'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span><span class="main">::</span>real <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> g_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">(</span>poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">(</span>poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> poly_has_sgnx_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="free">a</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_right <span class="free">a</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tendsto_eventually <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="skolem">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> p'<span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> q'<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> jump <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jump <span class="skolem">f</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jump_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> filterlim_tendsto_pos_mult_at_top_iff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> filterlim_tendsto_pos_mult_at_bot_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> g_tendsto <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jump_poly <span class="skolem">q'</span> <span class="skolem">p'</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> jump_jump_poly_aux<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p'</span> <span class="skolem">q'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> jump_poly_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹gcd <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">q'</span></span><span class="main">]</span> p' q'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>  
  
 
<span class="keyword1"><span class="command">lemma</span></span> jump_Im_divide_Re_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="free">x</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&lt;</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="free">g</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> path_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> continuous_on_interior<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="free">g</span> <span class="free">x</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>›</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> isCont_Re isCont_Im<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> jump_not_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_im_divide_Re_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="free">x</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span><span class="main">≤</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main">&lt;</span><span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span><span class="main">&lt;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main">≤</span><span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">g'</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&lt;</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g'</span> <span class="main">⤏</span> <span class="skolem">g'</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="free">g</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_at_right<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> continuous_Im continuous_Re True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">(</span>netlimit <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_ident_at<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>continuous_divide<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g'_def continuous_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_ident_at<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False atLeastAtMost_iff at_within_Icc_at continuous_Im continuous_Re
          continuous_on_eq_continuous_within less_le that<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">g'</span> <span class="free">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> g'_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> isCont_def <span class="keyword1"><span class="command">using</span></span> filterlim_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="skolem">g'</span> at_top <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="skolem">g'</span> at_bot <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_nhds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g'</span></span> <span class="quoted"><span class="quoted">"at_right <span class="free">x</span>"</span></span><span class="main">]</span> filterlim_at_bot_nhds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g'</span></span> <span class="quoted"><span class="quoted">"at_right <span class="free">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">g'</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≤</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g'</span> <span class="main">⤏</span> <span class="skolem">g'</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="free">g</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_at_left<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> continuous_Im continuous_Re True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">(</span>netlimit <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_ident_at<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>continuous_divide<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g'_def continuous_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_ident_at<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False atLeastAtMost_iff at_within_Icc_at continuous_Im continuous_Re
          continuous_on_eq_continuous_within less_le that<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">g'</span> <span class="free">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> g'_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> isCont_def <span class="keyword1"><span class="command">using</span></span> filterlim_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="skolem">g'</span> at_top <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> filterlim <span class="skolem">g'</span> at_bot <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_nhds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g'</span></span> <span class="quoted"><span class="quoted">"at_left <span class="free">x</span>"</span></span><span class="main">]</span> filterlim_at_bot_nhds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g'</span></span> <span class="quoted"><span class="quoted">"at_left <span class="free">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> jump_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">=</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> jump <span class="free">g</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> left<span class="main">:</span><span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">=</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> right<span class="main">:</span><span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">=</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> eventually_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> filterlim_cong<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> filterlim_cong<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jump_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> jumpF_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">=</span><span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">=</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> jumpF <span class="free">g</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">r</span> <span class="keyword1">in</span> <span class="free">G</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filterlim_cong jumpF_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> jump_at_left_at_right_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isCont <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sgnx_eq<span class="main">:</span><span class="quoted"><span class="quoted">"sgnx <span class="free">g</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgnx <span class="free">g</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">t</span><span class="main">/</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> sgn <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">x</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f_tendsto<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹isCont <span class="free">f</span> <span class="free">x</span>›</span></span> Lim_at_imp_Lim_at_within isCont_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">g</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">g</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> sgnx_eq <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">g</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="free">g</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> sgnx_eq <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jump_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_tendsto filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span> c_def<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_pos_has_sgnx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="free">F</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_dense<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> jumpF_neg_has_sgnx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="free">F</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_bot <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_at_bot_dense<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_IVT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">right</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">R</span><span class="main">::</span>real <span class="main">⇒</span> real <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span> <span class="bound">R</span> <span class="main">(</span>jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> 
                      <span class="main">∨</span> <span class="main">(</span>continuous <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="free">f</span> <span class="main">∧</span> <span class="bound">R</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">left</span><span class="main">≡</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">R</span><span class="main">::</span>real <span class="main">⇒</span> real <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span> <span class="bound">R</span> <span class="main">(</span>jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> 
                      <span class="main">∨</span> <span class="main">(</span>continuous <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="free">f</span> <span class="main">∧</span> <span class="bound">R</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    right_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">right</span> greater <span class="main">∧</span> <span class="free">left</span> less <span class="main">∨</span> <span class="free">right</span> less <span class="main">∧</span> <span class="free">left</span> greater"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">right</span> greater"</span></span> <span class="quoted"><span class="quoted">"<span class="free">left</span> less"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_pos_has_sgnx<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> tendsto_nonzero_has_sgnx<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"at_right <span class="free">a</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">a'</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right <span class="keyword1"><span class="command">using</span></span> sgn_1_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_neg_has_sgnx<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> tendsto_nonzero_has_sgnx<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"at_left <span class="free">b</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">b'</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left <span class="keyword1"><span class="command">using</span></span> sgn_1_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">a'</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">b'</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">a'</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="skolem">b'</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_def b'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span><span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="skolem">a'</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span><span class="main">=</span><span class="main">(</span><span class="free">b</span><span class="main">+</span><span class="skolem">b'</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">a0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span><span class="main">&lt;</span><span class="skolem">b0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> a0_def b0_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">≤</span><span class="skolem">b'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a0</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">b0</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a0</span></span><span class="main">]</span> b'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">a0</span><span class="main">..</span><span class="skolem">b0</span><span class="main">}</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cont <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">a0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atLeastAtMost_subseteq_greaterThanLessThan_iff continuous_on_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="skolem">a0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b0</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IVT_strict<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">a0</span></span> <span class="quoted"><span class="skolem">b0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">a0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lessThan_strict_subset_iff psubsetE subset_psubset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">right</span> less"</span></span> <span class="quoted"><span class="quoted">"<span class="free">left</span> greater"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_neg_has_sgnx<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> tendsto_nonzero_has_sgnx<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"at_right <span class="free">a</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">a'</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right <span class="keyword1"><span class="command">using</span></span> sgn_1_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_sgnx</span>  <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_pos_has_sgnx<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">f</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> tendsto_nonzero_has_sgnx<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"at_left <span class="free">b</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">b'</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left <span class="keyword1"><span class="command">using</span></span> sgn_1_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">a'</span> <span class="main">≤</span> <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">a'</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="skolem">b'</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="skolem">a'</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="main">{</span><span class="skolem">b'</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_def b'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span><span class="main">=</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="skolem">a'</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span><span class="main">=</span><span class="main">(</span><span class="free">b</span><span class="main">+</span><span class="skolem">b'</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">a0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span><span class="main">&lt;</span><span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span><span class="main">&lt;</span><span class="skolem">b0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">&lt;</span><span class="skolem">b0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> a0_def b0_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span><span class="main">≤</span><span class="skolem">b'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a0</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">b0</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a0</span></span><span class="main">]</span> b'_def<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">a0</span><span class="main">..</span><span class="skolem">b0</span><span class="main">}</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cont  <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">a0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atLeastAtMost_subseteq_greaterThanLessThan_iff continuous_on_subset<span class="main">)</span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="skolem">a0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">b0</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IVT_strict<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="skolem">a0</span></span> <span class="quoted"><span class="skolem">b0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">a0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lessThan_strict_subset_iff psubsetE subset_psubset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> right_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> jumpF_eventually_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">=</span><span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">≠</span>bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_const<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">≠</span>bot›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> jumpF_tan_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> tan<span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> cos <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> 
      <span class="keyword1">then</span> jumpF <span class="free">f</span> at_bot <span class="keyword1">else</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> tan<span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> cos <span class="free">x</span> <span class="main">=</span><span class="main">0</span> 
      <span class="keyword1">then</span> jumpF <span class="free">f</span> at_top <span class="keyword1">else</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> tan<span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">if</span> cos <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> filtermap <span class="free">f</span> at_bot <span class="keyword1">else</span> filtermap <span class="free">f</span> <span class="main">(</span>at_right <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> comp_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filtermap_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="quoted">tan</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> filtermap_tan_at_right_inf filtermap_tan_at_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> tan<span class="main">)</span> <span class="main">(</span>at_right <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> cos <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> 
          <span class="keyword1">then</span> jumpF <span class="free">f</span> at_bot <span class="keyword1">else</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def filterlim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> tan<span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">if</span> cos <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> filtermap <span class="free">f</span> at_top <span class="keyword1">else</span> filtermap <span class="free">f</span> <span class="main">(</span>at_left <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> comp_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filtermap_filtermap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="quoted">tan</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> filtermap_tan_at_left_inf filtermap_tan_at_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> tan<span class="main">)</span> <span class="main">(</span>at_left <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> cos <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> 
          <span class="keyword1">then</span> jumpF <span class="free">f</span> at_top <span class="keyword1">else</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="main">(</span>tan <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def filterlim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite jumpFs over an interval›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finite_jumpFs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span>  bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_jumpFs</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span> 
  
<span class="keyword1"><span class="command">lemma</span></span> finite_jumpFs_linear_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">⟷</span> finite_jumpFs <span class="free">f</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">lb</span> <span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">ub</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">lb</span> <span class="bound">ub</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">lb</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">ub</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">lb</span> <span class="bound">ub</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">lb</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">ub</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gi</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span> 
      <span class="main">=</span> finite <span class="main">(</span><span class="skolem">left</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">∪</span> <span class="skolem">right</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">finite</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>left_def right_def g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> finite <span class="main">(</span><span class="skolem">gi</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">left</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">lb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">ub</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">right</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">lb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">ub</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> j_rw<span class="main">:</span>
      <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="main">(</span><span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="main">(</span><span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> <span class="skolem">gi</span> <span class="main">`</span> <span class="skolem">left</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">lb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">ub</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">=</span> <span class="skolem">gi</span> <span class="main">`</span> <span class="skolem">right</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">lb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">ub</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> left_def right_def gi_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>g_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">∪</span> <span class="skolem">right</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span> 
        <span class="main">=</span> <span class="skolem">gi</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">left</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">lb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">ub</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">right</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">lb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">ub</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> finite <span class="main">(</span><span class="skolem">left</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">lb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">ub</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">right</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">lb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="free">ub</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> gi_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&gt;</span><span class="main">0</span>›</span></span>  inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  finite_jumpFs <span class="free">f</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">lb</span> <span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">ub</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">finite</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>left_def right_def g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> finite_jumpFs_consts<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="free">lb</span> <span class="free">ub</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def <span class="keyword1"><span class="command">using</span></span> jumpF_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> finite_jumpFs_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="free">f</span> <span class="free">b</span> <span class="free">c</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="free">f</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> finite_jumpFs_subE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="free">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b'</span><span class="main">≤</span><span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="free">f</span> <span class="free">a'</span> <span class="free">b'</span>"</span></span>  
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
<span class="keyword1"><span class="command">lemma</span></span> finite_Psegments_Re_imp_jumpFs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">/</span>Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_Psegments.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>emptyI <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>    
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_1 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="skolem">f</span> <span class="skolem">a</span> <span class="skolem">s</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹continuous_on <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="free">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insertI_1 <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="skolem">f</span> <span class="skolem">s</span> <span class="skolem">b</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_eventually_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that insertI_1 <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_eventually_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that insertI_1 <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span>
          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">=</span><span class="skolem">s</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_jumpFs_combine<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insertI_2 <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="skolem">f</span> <span class="skolem">a</span> <span class="skolem">s</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">s</span><span class="main">}</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹continuous_on <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="free">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> insertI_2 <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="skolem">f</span> <span class="skolem">s</span> <span class="skolem">b</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> f_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> isCont_Im isCont_Re 
            continuous_on_interior<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹continuous_on <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="free">g</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> insertI_2.hyps<span class="main">(</span>1<span class="main">)</span> that 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">using</span></span> insertI_2.hyps<span class="main">(</span>3<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_at_split jumpF_not_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">}</span>
          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">=</span><span class="skolem">s</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..&lt;</span><span class="skolem">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_jumpFs_combine<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> finite_ReZ_segments_imp_jumpFs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">/</span>Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments_Re_imp_jumpFs<span class="main">)</span>      
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">jumpF</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> at path ends›</span></span>  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jumpF_pathstart</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">jumpF_pathstart</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jumpF_pathfinish</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">jumpF_pathfinish</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_pathstart_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>pathstart <span class="free">g</span><span class="main">)</span><span class="main">≠</span>Re <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_im_divide_Re_0<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> pathstart_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> jumpF_pathfinish_eq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>pathfinish <span class="free">g</span><span class="main">)</span><span class="main">≠</span>Re <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_im_divide_Re_0<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> pathfinish_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
   
<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> jumpF_pathfinish_reversepath<span class="main">:</span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathstart <span class="free">g</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> jumpF_pathstart_reversepath<span class="main">:</span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>reversepath <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>reversepath <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def f'_def comp_def reversepath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathstart <span class="free">g</span> <span class="free">z</span>"</span></span> 
        <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g</span> <span class="free">z</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def jumpF_pathfinish_def
    <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> jumpF_linear_comp<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_def f'_def<span class="main">)</span>    
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
     
<span class="keyword1"><span class="command">lemma</span></span> jumpF_pathstart_joinpaths<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathstart <span class="free">g1</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g1</span> <span class="free">z</span> <span class="main">=</span> jumpF <span class="var">?h</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="var">?h</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?h</span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="var">?f</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_right <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> <span class="main">(*)</span> <span class="numeral">2</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span><span class="var">?f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>joinpaths_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>jumpF_pathstart <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_pathfinish_joinpaths<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g2</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="free">g2</span> <span class="free">z</span> <span class="main">=</span> jumpF <span class="var">?h</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="var">?h</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">t</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="var">?f</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span><span class="var">?f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>joinpaths_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>jumpF_pathfinish <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cauchy index›</span></span>  

<span class="comment1">―‹Deprecated, use "cindexE" if possible›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cindex</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cindex</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">.</span> jump <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cindexE</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cindexE</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">.</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">.</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>     

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cindexE_ubd</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cindexE_ubd</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span> <span class="main">}</span><span class="main">.</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> jumpF <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> cindexE_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">a</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.neutral<span class="main">)</span>     
  
<span class="keyword1"><span class="command">lemma</span></span> cindex_const<span class="main">:</span> <span class="quoted"><span class="quoted">"cindex <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
<span class="keyword1"><span class="command">lemma</span></span> cindex_eq_cindex_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"cindex <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cindex_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_poly <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="free">p</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span>jump_poly <span class="free">q</span> <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">.</span> jump_poly <span class="free">q</span> <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_poly_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_cong_right<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> jump_poly_not_root <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">≠</span><span class="main">0</span>›</span></span> poly_roots_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex <span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">/</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> jump_jump_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> cindex_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="free">f</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">c</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&lt;</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex <span class="free">a</span> <span class="free">c</span> <span class="free">f</span> <span class="main">=</span> cindex <span class="free">a</span> <span class="free">b</span> <span class="free">f</span>  <span class="main">+</span> jump <span class="free">f</span> <span class="free">b</span> <span class="main">+</span> cindex <span class="free">b</span> <span class="free">c</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ssum</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ssum</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> sum <span class="main">(</span>jump <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="free">f</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">c</span><span class="main">}</span> <span class="main">∩</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> ssum_union<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ssum</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ssum</span> <span class="skolem">A</span> <span class="main">+</span> <span class="skolem">ssum</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="main">=</span><span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ssum_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> C_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> sum_Un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span>"</span></span><span class="main">]</span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc inf_sup_aci<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf_sup_distrib1 sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="free">a</span> <span class="free">c</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">ssum</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">&lt;..&lt;</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ssum_def cindex_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"jump <span class="free"><span class="free">f</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"jump <span class="free"><span class="free">f</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="free">a</span> <span class="free">b</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">ssum</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_def ssum_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="free">f</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">ssum</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> ssum_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&lt;</span><span class="free">c</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jump <span class="free">f</span> <span class="free">b</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="free">b</span> <span class="free">c</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">ssum</span> <span class="main">{</span><span class="free">b</span><span class="main">&lt;..&lt;</span><span class="free">c</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_def ssum_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">&lt;</span><span class="free">c</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> ssum_union<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> ssum_union<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> cindexE_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span><span class="quoted"><span class="quoted">"finite_jumpFs <span class="free">f</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≤</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">c</span> <span class="free">f</span> <span class="main">=</span> cindexE <span class="free">a</span> <span class="free">b</span> <span class="free">f</span> <span class="main">+</span> cindexE <span class="free">b</span> <span class="free">c</span> <span class="free">f</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A0</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A1</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B0</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B1</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B2</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="skolem">A1</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A2</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B2</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B1</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B2</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> A1_def A2_def B1_def B2_def S_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≤</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">≤</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A1</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A2</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">c</span> <span class="free">f</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">A0</span> 
        <span class="main">-</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">B0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def A0_def B0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A1</span> <span class="main">∪</span> <span class="skolem">A2</span><span class="main">)</span> 
        <span class="main">-</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">B1</span> <span class="main">∪</span> <span class="skolem">B2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A0</span><span class="main">=</span><span class="skolem">A1</span><span class="main">∪</span><span class="skolem">A2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A0_def A1_def A2_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B0</span><span class="main">=</span><span class="skolem">B1</span><span class="main">∪</span><span class="skolem">B2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B0_def B1_def B2_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="free">a</span> <span class="free">b</span> <span class="free">f</span> <span class="main">+</span> cindexE <span class="free">b</span> <span class="free">c</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">∩</span> <span class="skolem">A2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A1_def A2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B1</span> <span class="main">∩</span> <span class="skolem">B2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B1_def B2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> A1_def A2_def B1_def B2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sum.union_disjoint<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_linear_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> 
    <span class="keyword1">then</span> cindex <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">lb</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">ub</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="free">f</span> 
    <span class="keyword1">else</span> <span class="main">-</span> cindex <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">ub</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">lb</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">ub</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">lb</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum_negf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jump_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jump_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> False <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindex <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">lb</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">ub</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jump_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jump_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> True <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>     

<span class="keyword1"><span class="command">lemma</span></span> cindexE_linear_comp<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span><span class="main">&gt;</span><span class="main">0</span> 
    <span class="keyword1">then</span> cindexE <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">lb</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">ub</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="free">f</span> 
    <span class="keyword1">else</span> <span class="main">-</span> cindexE <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">ub</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">lb</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cright</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cright</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">lb</span> <span class="bound">ub</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">lb</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">ub</span><span class="main">.</span> 
                        jumpF <span class="bound">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cleft</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cleft</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">lb</span> <span class="bound">ub</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">lb</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">ub</span><span class="main">.</span> 
                        jumpF <span class="bound">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> cindexE_unfold<span class="main">:</span><span class="quoted"><span class="quoted">"cindexE <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">cright</span> <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="skolem">f</span> <span class="main">-</span> <span class="skolem">cleft</span> <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">lb</span> <span class="skolem">ub</span> <span class="skolem">f</span> <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def cright_def cleft_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cright</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">cleft</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">ub</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">lb</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> cright_def cleft_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">c</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">c</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cleft</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">cright</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">ub</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">lb</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> cright_def cleft_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">c</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">c</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindexE_unfold <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cright</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">cright</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">lb</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">ub</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> cright_def cleft_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">c</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">c</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cleft</span> <span class="free">lb</span> <span class="free">ub</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">cleft</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">lb</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">ub</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> cright_def cleft_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">c</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">c</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_linear_comp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">c</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindexE_unfold <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindexE_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">;</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span><span class="main">;</span><span class="bound">x</span><span class="main">∉</span><span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">b</span> <span class="free">f</span> <span class="main">=</span> cindexE <span class="free">a</span> <span class="free">b</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">left</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">.</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">right</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">.</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">left</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="free">g</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">cs</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="free">a</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> Max <span class="skolem">cs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="skolem">x</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span><span class="main">=</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="free">a</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fg_eq <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹finite <span class="skolem">cs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">s</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">s</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">∈</span><span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">∈</span><span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">∈</span><span class="skolem">cs</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">≤</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹finite <span class="skolem">cs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">y'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>fg_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="skolem">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> left_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">right</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="free">g</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="skolem">x</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">cs</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> Min <span class="skolem">cs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span><span class="main">=</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">(</span><span class="skolem">x</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fg_eq <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹finite <span class="skolem">cs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">s</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">s</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">&lt;</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">∈</span><span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">∈</span><span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">∈</span><span class="skolem">cs</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">≥</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹finite <span class="skolem">cs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="skolem">y'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>fg_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_right <span class="skolem">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> right_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def left_def right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span> cindexE_constI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span><span class="free">a</span><span class="main">&lt;</span><span class="bound">t</span><span class="main">;</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">t</span><span class="main">=</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">b</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">left</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">.</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">right</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">.</span> jumpF <span class="bound">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_eventually_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_eventually_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def left_def right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_eq_cindexE_divide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">/</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_fg<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span><span class="free">g</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≤</span><span class="bound">x</span><span class="main">∧</span><span class="bound">x</span><span class="main">≤</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    g_imp_f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    f_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">b</span> <span class="free">h</span> <span class="main">=</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">+</span> cindex <span class="free">a</span> <span class="free">b</span> <span class="free">h</span> <span class="main">-</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">R</span> <span class="bound">S</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">L</span> <span class="bound">S</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> jump_gnz<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jump <span class="free">h</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="free">h</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">using</span></span> f_cont g_cont that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_interior<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jump <span class="free">h</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> jumpF_not_infinity jump_not_infinity <span class="keyword1"><span class="command">unfolding</span></span> continuous_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    
  <span class="keyword1"><span class="command">have</span></span> finite_jFs<span class="main">:</span><span class="quoted"><span class="quoted">"finite_jumpFs <span class="free">h</span> <span class="free">a</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">s</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> jump_gnz
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span><span class="free">g</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≤</span><span class="bound">x</span><span class="main">∧</span><span class="bound">x</span><span class="main">≤</span><span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">S</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> rev_finite_subset<span class="main">[</span><span class="operator">OF</span> finite_fg<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">S</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">S</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def finite_jumpFs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">b</span> <span class="free">h</span> <span class="main">=</span> <span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def right_def left_def R_def L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">R</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_jFs <span class="keyword1"><span class="command">unfolding</span></span> R_def finite_jumpFs_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">=</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> 
            <span class="main">+</span> <span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum.remove<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">L</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_jFs <span class="keyword1"><span class="command">unfolding</span></span> L_def finite_jumpFs_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="skolem">L</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span><span class="main">=</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum.remove<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="free">a</span><span class="main">)</span> <span class="main">+</span> cindex <span class="free">a</span> <span class="free">b</span> <span class="free">h</span> <span class="main">-</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> right_def S_def R_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_left<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_fg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_gnz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> left_def S_def L_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_left<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_fg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_gnz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> 
        <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_int<span class="main">(</span>jump <span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">S</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hr</span> <span class="main">=</span> sgnx <span class="free">h</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hl</span> <span class="main">=</span> sgnx <span class="free">h</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hr</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hl</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="free">h</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> finite_fg <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">h</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">using</span></span> f_cont g_cont
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_subset<span class="main">)</span> 
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> finite_fg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">hl</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="keyword1">sgnx_able</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">hr</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span>  finite_sgnx_at_left_at_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">h</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main"><span class="main">{</span></span></span></span><span class="bound"><span class="bound"><span class="bound"><span class="bound">x</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">.</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">g</span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound">x</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">∧</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">a</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">&lt;</span></span></span></span><span class="bound"><span class="bound"><span class="bound"><span class="bound">x</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">∧</span></span></span></span><span class="bound"><span class="bound"><span class="bound"><span class="bound">x</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">&lt;</span></span></span></span><span class="free"><span class="free"><span class="free"><span class="free">b</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">}</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span></span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> hl_def hr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span> <span class="keyword1">has_sgnx</span> <span class="skolem">hl</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span> <span class="keyword1">has_sgnx</span> <span class="skolem">hr</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> hl_def hr_def <span class="keyword1"><span class="command">using</span></span> sgnx_able_sgnx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>inverse <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">S</span>›</span></span> g_imp_f <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f_cont g_cont <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def S_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>comp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_interior<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="free">h</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="free">h</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="main">(</span>jump <span class="free">h</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> jump_jumpF<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">hr</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hl</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex <span class="free">a</span> <span class="free">b</span> <span class="free">h</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cindex_def of_int_sum S_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_cong_right<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> jump_gnz finite_fg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>  
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cauchy index along a path›</span></span>

<span class="comment1">―‹Deprecated, use "cindex\_pathE" if possible›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cindex_path</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cindex_path</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> cindex <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 
   
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cindex_pathE</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cindex_pathE</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_point<span class="main">:</span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>linepath <span class="free">a</span> <span class="free">a</span><span class="main">)</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cindexE_constI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_path_reversepath<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cindex_path <span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span> cindex_path <span class="free">g</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>reversepath <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>reversepath <span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def f'_def comp_def reversepath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="main">0</span> <span class="main">1</span> <span class="skolem">f'</span> <span class="main">=</span> <span class="main">-</span> cindex <span class="main">0</span> <span class="main">1</span> <span class="skolem">f</span>"</span></span>   
    <span class="keyword1"><span class="command">using</span></span> cindex_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_path_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_def f'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_reversepath<span class="main">:</span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span>cindex_pathE <span class="free">g</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cindex_pathE_def reversepath_def o_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_reversepath'<span class="main">:</span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span>cindex_pathE <span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cindex_pathE_def reversepath_def o_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_joinpaths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g1</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g2</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"path <span class="free">g1</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g2</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="free">g1</span> <span class="main">=</span> pathstart <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindex_pathE <span class="free">g1</span> <span class="free">z</span> <span class="main">+</span> cindex_pathE <span class="free">g2</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> Im <span class="main">(</span><span class="bound">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="bound">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span>  cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cindexE <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_combine<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> f_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_ReZ_segments_imp_jumpFs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_ReZ_segments_joinpaths<span class="main">[</span><span class="operator">OF</span> g1 g2<span class="main">]</span> assms<span class="main">(</span>3-5<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> path_join_imp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g1</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g2</span>›</span></span> <span class="quoted"><span class="quoted">‹pathfinish <span class="free">g1</span><span class="main">=</span>pathstart <span class="free">g2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_pathE <span class="free">g1</span> <span class="free">z</span> <span class="main">+</span> cindex_pathE <span class="free">g2</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindex_pathE <span class="free">g1</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g1</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">(*)</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> comp_def joinpaths_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_pathE <span class="free">g1</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindex_pathE <span class="free">g2</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindexE <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g2</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">x</span>  <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> comp_def joinpaths_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_pathE <span class="free">g2</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_constI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span><span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span><span class="main">;</span><span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">t</span><span class="main">=</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_constI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_subpath_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≤</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≤</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">a</span> <span class="free">b</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">+</span> cindex_pathE <span class="main">(</span>subpath <span class="free">b</span> <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> 
          <span class="main">=</span> cindex_pathE <span class="main">(</span>subpath <span class="free">a</span> <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">a</span> <span class="free">b</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_pathE_constI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">b</span> <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_pathE_constI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&lt;</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≤</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">≤</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">a</span> <span class="free">b</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindexE <span class="free">a</span> <span class="free">b</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">a</span> <span class="free">b</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def comp_def subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  cindexE <span class="free">a</span> <span class="free">b</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">-</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">b</span> <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindexE <span class="free">b</span> <span class="free">c</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">b</span> <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def comp_def subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  cindexE <span class="free">b</span> <span class="free">c</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">-</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">a</span> <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindexE <span class="free">a</span> <span class="free">c</span> <span class="skolem">f</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="free">a</span> <span class="free">c</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def comp_def subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  cindexE <span class="free">a</span> <span class="free">c</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">-</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">&lt;</span><span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">a</span> <span class="free">b</span> <span class="skolem">f</span> <span class="main">+</span> cindexE <span class="free">b</span> <span class="free">c</span> <span class="skolem">f</span> <span class="main">=</span> cindexE <span class="free">a</span> <span class="free">c</span> <span class="skolem">f</span> "</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="skolem">f</span> <span class="free">a</span> <span class="free">c</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> finite_ReZ_segments_imp_jumpFs<span class="main">[</span><span class="operator">OF</span> g <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">≤</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main">≤</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> finite_jumpFs_subE<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp cindexE_combine<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≤</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">≤</span><span class="free">c</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_shiftpath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> loop<span class="main">:</span><span class="quoted"><span class="quoted">"pathfinish <span class="free">g</span> <span class="main">=</span> pathstart <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindex_pathE <span class="free">g</span> <span class="free">z</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>real<span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="bound">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cindexE <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_combine<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_ReZ_segments_shiftpah<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> finite_ReZ_segments_imp_jumpFs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> path_shiftpath<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> loop <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span><span class="main">]</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">s</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="free">s</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">+</span> cindexE <span class="free">s</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindexE <span class="free">s</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> shiftpath_def f_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span> cindexE <span class="free">s</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="free">s</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>shiftpath <span class="free">s</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cindexE <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">+</span><span class="free">s</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> shiftpath_def f_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="free">s</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_combine<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="skolem">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> finite_ReZ_segments_imp_jumpFs<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_pathE <span class="free">g</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cauchy's Index Theorem›</span></span>  
    
<span class="keyword1"><span class="command">theorem</span></span> winding_number_cindex_pathE_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Re_ends<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re<span class="main">(</span>winding_number <span class="free">g</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="free">g</span> <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_ReZ_segments_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sub0 <span class="skolem">g</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>subpath <span class="main">0</span> <span class="main">0</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> path_image <span class="main">(</span>subpath <span class="main">0</span> <span class="main">0</span> <span class="skolem">g</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subpath_refl
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> winding_number_trivial<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>subpath <span class="main">0</span> <span class="main">0</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subpath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>cindex_pathE_constI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>subEq <span class="skolem">s</span> <span class="skolem">g</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Re_winding_0<span class="main">:</span><span class="quoted"><span class="quoted">"Re<span class="main">(</span>winding_number <span class="skolem">h</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> Re_const<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∉</span>path_image <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="main">(</span>Ln <span class="main">(</span>pathfinish <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">-</span> Im <span class="main">(</span>Ln <span class="main">(</span>pathstart <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_number_half_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Re_const <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> path_image <span class="skolem">h</span>›</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.commute imageE le_add_same_cancel1 order_refl 
            path_image_def plus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>Ln <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span>Ln <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">0</span> <span class="main">-</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z0</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z1</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> path_image <span class="skolem">h</span>›</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> z1_def z0_def path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z0</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> z1_def z0_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z1</span></span></span></span><span class="main">]</span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z0</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z0</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z1</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> z1_def z0_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z1</span></span></span></span><span class="main">]</span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z0</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z0</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z1</span><span class="main">≤</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> IVT2'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> that valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> f_def z0_def z1_def path_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Re_const  <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> path_image <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastAtMost_iff complex_surj image_eqI minus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                path_defs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> right_minus_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z0</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z1</span><span class="main">≥</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> IVT'<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> that valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> f_def z0_def z1_def path_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Re_const <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> path_image <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastAtMost_iff complex_surj image_eqI minus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                path_defs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> right_minus_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pathfinish_def pathstart_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> winding_number_offset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">g</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>winding_number <span class="skolem">g</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> * <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> path_image <span class="skolem">g</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_constI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">=</span> subpath <span class="main">0</span> <span class="skolem">s</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">=</span> subpath <span class="skolem">s</span> <span class="main">1</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g</span>›</span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="skolem">g</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g1</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g2</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_subpath_combine<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">∉</span>path_image <span class="skolem">g</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span>
            <span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g1_def g2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g1</span> <span class="skolem">z</span> <span class="main">-</span> cindex_pathE <span class="skolem">g2</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g1</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g1</span> <span class="skolem">z</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> g1_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subEq.hyps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> subEq.hyps<span class="main">(</span>1<span class="main">)</span> subEq.prems<span class="main">(</span>1<span class="main">)</span> valid_path_subpath <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Path_Connected.path_image_subpath_subset atLeastAtMost_iff 
            atLeastLessThan_iff less_eq_real_def subEq<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> subEq.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subEq.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
            subsetCE valid_path_imp_path zero_le_one<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Groups.add_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_0_left diff_zero mult.right_neutral subEq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
            subEq<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> subpath_def<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subEq.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subpath_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g2</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g2</span> <span class="skolem">z</span>"</span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g2</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">t</span><span class="main">=</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g2_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> add.left_neutral diff_add_cancel mult.commute mult.left_neutral 
                mult_zero_left subEq.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subEq.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subpath_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t'_def 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * (A&lt;1 * A&lt;2)) * R&lt;1) + ((A&lt;=1 * (A&lt;0 * R&lt;1)) * (R&lt;1 * [1]^2))))"</span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> g2_def subpath_def t'_def <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>winding_number <span class="skolem">g2</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> g2_def subEq.hyps<span class="main">(</span>1<span class="main">)</span> subEq.prems<span class="main">(</span>1<span class="main">)</span> valid_path_subpath <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Path_Connected.path_image_subpath_subset 
                atLeastAtMost_iff atLeastLessThan_iff g2_def less_eq_real_def subEq.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                subEq.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subEq.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE valid_path_imp_path zero_le_one<span class="main">)</span>  
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g2</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindexE_constI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="skolem">g</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">z</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> subpath_def finite_ReZ_segments_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> finite_Psegments_pos_linear<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">OF</span> this<span class="main">]</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="skolem">s</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>    
        <span class="keyword1"><span class="command">using</span></span> cindex_pathE_subpath_combine<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹path <span class="skolem">g</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">folded</span> g1_def g2_def<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>  
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>subNEq <span class="skolem">s</span> <span class="skolem">g</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Re_winding<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re<span class="main">(</span>winding_number <span class="skolem">h</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> jumpF_pathfinish <span class="skolem">h</span> <span class="skolem">z</span> <span class="main">-</span> jumpF_pathstart <span class="skolem">h</span> <span class="skolem">z</span>"</span></span> 
    <span class="keyword2"><span class="keyword">when</span></span> Re_neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∉</span>path_image <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> Re_winding_pos<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re<span class="main">(</span>winding_number <span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> jumpF_pathfinish <span class="skolem">h0</span> <span class="main">0</span> <span class="main">-</span> jumpF_pathstart <span class="skolem">h0</span> <span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">when</span></span> Re_gt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">h0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">∉</span>path_image <span class="skolem">h0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h0</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">t</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> Im<span class="main">(</span><span class="skolem">h0</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ln0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln0</span> <span class="main">=</span> Im <span class="main">(</span>Ln <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ln1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln1</span> <span class="main">=</span> Im <span class="main">(</span>Ln <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> pi"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">h0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h0</span>›</span></span> valid_path_imp_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">0</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">1</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> path_defs<span class="main">(</span>4<span class="main">)</span> that<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln1</span> <span class="main">=</span> jumpF_pathfinish <span class="skolem">h0</span> <span class="main">0</span>"</span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> sgnx_at_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">h0</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">h0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>continuous_on_at_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">h0</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ln1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="skolem">h0</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">f</span> at_top <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">" Im <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h0</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> sgnx_at_left cont that <span class="keyword1"><span class="command">unfolding</span></span> continuous_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def jumpF_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln1</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">h0</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ln1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="skolem">h0</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span>Im <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> sgnx_at_left that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">f</span> at_bot <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> cont that
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">" Im <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h0</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">unfolding</span></span> continuous_within <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def jumpF_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h0</span> <span class="main">1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">using</span></span> complex.expand <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln0</span> <span class="main">=</span> jumpF_pathstart <span class="skolem">h0</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> sgnx_at_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">h0</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h0</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">h0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_def      
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>continuous_on_at_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>   
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">h0</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ln0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="skolem">h0</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">f</span> at_top <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">" Im <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h0</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> sgnx_at_right cont that <span class="keyword1"><span class="command">unfolding</span></span> continuous_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def jumpF_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>   
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ln0</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Im_Ln_eq_pi_half<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">h0</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">≠</span></span><span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ln0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="skolem">h0</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="skolem">f</span> at_bot <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">" Im <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">h0</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> sgnx_at_right cont that <span class="keyword1"><span class="command">unfolding</span></span> continuous_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def jumpF_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h0</span> <span class="main">0</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">using</span></span> complex.expand <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re<span class="main">(</span>winding_number <span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ln1</span> <span class="main">-</span> <span class="skolem">ln0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="skolem">h0</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> Re <span class="bound">p</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> path_image <span class="skolem">h0</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">h0</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Re <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">t</span><span class="main">=</span><span class="main">1</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> that t <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Re <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that t Re_gt<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Re <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>    
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> Re_winding_number_half_right<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> path_image <span class="skolem">h0</span>›</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ln1_def ln0_def pathfinish_def pathstart_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
   
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hu</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">h</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re<span class="main">(</span>winding_number <span class="var">?hu</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> jumpF_pathfinish <span class="var">?hu</span> <span class="main">0</span> <span class="main">-</span> jumpF_pathstart <span class="var">?hu</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Re_winding_pos<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> valid_path_offset valid_path_uminus_comp 
            <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">∉</span>path_image <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff path_defs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="var">?hu</span> <span class="main">0</span> <span class="main">=</span> winding_number <span class="skolem">h</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> winding_number_offset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> 
              winding_number_uminus_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">t</span><span class="main">-</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span><span class="operator">unfolded</span> comp_def<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
              <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">∉</span>path_image <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="var">?hu</span> <span class="main">0</span> <span class="main">=</span>  jumpF_pathfinish <span class="skolem">h</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>jumpF_cong eventuallyI<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="var">?hu</span> <span class="main">0</span> <span class="main">=</span>  jumpF_pathstart <span class="skolem">h</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>jumpF_cong eventuallyI<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&gt;</span> Re <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hu</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re<span class="main">(</span>winding_number <span class="var">?hu</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> jumpF_pathfinish <span class="var">?hu</span> <span class="main">0</span> <span class="main">-</span> jumpF_pathstart <span class="var">?hu</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Re_winding_pos<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> valid_path_offset valid_path_uminus_comp 
            <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">∉</span>path_image <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="var">?hu</span> <span class="main">0</span> <span class="main">=</span> winding_number <span class="skolem">h</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> winding_number_offset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">∉</span>path_image <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="var">?hu</span> <span class="main">0</span> <span class="main">=</span>  jumpF_pathfinish <span class="skolem">h</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="var">?hu</span> <span class="main">0</span> <span class="main">=</span>  jumpF_pathstart <span class="skolem">h</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&gt;</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="skolem">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="skolem">z</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">t1</span><span class="main">)</span><span class="main">≤</span>Re <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">≥</span>Re <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">≤</span><span class="skolem">t2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">t1</span><span class="main">..</span><span class="skolem">t2</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span><span class="main">]</span> t <span class="keyword1"><span class="command">unfolding</span></span> path_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> atLeastatMost_subset_iff continuous_on_Re continuous_on_subset 
            eucl_less_le_not_le greaterThanLessThan_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≥</span><span class="skolem">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≤</span><span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  IVT'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">t1</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">]</span> t <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">≤</span><span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Re_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">≥</span><span class="skolem">t2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">t2</span><span class="main">..</span><span class="skolem">t1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span><span class="main">]</span> t <span class="keyword1"><span class="command">unfolding</span></span> path_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> atLeastatMost_subset_iff continuous_on_Re continuous_on_subset 
            eucl_less_le_not_le greaterThanLessThan_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≤</span><span class="skolem">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≥</span><span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  IVT2'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">t1</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">]</span> t <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">≥</span><span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Re_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> index_ends<span class="main">:</span><span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">h</span> <span class="skolem">z</span> <span class="main">=</span> jumpF_pathstart <span class="skolem">h</span> <span class="skolem">z</span> <span class="main">-</span> jumpF_pathfinish <span class="skolem">h</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">when</span></span> Re_neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ri</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ri</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Le</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Le</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> valid_path_imp_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> jumpF_eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">f</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> continuous_on_interior<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="skolem">h</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> path_def<span class="main"><span class="main">]</span></span><span class="main">]</span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> isCont_Im isCont_Re<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> continuous_at_split <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> jumpF_not_infinity<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">h</span> <span class="skolem">z</span>  <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="skolem">f</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Ri</span> <span class="main">-</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Le</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def Ri_def Le_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">-</span>  jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Ri</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Ri</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> jumpF_eq0 Ri_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ri</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Ri</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> jumpF_eq0 Ri_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ri</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Le</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Le</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Le_def <span class="keyword1"><span class="command">using</span></span> jumpF_eq0<span class="main">(</span>1<span class="main">)</span> greaterThanLessThan_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Le</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Le_def <span class="keyword1"><span class="command">using</span></span> jumpF_eq0<span class="main">(</span>1<span class="main">)</span> greaterThanLessThan_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF_pathstart <span class="skolem">h</span> <span class="skolem">z</span> <span class="main">-</span> jumpF_pathfinish <span class="skolem">h</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def jumpF_pathfinish_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="skolem">g</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> jumpF_pathfinish <span class="skolem">g</span> <span class="skolem">z</span> <span class="main">-</span> jumpF_pathstart <span class="skolem">g</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> subNEq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g</span> <span class="skolem">z</span> <span class="main">=</span> jumpF_pathstart <span class="skolem">g</span> <span class="skolem">z</span> <span class="main">-</span> jumpF_pathfinish <span class="skolem">g</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> index_ends<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> subNEq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">=</span> subpath <span class="main">0</span> <span class="skolem">s</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">=</span> subpath <span class="skolem">s</span> <span class="main">1</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">g</span>›</span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="skolem">g</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g1</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g2</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_subpath_combine<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">∉</span>path_image <span class="skolem">g</span>›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span>
            <span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g1_def g2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g1</span> <span class="skolem">z</span> <span class="main">-</span> cindex_pathE <span class="skolem">g2</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g1</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g1</span> <span class="skolem">z</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> g1_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subNEq.hyps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> subNEq.hyps<span class="main">(</span>1<span class="main">)</span> subNEq.prems<span class="main">(</span>1<span class="main">)</span> valid_path_subpath <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Path_Connected.path_image_subpath_subset atLeastAtMost_iff 
            atLeastLessThan_iff less_eq_real_def subNEq<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> subNEq.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subNEq.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
            subsetCE valid_path_imp_path zero_le_one<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Groups.add_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_0_left diff_zero mult.right_neutral subNEq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
            subNEq<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> subpath_def<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subNEq.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subpath_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g2</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g2</span> <span class="skolem">z</span>"</span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g2</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * (A&lt;1 * A&lt;2)) * R&lt;1) + ((A&lt;=1 * (A&lt;1 * R&lt;1)) * (R&lt;1 * [1]^2))))"</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g2_def subpath_def t'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re <span class="main">(</span>winding_number <span class="skolem">g2</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> jumpF_pathfinish <span class="skolem">g2</span> <span class="skolem">z</span> <span class="main">-</span> jumpF_pathstart <span class="skolem">g2</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Re_winding<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.right_neutral g2_def mult_zero_right subNEq.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                subpath_def that<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2</span> <span class="main">≡</span> subpath <span class="skolem">s</span> <span class="main">1</span> <span class="skolem">g</span>›</span></span> subNEq.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subpath_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> g2_def subNEq.hyps<span class="main">(</span>1<span class="main">)</span> subNEq.prems<span class="main">(</span>1<span class="main">)</span> valid_path_subpath <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Path_Connected.path_image_subpath_subset 
                <span class="quoted"><span class="quoted">‹path <span class="skolem">g</span>›</span></span> atLeastAtMost_iff atLeastLessThan_iff g2_def less_eq_real_def subNEq.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                subNEq.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE zero_le_one<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g2</span> <span class="skolem">z</span> <span class="main">=</span> jumpF_pathstart <span class="skolem">g2</span> <span class="skolem">z</span> <span class="main">-</span> jumpF_pathfinish <span class="skolem">g2</span> <span class="skolem">z</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> index_ends<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> g2_def subNEq.hyps<span class="main">(</span>1<span class="main">)</span> subNEq.prems<span class="main">(</span>1<span class="main">)</span> valid_path_subpath <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="skolem">g</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> finite_ReZ_segments_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_Psegments.insertI_2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Re <span class="skolem">z</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">z</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> subpath_def finite_ReZ_segments_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> finite_Psegments_pos_linear<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">OF</span> this<span class="main">]</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_Psegments <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="skolem">s</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>    
        <span class="keyword1"><span class="command">using</span></span> cindex_pathE_subpath_combine<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹path <span class="skolem">g</span>›</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">folded</span> g1_def g2_def<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> winding_number_cindex_pathE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    loop<span class="main">:</span> <span class="quoted"><span class="quoted">"pathfinish <span class="free">g</span> <span class="main">=</span> pathstart <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_ReZ_segment_cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>    
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> const<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> finite<span class="main">:</span><span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> continuous_constant_on_closure<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">&lt;..&lt;</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> Re<span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">,</span><span class="operator">unfolded</span> path_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> continuous_Re <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_subset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> const <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> loop <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="free">g</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="free">g</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> winding_number_cindex_pathE_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="free">g</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> integer_winding_number<span class="main">[</span><span class="operator">OF</span> _ loop <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">g</span>›</span></span><span class="main">]</span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral complex_eq complex_is_Int_iff mult_zero_right 
        nonzero_mult_div_cancel_left of_real_0 zero_neq_numeral<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> Re_neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> finite<span class="main">:</span><span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="main">(</span>subpath <span class="main">0</span> <span class="skolem">s</span> <span class="free">g</span><span class="main">)</span> <span class="free">z</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span> valid_path_imp_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="free">g</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="free">g</span> <span class="free">z</span>"</span></span>       
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> index_ends<span class="main">:</span><span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">h</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathstart <span class="skolem">h</span> <span class="free">z</span> <span class="main">-</span> jumpF_pathfinish <span class="skolem">h</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> Re_neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ri</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ri</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Le</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Le</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_path <span class="skolem">h</span>›</span></span> valid_path_imp_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> jumpF_eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">h</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">f</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> continuous_on_interior<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="skolem">h</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> path_def<span class="main"><span class="main">]</span></span><span class="main">]</span> that
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> isCont_Im isCont_Re<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> continuous_at_split <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> jumpF_not_infinity<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">h</span> <span class="free">z</span>  <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="skolem">f</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Ri</span> <span class="main">-</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Le</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def Ri_def Le_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">-</span>  jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Ri</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Ri</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> jumpF_eq0 Ri_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ri</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Ri</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> jumpF_eq0 Ri_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ri</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Le</span> <span class="main">=</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Le</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> Le_def <span class="keyword1"><span class="command">using</span></span> jumpF_eq0<span class="main">(</span>1<span class="main">)</span> greaterThanLessThan_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Le</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> Le_def <span class="keyword1"><span class="command">using</span></span> jumpF_eq0<span class="main">(</span>1<span class="main">)</span> greaterThanLessThan_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF_pathstart <span class="skolem">h</span> <span class="free">z</span> <span class="main">-</span> jumpF_pathfinish <span class="skolem">h</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def jumpF_pathfinish_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fI</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fR</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> fI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fI</span> <span class="main">⤏</span> <span class="skolem">fI</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fI</span> <span class="main">⤏</span> <span class="skolem">fI</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="skolem">fI</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_at_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fI_def path_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fI</span> <span class="main">⤏</span> <span class="skolem">fI</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="skolem">fI</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_at_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fI_def path_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fI</span> <span class="main">⤏</span> <span class="skolem">fI</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">have</span></span> fR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fR</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fR</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="skolem">fR</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_at_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fR_def path_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fR</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> fR_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="skolem">fR</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_at_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fR_def path_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fR</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that loop <span class="keyword1"><span class="command">unfolding</span></span> fR_def path_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&gt;</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="free">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="free">z</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t1</span><span class="main">)</span><span class="main">≤</span>Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">≥</span>Re <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">≤</span><span class="skolem">t2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">t1</span><span class="main">..</span><span class="skolem">t2</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">]</span> t <span class="keyword1"><span class="command">unfolding</span></span> path_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> atLeastatMost_subset_iff continuous_on_Re continuous_on_subset 
            eucl_less_le_not_le greaterThanLessThan_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≥</span><span class="skolem">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≤</span><span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  IVT'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">t1</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">]</span> t <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">≤</span><span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Re_neq <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">≥</span><span class="skolem">t2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">t2</span><span class="main">..</span><span class="skolem">t1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">]</span> t <span class="keyword1"><span class="command">unfolding</span></span> path_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> atLeastatMost_subset_iff continuous_on_Re continuous_on_subset 
            eucl_less_le_not_le greaterThanLessThan_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≤</span><span class="skolem">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">≥</span><span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  IVT2'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">t1</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">]</span> t <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span><span class="main">≥</span><span class="skolem">t2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Re_neq <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> Re_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&gt;</span> Re <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="free">g</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="free">g</span><span class="main">.</span> Re <span class="free">z</span> <span class="main">≤</span> Re <span class="bound">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> path_image <span class="free">g</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">≤</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_ge_on_closure<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">&lt;..&lt;</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Re <span class="free"><span class="free">z</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">,</span><span class="operator">unfolded</span> path_def<span class="main">]</span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≤</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">≤</span> Re <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> Re_winding_number_half_right<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">g</span>›</span></span><span class="main">]</span> loop
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">-</span> jumpF_pathfinish <span class="free">g</span> <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> index_ends<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">]</span> Re_neq <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> jumpF_pathstart_eq_0<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="free">g</span> <span class="free">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> jumpF_pathfinish_eq_0<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span><span class="main">]</span> that loop <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fR</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> fR_def has_sgnx_def eventually_at_right
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Re_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fR</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> fR_def has_sgnx_def eventually_at_left
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Re_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">0</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">fI</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">0</span> <span class="main">=</span><span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>›</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> fI_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∉</span> path_image <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">0</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">fI</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">fR</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">fI</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> that fI fR<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> Re <span class="free"><span class="free">z</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def fI_def fR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> loop that <span class="keyword1"><span class="command">unfolding</span></span> path_defs fI_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">fI</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">fR</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">fI</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> that fI fR<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> Re <span class="free"><span class="free">z</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def fI_def fR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>  
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">0</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">fI</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">fR</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">fI</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> that fI fR<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> Re <span class="free"><span class="free">z</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def fI_def fR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">1</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> loop that <span class="keyword1"><span class="command">unfolding</span></span> path_defs fI_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">fI</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">fR</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">fI</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> that fI fR<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> Re <span class="free"><span class="free">z</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def fI_def fR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>  
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> Re_neg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>winding_number <span class="free">g</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>path_image <span class="free">g</span><span class="main">.</span> Re <span class="free">z</span> <span class="main">≥</span> Re <span class="bound">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> path_image <span class="free">g</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">≥</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_le_on_closure<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">&lt;..&lt;</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Re <span class="free"><span class="free">z</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">,</span><span class="operator">unfolded</span> path_def<span class="main">]</span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">≤</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≤</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">≥</span> Re <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> Re_winding_number_half_left<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">g</span>›</span></span><span class="main">]</span> loop
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">-</span> jumpF_pathfinish <span class="free">g</span> <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> index_ends<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">]</span> Re_neq <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> Re <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> jumpF_pathstart_eq_0<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="free">g</span> <span class="free">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> jumpF_pathfinish_eq_0<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span><span class="main">]</span> that loop <span class="keyword1"><span class="command">unfolding</span></span> path_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fR</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> fR_def has_sgnx_def eventually_at_right
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Re_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fR</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> fR_def has_sgnx_def eventually_at_left
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Re_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">0</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">fI</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">0</span> <span class="main">=</span><span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>›</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> fI_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∉</span> path_image <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">0</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">fI</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">fR</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">fI</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> that fI fR<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> Re <span class="free"><span class="free">z</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def fI_def fR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> loop that <span class="keyword1"><span class="command">unfolding</span></span> path_defs fI_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">fI</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">fR</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">fI</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> that fI fR<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> Re <span class="free"><span class="free">z</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def fI_def fR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>  
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">0</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">fI</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">fR</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">fI</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> that fI fR<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> Re <span class="free"><span class="free">z</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def fI_def fR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fI</span> <span class="main">1</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> loop that <span class="keyword1"><span class="command">unfolding</span></span> path_defs fI_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">fI</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">fR</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">fI</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span> that fI fR<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹Re <span class="main"><span class="main">(</span></span><span class="free"><span class="free">g</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> Re <span class="free"><span class="free">z</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def fI_def fR_def jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>  
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> shiftpath <span class="skolem">s</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>winding_number <span class="skolem">g'</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="skolem">g'</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_cindex_pathE_aux<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g'</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">g'</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="free">g</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">≠</span><span class="main">0</span>›</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> g'_def shiftpath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">g'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> valid_path_shiftpath<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span> loop<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">,</span><span class="operator">folded</span> g'_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="skolem">g'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> g'_def loop path_image_shiftpath <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="skolem">g'</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_ReZ_segments_shiftpah<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>›</span></span> _ <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> loop<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="skolem">g'</span> <span class="free">z</span> <span class="main">=</span> winding_number <span class="free">g</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g'_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> winding_number_shiftpath<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∉</span> path_image <span class="free">g</span>›</span></span> loop<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">g'</span> <span class="free">z</span> <span class="main">=</span> cindex_pathE <span class="free">g</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g'_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cindex_pathE_shiftpath<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite_ReZ_segments <span class="free">g</span> <span class="free">z</span>›</span></span> _ <span class="quoted"><span class="quoted">‹path <span class="free">g</span>›</span></span> loop<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="free">g</span> <span class="free">z</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> integer_winding_number<span class="main">[</span><span class="operator">OF</span> _ loop <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>path_image <span class="free">g</span>›</span></span><span class="main">]</span> valid_path_imp_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_path <span class="free">g</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span> cindex_pathE <span class="free">g</span> <span class="free">z</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral complex_eq complex_is_Int_iff mult_zero_right 
        nonzero_mult_div_cancel_left of_real_0 zero_neq_numeral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹REMARK: The usual statement of Cauchy's Index theorem (i.e. Analytic Theory of Polynomials 
  (2002): Theorem 11.1.3) is about the equality between the number of polynomial roots and
  the Cauchy index, which is the joint application of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> winding_number_cindex_pathE<span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> argument_principle<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>  
  
<span class="keyword2"><span class="keyword">end</span></span>
  
  
</pre>
</div><div id="Winding_Number_Eval">
<div class="head">
<h1>Theory Winding_Number_Eval</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Evaluate winding numbers by calculating Cauchy indices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Winding_Number_Eval <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Cauchy_Index_Theorem.html">Cauchy_Index_Theorem</a> 
  <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach_Tools.html">HOL-Eisbach.Eisbach_Tools</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_on_closed_segmentI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> norm <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> closed_segment <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>between_mem_segment<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> between_norm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_on_closed_segmentI_complex<span class="main">:</span>    
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> closed_segment <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">≠</span><span class="free">a</span> <span class="main">∧</span> <span class="free">z</span><span class="main">≠</span><span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> 
    <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> not_on_closed_segmentI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>scaleR_complex.ctr <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>Complex_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹finite intersection with the two axes›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finite_axes_cross</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_axes_cross</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">t</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_cross_intros<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Re <span class="free">a</span><span class="main">≠</span>Re <span class="free">z</span> <span class="main">∨</span> Re <span class="free">b</span> <span class="main">≠</span>Re <span class="free">z</span><span class="main">;</span> Im <span class="free">a</span><span class="main">≠</span>Im <span class="free">z</span> <span class="main">∨</span> Im <span class="free">b</span><span class="main">≠</span>Im <span class="free">z</span><span class="main">⟧</span><span class="main">⟹</span>finite_axes_cross <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">st</span> <span class="main">≠</span> <span class="free">tt</span><span class="main">;</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> finite_axes_cross <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite_axes_cross <span class="free">g1</span> <span class="free">z</span><span class="main">;</span>finite_axes_cross <span class="free">g2</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> finite_axes_cross <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">≠</span>Re <span class="free">z</span> <span class="main">∨</span> Re <span class="free">b</span> <span class="main">≠</span>Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">a</span><span class="main">≠</span>Im <span class="free">z</span> <span class="main">∨</span> Im <span class="free">b</span><span class="main">≠</span>Im <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?S2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> linepath_half_finite_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">1</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> asm<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inner_complex_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> linepath_half_finite_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span>"</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> asm<span class="main">(</span>2<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inner_complex_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span> 
      <span class="main">=</span> <span class="var">?S1</span> <span class="main">∪</span> <span class="var">?S2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_axes_cross <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_axes_cross_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">≠</span><span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?S2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> part_circlepath_half_finite_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">1</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">z0</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span>"</span></span><span class="main">]</span> asm 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inner_complex_def Complex_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> part_circlepath_half_finite_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">z0</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span>"</span></span><span class="main">]</span> asm 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inner_complex_def Complex_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> 
      <span class="main">∨</span> Im <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="var">?S1</span> <span class="main">∪</span> <span class="var">?S2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_axes_cross <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> finite_axes_cross_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"finite_axes_cross <span class="free">g1</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"finite_axes_cross <span class="free">g2</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g1R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?g1I</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?g2R</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?g2I</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?g1R</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?g1I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="var">?g1R</span> <span class="main">∪</span> <span class="var">?g1I</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?g1R</span> <span class="main">∪</span> <span class="var">?g1I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_axes_cross_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?g1R</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?g1I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?g2R</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?g2I</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="var">?g2R</span> <span class="main">∪</span> <span class="var">?g2I</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?g2R</span> <span class="main">∪</span> <span class="var">?g2I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_axes_cross_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?g2R</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?g2I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?S2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S1</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> finite_half_joinpaths_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g1</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">1</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="free">g2</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="quoted"><span class="quoted">‹finite <span class="var">?g1R</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?g2R</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inner_complex_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> finite_half_joinpaths_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g1</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span>"</span></span> <span class="quoted"><span class="free">g2</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> 
      <span class="quoted"><span class="quoted">‹finite <span class="var">?g1I</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?g2I</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inner_complex_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>
        <span class="main">=</span> <span class="var">?S1</span> <span class="main">∪</span> <span class="var">?S2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_axes_cross <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> finite_axes_cross_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_path_joinpaths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_axes_cross <span class="free">g1</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"finite_axes_cross <span class="free">g2</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g1</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">g2</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="free">g1</span> <span class="main">=</span> pathstart <span class="free">g2</span>"</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="free">g1</span><span class="main">≠</span><span class="free">z</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_path <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindex_path <span class="free">g1</span> <span class="free">z</span> <span class="main">+</span> jumpF_pathstart <span class="free">g2</span> <span class="free">z</span> 
            <span class="main">-</span> jumpF_pathfinish <span class="free">g1</span> <span class="free">z</span>  <span class="main">+</span> cindex_path <span class="free">g2</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h12</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h12</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="bound">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="bound">g</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_path <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindex <span class="main">0</span> <span class="main">1</span> <span class="skolem">h12</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cindex_path_def h12_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="skolem">h12</span> <span class="main">+</span> jump <span class="skolem">h12</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> cindex <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">1</span> <span class="skolem">h12</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cindex_combine<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_axes_cross <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>finite_cross_intros<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span><span class="main">≤</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">≤</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> finite_axes_cross_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" jump <span class="skolem">h12</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jump_Im_divide_Re_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="bound">t</span><span class="main">-</span> <span class="free">z</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> h12_def<span class="main"><span class="main">,</span></span><span class="operator">OF</span> _ that<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_offset<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="skolem">h12</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_path <span class="free">g1</span> <span class="free">z</span> <span class="main">+</span> jumpF_pathstart <span class="free">g2</span> <span class="free">z</span>  
      <span class="main">-</span> jumpF_pathfinish <span class="free">g1</span> <span class="free">z</span>  <span class="main">+</span> cindex_path <span class="free">g2</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">h12</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span>  jumpF_pathstart <span class="free">g2</span> <span class="free">z</span> <span class="main">-</span>  jumpF_pathfinish <span class="free">g1</span> <span class="free">z</span>  "</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">h12</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="skolem">h12</span> <span class="main">(</span>at_right <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="skolem">h12</span> <span class="main">(</span>at_left <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">h12</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h12_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jump_Im_divide_Re_0<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> assms False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_offset<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h12</span> <span class="main">(</span>at_right <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h12_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> jumpF_im_divide_Re_0<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_offset<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5-6<span class="main">)</span> False <span class="keyword1"><span class="command">unfolding</span></span> joinpaths_def pathfinish_def pathstart_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h12</span> <span class="main">(</span>at_left <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h12_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> jumpF_im_divide_Re_0<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_offset<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5-6<span class="main">)</span> False <span class="keyword1"><span class="command">unfolding</span></span> joinpaths_def pathfinish_def pathstart_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Re_divide_numeral complex_Re_numeral complex_eq 
              divide_self_if joinpaths_def  minus_complex.simps mult.commute mult.left_neutral
              numeral_One pathfinish_def pathstart_def right_minus_eq times_divide_eq_left zero_neq_numeral<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jump_jumpF<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">h12</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="skolem">h12</span> <span class="main">(</span>at_left <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sgnx <span class="skolem">h12</span> <span class="main">(</span>at_right <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> h12_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">h12</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h12_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>path_offset<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> path_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> continuous_on_interior<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>inverse <span class="main">∘</span> <span class="skolem">h12</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> h12_def comp_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
              
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≡</span> sgnx <span class="skolem">h12</span> <span class="main">(</span>at_left <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≡</span> sgnx <span class="skolem">h12</span> <span class="main">(</span>at_right <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">-</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">h12</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="skolem">h12</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">g</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> path_def<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> h12_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>continuous_on_subset<span class="main">)</span>   
          <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">h12</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_axes_cross <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="free">z</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> finite_cross_intros<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g1</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">g2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="main">(</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> finite_axes_cross_def g_def 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> rev_finite_subset<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h12_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>disj_commute<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h12</span> <span class="keyword1">sgnx_able</span> at_left <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h12</span> <span class="keyword1">sgnx_able</span> at_right <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> l_def r_def <span class="keyword1"><span class="command">using</span></span> finite_sgnx_at_left_at_right<span class="main">[</span><span class="operator">OF</span> ** * **<span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h12</span> <span class="keyword1">has_sgnx</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h12</span> <span class="keyword1">has_sgnx</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">≠</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> l_def r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>sgnx_able_sgnx<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h12</span> <span class="main">(</span>at_right <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> jumpF_pathstart <span class="free">g2</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" jumpF <span class="skolem">h12</span> <span class="main">(</span>at_right <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">h12</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> jumpF_pathstart <span class="free">g2</span> <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h12_def jumpF_pathstart_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_right <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> Im <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> joinpaths_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h12</span> <span class="main">(</span>at_left <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g1</span> <span class="free">z</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h12</span> <span class="main">(</span>at_left <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">h12</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> jumpF_pathfinish <span class="free">g1</span> <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h12_def jumpF_pathfinish_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> Im <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> joinpaths_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="skolem">h12</span> <span class="main">=</span> cindex_path <span class="free">g1</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="main">0</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="skolem">h12</span> <span class="main">=</span> cindex <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindex_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">h12</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_path <span class="free">g1</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g1</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> jump <span class="var">?g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> h12_def   
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jump_cong<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="keyword1">at</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> Im <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> eventually_at joinpaths_def comp_def <span class="keyword1"><span class="command">using</span></span> that
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> 
            <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="var">?g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_def cindex_path_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> sum.cong<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>*<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">1</span> <span class="skolem">h12</span> <span class="main">=</span> cindex_path <span class="free">g2</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">1</span> <span class="skolem">h12</span> <span class="main">=</span> cindex <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cindex_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">h12</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindex_path <span class="free">g2</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g2</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> jump <span class="var">?g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> h12_def   
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jump_cong<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="keyword1">at</span> <span class="skolem">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> Im <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> eventually_at joinpaths_def comp_def <span class="keyword1"><span class="command">using</span></span> that
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="main">(</span><span class="skolem">h12</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> 
            <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="var">?g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_def cindex_path_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> sum.cong<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>*<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>     
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>  
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More lemmas related <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">cindex_pathE</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> / <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">jumpF_pathstart</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> / <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">jumpF_pathfinish</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_linepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>closed_segment <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">c1</span> <span class="main">=</span> Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">;</span> 
        <span class="bound">c2</span> <span class="main">=</span> Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">;</span> 
        <span class="bound">c3</span> <span class="main">=</span> Im <span class="free">a</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">*</span> Im <span class="free">b</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">-</span> Im <span class="free">z</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">-</span> Im <span class="free">b</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z</span> <span class="main">*</span> Im <span class="free">a</span><span class="main">;</span>
        <span class="bound">d1</span> <span class="main">=</span> Im <span class="free">a</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">;</span>
        <span class="bound">d2</span> <span class="main">=</span> Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">z</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> 
          <span class="main">(</span><span class="keyword1">if</span> <span class="bound">c3</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> 
       <span class="keyword1">else</span> 
          <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> <span class="bound">c2</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span><span class="bound">d1</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c2</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">d2</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> 
            <span class="keyword1">if</span> <span class="main">(</span><span class="bound">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c2</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="bound">d1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">c2</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c1</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="bound">d2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>  <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>
          <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">=</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">=</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">z</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span><span class="main">=</span>Im <span class="free">a</span> <span class="main">-</span> Im <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span><span class="main">=</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span> Re <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t</span><span class="main">)</span><span class="main">*</span>Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
      <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def <span class="keyword1"><span class="command">using</span></span> that  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span>Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> asm
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≤</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">≤</span> <span class="skolem">t</span><span class="main">*</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">≤</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">≤</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">t</span><span class="main">*</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t</span><span class="main">)</span><span class="main">*</span>Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">≥</span> <span class="skolem">t</span><span class="main">*</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&gt;</span> <span class="skolem">t</span><span class="main">*</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≤</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">c2</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span> <span class="main">⟶</span> Re<span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> linepath_def c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span> <span class="main">⟶</span> Re<span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> cindex_ends<span class="main">:</span><span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?g</span> <span class="free">z</span> <span class="main">=</span> jumpF_pathstart <span class="var">?g</span> <span class="free">z</span> <span class="main">-</span> jumpF_pathfinish <span class="var">?g</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> jumpF_nz<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def 
            <span class="keyword1"><span class="command">using</span></span> asm<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span> isCont_Im isCont_Re<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> continuous_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> jumpF_not_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?g</span> <span class="free">z</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">right</span> 
            <span class="main">-</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">left</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def cindexE_def right_def left_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> f_def<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">right</span> <span class="main">=</span> jumpF_pathstart <span class="var">?g</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" jumpF <span class="skolem">f</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">right</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> jumpF_nz right_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def <span class="keyword1"><span class="command">using</span></span> True
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">right</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> jumpF_nz right_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def <span class="keyword1"><span class="command">using</span></span> False
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">left</span> <span class="main">=</span> jumpF_pathfinish <span class="var">?g</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" jumpF <span class="skolem">f</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">using</span></span> jumpF_nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def <span class="keyword1"><span class="command">using</span></span> True
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">using</span></span> jumpF_nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def <span class="keyword1"><span class="command">using</span></span> False
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> jF_start<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathstart <span class="var">?g</span> <span class="free">z</span> <span class="main">=</span> 
          <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">d1</span> <span class="main">≠</span><span class="main">0</span> <span class="keyword1">then</span> 
            <span class="keyword1">if</span> <span class="skolem">c2</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="skolem">d1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>
          <span class="keyword1">else</span> 
            <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="skolem">d1</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="skolem">c1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> jump_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def f_def linepath_def g_def d1_def c1_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">d1</span> <span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="skolem">c1</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="skolem">c1</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="skolem">c1</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d1_def c1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eqI<span class="main">)</span>  
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span>path_image <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>closed_segment <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>    
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_not_infinity<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> f_def g_def<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="skolem">d1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="skolem">d1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> g_def 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_sgnx_derivative_at_right<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def c1_def d1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span><span class="main">)</span> <span class="main">=</span> sgn <span class="skolem">d1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   
              <span class="keyword1"><span class="command">using</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_right <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that jump_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c2</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="skolem">d1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="skolem">d1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> g_def 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_sgnx_derivative_at_right<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def c1_def d1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sgn <span class="skolem">d1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   
              <span class="keyword1"><span class="command">using</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_right <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that jump_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>        
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> jF_finish<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="var">?g</span> <span class="free">z</span> <span class="main">=</span> 
          <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c2</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c1</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">d2</span> <span class="main">≠</span><span class="main">0</span> <span class="keyword1">then</span> 
            <span class="keyword1">if</span> <span class="skolem">c1</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="skolem">d2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>
          <span class="keyword1">else</span> 
            <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span>Im <span class="free">a</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> jump_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def f_def linepath_def g_def d1_def c1_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">c2</span> <span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c1</span> <span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">d2</span> <span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="skolem">c2</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="skolem">c2</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">d2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="skolem">c2</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d2_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eqI<span class="main">)</span>  
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span>path_image <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>closed_segment <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>    
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_not_infinity<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> f_def g_def<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="skolem">d2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> f_def d2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="skolem">d2</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> g_def 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_sgnx_derivative_at_left<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def c1_def d1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> sgn <span class="main">(</span><span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span><span class="main">)</span> <span class="main">=</span> sgn <span class="skolem">d2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   
              <span class="keyword1"><span class="command">using</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d2</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_left <span class="main"><span class="main">1</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d2</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that jump_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">c1</span> <span class="main">&gt;</span><span class="main">0</span> <span class="main">⟷</span> <span class="skolem">d2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> f_def d2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="skolem">d2</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> g_def 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_sgnx_derivative_at_left<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def c1_def d1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span><span class="main">)</span> <span class="main">=</span> sgn <span class="skolem">d2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   
              <span class="keyword1"><span class="command">using</span></span> filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d2</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_left <span class="main"><span class="main">1</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d2</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that jump_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>  
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> c1_def c2_def d1_def d2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> linepath_def c1_def c2_def  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_0<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cindexE_constI<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span> that 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> c1_def c2_def d1_def d2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> c1c2_diff_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span>Im <span class="free">a</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span> <span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span><span class="main">=</span>Im<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">+</span>Re<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Im<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">+</span>Im<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span>Im<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> Im<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span> Re<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Im<span class="main">(</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> u_def c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">u</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> linepath_def u_def g_def  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">u2</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u1</span> <span class="skolem">u2</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">u1</span> <span class="main">-</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u1</span><span class="main">)</span> <span class="main">-</span> Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u1</span> <span class="main">-</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> re_g_iff<span class="main">:</span><span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">t</span><span class="main">=</span><span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> jumpF_nz<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> re_g_iff <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def linepath_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> add_diff_cancel_left' diff_diff_eq2 diff_zero 
              nonzero_mult_div_cancel_left u_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> h_def f_def g_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="skolem">h</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> continuous_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span><span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> jumpF_not_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">right</span> 
            <span class="main">-</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">left</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="skolem">h</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> h_def f_def g_def linepath_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">right</span> <span class="main">-</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">left</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def left_def right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">right</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">using</span></span> jumpF_nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">using</span></span> jumpF_nz <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">left</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> left_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">=</span><span class="skolem">u</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> jumpF_nz <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> left_def 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">=</span><span class="skolem">u</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> jumpF_nz <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">h</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c3</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1c2_diff_sgn <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">=</span> jump <span class="skolem">h</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">jump</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> linepath_def h_def f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span> 
          <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sgn <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span>Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jump_divide_derivative<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_offset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> continuous_on_Im path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> path_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> continuous_on_interior<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="skolem">u</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> "</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> closed_segment <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>linepath_in_path<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∉</span> closed_segment <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>   
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">c3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>   
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c3</span><span class="main">/</span><span class="main">(</span>Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ba</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ba</span> <span class="main">=</span> Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ba</span><span class="main">≠</span><span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ba_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> linepath_def u_def c3_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ba_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>  
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> ba_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> sgn <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="skolem">c3</span><span class="main">/</span><span class="main">(</span>Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="skolem">c3</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span> <span class="quoted"><span class="skolem">c3</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_zero_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">h</span> <span class="skolem">u</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jump_jumpF<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">u</span><span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">f</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span>path_image <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> path_image_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> rev_image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> re_g_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> f_def linepath_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> complex.expand<span class="main">)</span>  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∉</span>closed_segment <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>inverse <span class="main">∘</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h_def comp_def f_def g_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span> <span class="main">=</span> sgn <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">c2</span> <span class="main">-</span><span class="skolem">c1</span><span class="main">)</span><span class="main">)</span>"</span></span>     
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="keyword1">has_sgnx</span> <span class="skolem">hs</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span>"</span></span>    
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> ff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> tendsto_nonzero_has_sgnx<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">,</span> <span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">u</span><span class="main">≠</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> has_sgnx_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> gg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="skolem">c2</span> <span class="main">-</span> <span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">c2</span> <span class="main">-</span> <span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">c2</span> <span class="main">-</span> <span class="skolem">c1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def c1_def c2_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">-</span> <span class="skolem">c1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">c2</span> <span class="main">-</span> <span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span>"</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="skolem">c2</span> <span class="main">-</span> <span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> 
                has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">-</span><span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">u</span><span class="main">=</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="skolem">hs</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">u</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> has_sgnx_divide<span class="main">[</span><span class="operator">OF</span> ff<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> gg<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> h_def hs_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="keyword1">has_sgnx</span> <span class="skolem">hs</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">u</span><span class="main">)</span>"</span></span>    
          <span class="keyword1"><span class="command">using</span></span> has_sgnx_divide<span class="main">[</span><span class="operator">OF</span> ff<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> gg<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> h_def hs_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hs</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">hs</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> hs_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">u</span><span class="main">≠</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_if<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> c1_def c2_def c3_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> cindex_path_linepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∉</span>path_image <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_path <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">c1</span><span class="main">=</span>Re<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">-</span>Re<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">;</span> <span class="bound">c2</span><span class="main">=</span>Re<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">-</span>Re<span class="main">(</span><span class="free">z</span><span class="main">)</span> <span class="main">;</span> 
        <span class="bound">c3</span> <span class="main">=</span> Im<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">+</span>Re<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Im<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">+</span>Im<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span>Im<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> Im<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span> Re<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Im<span class="main">(</span><span class="free">a</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">c3</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">=</span>Re<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">-</span>Re<span class="main">(</span><span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">=</span>Re<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">-</span>Re<span class="main">(</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span> Re <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t</span><span class="main">)</span><span class="main">*</span>Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
      <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def <span class="keyword1"><span class="command">using</span></span> that  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span>Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">t</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> asm
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≤</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">≤</span> <span class="skolem">t</span><span class="main">*</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">≤</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">≤</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">t</span><span class="main">*</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">t</span><span class="main">)</span><span class="main">*</span>Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">≥</span> <span class="skolem">t</span><span class="main">*</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&gt;</span> <span class="skolem">t</span><span class="main">*</span> Re <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">a</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">b</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> Re <span class="free">z</span> <span class="main">+</span> <span class="skolem">t</span> <span class="main">*</span> Re <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≤</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">c2</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">≥</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">c2</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span> <span class="main">⟶</span> Re<span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Re <span class="free">a</span><span class="main">=</span> Re <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">&lt;</span><span class="main">1</span> <span class="main">⟶</span> Re<span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jump_Im_divide_Re_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span>"</span></span><span class="main"><span class="main">,</span></span> 
              <span class="operator">OF</span> _ asm<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_offset that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_path <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_path_def cindex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> c1_def c2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">a</span><span class="main">=</span> Re <span class="free">z</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span><span class="main">=</span>Re <span class="free">z</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_0<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
        <span class="keyword1"><span class="command">using</span></span> jump_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_path <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_path_def cindex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> c1_def c2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> c1c2_diff_sgn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&lt;</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">c2</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span><span class="main">=</span>Im<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">+</span>Re<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Im<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">+</span>Im<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span>Im<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> Im<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">*</span>Re<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span> Re<span class="main">(</span><span class="free">z</span><span class="main">)</span><span class="main">*</span>Im<span class="main">(</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> u_def c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> linepath_def u_def  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">u2</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u1</span> <span class="skolem">u2</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">u1</span> <span class="main">-</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u1</span><span class="main">)</span> <span class="main">-</span> Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u1</span> <span class="main">-</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> re_g_iff<span class="main">:</span><span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">t</span><span class="main">=</span><span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_path <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="skolem">f</span> <span class="skolem">t</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">≠</span><span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jump_Im_divide_Re_0<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> that re_g_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_offset<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="skolem">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> jump <span class="skolem">f</span> <span class="skolem">u</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cindex_path_def cindex_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> f_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">/</span>Re<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c3</span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1c2_diff_sgn <span class="keyword1"><span class="command">unfolding</span></span> c1_def c2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">/</span> Re<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span> 
          <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sgn <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span>Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jump_divide_derivative<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_offset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im<span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> continuous_on_Im path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span><span class="var">?g</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> path_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> continuous_on_interior<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Im <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="skolem">u</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> "</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> path_image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span> <span class="bound">t</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">c3</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>   
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c3</span><span class="main">/</span><span class="main">(</span>Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ba</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ba</span> <span class="main">=</span> Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ba</span><span class="main">≠</span><span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ba_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> linepath_def u_def c3_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ba_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>  
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> ba_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>Im<span class="main">(</span><span class="var">?g</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> sgn <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="skolem">c3</span><span class="main">/</span><span class="main">(</span>Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="skolem">c3</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">b</span><span class="main">-</span>Re <span class="free">a</span><span class="main">≠</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span> <span class="quoted"><span class="skolem">c3</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sgn_zero_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1c2_diff_sgn
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> c1_def c2_def c3_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cindex_pathE_part_circlepath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">≠</span><span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="free">st</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span>pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="main">¦</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="keyword1">then</span> 
      <span class="main">(</span><span class="keyword1">let</span>
          <span class="bound">θ</span> <span class="main">=</span> arccos <span class="main">(</span><span class="main">(</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span><span class="main">/</span><span class="free">r</span><span class="main">)</span><span class="main">;</span>
          <span class="bound">β</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>pi <span class="main">-</span> <span class="bound">θ</span>
        <span class="keyword1">in</span>
          jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span>
          <span class="main">+</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="free">st</span><span class="main">&lt;</span><span class="bound">θ</span> <span class="main">∧</span> <span class="bound">θ</span><span class="main">&lt;</span><span class="free">tt</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">r</span> <span class="main">*</span> sin <span class="bound">θ</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">&gt;</span> Im <span class="free">z0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">+</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="free">st</span><span class="main">&lt;</span><span class="bound">β</span> <span class="main">∧</span> <span class="bound">β</span> <span class="main">&lt;</span> <span class="free">tt</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">r</span> <span class="main">*</span> sin <span class="bound">β</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">&gt;</span> Im <span class="free">z0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">-</span> 
          jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span>
      <span class="main">)</span>
    <span class="keyword1">else</span> 
      <span class="keyword1">if</span> <span class="main">¦</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">¦</span> <span class="main">=</span> <span class="free">r</span> <span class="keyword1">then</span> 
        jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
        <span class="main">-</span> jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
      <span class="keyword1">else</span> <span class="main">0</span>
    <span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> sin <span class="bound">i</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> cos <span class="bound">i</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> index_eq<span class="main">:</span><span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> cindexE <span class="free">st</span> <span class="free">tt</span> <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
      <span class="main">=</span> cindexE <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def part_circlepath_def exp_Euler f_def g_def comp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_of_real sin_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="free">st</span> <span class="free">tt</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">using</span></span> cindexE_linear_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="free">st</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="main">_</span> <span class="quoted"><span class="free">st</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cindexE <span class="free">st</span> <span class="free">tt</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> jstart_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
            <span class="main">=</span> jumpF <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def part_circlepath_def exp_Euler f_def g_def comp_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_of_real sin_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="free">st</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> jfinish_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
            <span class="main">=</span> jumpF <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def part_circlepath_def exp_Euler f_def g_def comp_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_of_real sin_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="free">st</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">have</span></span> finite_jFs<span class="main">:</span><span class="quoted"><span class="quoted">"finite_jumpFs <span class="skolem">h</span> <span class="free">st</span> <span class="free">tt</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> finite_ReZ_segments_imp_jumpFs<span class="main">[</span><span class="operator">OF</span> finite_ReZ_segments_part_circlepath
          <span class="main">,</span><span class="operator">of</span>  <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="free">z0</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> h_def f_def g_def part_circlepath_def exp_Euler comp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_of_real sin_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_jumpFs <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="free">st</span> <span class="free">tt</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">using</span></span> finite_jumpFs_linear_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="free">st</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_imp_f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="skolem">i</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> "</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">i</span> <span class="main">=</span> Im <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> cos <span class="skolem">i</span> <span class="main">=</span> Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">*</span> sin <span class="skolem">i</span><span class="main">)</span> <span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> cos <span class="skolem">i</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> Im <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span>  Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="skolem">i</span> <span class="main">^</span><span class="numeral">2</span>  <span class="main">+</span> cos <span class="skolem">i</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span>  Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_mult_distrib<span class="main">)</span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> cmod <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>   
      <span class="keyword1"><span class="command">unfolding</span></span> cmod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> cmod <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> power2_eq_imp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">≠</span><span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> norm_minus_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">/</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span><span class="main">/</span><span class="free">r</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_cos_le_one<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>    
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">h</span> <span class="skolem">x</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> h_def f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> jumpF_not_infinity <span class="keyword1"><span class="command">unfolding</span></span> continuous_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">st</span> <span class="free">tt</span> <span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> index_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">¦</span> <span class="main">=</span> <span class="free">r</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">right</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">R</span> <span class="bound">S</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">left</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">L</span> <span class="bound">S</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> cindexE <span class="free">st</span> <span class="free">tt</span> <span class="skolem">h</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> index_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cindexE_def right_def left_def R_def L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">-</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">R</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> finite_jFs <span class="keyword1"><span class="command">unfolding</span></span> R_def finite_jumpFs_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">st</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span><span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> 
            <span class="main">+</span> <span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sum.remove<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">{</span><span class="free">st</span><span class="main">..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> right_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">L</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> finite_jFs <span class="keyword1"><span class="command">unfolding</span></span> L_def finite_jumpFs_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">tt</span> <span class="main">∈</span> <span class="skolem">L</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">L</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span><span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sum.remove<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..</span><span class="free">tt</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> left_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">tt</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> right_def S_def R_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_left<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_jFs <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> left_def S_def L_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_left<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_jFs <span class="keyword1"><span class="command">unfolding</span></span> finite_jumpFs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">right</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">left</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span> 
          <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="keyword1">at</span> <span class="skolem">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="keyword1">at</span> <span class="skolem">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">─</span><span class="skolem">i</span><span class="main">→</span> <span class="skolem">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">─</span><span class="skolem">i</span><span class="main">→</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> g_imp_f<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">i</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">i</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> Re <span class="free">z0</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> g_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> cos <span class="bound">t</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">¦</span> <span class="main">=</span> <span class="free">r</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="skolem">i</span> "</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">t</span> <span class="skolem">i</span> <span class="main">&lt;</span> pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">i</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_alt 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_cancel_left 
                        mult_minus1_right real_add_minus_iff<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> cos_eq_minus1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">≤</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_alt 
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add_le_same_cancel1 add_minus_cancel 
                          mult_le_cancel_left1 mult_le_cancel_right1 mult_minus_right mult_zero_left 
                          sgn_pos zero_le_one<span class="main">)</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">t</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute cos_ge_minus_one le_less not_less real_add_le_0_iff<span class="main">)</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> cos_eq_minus1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">*</span><span class="main">(</span><span class="skolem">k'</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>  <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>  <span class="main">(</span><span class="skolem">k'</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> pi"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹dist <span class="skolem">t</span> <span class="skolem">i</span> <span class="main">&lt;</span> pi›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dist_norm abs_mult<span class="main">)</span>
                    <span class="keyword1"><span class="command">from</span></span> divide_strict_right_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>pi"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k'</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_def k'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≠</span><span class="skolem">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"pi"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">i</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">at</span></span> <span class="skolem"><span class="skolem">i</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_if<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&lt;</span> Re <span class="free">z0</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> g_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> cos <span class="bound">t</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">¦</span> <span class="main">=</span> <span class="free">r</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="skolem">i</span> "</span></span> <span class="quoted"><span class="quoted">"dist <span class="skolem">t</span> <span class="skolem">i</span> <span class="main">&lt;</span> pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k</span>  <span class="main">*</span> pi<span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> cos_one_2pi_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">g</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_alt 
                        <span class="keyword1"><span class="command">using</span></span> mult_le_cancel_left1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">t</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cos_le_one diff_ge_0_iff_ge le_less not_less<span class="main">)</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">k'</span><span class="main">*</span> pi"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> cos_one_2pi_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">*</span><span class="main">(</span><span class="skolem">k'</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>  <span class="main">*</span> pi <span class="main">*</span> <span class="main">¦</span>  <span class="main">(</span><span class="skolem">k'</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> pi"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹dist <span class="skolem">t</span> <span class="skolem">i</span> <span class="main">&lt;</span> pi›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dist_norm abs_mult<span class="main">)</span>
                      <span class="keyword1"><span class="command">from</span></span> divide_strict_right_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>pi"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k'</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_def k'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">≠</span><span class="skolem">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"pi"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * filterlim_divide_at_bot_at_top_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">i</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">at</span></span> <span class="skolem"><span class="skolem">i</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_if<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span><span class="main">≠</span> Re <span class="free">z0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">¦</span> <span class="main">=</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="keyword1">at</span> <span class="skolem">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def h_def filterlim_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="keyword1">at</span> <span class="skolem">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>  <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def h_def filterlim_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">h</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> h_def f_def g_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> jumpF_not_infinity <span class="keyword1"><span class="command">unfolding</span></span> continuous_at_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.neutral<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
        <span class="main">-</span> jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> jstart_eq jfinish_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> 
        jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
        <span class="main">-</span> jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zr</span><span class="main">=</span> <span class="main">(</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span><span class="main">/</span><span class="free">r</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">=</span> arccos <span class="skolem">zr</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>pi <span class="main">-</span> <span class="skolem">θ</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">θ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span><span class="main">&lt;</span>pi"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">zr</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zr</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> arccos_lt_bounded<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">θ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span><span class="main">&lt;</span>pi"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> θ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">zr</span><span class="main">¦</span><span class="main">≤</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> zr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">θ</span> <span class="main">=</span> <span class="skolem">zr</span>"</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">β</span> <span class="main">=</span> cos <span class="skolem">θ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> θ_def<span class="main">[</span><span class="operator">folded</span> zr_def<span class="main">]</span> β_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zr_def g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> g_sgnx_θ<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">θ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_real_derivative</span> <span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sin_gt_zero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span><span class="main">&lt;</span>pi›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">θ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">θ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">θ</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> 
              has_sgnx_derivative_at_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">θ</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> g_sgnx_β<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">β</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_real_derivative</span> <span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">β</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">β</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pi<span class="main">&lt;</span><span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">*</span>pi"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> β_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span><span class="main">&lt;</span><span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span><span class="main">&lt;</span>pi›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> sin_lt_zero<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">β</span> <span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">β</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">β</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">β</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> 
              has_sgnx_derivative_at_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">β</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">β</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> f_tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> g_tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> <span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_split<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⤏</span> <span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_split<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">θ_if</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ_if</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">&gt;</span> Im <span class="free">z0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">β_if</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β_if</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">β</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">&gt;</span> Im <span class="free">z0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="skolem">θ_if</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">&gt;</span> Im <span class="free">z0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="skolem">θ</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">θ</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">θ</span> <span class="main">=</span><span class="main">0</span>›</span></span> f_tendsto g_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">θ</span></span></span></span><span class="main">]</span> g_sgnx_θ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="skolem">θ</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_right <span class="skolem">θ</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>    
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">θ</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">θ</span> <span class="main">=</span><span class="main">0</span>›</span></span> f_tendsto g_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">θ</span></span></span></span><span class="main">]</span> g_sgnx_θ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> jump_def θ_if_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">&lt;</span> Im <span class="free">z0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="skolem">θ</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">θ</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">θ</span> <span class="main">=</span><span class="main">0</span>›</span></span> f_tendsto g_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">θ</span></span></span></span><span class="main">]</span> g_sgnx_θ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_right <span class="skolem">θ</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>    
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">θ</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">θ</span> <span class="main">=</span><span class="main">0</span>›</span></span> f_tendsto g_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">θ</span></span></span></span><span class="main">]</span> g_sgnx_θ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> jump_def θ_if_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">≠</span> Im <span class="free">z0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_imp_f<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">θ</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">β</span> <span class="main">=</span> <span class="skolem">β_if</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">β</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">&gt;</span> Im <span class="free">z0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">β</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="skolem">β</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">β</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">β</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">β</span> <span class="main">=</span><span class="main">0</span>›</span></span> f_tendsto g_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">β</span></span></span></span><span class="main">]</span> g_sgnx_β <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_right <span class="skolem">β</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>    
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">β</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">β</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">β</span> <span class="main">=</span><span class="main">0</span>›</span></span> f_tendsto g_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">β</span></span></span></span><span class="main">]</span> g_sgnx_β <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> jump_def β_if_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">β</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">&lt;</span> Im <span class="free">z0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">β</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_left <span class="skolem">β</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">β</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">β</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">β</span> <span class="main">=</span><span class="main">0</span>›</span></span> f_tendsto g_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">β</span></span></span></span><span class="main">]</span> g_sgnx_β <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> <span class="main">(</span>at_right <span class="skolem">β</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot<span class="main">)</span>"</span></span>    
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">β</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">β</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">β</span> <span class="main">=</span><span class="main">0</span>›</span></span> f_tendsto g_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">β</span></span></span></span><span class="main">]</span> g_sgnx_β <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> jump_def β_if_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">β</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">≠</span> Im <span class="free">z0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_imp_f<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">β</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">θ</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">β</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="free">tt</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">θ</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="skolem">θ_if</span>›</span></span> <span class="quoted"><span class="quoted">‹jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">β</span> <span class="main">=</span> <span class="skolem">β_if</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> θ_if_def β_if_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse add.inverse_neutral of_int_0 one_neq_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">θ</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>  
          <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> jump_not_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">zr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def zr_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span>pi"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">≥</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span>cos <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> arccos_cos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">θ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> θ_def <span class="quoted"><span class="quoted">‹cos <span class="skolem">x</span><span class="main">=</span><span class="skolem">zr</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span><span class="main">≤</span>pi"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">≤</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi<span class="main">≤</span><span class="skolem">x</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span>pi"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">tt</span><span class="main">≤</span><span class="numeral">2</span><span class="main">*</span>pi›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> arccos_cos2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span>cos <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">-</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span>cos <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">-</span><span class="skolem">x</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arccos cos_2pi_minus cos_ge_minus_one cos_le_one<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> β_def θ_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="skolem">x</span> <span class="main">=</span><span class="skolem">zr</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> jump <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">tt</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">θ</span><span class="main">,</span><span class="skolem">β</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">st</span><span class="main">&lt;..&lt;</span><span class="free">tt</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span><span class="main">≠</span><span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> β_def <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">&lt;</span> pi›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex <span class="free">st</span> <span class="free">tt</span> <span class="skolem">h</span> <span class="main">=</span> 
          <span class="main">(</span><span class="keyword1">if</span> <span class="free">st</span><span class="main">&lt;</span><span class="skolem">θ</span> <span class="main">∧</span> <span class="skolem">θ</span><span class="main">&lt;</span><span class="free">tt</span> <span class="keyword1">then</span> <span class="skolem">θ_if</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">+</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="free">st</span><span class="main">&lt;</span><span class="skolem">β</span> <span class="main">∧</span> <span class="skolem">β</span> <span class="main">&lt;</span> <span class="free">tt</span> <span class="keyword1">then</span> <span class="skolem">β_if</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cindex_def h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindexE <span class="free">st</span> <span class="free">tt</span> <span class="skolem">h</span> <span class="main">=</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">+</span> cindex <span class="free">st</span> <span class="free">tt</span> <span class="skolem">h</span> <span class="main">-</span> jumpF <span class="skolem">h</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cindex_eq_cindexE_divide<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main"><span class="main">,</span></span><span class="operator">folded</span> h_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">&lt;</span> <span class="free">tt</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">st</span> <span class="main">&lt;</span> <span class="free">tt</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">st</span><span class="main">..</span><span class="free">tt</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g_imp_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">st</span><span class="main">..</span><span class="free">tt</span><span class="main">}</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">st</span><span class="main">..</span><span class="free">tt</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>  
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S2</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span><span class="main">=</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span>  <span class="skolem">g</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">=</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span>  <span class="skolem">f</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vl</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="free">st</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">tt</span><span class="main">-</span><span class="free">st</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Re <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span> 
             <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> Im <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="bound">t</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> part_circlepath_half_finite_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">1</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z0</span>"</span></span><span class="main">]</span>
              part_circlepath_half_finite_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">tt</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"Complex <span class="main">0</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z0</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inner_complex_def Complex_eq_0<span class="main">)</span>  
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"Re <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="skolem">t</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">g</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="quoted"><span class="quoted">"Im <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span> <span class="skolem">t</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">f</span> <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
          <span class="keyword1"><span class="command">unfolding</span></span> cindex_pathE_def part_circlepath_def exp_Euler f_def g_def comp_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_of_real sin_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def F_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">tt</span><span class="main">}</span> <span class="main">⊆</span> linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="skolem">F</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">tt</span><span class="main">}</span> <span class="main">⊆</span> linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">(</span><span class="skolem">vl</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vl</span> <span class="skolem">t</span><span class="main">≥</span><span class="main">0</span> <span class="main">⟷</span> <span class="skolem">t</span><span class="main">≥</span><span class="free">st</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vl</span> <span class="skolem">t</span><span class="main">≤</span><span class="main">1</span> <span class="main">⟷</span><span class="skolem">t</span><span class="main">≤</span><span class="free">tt</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> 
          <span class="keyword1"><span class="command">unfolding</span></span> linepath_def vl_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">tt</span><span class="main">&gt;</span><span class="free">st</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>   
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">tt</span><span class="main">}</span> <span class="main">⊆</span> linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span><span class="skolem">F</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">tt</span><span class="main">}</span> <span class="main">⊆</span> linepath <span class="free">st</span> <span class="free">tt</span> <span class="main">`</span><span class="skolem">G</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> F_def G_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">|</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">vl</span></span> <span class="improper"><span class="improper">x</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_image_eqI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">tt</span><span class="main">}</span>"</span></span> 
          <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">tt</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> finite_UnI<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">tt</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> rev_finite_subset<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Let_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> zr_def θ_def β_def θ_if_def β_if_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">using</span></span> jstart_eq jfinish_eq index_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> jumpF_pathstart_part_circlepath<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">≠</span><span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">(</span>
            <span class="keyword1">if</span> <span class="free">r</span> <span class="main">*</span> cos <span class="free">st</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> 
              <span class="main">(</span><span class="keyword1">let</span> 
                <span class="bound">Δ</span> <span class="main">=</span> <span class="free">r</span><span class="main">*</span> sin <span class="free">st</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span>
              <span class="keyword1">in</span>
                <span class="keyword1">if</span> <span class="main">(</span>sin <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">st</span><span class="main">=</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="bound">Δ</span> <span class="main">&lt;</span> <span class="main">0</span> 
                    <span class="main">∨</span> <span class="main">(</span>sin <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span>  cos <span class="free">st</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="bound">Δ</span> <span class="main">&gt;</span> <span class="main">0</span>  <span class="keyword1">then</span> 
                  <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>
                <span class="keyword1">else</span> 
                  <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> sin <span class="bound">i</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> cos <span class="bound">i</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> jumpF_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
        <span class="main">=</span> jumpF <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">o</span> linepath <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def part_circlepath_def exp_Euler f_def g_def comp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_of_real sin_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="free">st</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_has_sgnx1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">st</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">st</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="free">st</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_sgnx_derivative_at_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="free">st</span>"</span></span> <span class="quoted"><span class="free">st</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹sin <span class="free">st</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">st</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">st</span><span class="main">+</span>pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_int <span class="skolem">k</span> <span class="main">*</span> pi<span class="main">+</span> pi"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">st</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cos_eq_minus1 distrib_left mult.commute mult.right_neutral<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="free">st</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cos_monotone_0_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="free">st</span>"</span></span> <span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="free">st</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cos <span class="skolem">i</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cos_eq_neg_periodic_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">i</span><span class="main">&gt;</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">st</span><span class="main">&lt;</span>cos <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">st</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> cos <span class="free">st</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">*</span> cos <span class="skolem">i</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">st</span> <span class="main">&lt;</span> cos <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">+</span>pi"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_has_sgnx2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">st</span><span class="main">=</span><span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">st</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="free">st</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_sgnx_derivative_at_right<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="free">st</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹sin <span class="free">st</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>    
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">st</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">&lt;</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">st</span><span class="main">+</span>pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_int <span class="skolem">k</span> <span class="main">*</span> pi"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">st</span><span class="main">=</span><span class="main">1</span>›</span></span> cos_one_2pi_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="free">st</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cos_monotone_0_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="free">st</span>"</span></span> <span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="free">st</span><span class="main">)</span> <span class="main">=</span> cos <span class="skolem">i</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cos_eq_periodic_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">i</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">st</span><span class="main">&gt;</span>cos <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">st</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> cos <span class="free">st</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&gt;</span> <span class="free">r</span> <span class="main">*</span> cos <span class="skolem">i</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">st</span> <span class="main">&gt;</span> cos <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_right
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">+</span>pi"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> cos <span class="free">st</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">st</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> jumpF_not_infinity<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"at_right <span class="free">st</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> cos <span class="free">st</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>sin <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>cos <span class="free">st</span><span class="main">=</span><span class="main">1</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span> 
                    <span class="main">∨</span> <span class="main">(</span>sin <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span>  <span class="main">(</span>cos <span class="free">st</span><span class="main">=</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">st</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">st</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="free">st</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g_has_sgnx1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> g_has_sgnx2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="free">st</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="free"><span class="free">st</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_right <span class="free"><span class="free">st</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="free">st</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span> <span class="main">=</span> <span class="main">0</span>›</span></span> g_cont f_cont <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_eq that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> cos <span class="free">st</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span>sin <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">st</span><span class="main">=</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span> 
                    <span class="main">∨</span> <span class="main">(</span>sin <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span>  cos <span class="free">st</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">neq1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">neq1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="free">st</span> <span class="main">≠</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">neq2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">neq2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="free">st</span> <span class="main">≠</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">*</span>pi<span class="main">+</span>pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">st</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">st</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">st</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span><span class="free">r</span> <span class="main">*</span> sin <span class="free">st</span> "</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> cos <span class="free">st</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> sqrt<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">*</span> sin <span class="free">st</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> cos <span class="free">st</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> cmod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="free">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>sin <span class="free">st</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>cos <span class="free">st</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">≠</span><span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sin <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>cos <span class="free">st</span><span class="main">=</span><span class="main">1</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>sin <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span>  <span class="main">(</span>cos <span class="free">st</span><span class="main">=</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">st</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> cos <span class="free">st</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> cos <span class="free">st</span><span class="main">=</span><span class="main">1</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.right_neutral cancel_comm_monoid_add_class.diff_cancel 
            cos_diff cos_zero mult_eq_0_iff power2_eq_1_iff power2_eq_square sin_squared_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sin <span class="free">st</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> cos <span class="free">st</span> <span class="main">≠</span><span class="main">1</span> <span class="main">)</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>sin <span class="free">st</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span>  cos <span class="free">st</span><span class="main">≠</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="free">st</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="free">st</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> linorder_neqE_linordered_idom not_le<span class="main">)</span>   
    <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="free">st</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> g_has_sgnx1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> g_has_sgnx2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="free">st</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="free"><span class="free">st</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_right <span class="free"><span class="free">st</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="free">st</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">st</span> <span class="main">=</span> <span class="main">0</span>›</span></span> g_cont f_cont <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_right <span class="free">st</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_eq that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_pathfinish_part_circlepath<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">≠</span><span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">(</span>
            <span class="keyword1">if</span> <span class="free">r</span> <span class="main">*</span> cos <span class="free">tt</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> 
              <span class="main">(</span><span class="keyword1">let</span> 
                <span class="bound">Δ</span> <span class="main">=</span> <span class="free">r</span><span class="main">*</span> sin <span class="free">tt</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span>
              <span class="keyword1">in</span>
                <span class="keyword1">if</span> <span class="main">(</span>sin <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="bound">Δ</span> <span class="main">&lt;</span> <span class="main">0</span> 
                    <span class="main">∨</span> <span class="main">(</span>sin <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span>  cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="bound">Δ</span> <span class="main">&gt;</span> <span class="main">0</span>  <span class="keyword1">then</span> 
                  <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>
                <span class="keyword1">else</span> 
                  <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> sin <span class="bound">i</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">r</span> <span class="main">*</span> cos <span class="bound">i</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> jumpF_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="free">z0</span> 
        <span class="main">=</span> jumpF <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">o</span> linepath <span class="free">st</span> <span class="free">tt</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def part_circlepath_def exp_Euler f_def g_def comp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cos_of_real sin_of_real <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> jumpF_linear_comp<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="free">st</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span>  <span class="quoted"><span class="quoted">‹<span class="free">st</span><span class="main">&lt;</span><span class="free">tt</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> linepath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_has_sgnx1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">tt</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_sgnx_derivative_at_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="free">tt</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹sin <span class="free">tt</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span>pi<span class="main">&lt;</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">tt</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tt</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_int <span class="skolem">k</span> <span class="main">*</span> pi"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span>›</span></span> cos_one_2pi_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="free">tt</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> cos_monotone_0_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="skolem">i</span>"</span></span> <span class="main">]</span> that cos_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="skolem">i</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="free">tt</span><span class="main">)</span> <span class="main">=</span> cos <span class="skolem">i</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cos_eq_periodic_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">i</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">tt</span><span class="main">&gt;</span>cos <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> cos <span class="free">tt</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&gt;</span> <span class="free">r</span> <span class="main">*</span> cos <span class="skolem">i</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">tt</span> <span class="main">&gt;</span> cos <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span>pi"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g_has_sgnx2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">tt</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_sgnx_derivative_at_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">*</span> sin <span class="free">tt</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹sin <span class="free">tt</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">tt</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span>pi<span class="main">&lt;</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="free">tt</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tt</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_int <span class="skolem">k</span> <span class="main">*</span> pi<span class="main">+</span> pi"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">tt</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cos_eq_minus1 distrib_left mult.commute mult.right_neutral<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="free">tt</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> cos_monotone_0_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="skolem">i</span>"</span></span> <span class="main">]</span> that cos_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span><span class="skolem">i</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cos <span class="skolem">i</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cos_eq_neg_periodic_intro<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">i</span><span class="main">&gt;</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">tt</span><span class="main">&lt;</span>cos <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">tt</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> cos <span class="free">tt</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">*</span> cos <span class="skolem">i</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cos <span class="free">tt</span> <span class="main">&lt;</span> cos <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> has_sgnx_def eventually_at_left 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">tt</span><span class="main">-</span>pi"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> cos <span class="free">tt</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">tt</span> <span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> jumpF_not_infinity<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"at_left <span class="free">tt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> cos <span class="free">tt</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>sin <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span> 
                    <span class="main">∨</span> <span class="main">(</span>sin <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">tt</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g_has_sgnx1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> g_has_sgnx2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="free">tt</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="free"><span class="free">tt</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_left <span class="free"><span class="free">tt</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="free">tt</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">0</span>›</span></span> g_cont f_cont <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_eq that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> cos <span class="free">tt</span> <span class="main">+</span> Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span>sin <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span> 
                    <span class="main">∨</span> <span class="main">(</span>sin <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span>  cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">tt</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span><span class="free">r</span> <span class="main">*</span> sin <span class="free">tt</span> "</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> cos <span class="free">tt</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> sqrt<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">*</span> sin <span class="free">tt</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> cos <span class="free">tt</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> cmod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="free">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>sin <span class="free">tt</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>cos <span class="free">tt</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">z0</span><span class="main">)</span> <span class="main">≠</span><span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sin <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>sin <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span>  cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span> <span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">tt</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> cos <span class="free">tt</span><span class="main">=</span><span class="main">1</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.right_neutral cancel_comm_monoid_add_class.diff_cancel 
            cos_diff cos_zero mult_eq_0_iff power2_eq_1_iff power2_eq_square sin_squared_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sin <span class="free">tt</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> cos <span class="free">tt</span> <span class="main">≠</span><span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>sin <span class="free">tt</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span>  cos <span class="free">tt</span><span class="main">≠</span><span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="free">tt</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="free">tt</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>  
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> linorder_neqE_linordered_idom not_le<span class="main">)</span>   
    <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span><span class="skolem">f</span> <span class="free">tt</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> g_has_sgnx1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> g_has_sgnx2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span><span class="main">=</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="free">tt</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">f</span></span> <span class="free"><span class="free">tt</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"at_left <span class="free"><span class="free">tt</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="free">tt</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="free">tt</span> <span class="main">=</span> <span class="main">0</span>›</span></span> g_cont f_cont <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_within<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>at_left <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jumpF_eq that <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z0</span> <span class="free">z</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper</span> <span class="main">≡</span> cindex_pathE <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="free">z0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower</span> <span class="main">≡</span> cindex_pathE <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> pi <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> <span class="free">z0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> cindex_pathE_circlepath_upper<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span>cmod <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">upper</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Im <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">r</span><span class="main">;</span> <span class="main">¦</span>Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">upper</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Im <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="free">r</span><span class="main">;</span> <span class="main">¦</span>Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">upper</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">¦</span>Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="free">r</span><span class="main">;</span> <span class="free">r</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">upper</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cindex_pathE_circlepath_lower<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span>cmod <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">lower</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Im <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">r</span><span class="main">;</span> <span class="main">¦</span>Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">lower</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Im <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="free">r</span><span class="main">;</span> <span class="main">¦</span>Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">lower</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">¦</span>Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="free">r</span><span class="main">;</span> <span class="free">r</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">lower</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> zz_facts<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">r</span><span class="main">&lt;</span>Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">-</span> Re <span class="free">z0</span><span class="main">&lt;</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms complex_Re_le_cmod le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms complex_Re_le_cmod le_less_trans minus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms le_less_trans norm_ge_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">=</span> arccos <span class="main">(</span><span class="main">(</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">/</span> <span class="free">r</span><span class="main">)</span>"</span></span>    
  <span class="keyword1"><span class="command">have</span></span> θ_bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">θ</span> <span class="main">∧</span> <span class="skolem">θ</span> <span class="main">&lt;</span> pi"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> θ_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arccos_lt_bounded<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> zz_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Im_sin<span class="main">:</span><span class="quoted"><span class="quoted">"abs <span class="main">(</span>Im <span class="free">z0</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span><span class="main">=</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">zz</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">zz</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> zz_def cmod_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">zz</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">zz</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cmod_power2 dvd_refl linorder_not_le norm_complex_def power2_le_imp_le
            real_sqrt_power zero_le_power_eq_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="skolem">zz</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">zz</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>Im <span class="skolem">zz</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="main">(</span><span class="free">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">zz</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_less_rsqrt<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> θ_def zz_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sin_arccos_abs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> zz_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> real_sqrt_divide<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_pathstart_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> zz_facts assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_pathfinish_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> zz_facts assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms zz_facts θ_bound Im_sin <span class="keyword1"><span class="command">unfolding</span></span> upper_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> θ_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> pi <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_pathstart_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> zz_facts assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> pi <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_pathfinish_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> zz_facts assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms zz_facts θ_bound Im_sin <span class="keyword1"><span class="command">unfolding</span></span> lower_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> θ_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> upper_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_Re_le_cmod abs_minus_commute eucl_less_le_not_le minus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> lower_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_Re_le_cmod abs_minus_commute eucl_less_le_not_le minus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">=</span> arccos <span class="main">(</span><span class="main">(</span>Re <span class="free">z0</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">/</span> <span class="free">r</span><span class="main">)</span>"</span></span>   
  <span class="keyword1"><span class="command">have</span></span> θ_bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">θ</span> <span class="main">∧</span> <span class="skolem">θ</span> <span class="main">&lt;</span> pi"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> θ_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arccos_lt_bounded<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> norm_minus_commute<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> jumpFs<span class="main">:</span>
      <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> <span class="main">0</span> pi<span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> pi <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>part_circlepath <span class="free">z</span> <span class="free">r</span> pi <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> <span class="free">z0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_pathstart_part_circlepath<span class="main"><span class="keyword3">,</span></span><span class="operator">use</span> assms that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_pathfinish_part_circlepath<span class="main"><span class="keyword3">,</span></span><span class="operator">use</span> assms that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_pathstart_part_circlepath<span class="main"><span class="keyword3">,</span></span><span class="operator">use</span> assms that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> jumpF_pathfinish_part_circlepath<span class="main"><span class="keyword3">,</span></span><span class="operator">use</span> assms that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="free">r</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that assms abs_Im_le_cmod abs_le_D1 not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z0</span> <span class="main">-</span> Im <span class="free">z</span> <span class="main">&gt;</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> Im <span class="free">z0</span> <span class="main">-</span> Im <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms jumpFs θ_bound that <span class="keyword1"><span class="command">unfolding</span></span> upper_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> θ_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span>  <span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> θ_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_gt_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">z0</span> <span class="main">-</span> Im <span class="free">z</span> <span class="main">&gt;</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>›</span></span> 
        assms jumpFs θ_bound that <span class="keyword1"><span class="command">unfolding</span></span> lower_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> θ_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="free">z0</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="free">r</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_Im_le_cmod abs_le_D1 minus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> minus_diff_eq neg_less_iff_less 
          norm_minus_cancel not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span> <span class="main">&gt;</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z0</span> <span class="main">-</span> Im <span class="free">z</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z0</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> θ_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_gt_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms jumpFs θ_bound that <span class="keyword1"><span class="command">unfolding</span></span> upper_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> θ_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">z0</span> <span class="main">-</span> Im <span class="free">z</span> <span class="main">&lt;</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">z0</span> <span class="main">&gt;</span> <span class="free">r</span> <span class="main">*</span> sin <span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span><span class="free">z0</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≠</span> <span class="free">r</span>›</span></span>
        assms jumpFs θ_bound that <span class="keyword1"><span class="command">unfolding</span></span> lower_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> θ_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_pathstart_linepath<span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> Re <span class="free">a</span> <span class="main">=</span> Re <span class="free">z</span> <span class="main">∧</span> Im <span class="free">a</span><span class="main">≠</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">≠</span> Re <span class="free">a</span> <span class="keyword1">then</span> 
        <span class="keyword1">if</span> <span class="main">(</span>Im <span class="free">a</span><span class="main">&gt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">&gt;</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="free">a</span><span class="main">&lt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">&lt;</span> Re <span class="free">a</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> 
     <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span>Im <span class="free">a</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> jump_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def f_def linepath_def g_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">≠</span>Re <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathstart <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathstart_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_im_divide_Re_0<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>linepath_def that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span>Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">a</span> <span class="main">=</span> Im <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_right f_def g_def c_def <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span>Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">=</span> Re <span class="free">a</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="free">a</span><span class="main">&gt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">&gt;</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="free">a</span><span class="main">&lt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">&lt;</span> Re <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Im <span class="free"><span class="free">a</span></span> <span class="main"><span class="main">-</span></span> Im <span class="free"><span class="free">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> <span class="dynamic"><span class="dynamic">sgnx_eq_intros</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">a</span><span class="main">≠</span>Im <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">≠</span> Re <span class="free">a</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span>Im <span class="free">a</span><span class="main">&gt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">&gt;</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="free">a</span><span class="main">&lt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">&lt;</span> Re <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="free">a</span><span class="main">&gt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">&lt;</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="free">a</span><span class="main">&lt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">&gt;</span> Re <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Im <span class="free"><span class="free">a</span></span> <span class="main"><span class="main">-</span></span> Im <span class="free"><span class="free">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> <span class="dynamic"><span class="dynamic">sgnx_eq_intros</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_right <span class="main">0</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> jumpF_pathfinish_linepath<span class="main">:</span>
  <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> Re <span class="free">b</span> <span class="main">=</span> Re <span class="free">z</span> <span class="main">∧</span> Im <span class="free">b</span> <span class="main">≠</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">b</span> <span class="main">≠</span> Re <span class="free">a</span> <span class="keyword1">then</span> 
        <span class="keyword1">if</span> <span class="main">(</span>Im <span class="free">b</span><span class="main">&gt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">a</span> <span class="main">&gt;</span> Re <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="free">b</span><span class="main">&lt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">a</span> <span class="main">&lt;</span> Re <span class="free">b</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> 
     <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span>Im <span class="free">a</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span> <span class="main">)</span><span class="main">*</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> jump_eq<span class="main">:</span><span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def f_def linepath_def g_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span><span class="main">≠</span>Re <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF_pathfinish <span class="main">(</span>linepath <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_pathfinish_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_im_divide_Re_0<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>linepath_def that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span><span class="main">=</span>Re <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span> <span class="main">=</span> Im <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">(</span>Im <span class="free">a</span> <span class="main">-</span> Im <span class="free">b</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> jumpF_cong<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Im <span class="free">a</span> <span class="main">-</span> Im <span class="free">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span>Re <span class="free">a</span> <span class="main">-</span> Re <span class="free">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">z</span><span class="main">=</span>Re <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">z</span> <span class="main">=</span> Im <span class="free">b</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_left <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span><span class="main">=</span>Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">=</span> Re <span class="free">a</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> jumpF <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="free">b</span><span class="main">&gt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">a</span> <span class="main">&gt;</span> Re <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="free">b</span><span class="main">&lt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">a</span> <span class="main">&lt;</span> Re <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_real_derivative</span> Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> sgn <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Im <span class="free"><span class="free">b</span></span> <span class="main"><span class="main">-</span></span> Im <span class="free"><span class="free">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">=</span> Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">b</span><span class="main">≠</span>Im <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">b</span> <span class="main">≠</span> Re <span class="free">a</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span>Im <span class="free">b</span><span class="main">&gt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">a</span> <span class="main">&gt;</span> Re <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="free">b</span><span class="main">&lt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">a</span> <span class="main">&lt;</span> Re <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="free">b</span><span class="main">&gt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">a</span> <span class="main">&lt;</span> Re <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="free">b</span><span class="main">&lt;</span>Im <span class="free">z</span> <span class="main">∧</span> Re <span class="free">a</span> <span class="main">&gt;</span> Re <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_real_derivative</span> Re <span class="free">b</span> <span class="main">-</span> Re <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> has_sgnx_derivative_at_left<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_sgnx</span> <span class="main">-</span> sgn <span class="main">(</span>Im <span class="free">b</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_divide_at_bot_at_top_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Im <span class="free"><span class="free">b</span></span> <span class="main"><span class="main">-</span></span> Im <span class="free"><span class="free">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> <span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="keyword1">LIM</span> <span class="bound">x</span> at_left <span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_at_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"jumpF <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">t</span><span class="main">/</span><span class="skolem">g</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> jumpF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> jump_eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>    
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Setting up the method for evaluating winding numbers›</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> pathfinish_pathstart_partcirclepath_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">-</span> Complex <span class="main">0</span> <span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">+</span> <span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">-</span> Complex <span class="main">0</span> <span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">+</span> <span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="main">0</span> <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">+</span> <span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">+</span> Complex <span class="main">0</span> <span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="main">(</span>pi<span class="main">)</span> <span class="free">tt</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">-</span> <span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span><span class="main">+</span><span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">+</span> Complex <span class="main">0</span> <span class="free">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>part_circlepath <span class="free">z0</span> <span class="free">r</span> <span class="free">st</span> <span class="main">(</span>pi<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">z0</span> <span class="main">-</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> part_circlepath_def linepath_def pathstart_def pathfinish_def exp_Euler
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sin.minus_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> cos.minus_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_of_real_i<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_of_real_i<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sin.minus_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> cos.minus_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_of_real_i<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_of_real_i<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> winding_eq_intro<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite_ReZ_segments <span class="free">g</span> <span class="free">z</span> <span class="main">⟹</span>
  valid_path <span class="free">g</span> <span class="main">⟹</span>
  <span class="free">z</span> <span class="main">∉</span> path_image <span class="free">g</span> <span class="main">⟹</span>
  pathfinish <span class="free">g</span> <span class="main">=</span> pathstart <span class="free">g</span> <span class="main">⟹</span>  
  <span class="main">-</span> of_real<span class="main">(</span>cindex_pathE <span class="free">g</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span> <span class="main">⟹</span>
  winding_number <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>complex<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> winding_number_cindex_pathE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    
<span class="keyword1"><span class="command">named_theorems</span></span> winding_intros <span class="keyword2"><span class="keyword">and</span></span> winding_simps
   
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">winding_intros</span><span class="main">]</span> <span class="main">=</span> 
  finite_ReZ_segments_joinpaths
  valid_path_join
  path_join_imp
  not_in_path_image_join

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">winding_simps</span><span class="main">]</span> <span class="main">=</span>
  finite_ReZ_segments_linepath
  finite_ReZ_segments_part_circlepath
  jumpF_pathfinish_joinpaths
  jumpF_pathstart_joinpaths
  pathfinish_linepath
  pathstart_linepath
  pathfinish_join
  pathstart_join
  valid_path_linepath
  valid_path_part_circlepath
  path_part_circlepath
  Re_complex_of_real
  Im_complex_of_real
  of_real_linepath
  pathfinish_pathstart_partcirclepath_simps
    
<span class="keyword1"><span class="command">method</span></span> rep_subst  <span class="main">=</span>
  <span class="main">(</span><span class="operator">subst</span> cindex_pathE_joinpaths<span class="main"><span class="keyword3">;</span></span> <span class="operator">rep_subst</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>
 
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The method "eval\_winding" <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will try to simplify of the form <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="free"><span class="free">g</span></span> <span class="free"><span class="free">z</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an integer and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a closed path comprised of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">linepath</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">part_circlepath</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">joinpaths</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Suppose <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">g</span></span><span class="main"><span class="main">=</span></span><span class="free"><span class="free">l1</span></span><span class="main"><span class="main">+++</span></span><span class="free"><span class="free">l2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, usually, the key behind the success of this framework is whether we can prove 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">z</span></span> <span class="main"><span class="main">∉</span></span> path_image <span class="free"><span class="free">l1</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">z</span></span> <span class="main"><span class="main">∉</span></span> path_image <span class="free"><span class="free">l2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and calculate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="free"><span class="free">l1</span></span> <span class="free"><span class="free">z</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="free"><span class="free">l2</span></span> <span class="free"><span class="free">z</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
  
<span class="keyword1"><span class="command">method</span></span> eval_winding <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> winding_eq_intro<span class="main"><span class="keyword3">;</span></span>
    <span class="operator">rep_subst</span>
    <span class="main">)</span>
  <span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">winding_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>notI <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">winding_intros</span></span>
  <span class="main"><span class="keyword3">,</span></span> <span class="operator">tactic</span> <span class="quoted">‹distinct_subgoals_tac›</span><span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Winding_Number_Eval_Examples">
<div class="head">
<h1>Theory Winding_Number_Eval_Examples</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Wenda Li &lt;wl302@cam.ac.uk / liwenda1990@hotmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some examples of applying the method winding\_eval›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Winding_Number_Eval_Examples <span class="keyword2"><span class="keyword">imports</span></span> <a href="Winding_Number_Eval.html">Winding_Number_Eval</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> example1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="free">R</span> <span class="main">0</span> pi <span class="main">+++</span> linepath <span class="main">(</span><span class="main">-</span><span class="free">R</span><span class="main">)</span> <span class="free">R</span><span class="main">)</span> <span class="keyword1">𝗂</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">eval_winding</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">CR</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">CR</span> <span class="main">≡</span>part_circlepath <span class="main">0</span> <span class="free">R</span> <span class="main">0</span> pi"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span><span class="main">≡</span> linepath <span class="main">(</span><span class="main">-</span> <span class="main">(</span>complex_of_real <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="free">R</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">∉</span> path_image <span class="skolem">CR</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> CR_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> not_on_circlepathI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>  
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">∉</span> closed_segment <span class="main">(</span><span class="main">-</span> <span class="main">(</span>of_real <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> complex_eq_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> not_on_closed_segmentI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cindex_pathE_linepath<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">L</span> <span class="keyword1">𝗂</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">CR</span> <span class="keyword1">𝗂</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CR_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>jumpF_pathstart_part_circlepath jumpF_pathfinish_part_circlepath<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> complex_of_real <span class="main">(</span>cindex_pathE <span class="skolem">CR</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">-</span> cindex_pathE <span class="skolem">L</span> <span class="keyword1">𝗂</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L_def CR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> example2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="main">(</span>part_circlepath <span class="main">0</span> <span class="free">R</span> <span class="main">0</span> pi <span class="main">+++</span> linepath <span class="main">(</span><span class="main">-</span><span class="free">R</span><span class="main">)</span> <span class="free">R</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">eval_winding</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">CR</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">CR</span> <span class="main">≡</span>part_circlepath <span class="main">0</span> <span class="free">R</span> <span class="main">0</span> pi"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span><span class="main">≡</span> linepath <span class="main">(</span><span class="main">-</span> <span class="main">(</span>complex_of_real <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="free">R</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">∉</span> path_image <span class="skolem">CR</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> CR_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> not_on_circlepathI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>  
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">∉</span> closed_segment <span class="main">(</span><span class="main">-</span> <span class="main">(</span>of_real <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> complex_eq_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> not_on_closed_segmentI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cindex_pathE_linepath<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">L</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="skolem">CR</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CR_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span><span class="main">&gt;</span><span class="main">1</span>›</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_part_circlepath<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>jumpF_pathstart_part_circlepath jumpF_pathfinish_part_circlepath<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>cindex_pathE <span class="skolem">CR</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> cindex_pathE <span class="skolem">L</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L_def CR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> example3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">lb</span> <span class="free">ub</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">rec</span> <span class="main">≡</span>  linepath <span class="free">lb</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span> <span class="main">+++</span> linepath <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span> <span class="free">ub</span> 
              <span class="main">+++</span> linepath <span class="free">ub</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span> <span class="main">+++</span> linepath <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> order_asms<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="free">lb</span> <span class="main">&lt;</span> Re <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&lt;</span> Re <span class="free">ub</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">lb</span> <span class="main">&lt;</span> Im <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span> <span class="main">&lt;</span> Im <span class="free">ub</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"winding_number <span class="free">rec</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rec_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">eval_winding</span><span class="main">)</span>    
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="free">lb</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?l2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">ub</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">lb</span><span class="main">)</span><span class="main">)</span> <span class="free">ub</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?l3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="free">ub</span> <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?l4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"linepath <span class="main">(</span>Complex <span class="main">(</span>Re <span class="free">lb</span><span class="main">)</span> <span class="main">(</span>Im <span class="free">ub</span><span class="main">)</span><span class="main">)</span> <span class="free">lb</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="var">?l1</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> not_on_closed_segmentI_complex<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> order_asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> crossproduct_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="var">?l2</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> not_on_closed_segmentI_complex<span class="main">)</span>      
    <span class="keyword1"><span class="command">using</span></span> order_asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> crossproduct_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> l3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="var">?l3</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> not_on_closed_segmentI_complex<span class="main">)</span>      
    <span class="keyword1"><span class="command">using</span></span> order_asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> crossproduct_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> l4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> path_image <span class="var">?l4</span>"</span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> not_on_closed_segmentI_complex<span class="main">)</span>      
    <span class="keyword1"><span class="command">using</span></span> order_asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> crossproduct_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> complex_of_real <span class="main">(</span>cindex_pathE <span class="var">?l1</span> <span class="free">z</span> <span class="main">+</span> <span class="main">(</span>cindex_pathE <span class="var">?l2</span> <span class="free">z</span> <span class="main">+</span> <span class="main">(</span>cindex_pathE <span class="var">?l3</span> <span class="free">z</span> <span class="main">+</span>
          cindex_pathE <span class="var">?l4</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="free">z</span> <span class="main">-</span> Im <span class="free">ub</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mult_less_0_iff order_asms<span class="main">(</span>1<span class="main">)</span> order_asms<span class="main">(</span>2<span class="main">)</span> order_asms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?l3</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> l3 order_asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="free">lb</span> <span class="main">-</span> Im <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="free">ub</span> <span class="main">-</span> Re <span class="free">lb</span><span class="main">)</span> <span class="main">&lt;</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mult_less_0_iff order_asms<span class="main">(</span>1<span class="main">)</span> order_asms<span class="main">(</span>2<span class="main">)</span> order_asms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?l1</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> l1 order_asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?l2</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> l2 order_asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cindex_pathE <span class="var">?l4</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cindex_pathE_linepath<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> l4 order_asms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>