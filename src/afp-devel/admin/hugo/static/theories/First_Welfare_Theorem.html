<div id="Syntax">
<div class="head">
<h1>Theory Syntax</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>
<span class="comment1">(*
Author: Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author: Cezary Kaliszyk
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Introducing Syntax ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Syntax, abbreviations and type-synonyms ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Syntax
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> relation <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">gen_weak_stx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≽[</span>_<span class="keyword1">]</span> _"</span> <span class="main">[</span>51<span class="main">,</span>100<span class="main">,</span>51<span class="main">]</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">≽[</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">gen_indif_stx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≈[</span>_<span class="keyword1">]</span> _"</span> <span class="main">[</span>51<span class="main">,</span>100<span class="main">,</span>51<span class="main">]</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">≈[</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> "</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">gen_strc_stx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≻[</span>_<span class="keyword1">]</span> _"</span> <span class="main">[</span>51<span class="main">,</span>100<span class="main">,</span>51<span class="main">]</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">≻[</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> "</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Argmax">
<div class="head">
<h1>Theory Argmax</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Arg Min and Arg Max sets›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Argmax
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Definitions and Lemmas by Julian Parsert ›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ definition of argmax and argmin returing a set. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arg_min_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>ord<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">arg_min_set</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> is_arg_min <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arg_max_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>ord<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">arg_max_set</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> is_arg_max <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Useful lemmas for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"arg_max_set"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"arg_min_set"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. ›</span></span>

<span class="keyword1" id="Argmax-no_better_in_s"><span class="command">lemma</span></span> no_better_in_s<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arg_max_set_def assms is_arg_max_def mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Argmax-argmax_sol_in_s"><span class="command">lemma</span></span> argmax_sol_in_s<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CollectD arg_max_set_def assms is_arg_max_def<span class="main">)</span>

<span class="keyword1" id="Argmax-leq_all_in_sol"><span class="command">lemma</span></span> leq_all_in_sol<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">::</span> preorder<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≥</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> arg_max_set <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arg_max_set_def is_arg_max_def<span class="main">)</span>

<span class="keyword1" id="Argmax-all_leq"><span class="command">lemma</span></span> all_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">::</span> linorder<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms leI no_better_in_s<span class="main">)</span>

<span class="keyword1" id="Argmax-all_in_argmax_equal"><span class="command">lemma</span></span> all_in_argmax_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">::</span> linorder<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> arg_max_set <span class="free">f</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all_leq argmax_sol_in_s assms le_less no_better_in_s<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Preferences">
<div class="head">
<h1>Theory Preferences</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>
<span class="comment1">(*
Author: Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author: Cezary Kaliszyk
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preference Relations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Preferences modeled as a set of pairs ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Preferences
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
    <a href="Syntax.html">Syntax</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Preference Relation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Basic preference relation locale with carrier and relation modeled as a set of pairs. ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> preference <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">carrier</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_outside<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">relation</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">relation</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> trans_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"preorder_on  <span class="free">carrier</span> <span class="free">relation</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> preference
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">geq</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≽</span> _"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">]</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">≽</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">str_gr</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≻</span> _"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">]</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">≻</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≽</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≽</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">indiff</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≈</span> _"</span> <span class="main">[</span>51<span class="main">,</span>51<span class="main">]</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">≈</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≽</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≽</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Preferences-reflexivity"><span class="command">lemma</span></span> reflexivity<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> preorder_on_def trans_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Preferences-transitivity"><span class="command">lemma</span></span> transitivity<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> preorder_on_def trans_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preferences-indiff_trans"><span class="command">lemma</span></span> indiff_trans <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≈</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≈</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≈</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> transE transitivity<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Contour sets ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">at_least_as_good</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">at_least_as_good</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">no_better_than</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">no_better_than</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">as_good_as</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">as_good_as</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≈[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Preferences-at_lst_asgd_ge"><span class="command">lemma</span></span> at_lst_asgd_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> at_least_as_good <span class="free">y</span> <span class="free">B</span> <span class="free">Pr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="free">Pr</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms at_least_as_good_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Preferences-strict_contour_is_diff"><span class="command">lemma</span></span> strict_contour_is_diff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≻[</span><span class="free">Pr</span><span class="main">]</span> <span class="free">y</span><span class="main">}</span> <span class="main">=</span> at_least_as_good <span class="free">y</span> <span class="free">B</span> <span class="free">Pr</span> <span class="main">-</span> as_good_as <span class="free">y</span> <span class="free">B</span> <span class="free">Pr</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_least_as_good_def as_good_as_def<span class="main">)</span>

<span class="keyword1" id="Preferences-strict_countour_def"><span class="command">lemma</span></span> strict_countour_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>at_least_as_good <span class="free">y</span> <span class="free">B</span> <span class="free">Pr</span><span class="main">)</span> <span class="main">-</span> as_good_as <span class="free">y</span> <span class="free">B</span> <span class="free">Pr</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≻[</span><span class="free">Pr</span><span class="main">]</span> <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> as_good_as_def at_least_as_good_def strict_contour_is_diff<span class="main">)</span>

<span class="keyword1" id="Preferences-at_least_as_goodD"><span class="command">lemma</span></span> at_least_as_goodD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> at_least_as_good <span class="free">y</span> <span class="free">B</span> <span class="free">Pr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≽[</span><span class="free">Pr</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms at_least_as_good_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Rational Preference Relation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Rational preferences add totality to the basic preferences. ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> rational_preference <span class="main">=</span> preference <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> total<span class="main">:</span> <span class="quoted"><span class="quoted">"total_on <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Preferences-compl"><span class="command">lemma</span></span> compl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span> <span class="free">carrier</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≽</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">y</span> <span class="main">≽</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> refl_onD reflexivity total total_on_def<span class="main">)</span>

<span class="keyword1" id="Preferences-strict_not_refl_weak"><span class="command">lemma</span></span> strict_not_refl_weak <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="free">y</span> <span class="main">≽</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≻</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> refl_onD reflexivity total total_on_def<span class="main">)</span>

<span class="keyword1" id="Preferences-strict_trans"><span class="command">lemma</span></span> strict_trans <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≻</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≻</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≻</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> transE transitivity<span class="main">)</span>

<span class="keyword1" id="Preferences-completeD"><span class="command">lemma</span></span> completeD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽</span> <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Preferences-pref_in_at_least_as"><span class="command">lemma</span></span> pref_in_at_least_as<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> at_least_as_good <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectI assms
      at_least_as_good_def preference.not_outside preference_axioms<span class="main">)</span>

<span class="keyword1" id="Preferences-worse_in_no_better"><span class="command">lemma</span></span> worse_in_no_better<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectI assms no_better_than_def
      preference_axioms preference_def strict_not_refl_weak<span class="main">)</span>

<span class="keyword1" id="Preferences-strict_is_neg_transitive"><span class="command">lemma</span></span> strict_is_neg_transitive <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≻</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≻</span> <span class="free">z</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">≻</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms compl transE transitivity<span class="main">)</span>

<span class="keyword1" id="Preferences-weak_is_transitive"><span class="command">lemma</span></span> weak_is_transitive<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> transD transitivity<span class="main">)</span>

<span class="keyword1" id="Preferences-no_better_than_nonepty"><span class="command">lemma</span></span> no_better_than_nonepty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="main">(</span>no_better_than <span class="bound">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> empty_iff mem_Collect_eq
      no_better_than_def refl_onD reflexivity<span class="main">)</span>

<span class="keyword1" id="Preferences-no_better_subset_pref"><span class="command">lemma</span></span> no_better_subset_pref <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⊆</span> no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms mem_Collect_eq no_better_than_def transE transitivity<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-no_better_thansubset_rel"><span class="command">lemma</span></span> no_better_thansubset_rel <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⊆</span> no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="free">y</span> <span class="main">≽</span> <span class="bound">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="free">x</span> <span class="main">≽</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> no_better_than_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_mono_iff assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> compl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-nbt_nest"><span class="command">lemma</span></span> nbt_nest <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⊆</span> no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span>no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⊆</span> no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectD compl no_better_subset_pref no_better_than_def not_outside subsetI<span class="main">)</span>

<span class="keyword1" id="Preferences-at_lst_asgd_not_ge"><span class="command">lemma</span></span> at_lst_asgd_not_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> at_least_as_good <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≽</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectI assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> at_least_as_good_def<span class="main">)</span>

<span class="keyword1" id="Preferences-as_good_as_sameIff"><span class="command">lemma</span></span> as_good_as_sameIff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> as_good_as <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">≽</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> as_good_as_def mem_Collect_eq not_outside<span class="main">)</span>

<span class="keyword1" id="Preferences-same_at_least_as_equal"><span class="command">lemma</span></span> same_at_least_as_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≈</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"at_least_as_good <span class="free">z</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">=</span>
         at_least_as_good <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?az</span> <span class="main">=</span> <span class="var">?ay</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms refl_onD2 reflexivity<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽</span> <span class="free">z</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≽</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms transD transitivity<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?az</span> <span class="main">⊆</span> <span class="var">?ay</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> at_lst_asgd_ge at_lst_asgd_not_ge
        equals0D not_outside subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms refl_onD2 reflexivity<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽</span> <span class="free">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≽</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms transD transitivity<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ay</span> <span class="main">⊆</span> <span class="var">?az</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> at_lst_asgd_ge at_lst_asgd_not_ge
        equals0D not_outside subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-as_good_asIff"><span class="command">lemma</span></span> as_good_asIff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> as_good_as <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≈[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Preferences-nbt_subset"><span class="command">lemma</span></span> nbt_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⊆</span> no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">∨</span>
         no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⊆</span> no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preferences-fnt_carrier_fnt_rel"><span class="command">lemma</span></span> fnt_carrier_fnt_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">carrier</span> <span class="main">⟹</span> finite <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_SigmaI refl_on_def reflexivity rev_finite_subset<span class="main">)</span>

<span class="keyword1" id="Preferences-nbt_subset_carrier"><span class="command">lemma</span></span> nbt_subset_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> no_better_than_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Preferences-xy_in_eachothers_nbt"><span class="command">lemma</span></span> xy_in_eachothers_nbt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">∨</span>
         <span class="free">y</span> <span class="main">∈</span> no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> contra_subsetD nbt_nest refl_onD reflexivity worse_in_no_better<span class="main">)</span>

<span class="keyword1" id="Preferences-same_nbt_same_pref"><span class="command">lemma</span></span> same_nbt_same_pref<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">∧</span>
         <span class="free">y</span> <span class="main">∈</span> no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≈</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectD contra_subsetD no_better_subset_pref
        no_better_than_def worse_in_no_better<span class="main">)</span>

<span class="keyword1" id="Preferences-indifferent_imp_weak_pref"><span class="command">lemma</span></span> indifferent_imp_weak_pref<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≈</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">≽</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≽</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Finite carrier›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Preferences-fnt_carrier_fnt_nbt"><span class="command">lemma</span></span> fnt_carrier_fnt_nbt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span> finite <span class="main">(</span>no_better_than <span class="bound">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>no_better_than <span class="skolem">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  finite_subset nbt_subset_carrier <span class="quoted"><span class="quoted">‹finite <span class="free">carrier</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-nbt_subset_imp_card_leq"><span class="command">lemma</span></span> nbt_subset_imp_card_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⊆</span> no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⟷</span>
  card <span class="main">(</span>no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span> <span class="main">≤</span> card  <span class="main">(</span>no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nbt</span> <span class="main">⟷</span> <span class="var">?card</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nbt</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?card</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> card_mono fnt_carrier_fnt_nbt<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?card</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?nbt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> card_seteq fnt_carrier_fnt_nbt nbt_nest<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-card_leq_pref"><span class="command">lemma</span></span> card_leq_pref<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>no_better_than <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>no_better_than <span class="free">y</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>
   <span class="main">⟷</span> <span class="free">y</span> <span class="main">≽</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> nbt_subset_imp_card_leq no_better_thansubset_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> nbt_subset_imp_card_leq no_better_subset_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-finite_ne_remove_induct"><span class="command">lemma</span></span> finite_ne_remove_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span>  <span class="main">⟹</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
         <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms finite_remove_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">F</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">F</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="main"><span class="main"><span class="main">{}</span></span></span> <span class="main"><span class="main"><span class="main">∨</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">P</span></span></span> <span class="bound"><span class="bound"><span class="bound">F</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">P</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1" id="Preferences-finite_nempty_preorder_has_max"><span class="command">lemma</span></span> finite_nempty_preorder_has_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">B</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">B</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> subset_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">B</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_subset_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl_onD total_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> refl_onD2 transE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preferences-finite_nempty_preorder_has_min"><span class="command">lemma</span></span> finite_nempty_preorder_has_min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">B</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">B</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> subset_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">B</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_subset_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl_onD total_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> refl_onD2 transE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Preferences-finite_nonempty_carrier_has_maximum"><span class="command">lemma</span></span> finite_nonempty_carrier_has_maximum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="bound">e</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_nempty_preorder_has_max<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">relation</span></span><span class="main">]</span> assms
     <span class="quoted"><span class="quoted">‹finite <span class="free">carrier</span>›</span></span> reflexivity total transitivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Preferences-finite_nonempty_carrier_has_minimum"><span class="command">lemma</span></span> finite_nonempty_carrier_has_minimum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="bound">e</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_nempty_preorder_has_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">relation</span></span><span class="main">]</span> assms
     <span class="quoted"><span class="quoted">‹finite <span class="free">carrier</span>›</span></span> reflexivity total transitivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*finite carrier*)</span>


<span class="keyword1" id="Preferences-all_carrier_ex_sub_rel"><span class="command">lemma</span></span> all_carrier_ex_sub_rel<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">c</span></span> <span class="main">⊆</span> <span class="free">carrier</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">r</span></span> <span class="main">⊆</span> <span class="free">relation</span><span class="main">.</span> rational_preference <span class="bound">c</span> <span class="bound">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> c_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">x</span></span><span class="main">,</span><span class="bound"><span class="bound">y</span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">relation</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> r'_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">⊆</span> <span class="skolem">c</span> <span class="main">×</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">c</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽[</span><span class="skolem">r'</span><span class="main">]</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectI c_in case_prodI compl r'_def subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> refl<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on <span class="skolem">c</span> <span class="skolem">r'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> r'_sub refl_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> trans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">r'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="skolem">r'</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≽[</span><span class="skolem">r'</span><span class="main">]</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">≽[</span><span class="skolem">r'</span><span class="main">]</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectD CollectI a1 a2 case_prodD case_prodI r'_def transE transitivity<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> total<span class="main">:</span> <span class="quoted"><span class="quoted">"total_on <span class="skolem">c</span> <span class="skolem">r'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="skolem">r'</span><span class="main">]</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≽[</span><span class="skolem">r'</span><span class="main">]</span> <span class="skolem">x</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectI a1 a2 c_in case_prodI compl r'_def subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rational_preference <span class="skolem">c</span> <span class="skolem">r'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.refl local.trans preference.intro preorder_on_def rational_preference.intro 
        rational_preference_axioms.intro refl_on_domain total<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">r</span></span><span class="main">⊆</span><span class="free">relation</span><span class="main">.</span> rational_preference <span class="skolem">c</span> <span class="bound">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectD case_prodD r'_def subrelI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*rational preference*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Local Non-Satiation ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Defining local non-satiation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">local_nonsatiation</span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">local_nonsatiation</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Alternate definitions and intro/dest rules with them ›</span></span>

<span class="keyword1" id="Preferences-lns_alt_def1"><span class="command">lemma</span></span> lns_alt_def1 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">B</span> <span class="free">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> dist <span class="bound">y</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻[</span><span class="free">P</span><span class="main">]</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span> <span class="main"><span class="main">:</span></span> dist_norm local_nonsatiation_def<span class="main">)</span>

<span class="keyword1" id="Preferences-lns_normI"><span class="command">lemma</span></span> lns_normI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻[</span><span class="free">P</span><span class="main">]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">B</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms dist_norm<span class="main">)</span>

<span class="keyword1" id="Preferences-lns_distI"><span class="command">lemma</span></span> lns_distI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">e</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">(</span>dist <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻[</span><span class="free">P</span><span class="main">]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">B</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lns_alt_def1 assms<span class="main">)</span>

<span class="keyword1" id="Preferences-lns_alt_def2"><span class="command">lemma</span></span> lns_alt_def2 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">B</span> <span class="free">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span>  <span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>ball <span class="bound">x</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻[</span><span class="free">P</span><span class="main">]</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">B</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> ball <span class="bound">x</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">≻[</span><span class="free">P</span><span class="main">]</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span> <span class="main"><span class="main">:</span></span> ball_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> dense le_less_trans dist_commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> ball <span class="bound">x</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻[</span><span class="free">P</span><span class="main">]</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">B</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ball_def dist_commute
        less_le_not_le lns_alt_def1 mem_Collect_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-lns_normD"><span class="command">lemma</span></span> lns_normD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">B</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="main">(</span>norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻[</span><span class="free">P</span><span class="main">]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms local_nonsatiation_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Convex preferences ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weak_convex_pref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> relation <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">weak_convex_pref</span> <span class="free"><span class="bound"><span class="entity">Pr</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">Pr</span></span></span><span class="main">]</span> <span class="bound">y</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="bound">α</span> <span class="main">+</span> <span class="bound">β</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">α</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">β</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">Pr</span></span></span><span class="main">]</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">convex_pref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> relation <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">convex_pref</span> <span class="free"><span class="bound"><span class="entity">Pr</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≻[</span><span class="free"><span class="bound"><span class="entity">Pr</span></span></span><span class="main">]</span> <span class="bound">y</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">α</span><span class="main">.</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="bound">α</span> <span class="main">∧</span> <span class="bound">α</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">α</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span> <span class="main">≻[</span><span class="free"><span class="bound"><span class="entity">Pr</span></span></span><span class="main">]</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strict_convex_pref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> relation <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">strict_convex_pref</span> <span class="free"><span class="bound"><span class="entity">Pr</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">Pr</span></span></span><span class="main">]</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">α</span><span class="main">.</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="bound">α</span> <span class="main">∧</span> <span class="bound">α</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">α</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span> <span class="main">≻[</span><span class="free"><span class="bound"><span class="entity">Pr</span></span></span><span class="main">]</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Preferences-convex_ge_imp_conved"><span class="command">lemma</span></span> convex_ge_imp_conved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽[</span><span class="free">Pr</span><span class="main">]</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="bound">α</span> <span class="main">+</span> <span class="bound">β</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">α</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">β</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span> <span class="main">≽[</span><span class="free">Pr</span><span class="main">]</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"weak_convex_pref <span class="free">Pr</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms weak_convex_pref_def<span class="main">)</span>

<span class="keyword1" id="Preferences-weak_convexI"><span class="command">lemma</span></span> weak_convexI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽[</span><span class="free">Pr</span><span class="main">]</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">α</span> <span class="main">+</span> <span class="bound">β</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">α</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">β</span> <span class="main">⟹</span> <span class="bound">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">y</span> <span class="main">≽[</span><span class="free">Pr</span><span class="main">]</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"weak_convex_pref <span class="free">Pr</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms weak_convex_pref_def<span class="main">)</span>

<span class="keyword1" id="Preferences-weak_convexD"><span class="command">lemma</span></span> weak_convexD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"weak_convex_pref <span class="free">Pr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="free">Pr</span><span class="main">]</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="free">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="main">≽[</span><span class="free">Pr</span><span class="main">]</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms weak_convex_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Real Vector Preferences ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Preference relations on real vector type class. ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> real_vector_rpr <span class="main">=</span> rational_preference <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">relation</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">carrier</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_vector set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span>  real_vector_rpr <span class="main">⊆</span> rational_preference <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">relation</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rational_preference_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> real_vector_rpr
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Preferences-have_rpr"><span class="command">lemma</span></span> have_rpr<span class="main">:</span> <span class="quoted"><span class="quoted">"rational_preference <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rational_preference_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Multiple convexity alternate definitions intro/dest rules. ›</span></span>

<span class="keyword1" id="Preferences-weak_convex1D"><span class="command">lemma</span></span> weak_convex1D <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"weak_convex_pref <span class="free">relation</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="free">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> u_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="free">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> u_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> u_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> preference.reflexivity preference_axioms
          real_vector.scale_zero_left refl_onD2 scaleR_one strict_not_refl_weak<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="free">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> u_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟶</span> <span class="free">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="free">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_cancel_right_right antisym_conv not_le assms weak_convexD <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> u_0 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> add_cancel_right_right real_vector.scale_zero_left scaleR_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-weak_convex1I"><span class="command">lemma</span></span> weak_convex1I <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> convex <span class="main">(</span>at_least_as_good <span class="bound">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"weak_convex_pref <span class="free">relation</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> weak_convexI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">α</span> <span class="skolem">β</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> assum <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> reals<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">α</span> <span class="main">+</span> <span class="skolem">β</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assum preference.not_outside rational_preference.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> have_rpr<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assum refl_onD2 reflexivity<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y_in_upper_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>at_least_as_good <span class="skolem">y</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rational_preference.at_lst_asgd_not_ge
      rational_preference.compl  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff have_rpr<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>at_least_as_good <span class="skolem">y</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assum pref_in_at_least_as <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">β</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reals <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> at_least_as_goodD convexD reals<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> y_in_upper_cont<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Definition of convexity in "Handbook of Social Choice and Welfare"<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "arrow2010handbook"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. ›</span></span>

<span class="keyword1" id="Preferences-convex_def_alt"><span class="command">lemma</span></span> convex_def_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rational_preference <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"weak_convex_pref <span class="free">relation</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> convex <span class="main">(</span>at_least_as_good <span class="bound">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>at_least_as_good <span class="skolem">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"convex <span class="var">?x</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> convexI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">α</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?x</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?x</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> reals<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">+</span> <span class="skolem">β</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a_g_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> b_g_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_in at_least_as_goodD b_in preference.not_outside
          rational_preference.compl rational_preference_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="var">?x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span>  <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms reals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> b_g_x  assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> preference.not_outside x_in
            rational_preference.strict_is_neg_transitive
            rational_preference.strict_not_refl_weak rational_preference_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectI  assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            at_least_as_good_def preference_def rational_preference_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> reals weak_convex1D<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> as add.commute  assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
            reals<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> weak_convex1D<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">β</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">b</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_g_x assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> preference.indiff_trans x_in
            preference.not_outside rational_preference.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            rational_preference.strict_is_neg_transitive <span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> pref_in_at_least_as <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Preferences-convex_imp_convex_str_upper_cnt"><span class="command">lemma</span></span> convex_imp_convex_str_upper_cnt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> convex <span class="main">(</span>at_least_as_good <span class="bound">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span>at_least_as_good <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span> <span class="main">-</span> as_good_as <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">(</span> <span class="var">?a</span> <span class="main">-</span> <span class="var">?b</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> convexI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">y</span> <span class="skolem">u</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> as_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?a</span> <span class="main">-</span> <span class="var">?b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> as_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?a</span> <span class="main">-</span> <span class="var">?b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> reals<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">u</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> cvx<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_convex_pref <span class="free">relation</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms at_least_as_goodD convexI have_rpr
        preference_def rational_preference.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> weak_convex1I<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a_g_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≻[</span><span class="free">relation</span><span class="main">]</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> as_a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y_gt_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≻[</span><span class="free">relation</span><span class="main">]</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> as_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">∈</span> <span class="var">?a</span> <span class="main">-</span> <span class="var">?b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">∈</span> <span class="var">?a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 a_g_x as_a as_y assms convexD reals have_rpr
          preference_def rational_preference.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_g_x y_gt_x assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> preference.not_outside have_rpr
          rational_preference.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rational_preference.strict_not_refl_weak<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">∉</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cvx assms<span class="main">(</span>1<span class="main">)</span> reals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">≻[</span><span class="free">relation</span><span class="main">]</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> y_gt_x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rational_preference.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> have_rpr
            rational_preference.strict_is_neg_transitive preference_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">∉</span> as_good_as <span class="free">x</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cvx assms<span class="main">(</span>1<span class="main">)</span> reals <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute weak_convex1D<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">≻[</span><span class="free">relation</span><span class="main">]</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_g_x assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rational_preference.strict_is_neg_transitive
            rational_preference.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> preference_def have_rpr<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">y</span> <span class="main">∉</span> <span class="var">?b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ Monotone preferences ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weak_monotone_prefs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ord<span class="main">)</span> relation <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">weak_monotone_prefs</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≽[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span><span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">monotone_preference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ord<span class="main">)</span> relation <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">monotone_preference</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≻[</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">]</span> <span class="bound">y</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Given a carrier set that is unbounded above (not the "standard" mathematical definition),
       monotonicity implies local non-satiation. ›</span></span>

<span class="keyword1" id="Preferences-unbounded_above_mono_imp_lns"><span class="command">lemma</span></span> unbounded_above_mono_imp_lns<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">&gt;</span> <span class="bound">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone_preference <span class="main">(</span><span class="free">carrier</span><span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>ordered_euclidean_space set<span class="main">)</span> <span class="free">relation</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> lns_distI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted"><span class="quoted">"real"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> gz <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span> dist <span class="bound">y</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
      v<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gz dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∈</span> Basis"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      y_value <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">v</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ge<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≥</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_value i <span class="keyword1"><span class="command">unfolding</span></span> y_value
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_le_scaleR_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_value i <span class="keyword1"><span class="command">unfolding</span></span> y_value
      <span class="keyword1"><span class="command">using</span></span> v<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> y_str_g_x <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> y_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> x_in y_str_g_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y_pref_x <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≻[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_str_g_x x_in mono monotone_preference_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" norm <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">v</span>›</span></span> y_value y_value i v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> dist_less_e <span class="main">:</span> <span class="quoted"><span class="quoted">"dist <span class="skolem">y</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> y_pref_x dist_less_e y_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Utility_Functions">
<div class="head">
<h1>Theory Utility_Functions</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>
<span class="comment1">(*
Author: Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author: Cezary Kaliszyk
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Utility Functions ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Utility functions and results involving them. ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Utility_Functions
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Preferences.html">Preferences</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Ordinal utility functions"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Ordinal utility function locale ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ordinal_utility <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">carrier</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> util_def<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">u</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">u</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_outside<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Utility_Functions-util_def_conf"><span class="command">lemma</span></span> util_def_conf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="free">u</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">u</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> util_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Utility_Functions-relation_subset_crossp"><span class="command">lemma</span></span> relation_subset_crossp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">relation</span> <span class="main">⊆</span> <span class="free">carrier</span> <span class="main">×</span> <span class="free">carrier</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">relation</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prod_conv ordinal_utility_axioms ordinal_utility_def surj_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">×</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">relation</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Utility function implies totality of relation ›</span></span>
<span class="keyword1" id="Utility_Functions-util_imp_total"><span class="command">lemma</span></span> util_imp_total<span class="main">:</span> <span class="quoted"><span class="quoted">"total_on <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x_inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_inc <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fst <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="free">u</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="free">u</span> <span class="skolem">y</span> <span class="main">≥</span> <span class="free">u</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> util_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_inc y_inc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Utility_Functions-x_y_in_carrier"><span class="command">lemma</span></span> x_y_in_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ordinal_utility_axioms ordinal_utility_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Utility function implies transitivity of relation. ›</span></span>

<span class="keyword1" id="Utility_Functions-util_imp_trans"><span class="command">lemma</span></span> util_imp_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">relation</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> transI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> x_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> y_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_ge_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="free">u</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> x_y_in_carrier ordinal_utility_axioms util_def x_y<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">y</span> <span class="main">≥</span> <span class="free">u</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> y_z ordinal_utility_axioms ordinal_utility_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_y_in_carrier<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> x_ge_y  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="free">u</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="free">u</span> <span class="skolem">y</span>›</span></span> order_trans x_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>›</span></span> ordinal_utility_axioms ordinal_utility_def y_z<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Utility_Functions-util_imp_refl"><span class="command">lemma</span></span> util_imp_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> refl_on_def relation_subset_crossp<span class="main">)</span>

<span class="keyword1" id="Utility_Functions-affine_trans_is_u"><span class="command">lemma</span></span> affine_trans_is_u<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">α</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">β</span><span class="main">.</span> ordinal_utility  <span class="free">carrier</span> <span class="free">relation</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">α</span> <span class="main">+</span> <span class="bound">β</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">β</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">α</span> <span class="main">+</span> <span class="skolem">β</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ordinal_utility_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * add.commute add_le_cancel_left not_le mult_less_iff1 util_def_conf<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> refl_on_domain util_imp_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ This utility function definition is ordinal.
        Hence they are only unique up to a monotone transformation. ›</span></span>

<span class="keyword1" id="Utility_Functions-ordinality_of_utility_function"><span class="command">lemma</span></span> ordinality_of_utility_function <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monot<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone <span class="main">(&gt;)</span> <span class="main">(&gt;)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">u</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="free">u</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?func</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">u</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">n</span> <span class="main">.</span> <span class="free">u</span> <span class="bound">m</span> <span class="main">≥</span> <span class="free">u</span> <span class="bound">n</span> <span class="main">⟷</span> <span class="var">?func</span> <span class="bound">m</span> <span class="main">≥</span> <span class="var">?func</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less monot monotone_def not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="free">u</span> <span class="free">y</span> <span class="main">⟷</span> <span class="var">?func</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="var">?func</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> utility_prefs_corresp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monotonicity <span class="main">:</span> <span class="quoted"><span class="quoted">"monotone <span class="main">(&gt;)</span> <span class="main">(&gt;)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">relation</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> monotonicity not_less ordinality_of_utility_function util_def_conf<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> monotone_comp_is_utility<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monot<span class="main">:</span> <span class="quoted"><span class="quoted">"monotone <span class="main">(&gt;)</span> <span class="main">(&gt;)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordinal_utility.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> monot utility_prefs_corresp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_outside <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> x_y_in_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Utility_Functions-ordinal_utility_left"><span class="command">lemma</span></span> ordinal_utility_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">u</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms x_y_in_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Utility_Functions-add_right"><span class="command">lemma</span></span> add_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordinal_utility.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">u</span> <span class="skolem">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">relation</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">r</span> <span class="main">≤</span> <span class="free">u</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≤</span> <span class="free">u</span> <span class="skolem">y</span> <span class="main">+</span> <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∨</span> <span class="free">u</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">u</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_le_cancel_left add_le_cancel_right assms util_def xy<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> xy<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> add_mono assms calculation le_cases order_trans util_def xy<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> xy<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> not_outside <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> x_y_in_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Utility_Functions-add_left"><span class="command">lemma</span></span> add_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_right assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Groups.ab_semigroup_add_class.add.commute
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Utility_Functions-ordinal_utility_scale_transl"><span class="command">lemma</span></span> ordinal_utility_scale_transl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monotone <span class="main">(&gt;)</span> <span class="main">(&gt;)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"monotone <span class="main">(&gt;)</span> <span class="main">(&gt;)</span> <span class="var">?fn</span>"</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms monotone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> monotone_comp_is_utility <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="main">(</span><span class="var">?fn</span> <span class="main">∘</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fn</span> <span class="main">∘</span> <span class="free">u</span> <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Utility_Functions-strict_prefernce_iff_strict_utility"><span class="command">lemma</span></span> strict_prefernce_iff_strict_utility<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≻[</span><span class="free">relation</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">u</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="free">u</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_eq_real_def not_less util_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ A utility function implies a rational preference relation.
      Hence a utility function contains exactly the same amount of information as a RPR ›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> ordinal_utility <span class="main">⊆</span> rational_preference <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">relation</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_outside <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="main">(</span><span class="operator">meson</span> xy refl_onD2 util_imp_refl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">relation</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> util_imp_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preorder_on_def util_imp_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> util_imp_total<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Given a finite carrier set. We can guarantee that given a rational preference
       relation, there must also exist a utility function representing this relation.
       Construction of witness roughly follows from.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fnt_carrier_exists_util_fun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rational_preference <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">(</span>no_better_than <span class="bound">x</span> <span class="free">carrier</span> <span class="free">relation</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> x_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> y_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="main">(</span>real <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> real <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">yn</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        yn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yn</span> <span class="main">=</span> no_better_than <span class="skolem">y</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xn</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        xn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xn</span> <span class="main">=</span> no_better_than <span class="skolem">x</span> <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yn</span> <span class="main">⊆</span> <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm yn assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rational_preference.no_better_subset_pref<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">yn</span> <span class="main">≤</span> card <span class="skolem">xn</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_c y_c asm assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rational_preference.card_leq_pref xn yn<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> real <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  f xn yn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> real <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> f rational_preference.card_leq_pref x_c y_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≽[</span><span class="free">relation</span><span class="main">]</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> asm assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> preference.not_outside rational_preference.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> asm assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> preference_def rational_preference_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> obt_u_fnt_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rational_preference <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> fnt_carrier_exists_util_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> ordinal_util_imp_rat_prefs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rational_preference <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms order_on_defs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ordinal_utility.util_imp_refl 
      ordinal_utility.util_imp_total ordinal_utility.util_imp_trans ordinal_utility_def 
      preference.intro rational_preference.intro rational_preference_axioms_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Utility function on  Euclidean Space ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> eucl_ordinal_utility <span class="main">=</span> ordinal_utility <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">relation</span></span> <span class="quoted"><span class="free">u</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">carrier</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">u</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> eucl_ordinal_utility <span class="main">⊆</span> rational_preference <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">relation</span></span>
  <span class="keyword1"><span class="command">using</span></span> rational_preference_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="Utility_Functions-ord_eucl_utility_imp_rpr"><span class="command">lemma</span></span> ord_eucl_utility_imp_rpr<span class="main">:</span> <span class="quoted"><span class="quoted">"eucl_ordinal_utility <span class="free">s</span> <span class="free">rel</span> <span class="free">u</span> <span class="main">⟶</span> real_vector_rpr <span class="free">s</span> <span class="free">rel</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eucl_ordinal_utility.axioms ordinal_util_imp_rat_prefs real_vector_rpr.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">context</span></span> eucl_ordinal_utility
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Local non-satiation on utility functions ›</span></span>

<span class="keyword1" id="Utility_Functions-lns_pref_lns_util"><span class="command">lemma</span></span> lns_pref_lns_util <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">e</span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span>
  norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="free">u</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="free">u</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="var">?alt</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lns<span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≻</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="free">u</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="free">u</span> <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_real_def util_def x_y_in_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?alt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lns local_nonsatiation_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?alt</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">carrier</span> <span class="free">relation</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> lns_normI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span> norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_eq_real_def linorder_not_less lns util_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span> norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="main">∧</span> <span class="free">u</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="free">u</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e x_in lns <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">carrier</span><span class="main">.</span> norm <span class="main">(</span><span class="bound">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≻</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> compl not_less util_def x_in<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Utility_Functions-finite_carrier_rpr_iff_u"><span class="command">lemma</span></span> finite_carrier_rpr_iff_u<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">carrier</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">relation</span><span class="main">::</span><span class="tfree">'a</span> relation<span class="main">)</span> <span class="main">⊆</span> <span class="free">carrier</span> <span class="main">×</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rational_preference <span class="free">carrier</span> <span class="free">relation</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rational_preference <span class="free">carrier</span> <span class="free">relation</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="bound">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> fnt_carrier_exists_util_fun<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> ordinal_utility <span class="free">carrier</span> <span class="free">relation</span> <span class="bound">u</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rational_preference <span class="free">carrier</span> <span class="free">relation</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> order_on_defs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ordinal_utility.util_imp_refl 
        ordinal_utility.util_imp_total ordinal_utility.util_imp_trans ordinal_utility_def 
        preference.intro rational_preference_axioms_def rational_preference_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Consumers">
<div class="head">
<h1>Theory Consumers</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>
<span class="comment1">(*
Author: Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author: Cezary Kaliszyk
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Consumers  ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Consumption sets ›</span></span>


<span class="keyword1"><span class="command">theory</span></span> Consumers
  <span class="keyword2"><span class="keyword">imports</span></span>                 
    <span class="quoted">"<a href="../../HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
    <span class="quoted">"<a href="Syntax.html">../Syntax</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Pre Arrow-Debreu consumption set ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ It turns out that the First Welfare Theorem does
       not require any particular limitations on the consumption set ›</span></span>
<span class="keyword1"><span class="command">locale</span></span> pre_arrow_debreu_consumption_set <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">consumption_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>UNIV<span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Arrow-Debreu model consumption set›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ The Arrow-Debreu model consumption set includes more and stricter
        assumptions which are necessary for further results. ›</span></span>
<span class="keyword1"><span class="command">locale</span></span> gen_pre_arrow_debreu_consum_set <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">consumption_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ordered_euclidean_space<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> arrow_debreu_consum_set <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">consumption_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ordered_euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">consumption_set</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> closed<span class="main">:</span> <span class="quoted"><span class="quoted">"closed <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> convex<span class="main">:</span> <span class="quoted"><span class="quoted">"convex <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">consumption_set</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> <span class="free">consumption_set</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">&gt;</span> <span class="bound">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">consumption_set</span><span class="main">)</span>"</span></span> <span class="comment1">(*unbounded above*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Consumers-x_larger_0"><span class="command">lemma</span></span> x_larger_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">consumption_set</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> r_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Consumers-larger_in_consump_set"><span class="command">lemma</span></span> larger_in_consump_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">consumption_set</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arrow_debreu_consum_set_axioms arrow_debreu_consum_set_def
    dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Common">
<div class="head">
<h1>Theory Common</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>
<span class="comment1">(*
Author: Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author: Cezary Kaliszyk
*)</span>


<span class="keyword1"><span class="command">theory</span></span> Common
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="Preferences.html">../Preferences</a>"</span>
    <span class="quoted">"<a href="Utility_Functions.html">../Utility_Functions</a>"</span>
    <span class="quoted">"<a href="Argmax.html">../Argmax</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Pareto Ordering ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Allows us to define a Pareto Ordering. ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> pareto_ordering <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">notation</span></span> <span class="free">U</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">U[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pareto_dominating</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≻Pareto</span>"</span>  60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">≻Pareto</span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⟷</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Common-trans_strict_pareto"><span class="command">lemma</span></span> trans_strict_pareto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="keyword1">≻Pareto</span> <span class="free">Y</span> <span class="main">⟹</span> <span class="free">Y</span> <span class="keyword1">≻Pareto</span> <span class="free">Z</span> <span class="main">⟹</span> <span class="free">X</span> <span class="keyword1">≻Pareto</span> <span class="free">Z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="keyword1">≻Pareto</span> <span class="free">Y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="keyword1">≻Pareto</span> <span class="free">Z</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">Z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a1 order_trans pareto_dominating_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">¬</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 pareto_dominating_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">Y</span> <span class="keyword1">≻Pareto</span> <span class="free">Z</span>›</span></span> less_eq_real_def pareto_dominating_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Common-anti_sym_strict_pareto"><span class="command">lemma</span></span> anti_sym_strict_pareto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="keyword1">≻Pareto</span> <span class="free">Y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">Y</span> <span class="keyword1">≻Pareto</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pareto_dominating_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Budget constraint›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Definition returns all afforedable bundles given wealth W ›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ f is a function that computes the value given a bundle›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">budget_constraint</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">budget_constraint</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Feasiblity ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">feasible_private_ownership</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">feasible_private_ownership</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⟷</span>
      <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ℰ</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Cs</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">j</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Common-feasible_private_ownershipD"><span class="command">lemma</span></span> feasible_private_ownershipD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"feasible_private_ownership <span class="free">A</span> <span class="free">F</span> <span class="free">ℰ</span> <span class="free">Cs</span> <span class="free">Ps</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">ℰ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Cs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">Ps</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms feasible_private_ownership_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms feasible_private_ownership_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">meson</span> assms feasible_private_ownership_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Exchange_Economy">
<div class="head">
<h1>Theory Exchange_Economy</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>
<span class="comment1">(*
Author: Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author: Cezary Kaliszyk
*)</span>


<span class="keyword1"><span class="command">theory</span></span> Exchange_Economy
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="Preferences.html">../Preferences</a>"</span>
    <span class="quoted">"<a href="Utility_Functions.html">../Utility_Functions</a>"</span>
    <span class="quoted">"<a href="Argmax.html">../Argmax</a>"</span>
    <a href="Consumers.html">Consumers</a>
    <a href="Common.html">Common</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Exchange Economy ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Define the exchange economy model ›</span></span>

<span class="keyword1"><span class="command">locale</span></span> exchange_economy <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">consumption_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ordered_euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Pref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> relation"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cons_set_props<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_arrow_debreu_consumption_set <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> agent_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> eucl_ordinal_utility <span class="free">consumption_set</span> <span class="main">(</span><span class="free">Pref</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">U</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_agents<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">agents</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">agents</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> exchange_economy <span class="main">⊆</span> pareto_ordering <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">U</span></span>
  <span class="keyword1"><span class="command">.</span></span>                                 

<span class="keyword1"><span class="command">context</span></span> exchange_economy
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="free">U</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">U[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="free">Pref</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Pr[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="free">ℰ</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ℰ[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>

<span class="keyword1" id="Exchange_Economy-base_pref_is_ord_eucl_rpr"><span class="command">lemma</span></span> base_pref_is_ord_eucl_rpr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> rational_preference <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> exchange_economy.agent_props exchange_economy_axioms
      ord_eucl_utility_imp_rpr real_vector_rpr.have_rpr<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">calculate_value</span> 
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">calculate_value</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Feasibility ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">feasible_allocation</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">feasible_allocation</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⟷</span>
      <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Pareto optimality ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pareto_optimal_endow</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">pareto_optimal_endow</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⟷</span>
              <span class="main">(</span>feasible_allocation <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∄</span><span class="bound">X'</span><span class="main">.</span> feasible_allocation <span class="bound">X'</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Competitive Equilibrium in Exchange Economy ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Competitive Equilibirum or Walrasian Equilibrium definition. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">comp_equilib_endow</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">comp_equilib_endow</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">≡</span>
      feasible_allocation <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">i</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>
        <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lemmas for final result ›</span></span>

<span class="keyword1" id="Exchange_Economy-utility_function_def"><span class="command">lemma</span></span> utility_function_def<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≽[</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">]</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordinal_utility <span class="free">consumption_set</span> <span class="main">(</span><span class="free">Pref</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> agent_props assms eucl_ordinal_utility_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span> <span class="main">≤</span>  <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽[</span><span class="free">Pref</span> <span class="free">i</span><span class="main">]</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I cons_set_props ordinal_utility.util_def_conf
        pre_arrow_debreu_consumption_set_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="free">Pref</span> <span class="free">i</span><span class="main">]</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> agent_props assms ordinal_utility_def eucl_ordinal_utility_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Exchange_Economy-budget_constraint_is_feasible"><span class="command">lemma</span></span> budget_constraint_is_feasible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="main">≤</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> budget_constraint_def assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> budget_constraint_def<span class="main">)</span>

<span class="keyword1" id="Exchange_Economy-arg_max_set_therefore_no_better"><span class="command">lemma</span></span> arg_max_set_therefore_no_better <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">∉</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> no_better_in_s assms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Since we need no restriction on the consumption set for the First Welfare Theorem ›</span></span>

<span class="keyword1" id="Exchange_Economy-consumption_set_member"><span class="command">lemma</span></span> consumption_set_member<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cons_set_props pre_arrow_debreu_consumption_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_arrow_debreu_consumption_set_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Under the assumption of Local non-satiation, agents will utilise their entire budget. ›</span></span>

<span class="keyword1" id="Exchange_Economy-argmax_entire_budget"><span class="command">lemma</span></span> argmax_entire_budget <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> leq <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> argmax_sol_in_s<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span><span class="main">]</span>
        assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> budget_constraint_is_feasible <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="main">&lt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> cpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">X</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lesS</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lesS</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"ball <span class="free">X</span> <span class="skolem">e</span> <span class="main">⊆</span> <span class="skolem">lesS</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpos lesS_def mem_Collect_eq
          open_contains_ball_eq open_halfspace_lt<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≻[</span><span class="free">Pref</span> <span class="free">i</span><span class="main">]</span> <span class="free">X</span> "</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> ball <span class="free">X</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e consumption_set_member assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> consumption_set_member <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> budget_constraint_def e lesS_def
        less_eq_real_def Y  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms Y all_leq utility_function_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> leq not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ All bundles that would be strictly preferred to any argmax result, are more expensive. ›</span></span>

<span class="keyword1" id="Exchange_Economy-pref_more_expensive"><span class="command">lemma</span></span> pref_more_expensive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> cpos <span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">y</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xp_leq <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">P</span> <span class="main">∙</span>  <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> argmax_sol_in_s<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span><span class="main">]</span>
      assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> xp_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> xp_leq inner_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> consumption_set_member <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> budget_constraint_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≻[</span><span class="free">Pref</span> <span class="free">i</span><span class="main">]</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> arg_max_set_therefore_no_better assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≻[</span><span class="free">Pref</span> <span class="free">i</span><span class="main">]</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xp_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms exchange_economy.arg_max_set_therefore_no_better
        exchange_economy_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Greater or equal utility implies greater or equal price. ›</span></span>

<span class="keyword1" id="Exchange_Economy-same_util_is_equal_or_more_expensive"><span class="command">lemma</span></span> same_util_is_equal_or_more_expensive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> not_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms leq_all_in_sol assms<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> budget_constraint_def inner_commute
          consumption_set_member<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> argmax_entire_budget not_in assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span>
        dual_order.order_iff_strict inner_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Exchange_Economy-all_in_argmax_same_price"><span class="command">lemma</span></span> all_in_argmax_same_price<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">x</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> argmax_entire_budget assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ All rationally acting agents (which is every agent by assumption)
        will not decrease his utility ›</span></span>
<span class="keyword1" id="Exchange_Economy-individual_rationalism"><span class="command">lemma</span></span> individual_rationalism <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"comp_equilib_endow <span class="free">P</span> <span class="free">X</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span> <span class="main">≽[</span><span class="free">Pref</span> <span class="bound">i</span><span class="main">]</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pref_more_expensive comp_equilib_endow_def assms
      inner_commute less_irrefl not_le utility_function_def<span class="main">)</span>

<span class="keyword1" id="Exchange_Economy-walras_law_per_agent"><span class="command">lemma</span></span> walras_law_per_agent <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"comp_equilib_endow <span class="free">P</span> <span class="free">X</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> argmax_entire_budget comp_equilib_endow_def assms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Walras Law holds in our Exchange Economy model. It states that in an equilibrium,
       demand equals supply ›</span></span>

<span class="keyword1" id="Exchange_Economy-walras_law"><span class="command">lemma</span></span> walras_law<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"comp_equilib_endow <span class="free">P</span> <span class="free">X</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms walras_law_per_agent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Exchange_Economy-inner_with_ge_0"><span class="command">lemma</span></span> inner_with_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="main">(</span>real<span class="main">,</span> <span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span> vec<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≥</span> <span class="free">B</span> <span class="main">⟹</span>  <span class="free">P</span> <span class="main">∙</span> <span class="free">A</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.order_iff_strict inner_commute
      interval_inner_leI<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ord_class.atLeastAtMost_iff<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ First Welfare Theorem in Exchange Economy ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ We prove the first welfare theorem in our Exchange Economy model. ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> first_welfare_theorem_exchange<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> price_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equilibrium <span class="main">:</span> <span class="quoted"><span class="quoted">"comp_equilib_endow <span class="free">Price</span> <span class="free">𝒳</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pareto_optimal_endow <span class="free">𝒳</span> <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> neg_ass <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pareto_optimal_endow <span class="free">𝒳</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> equili_feasible <span class="main">:</span> <span class="quoted"><span class="quoted">"feasible_allocation <span class="free">𝒳</span> <span class="free">ℰ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_equilib_endow_def equilibrium
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_equilib_endow_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> price_g_zero <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> price_cond<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    xprime_pareto<span class="main">:</span> <span class="quoted"><span class="quoted">"feasible_allocation <span class="skolem">Y</span> <span class="free">ℰ</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equili_feasible neg_ass pareto_dominating_def
      pareto_optimal_endow_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> is_feasible <span class="main">:</span> <span class="quoted"><span class="quoted">"feasible_allocation <span class="skolem">Y</span> <span class="free">ℰ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> all_great_eq_value <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> x_in_agmx <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">Price</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span> comp_equilib_endow_def equilibrium<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span> argmax_entire_budget diff_le_0_iff_le x_in_agmx
            inner_commute lns same_util_is_equal_or_more_expensive<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> ex_greater_value <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      obt_witness <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span> <span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="skolem">Y</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒳</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="skolem">Y</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">ℰ</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pref_more_expensive comp_equilib_endow_def
            equilibrium inner_commute obt_witness<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> obt_witness<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="free">ℰ</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒳</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> equilibrium lns obt_witness<span class="main">(</span>1<span class="main">)</span> walras_law_per_agent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Price</span> <span class="main">∙</span> <span class="free">ℰ</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="skolem">Y</span> <span class="skolem">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> a1 all_great_eq_value obt_witness<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> dominating_more_exp <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> mp_rule <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_sum_right<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_great_eq_value finite_agents ex_greater_value sum_strict_mono_ex1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mp_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> equili_walras_law <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> eq_iff_diff_eq_0 equilibrium
        inner_sum_right lns walras_law<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dominating_feasible <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastAtMost_iff dual_order.order_iff_strict equili_walras_law
        feasible_allocation_def inner_commute interval_inner_leI<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_feasible price_g_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> dominating_more_exp equili_walras_law dominating_feasible
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Monotone preferences can be used instead of local non-satiation.
       Many textbooks etc. do not introduce the concept of
       local non-satiation and use monotonicity instead. ›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> first_welfare_exch_thm_monot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">&gt;</span> <span class="bound">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> monotone_preference <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> price_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"comp_equilib_endow <span class="free">Price</span> <span class="free">𝒳</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pareto_optimal_endow <span class="free">𝒳</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms exchange_economy.consumption_set_member
      first_welfare_theorem_exchange exchange_economy_axioms unbounded_above_mono_imp_lns<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Private_Ownership_Economy">
<div class="head">
<h1>Theory Private_Ownership_Economy</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>
<span class="comment1">(*
Author: Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author: Cezary Kaliszyk
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Pre Arrow-Debreu model ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Model similar to Arrow-Debreu model but with fewer assumptions,
       since we only need assumptions strong enough to proof the First Welfare Theorem. ›</span></span>


<span class="keyword1"><span class="command">theory</span></span> Private_Ownership_Economy
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="Preferences.html">../Preferences</a>"</span>
    <span class="quoted">"<a href="Preferences.html">../Preferences</a>"</span>
    <span class="quoted">"<a href="Utility_Functions.html">../Utility_Functions</a>"</span>
    <span class="quoted">"<a href="Argmax.html">../Argmax</a>"</span>
    <a href="Consumers.html">Consumers</a>
    <a href="Common.html">Common</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">locale</span></span> pre_arrow_debreu_model <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">production_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ordered_euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">consumption_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">firms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">ℰ[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Pref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> relation"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Pr[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">U[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Θ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> real"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">Θ[</span>_<span class="keyword1">,</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cons_set_props<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_arrow_debreu_consumption_set <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> agent_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> eucl_ordinal_utility <span class="free">consumption_set</span> <span class="main">(</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> firms_comp_owned<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">firms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="free">j</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_nonepty_agents<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">agents</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">agents</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pre_arrow_debreu_model <span class="main">⊆</span> pareto_ordering <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">U</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">context</span></span> pre_arrow_debreu_model
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ No restrictions on consumption set needed ›</span></span>
<span class="keyword1" id="Private_Ownership_Economy-all_larger_zero_in_csset"><span class="command">lemma</span></span> all_larger_zero_in_csset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cons_set_props pre_arrow_debreu_consumption_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">context</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Calculate wealth of individual i in context of Private Ownership economy. ›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">poe_wealth</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">poe_wealth</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Feasiblity ›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">feasible</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">feasible</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> feasible_private_ownership <span class="free">agents</span> <span class="free">firms</span> <span class="free">ℰ</span> <span class="free">consumption_set</span> <span class="free">production_sets</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">calculate_value</span> 
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">calculate_value</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Profit maximisation ›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In a production economy we need to specify profit maximisation. ›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">profit_maximisation</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">profit_maximisation</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> arg_max_set <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Competitive Equilibirium ›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Competitive equilibrium in context of production economy with private ownership.
             This includes the profit maximisation condition. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">competitive_equilibrium</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">competitive_equilibrium</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⟷</span> feasible <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> profit_maximisation <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free">production_sets</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Private_Ownership_Economy-competitive_equilibriumD"><span class="command">lemma</span></span> competitive_equilibriumD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"feasible <span class="free">X</span> <span class="free">Y</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> profit_maximisation <span class="free">P</span> <span class="main">(</span><span class="free">production_sets</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="bound">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> competitive_equilibrium_def<span class="main">)</span>

<span class="keyword1" id="Private_Ownership_Economy-compet_max_profit"><span class="command">lemma</span></span> compet_max_profit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">firms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="free">j</span> <span class="main">∈</span> profit_maximisation <span class="free">P</span> <span class="main">(</span><span class="free">production_sets</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Pareto Optimality ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pareto_optimal</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">pareto_optimal</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⟷</span>
              <span class="main">(</span>feasible <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> feasible <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Private_Ownership_Economy-pareto_optimalI"><span class="command">lemma</span></span> pareto_optimalI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"feasible <span class="free">X</span> <span class="free">Y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> feasible <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pareto_optimal_def assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Private_Ownership_Economy-pareto_optimalD"><span class="command">lemma</span></span> pareto_optimalD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"feasible <span class="free">X</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> feasible <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pareto_optimal_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Private_Ownership_Economy-util_fun_def_holds"><span class="command">lemma</span></span> util_fun_def_holds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≽[</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">]</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> agent_props all_larger_zero_in_csset eucl_ordinal_utility_def ordinal_utility_def<span class="main">)</span>

<span class="keyword1" id="Private_Ownership_Economy-base_pref_is_ord_eucl_rpr"><span class="command">lemma</span></span> base_pref_is_ord_eucl_rpr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> rational_preference <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> agent_props ord_eucl_utility_imp_rpr real_vector_rpr.have_rpr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Private_Ownership_Economy-prof_max_ge_all_in_pset"><span class="command">lemma</span></span> prof_max_ge_all_in_pset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">firms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="free">j</span> <span class="main">∈</span> profit_maximisation <span class="free">P</span> <span class="main">(</span><span class="free">production_sets</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">production_sets</span> <span class="free">j</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="free">j</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> all_leq assms<span class="main">(</span>2<span class="main">)</span> profit_maximisation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lemmas for final result ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Strictly preferred bundles are strictly more expensive. ›</span></span>

<span class="keyword1" id="Private_Ownership_Economy-all_prefered_are_more_expensive"><span class="command">lemma</span></span> all_prefered_are_more_expensive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_agt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equil<span class="main">:</span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span> <span class="free">i</span><span class="main">)</span> <span class="free">z</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">U</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> neg_as <span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">z</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xp_leq <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">P</span> <span class="main">∙</span>  <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="free">z</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x_in_argmax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equil i_agt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒳</span> <span class="free">i</span> <span class="main">∈</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> argmax_sol_in_s <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> z_in_budget<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> z_leq_endow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> xp_leq inner_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> z_in_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> x_in budget_constraint_def z_leq_endow
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span>  <span class="free">P</span> <span class="main">∙</span> <span class="free">𝒳</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≤</span> <span class="bound">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> z_leq_endow <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> budget_constraint_def x_in z_in_cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> budget_constraint_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> nex_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span>  <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_better_in_s<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">𝒳</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
        <span class="quoted"><span class="quoted">"budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span>"</span></span><span class="main">]</span> x_in_argmax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">z</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms z_in_budget <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> nex_prop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Given local non-satiation, argmax will use the entire budget. ›</span></span>

<span class="keyword1" id="Private_Ownership_Economy-am_utilises_entire_bgt"><span class="command">lemma</span></span> am_utilises_entire_bgt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_agts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> argmax_sol <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?wlt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> argmax_sol_in_s <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="var"><span class="quoted"><span class="var">?bc</span></span></span><span class="main">]</span> argmax_sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> is_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">≤</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> budget_constraint_def
        inner_commute mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">X</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&lt;</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&lt;</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> bgt_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="var">?bc</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">X</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> leq_all_in_sol <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span>"</span></span><span class="main">]</span>
        all_leq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span>"</span></span><span class="main">]</span>
        argmax_sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s_low</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">s_low</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span> <span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="var">?wlt</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">.</span> ball <span class="free">X</span> <span class="bound">e</span> <span class="main">⊆</span> <span class="skolem">s_low</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> x_in_budget<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="main">&lt;</span> <span class="var">?wlt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inner_commute neg<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> s_low_open<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">s_low</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> open_halfspace_lt s_low_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> s_low_open open_contains_ball_eq
          s_low_def x_in_budget <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"ball <span class="free">X</span> <span class="skolem">e</span> <span class="main">⊆</span> <span class="skolem">s_low</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> ball <span class="free">X</span> <span class="bound">e</span> <span class="main">⊆</span> <span class="skolem">s_low</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      y_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ball <span class="free">X</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≻[</span><span class="free">Pref</span> <span class="free">i</span><span class="main">]</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> all_larger_zero_in_csset lns <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">s_low</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> ball <span class="free">X</span> <span class="skolem">e</span>›</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_low_def all_larger_zero_in_csset
            budget_constraint_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> bgt_leq i_agts y_props<span class="main">(</span>2<span class="main">)</span> util_fun_def_holds <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inner_commute is_leq
        less_eq_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> x_equil_x_ext_budget<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_agt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equilibrium <span class="main">:</span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="free">i</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="free">i</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equilibrium i_agt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> am_utilises_entire_bgt i_agt lns <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Private_Ownership_Economy-same_price_in_argmax"><span class="command">lemma</span></span> same_price_in_argmax <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_agt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> am_utilises_entire_bgt assms lns
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> am_utilises_entire_bgt assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> i_agt lns<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Greater or equal utility implies greater or equal value. ›</span></span>

<span class="keyword1" id="Private_Ownership_Economy-utility_ge_price_ge"><span class="command">lemma</span></span> utility_ge_price_ge <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> agts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equil<span class="main">:</span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> geq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">z</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_in <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="var">?bc</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="free">firms</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="free">i</span> <span class="main">∈</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="var">?bc</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> competitive_equilibriumD assms pareto_optimal_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span>  geq leq_all_in_sol<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> budget_constraint_def assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> budget_constraint_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_in_argmax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> agts equil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> x_in_budget<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> argmax_sol_in_s <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> con_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z_in_argmax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span><span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> agts am_utilises_entire_bgt lns x_in_argmax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> con_neg less_eq_real_def not_in<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> z_budget_utilisation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> agts am_utilises_entire_bgt lns x_in_argmax z_in_argmax<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agts am_utilises_entire_bgt lns x_in_argmax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> z_budget_utilisation con_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> agts am_utilises_entire_bgt eq_iff eucl_less_le_not_le lns not_in x_in_argmax<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Private_Ownership_Economy-commutativity_sums_over_funs"><span class="command">lemma</span></span> commutativity_sums_over_funs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'y</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">C</span> <span class="main">∙</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">C</span> <span class="main">∙</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Private_Ownership_Economy-assoc_fun_over_sum"><span class="command">lemma</span></span> assoc_fun_over_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'y</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">C</span> <span class="main">∙</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">C</span> <span class="main">∙</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_sum_left scaleR_left.sum<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Walras' law in context of production economy with private ownership.
       That is, in an equilibrium demand equals supply. ›</span></span>

<span class="keyword1" id="Private_Ownership_Economy-walras_law"><span class="command">lemma</span></span> walras_law<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="bound">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> value_equal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">f</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> all_exhaust_bgt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms am_utilises_entire_bgt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>all_exhaust_bgt inner_sum_right sum.distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">(</span><span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> commutativity_sums_over_funs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Θ</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">firms</span></span> <span class="quoted"><span class="free">agents</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> eq_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> value_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span>  <span class="keyword1"><span class="command">have</span></span> eq_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">P</span> <span class="main">∙</span>  <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assoc_fun_over_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Θ</span>"</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">firms</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> eq_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span>  <span class="free">Y</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> firms_comp_owned <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> comp_wise_inner<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_1 eq_2 eq_3 eq_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_right_distrib inner_sum_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Private_Ownership_Economy-walras_law_in_compeq"><span class="command">lemma</span></span> walras_law_in_compeq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> walras_law <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_diff_right inner_right_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ First Welfare Theorem ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Proof of First Welfare Theorem in context of production economy with private ownership. ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> first_welfare_theorem_priv_own<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">Price</span> <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> neg_as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pareto_optimal <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> equili_feasible <span class="main">:</span> <span class="quoted"><span class="quoted">"feasible <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> competitive_equilibrium_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X'</span></span> <span class="skolem"><span class="skolem">Y'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    xprime_pareto<span class="main">:</span> <span class="quoted"><span class="quoted">"feasible <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equili_feasible pareto_optimal_def
      pareto_dominating_def neg_as <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> is_feasible<span class="main">:</span> <span class="quoted"><span class="quoted">"feasible <span class="skolem">X'</span> <span class="skolem">Y'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> xprime_leq_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span>
    <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="free">firms</span><span class="main">)</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> xprime_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_larger_zero_in_csset<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> x_leq_xprime<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">X'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lns_pref<span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> as assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> xprime_ge_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_leq_xprime xprime_cons as assms utility_ge_price_ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="free">firms</span><span class="main">)</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="skolem">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xprime_ge_x <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span> lns_pref assms x_equil_x_ext_budget <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> ex_greater_value <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> cpos <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      obt_witness <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="skolem">X'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpos all_larger_zero_in_csset all_prefered_are_more_expensive
          inner_commute obt_witness<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> obt_witness<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> dom_g <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">&gt;</span> <span class="main">_</span> <span class="main">∙</span> <span class="var">?x_sum</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> xprime_leq_y assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> ex_greater_value
          finite_nonepty_agents sum_strict_mono_ex1 x_equil_x_ext_budget<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="var">?x_sum</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_sum_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y_sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> equili_walras_law<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="var">?x_sum</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?ws</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒳</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> x_equil_x_ext_budget<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_sum_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> remove_firm_pct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="var">?y_sum</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> equals_inner_price<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?x_sum</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">ℰ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="var">?y_sum</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> diff_diff_add assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span>  walras_law_in_compeq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="var">?x_sum</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">ℰ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="var">?y_sum</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> equals_inner_price inner_diff_right right_minus_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equili_walras_law inner_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> xp_l_yp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_feasible feasible_private_ownership_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> yprime_sgr_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">f</span><span class="main">)</span> <span class="main">&gt;</span> <span class="var">?ws</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> xp_l_yp atLeastAtMost_iff inner_commute
          interval_inner_leI<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_imp_le order_refl assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ws</span> <span class="main">&lt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">ℰ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dom_g equili_walras_law <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> Y_is_optimum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">production_sets</span> <span class="bound">j</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms prof_max_ge_all_in_pset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> yprime_in_prod_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">production_sets</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> feasible_private_ownership_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">production_sets</span> <span class="bound">j</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Y_is_optimum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> Y_ge_yprime<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="skolem">Y'</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yprime_in_prod_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> yprime_p_leq_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Price</span> <span class="main">∙</span> <span class="var">?y_sum</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_ge_yprime inner_sum_right sum_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> remove_firm_pct yprime_sgr_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Equilibrium cannot be Pareto dominated. ›</span></span>

<span class="keyword1" id="Private_Ownership_Economy-equilibria_dom_eachother"><span class="command">lemma</span></span> equilibria_dom_eachother<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equil<span class="main">:</span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">Price</span> <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> competitive_equilibrium <span class="free">P</span> <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free">𝒳</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms equil first_welfare_theorem_priv_own<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> feasible <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free">𝒳</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pareto_optimal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Using monotonicity instead of local non-satiation proves the First Welfare Theorem. ›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> first_welfare_thm_monotone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">&gt;</span> <span class="bound">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> monotone_preference <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">Price</span> <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> all_larger_zero_in_csset assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> 
    first_welfare_theorem_priv_own unbounded_above_mono_imp_lns <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Arrow_Debreu_Model">
<div class="head">
<h1>Theory Arrow_Debreu_Model</h1>
</div>
<pre class="source"><span class="comment1">(* License: LGPL *)</span>
<span class="comment1">(*
Author: Julian Parsert &lt;julian.parsert@gmail.com&gt;
Author: Cezary Kaliszyk
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Arrow-Debreu model ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Arrow_Debreu_Model
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="Preferences.html">../Preferences</a>"</span>
    <span class="quoted">"<a href="Preferences.html">../Preferences</a>"</span>
    <span class="quoted">"<a href="Utility_Functions.html">../Utility_Functions</a>"</span>
    <span class="quoted">"<a href="Argmax.html">../Argmax</a>"</span>
    <a href="Consumers.html">Consumers</a>
    <a href="Common.html">Common</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> pre_arrow_debreu_model <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">production_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ordered_euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">consumption_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">agents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">firms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">ℰ[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Pref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> relation"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Pr[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">U[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Θ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'f</span> <span class="main">⇒</span> real"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">Θ[</span>_<span class="keyword1">,</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cons_set_props<span class="main">:</span> <span class="quoted"><span class="quoted">"arrow_debreu_consum_set <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> agent_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> eucl_ordinal_utility <span class="free">consumption_set</span> <span class="main">(</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> firms_comp_owned<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">firms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="free">j</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_nonepty_agents<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">agents</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">agents</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pre_arrow_debreu_model <span class="main">⊆</span> pareto_ordering <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">U</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="comment1">(*sublocale pre_arrow_debreu_model ⊆ exchange_economy consumption_set agents ℰ Pref U Price
  by (metis exchange_economy.intro pre_arrow_debreu_model_axioms pre_arrow_debreu_model_def)
*)</span>

<span class="keyword1"><span class="command">context</span></span> pre_arrow_debreu_model
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Calculate wealth of individual i in context of Private Ownership economy. ›</span></span>

<span class="keyword1"><span class="command">context</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">poe_wealth</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">poe_wealth</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Feasiblity ›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">feasible</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">feasible</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> feasible_private_ownership <span class="free">agents</span> <span class="free">firms</span> <span class="free">ℰ</span> <span class="free">consumption_set</span> <span class="free">production_sets</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">calculate_value</span> 
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">calculate_value</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Profit maximisation ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ In a production economy (which this is) we need to specify profit maximisation. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">profit_maximisation</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">profit_maximisation</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> arg_max_set <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∙</span> <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Competitive Equilibirium ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Competitive equilibrium in context of production economy with private ownership.
             This includes the profit maximisation condition. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">competitive_equilibrium</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">competitive_equilibrium</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⟷</span> feasible <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> profit_maximisation <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free">production_sets</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-competitive_equilibriumD"><span class="command">lemma</span></span> competitive_equilibriumD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"feasible <span class="free">X</span> <span class="free">Y</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> profit_maximisation <span class="free">P</span> <span class="main">(</span><span class="free">production_sets</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="bound">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> competitive_equilibrium_def<span class="main">)</span>

<span class="keyword1" id="Arrow_Debreu_Model-compet_max_profit"><span class="command">lemma</span></span> compet_max_profit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">firms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="free">j</span> <span class="main">∈</span> profit_maximisation <span class="free">P</span> <span class="main">(</span><span class="free">production_sets</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Pareto Optimality ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pareto_optimal</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">pareto_optimal</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⟷</span>
              <span class="main">(</span>feasible <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> feasible <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-pareto_optimalI"><span class="command">lemma</span></span> pareto_optimalI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"feasible <span class="free">X</span> <span class="free">Y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> feasible <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pareto_optimal_def assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Arrow_Debreu_Model-pareto_optimalD"><span class="command">lemma</span></span> pareto_optimalD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"feasible <span class="free">X</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> feasible <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pareto_optimal_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Arrow_Debreu_Model-util_fun_def_holds"><span class="command">lemma</span></span> util_fun_def_holds<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">]</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">]</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≽[</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">]</span> <span class="free">y</span>›</span></span> agent_props assms eucl_ordinal_utility_def ordinal_utility_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eucl_ordinal_utility <span class="free">consumption_set</span> <span class="main">(</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agent_props assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≽[</span><span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">]</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">x</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> eucl_ordinal_utility_def ordinal_utility.util_def_conf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-base_pref_is_ord_eucl_rpr"><span class="command">lemma</span></span> base_pref_is_ord_eucl_rpr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> rational_preference <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> agent_props ord_eucl_utility_imp_rpr real_vector_rpr.have_rpr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Arrow_Debreu_Model-prof_max_ge_all_in_pset"><span class="command">lemma</span></span> prof_max_ge_all_in_pset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">firms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="free">j</span> <span class="main">∈</span> profit_maximisation <span class="free">P</span> <span class="main">(</span><span class="free">production_sets</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">production_sets</span> <span class="free">j</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="free">j</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> all_leq assms<span class="main">(</span>2<span class="main">)</span> profit_maximisation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Lemmas for final result ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Strictly preferred bundles are strictly more expensive. ›</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-all_prefered_are_more_expensive"><span class="command">lemma</span></span> all_prefered_are_more_expensive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_agt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equil<span class="main">:</span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span> <span class="free">i</span><span class="main">)</span> <span class="free">z</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">U</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> neg_as <span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">z</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xp_leq <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">P</span> <span class="main">∙</span>  <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="free">z</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&gt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x_in_argmax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equil i_agt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒳</span> <span class="free">i</span> <span class="main">∈</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> argmax_sol_in_s <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> z_in_budget<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> z_leq_endow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> xp_leq inner_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> z_in_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> x_in budget_constraint_def z_leq_endow
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span>  <span class="free">P</span> <span class="main">∙</span> <span class="free">𝒳</span> <span class="free">i</span> <span class="main">≤</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≤</span> <span class="bound">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> z_leq_endow <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> budget_constraint_def x_in z_in_cons
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> budget_constraint_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> nex_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span>  <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_better_in_s<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">𝒳</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
        <span class="quoted"><span class="quoted">"budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span>"</span></span><span class="main">]</span> x_in_argmax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">𝒴</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">z</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms z_in_budget <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> nex_prop
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Given local non-satiation, argmax will use the entire budget. ›</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-am_utilises_entire_bgt"><span class="command">lemma</span></span> am_utilises_entire_bgt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_agts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> argmax_sol <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?wlt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> argmax_sol_in_s <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="var"><span class="quoted"><span class="var">?bc</span></span></span><span class="main">]</span> argmax_sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> is_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">≤</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> budget_constraint_def
        inner_commute mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> not_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">X</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&lt;</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∙</span> <span class="free">P</span> <span class="main">&lt;</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> bgt_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="var">?bc</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">X</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> leq_all_in_sol <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span>"</span></span><span class="main">]</span>
        all_leq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span>"</span></span><span class="main">]</span>
        argmax_sol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s_low</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">s_low</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span> <span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="var">?wlt</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">.</span> ball <span class="free">X</span> <span class="bound">e</span> <span class="main">⊆</span> <span class="skolem">s_low</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> x_in_budget<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="main">&lt;</span> <span class="var">?wlt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inner_commute neg<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> s_low_open<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="skolem">s_low</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> open_halfspace_lt s_low_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> s_low_open open_contains_ball_eq
          s_low_def x_in_budget <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"ball <span class="free">X</span> <span class="skolem">e</span> <span class="main">⊆</span> <span class="skolem">s_low</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> ball <span class="free">X</span> <span class="bound">e</span> <span class="main">⊆</span> <span class="skolem">s_low</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      y_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> ball <span class="free">X</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≻[</span><span class="free">Pref</span> <span class="free">i</span><span class="main">]</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> xin assms<span class="main">(</span>2<span class="main">)</span> budget_constraint_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lns_alt_def2 mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">s_low</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> ball <span class="free">X</span> <span class="skolem">e</span>›</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> agent_props eucl_ordinal_utility_def i_agts ordinal_utility_def y_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="skolem">y</span> <span class="main">≤</span> poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">)</span> s_low_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> budget_constraint_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> bgt_leq i_agts y_props<span class="main">(</span>2<span class="main">)</span> util_fun_def_holds xin budget_constraint_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inner_commute is_leq
        less_eq_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> x_equil_x_ext_budget<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_agt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equilibrium <span class="main">:</span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">X</span> <span class="free">i</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="free">i</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equilibrium i_agt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> am_utilises_entire_bgt i_agt lns <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-same_price_in_argmax"><span class="command">lemma</span></span> same_price_in_argmax <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_agt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> am_utilises_entire_bgt assms lns
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> am_utilises_entire_bgt assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> i_agt lns<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Greater or equal utility implies greater or equal value. ›</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-utility_ge_price_ge"><span class="command">lemma</span></span> utility_ge_price_ge <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> agts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lns <span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equil<span class="main">:</span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> geq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">z</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> not_in <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="var">?bc</span> <span class="main">⟹</span>
    <span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="free">firms</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="free">i</span> <span class="main">∈</span> arg_max_set <span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="var">?bc</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> competitive_equilibriumD assms pareto_optimal_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="free">i</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span>  geq leq_all_in_sol<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> budget_constraint_def assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> budget_constraint_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_in_argmax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> agts equil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> x_in_budget<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> argmax_sol_in_s <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> con_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">≥</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z_in_argmax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span><span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> agts am_utilises_entire_bgt lns x_in_argmax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> con_neg less_eq_real_def not_in<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> z_budget_utilisation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="free">z</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> agts am_utilises_entire_bgt lns x_in_argmax z_in_argmax<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="free">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> agts am_utilises_entire_bgt lns x_in_argmax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1"><span class="free">U[</span></span><span class="free">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">X</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> z_budget_utilisation con_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> agts am_utilises_entire_bgt eq_iff eucl_less_le_not_le lns not_in x_in_argmax<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-commutativity_sums_over_funs"><span class="command">lemma</span></span> commutativity_sums_over_funs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'y</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">C</span> <span class="main">∙</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">C</span> <span class="main">∙</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Arrow_Debreu_Model-assoc_fun_over_sum"><span class="command">lemma</span></span> assoc_fun_over_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'y</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">C</span> <span class="main">∙</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">C</span> <span class="main">∙</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_sum_left scaleR_left.sum<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Walras' law in context of production economy with private ownership.
       That is, in an equilibrium demand equals supply. ›</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-walras_law"><span class="command">lemma</span></span> walras_law<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> arg_max_set <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span>budget_constraint <span class="main">(</span>calculate_value <span class="free">P</span><span class="main">)</span> <span class="free">consumption_set</span> <span class="main">(</span>poe_wealth <span class="free">P</span> <span class="bound">i</span> <span class="free">Y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> value_equal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">f</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> all_exhaust_bgt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms am_utilises_entire_bgt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>all_exhaust_bgt inner_sum_right sum.distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">(</span><span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> commutativity_sums_over_funs <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Θ</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">firms</span></span> <span class="quoted"><span class="free">agents</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> eq_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> value_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span>  <span class="keyword1"><span class="command">have</span></span> eq_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span><span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">P</span> <span class="main">∙</span>  <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assoc_fun_over_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Θ</span>"</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">agents</span></span> <span class="quoted"><span class="free">firms</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> eq_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span>  <span class="free">Y</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> firms_comp_owned <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> comp_wise_inner<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">P</span> <span class="main">∙</span> <span class="free">Y</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_1 eq_2 eq_3 eq_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_right_distrib inner_sum_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-walras_law_in_compeq"><span class="command">lemma</span></span> walras_law_in_compeq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">P</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">X</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> walras_law <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_diff_right inner_right_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ First Welfare Theorem ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Proof of First Welfare Theorem in context of production economy with private ownership. ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> first_welfare_theorem_priv_own<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">Price</span> <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> neg_as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pareto_optimal <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> equili_feasible <span class="main">:</span> <span class="quoted"><span class="quoted">"feasible <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> competitive_equilibrium_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X'</span></span> <span class="skolem"><span class="skolem">Y'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    xprime_pareto<span class="main">:</span> <span class="quoted"><span class="quoted">"feasible <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equili_feasible pareto_optimal_def
      pareto_dominating_def neg_as <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> is_feasible<span class="main">:</span> <span class="quoted"><span class="quoted">"feasible <span class="skolem">X'</span> <span class="skolem">Y'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> xprime_leq_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span>
    <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="free">firms</span><span class="main">)</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> xprime_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">consumption_set</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> feasible_private_ownershipD as is_feasible <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> x_leq_xprime<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="skolem">X'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lns_pref<span class="main">:</span> <span class="quoted"><span class="quoted">"local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> as assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> xprime_ge_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_leq_xprime xprime_cons as assms utility_ge_price_ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="free">firms</span><span class="main">)</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="skolem">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xprime_ge_x <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>›</span></span> lns_pref assms x_equil_x_ext_budget <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> ex_greater_value <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> cpos <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      obt_witness <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">agents</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">(</span><span class="skolem">X'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="keyword1"><span class="free">U[</span></span><span class="skolem">i</span><span class="main"><span class="free">]</span></span> <span class="main">(</span><span class="free">𝒳</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_prefered_are_more_expensive assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cpos 
          feasible_private_ownershipD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inner_commute xprime_pareto<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> dom_g <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">&gt;</span> <span class="main">_</span> <span class="main">∙</span> <span class="var">?x_sum</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="free">𝒳</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> xprime_leq_y assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> ex_greater_value
          finite_nonepty_agents sum_strict_mono_ex1 x_equil_x_ext_budget<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="var">?x_sum</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_sum_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y_sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> equili_walras_law<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="var">?x_sum</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?ws</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒳</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="keyword1"><span class="free">Θ[</span></span><span class="bound">i</span><span class="main"><span class="free">,</span></span><span class="bound">j</span><span class="main"><span class="free">]</span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> x_equil_x_ext_budget<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_sum_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> remove_firm_pct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">Price</span> <span class="main">∙</span> <span class="var">?y_sum</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> equals_inner_price<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="var">?x_sum</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">ℰ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="var">?y_sum</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> diff_diff_add assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> walras_law_in_compeq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="var">?x_sum</span> <span class="main">=</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">ℰ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="var">?y_sum</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> equals_inner_price inner_diff_right right_minus_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equili_walras_law inner_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> xp_l_yp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> feasible_private_ownership_def is_feasible <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> yprime_sgr_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">f</span><span class="main">)</span> <span class="main">&gt;</span> <span class="var">?ws</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="skolem">X'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="keyword1"><span class="free">ℰ[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> xp_l_yp atLeastAtMost_iff inner_commute
          interval_inner_leI<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_imp_le order_refl assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ws</span> <span class="main">&lt;</span> <span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">agents</span><span class="main">.</span> <span class="free">ℰ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dom_g equili_walras_law <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_right_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> Y_is_optimum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">production_sets</span> <span class="bound">j</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms prof_max_ge_all_in_pset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> yprime_in_prod_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">production_sets</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> feasible_private_ownershipD xprime_pareto <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">production_sets</span> <span class="bound">j</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Y_is_optimum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> Y_ge_yprime<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">firms</span><span class="main">.</span> <span class="free">Price</span> <span class="main">∙</span> <span class="free">𝒴</span> <span class="bound">j</span> <span class="main">≥</span> <span class="free">Price</span> <span class="main">∙</span> <span class="skolem">Y'</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> yprime_in_prod_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> yprime_p_leq_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">∙</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">firms</span><span class="main">.</span> <span class="skolem">Y'</span> <span class="bound">f</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Price</span> <span class="main">∙</span> <span class="var">?y_sum</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_ge_yprime inner_sum_right sum_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> remove_firm_pct yprime_sgr_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Equilibrium cannot be Pareto dominated. ›</span></span>

<span class="keyword1" id="Arrow_Debreu_Model-equilibria_dom_eachother"><span class="command">lemma</span></span> equilibria_dom_eachother<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> local_nonsatiation <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> equil<span class="main">:</span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">Price</span> <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> competitive_equilibrium <span class="free">P</span> <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free">𝒳</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> equil first_welfare_theorem_priv_own assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">X'</span> <span class="bound">Y'</span><span class="main">.</span> feasible <span class="bound">X'</span> <span class="bound">Y'</span> <span class="main">∧</span> <span class="bound">X'</span> <span class="keyword1">≻Pareto</span> <span class="free">𝒳</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pareto_optimal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Using monotonicity instead of local non-satiation proves the First Welfare Theorem. ›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> first_welfare_thm_monotone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">&gt;</span> <span class="bound">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">carrier</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">agents</span> <span class="main">⟹</span> monotone_preference <span class="free">consumption_set</span> <span class="keyword1"><span class="free">Pr[</span></span><span class="bound">i</span><span class="main"><span class="free">]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Price</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"competitive_equilibrium <span class="free">Price</span> <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pareto_optimal <span class="free">𝒳</span> <span class="free">𝒴</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> arrow_debreu_consum_set_def assms cons_set_props first_welfare_theorem_priv_own unbounded_above_mono_imp_lns<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>