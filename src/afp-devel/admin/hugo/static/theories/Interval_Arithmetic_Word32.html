<div id="Interval_Word32">
<div class="head">
<h1>Theory Interval_Word32</h1>
</div>
<pre class="source"><span class="comment1">(* Author:     Brandon Bohrer *)</span>
<span class="keyword1"><span class="command">theory</span></span> Interval_Word32
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="../Word_Lib/Word_Lib_Sumo.html">Word_Lib.Word_Lib_Sumo</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">signed_real_of_word</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span><span class="main">::</span>len word <span class="main">⇒</span> real›</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">signed_real_of_word</span> <span class="main">≡</span> signed›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linordered_idom<span class="main">)</span> signed_less_numeral_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹signed <span class="free">w</span> <span class="main">&lt;</span> numeral <span class="free">n</span> <span class="main">⟷</span> sint <span class="free">w</span> <span class="main">&lt;</span> numeral <span class="free">n</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> of_int <span class="main">(</span>sint <span class="free">w</span><span class="main">)</span> <span class="main">&lt;</span> of_int <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted">less</span> <span class="quoted">less_eq</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linordered_idom<span class="main">)</span> signed_less_neg_numeral_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹signed <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span> numeral <span class="free">n</span> <span class="main">⟷</span> sint <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span> numeral <span class="free">n</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> of_int <span class="main">(</span>sint <span class="free">w</span><span class="main">)</span> <span class="main">&lt;</span> of_int <span class="main">(</span><span class="main">-</span> numeral <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted">less</span> <span class="quoted">less_eq</span> <span class="quoted">uminus</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linordered_idom<span class="main">)</span> numeral_less_signed_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹numeral <span class="free">n</span> <span class="main">&lt;</span> signed <span class="free">w</span> <span class="main">⟷</span> numeral <span class="free">n</span> <span class="main">&lt;</span> sint <span class="free">w</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> of_int <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> of_int <span class="main">(</span>sint <span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted">less</span> <span class="quoted">less_eq</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linordered_idom<span class="main">)</span> neg_numeral_less_signed_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">-</span> numeral <span class="free">n</span> <span class="main">&lt;</span> signed <span class="free">w</span> <span class="main">⟷</span> <span class="main">-</span> numeral <span class="free">n</span> <span class="main">&lt;</span> sint <span class="free">w</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> of_int <span class="main">(</span><span class="main">-</span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> of_int <span class="main">(</span>sint <span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted">less</span> <span class="quoted">less_eq</span> <span class="quoted">uminus</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> linordered_idom<span class="main">)</span> signed_nonnegative_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> signed <span class="free">w</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">≤</span> sint <span class="free">w</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> of_int <span class="main">0</span> <span class="main">≤</span> of_int <span class="main">(</span>sint <span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted">less_eq</span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-signed_real_of_word_plus_numeral_eq_signed_real_of_word_iff"><span class="command">lemma</span></span> signed_real_of_word_plus_numeral_eq_signed_real_of_word_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">v</span> <span class="main">+</span> numeral <span class="free">n</span> <span class="main">=</span> signed_real_of_word <span class="free">w</span>
    <span class="main">⟷</span> sint <span class="free">v</span> <span class="main">+</span> numeral <span class="free">n</span> <span class="main">=</span> sint <span class="free">w</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="main">(</span>sint <span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-signed_real_of_word_sum_less_eq_numeral_iff"><span class="command">lemma</span></span> signed_real_of_word_sum_less_eq_numeral_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">v</span> <span class="main">+</span> signed_real_of_word <span class="free">w</span> <span class="main">≤</span> numeral <span class="free">n</span>
    <span class="main">⟷</span> sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span> <span class="main">≤</span> numeral <span class="free">n</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-signed_real_of_word_sum_less_eq_neg_numeral_iff"><span class="command">lemma</span></span> signed_real_of_word_sum_less_eq_neg_numeral_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">v</span> <span class="main">+</span> signed_real_of_word <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span> numeral <span class="free">n</span>
    <span class="main">⟷</span> sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span> numeral <span class="free">n</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="main">-</span> numeral <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-signed_real_of_word_sum_less_numeral_iff"><span class="command">lemma</span></span> signed_real_of_word_sum_less_numeral_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">v</span> <span class="main">+</span> signed_real_of_word <span class="free">w</span> <span class="main">&lt;</span> numeral <span class="free">n</span>
    <span class="main">⟷</span> sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span> <span class="main">&lt;</span> numeral <span class="free">n</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span><span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-signed_real_of_word_sum_less_neg_numeral_iff"><span class="command">lemma</span></span> signed_real_of_word_sum_less_neg_numeral_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">v</span> <span class="main">+</span> signed_real_of_word <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span> numeral <span class="free">n</span>
    <span class="main">⟷</span> sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span> <span class="main">&lt;</span> <span class="main">-</span> numeral <span class="free">n</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span><span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span><span class="main">-</span> numeral <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-numeral_less_eq_signed_real_of_word_sum"><span class="command">lemma</span></span> numeral_less_eq_signed_real_of_word_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹numeral <span class="free">n</span> <span class="main">≤</span> signed_real_of_word <span class="free">v</span> <span class="main">+</span> signed_real_of_word <span class="free">w</span>
    <span class="main">⟷</span> numeral <span class="free">n</span> <span class="main">≤</span> sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-neg_numeral_less_eq_signed_real_of_word_sum"><span class="command">lemma</span></span> neg_numeral_less_eq_signed_real_of_word_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">-</span> numeral <span class="free">n</span> <span class="main">≤</span> signed_real_of_word <span class="free">v</span> <span class="main">+</span> signed_real_of_word <span class="free">w</span>
    <span class="main">⟷</span> <span class="main">-</span> numeral <span class="free">n</span> <span class="main">≤</span> sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span><span class="main">-</span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-numeral_less_signed_real_of_word_sum"><span class="command">lemma</span></span> numeral_less_signed_real_of_word_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹numeral <span class="free">n</span> <span class="main">&lt;</span> signed_real_of_word <span class="free">v</span> <span class="main">+</span> signed_real_of_word <span class="free">w</span>
    <span class="main">⟷</span> numeral <span class="free">n</span> <span class="main">&lt;</span> sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-neg_numeral_less_signed_real_of_word_sum"><span class="command">lemma</span></span> neg_numeral_less_signed_real_of_word_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">-</span> numeral <span class="free">n</span> <span class="main">&lt;</span> signed_real_of_word <span class="free">v</span> <span class="main">+</span> signed_real_of_word <span class="free">w</span>
    <span class="main">⟷</span> <span class="main">-</span> numeral <span class="free">n</span> <span class="main">&lt;</span> sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⟷</span> real_of_int <span class="main">(</span><span class="main">-</span> numeral <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span>sint <span class="free">v</span> <span class="main">+</span> sint <span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">…</span> <span class="main">⟷</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> real_of_word_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> signed_less_numeral_iff <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span>
  numeral_less_signed_iff <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span>
  signed_less_neg_numeral_iff <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span>
  neg_numeral_less_signed_iff <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span>
  signed_nonnegative_iff <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> more_real_of_word_simps <span class="main">=</span>
  signed_real_of_word_plus_numeral_eq_signed_real_of_word_iff
  signed_real_of_word_sum_less_eq_numeral_iff
  signed_real_of_word_sum_less_eq_neg_numeral_iff
  signed_real_of_word_sum_less_numeral_iff
  signed_real_of_word_sum_less_neg_numeral_iff
  numeral_less_eq_signed_real_of_word_sum
  neg_numeral_less_eq_signed_real_of_word_sum
  numeral_less_signed_real_of_word_sum
  neg_numeral_less_signed_real_of_word_sum

<span class="keyword1"><span class="command">declare</span></span> more_real_of_word_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interval-Word32.thy implements conservative interval arithmetic operators on 32-bit word 
   values, with explicit infinities for values outside the representable bounds. It is suitable 
   for use in interpreters for languages which  must have a well-understood low-level behavior
   (see Interpreter.thy). This work was originally part of the paper by Bohrer \emph{et al.}~\cite{BohrerTMMP18}.

   It is worth noting that this is not the first formalization of interval arithmetic in 
   Isabelle/HOL. This article is presented regardless because it has unique goals in mind
   which have led to unique design decisions. Our goal is generate code which can be used to 
   perform conservative arithmetic in implementations extracted from a proof.

   The Isabelle standard library now features interval arithmetic, for example in Approximation.thy.
   Ours differs in two ways:
   1) We use intervals with explicit positive and negative infinities, and with overflow checking.
      Such checking is often relevant in implementation-level code with unknown inputs.
      To promote memory-efficient implementations, we moreover use sentinel values for infinities,
      rather than datatype constructors. This is especially important in real-time settings where
      the garbarge collection required for datatypes can be a concern.
   2) Our goal is not to use interval arithmetic to discharge Isabelle goals, but to generate useful
      proven-correct implementation code, see Interpreter.thy. On the other hand,  we are not 
      concerned with producing interval-based automation for arithmetic goals in HOL.

   In practice, much of the work in this theory comes down to sheer case-analysis.
   Bounds-checking requires many edge cases in arithmetic functions, which come with many cases in
   proofs. Where possible, we attempt to offload interesting facts about word representations of 
   numbers into reusable lemmas, but even then main results require many subcases, each with 
   a certain amount of arithmetic grunt work.
›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Interval arithmetic definitions›</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Words are 32-bit›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> word <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> Word.word"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sentinel values for infinities. Note that we leave the maximum value ($2^31$) 
  completed unused, so that negation of $(2^{31})-1$ is not an edge case›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NEG_INF</span><span class="main">::</span><span class="quoted"><span class="quoted">"word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> NEG_INF_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">NEG_INF</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NegInf</span><span class="main">::</span><span class="quoted"><span class="quoted">"real"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> NegInf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">NegInf</span> <span class="main">=</span> real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">POS_INF</span><span class="main">::</span><span class="quoted"><span class="quoted">"word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> POS_INF_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">POS_INF</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PosInf</span><span class="main">::</span><span class="quoted"><span class="quoted">"real"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> PosInf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">PosInf</span> <span class="main">=</span> real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Subtype of words who represent a finite value. ›</span></span>
<span class="keyword1"><span class="command">typedef</span></span> bword <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">::</span>word<span class="main">.</span> sint <span class="bound">n</span> <span class="main">≥</span> sint NEG_INF <span class="main">∧</span> sint <span class="bound">n</span> <span class="main">≤</span> sint POS_INF<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">NEG_INF</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Numeric literals›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> lit <span class="main">=</span> <span class="quoted">bword</span>
      
<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_bword

<span class="keyword1"><span class="command">lift_definition</span></span> bword_zero<span class="main">::</span><span class="quoted"><span class="quoted">"bword"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> bword_one<span class="main">::</span><span class="quoted"><span class="quoted">"bword"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sint_uint<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> bword_neg_one<span class="main">::</span><span class="quoted"><span class="quoted">"bword"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">word</span><span class="main">::</span><span class="quoted"><span class="quoted">"word <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> word_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">word</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∈</span> <span class="main">{</span>NEG_INF<span class="main">..</span>POS_INF<span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">named_theorems</span></span> rep_simps <span class="quoted">"Simplifications for representation functions"</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions of interval containment and word representation
repe w r iff word w encodes real number r›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">repe</span> <span class="main">::</span><span class="quoted"><span class="quoted">"word <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  repPOS_INF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≥</span> real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span> <span class="main">⟹</span> <span class="free">repe</span> POS_INF <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span> 
<span class="main">|</span> repNEG_INF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≤</span> real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span> <span class="main">⟹</span> <span class="free">repe</span> NEG_INF <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> repINT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>sint <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">&lt;</span> real_of_int<span class="main">(</span>sint POS_INF<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sint <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">&gt;</span> real_of_int<span class="main">(</span>sint NEG_INF<span class="main">)</span> 
    <span class="main">⟹</span> <span class="free">repe</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span>sint <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span> 
    repePos_simps<span class="main">[</span><span class="operator">rep_simps</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"repe POS_INF <span class="free">r</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> repeNeg_simps<span class="main">[</span><span class="operator">rep_simps</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"repe NEG_INF <span class="free">r</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> repeInt_simps<span class="main">[</span><span class="operator">rep_simps</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"repe <span class="free">w</span> <span class="main">(</span>sint <span class="free">w</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹repU w r if w represents an upper bound of r›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">repU</span> <span class="main">::</span><span class="quoted"><span class="quoted">"word <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">repU</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">r'</span><span class="main">.</span> <span class="bound">r'</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> repe <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="bound">r'</span>"</span></span>

<span class="keyword1" id="Interval_Word32-repU_leq"><span class="command">lemma</span></span> repU_leq<span class="main">:</span><span class="quoted"><span class="quoted">"repU <span class="free">w</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟹</span> repU <span class="free">w</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repU_def
  <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹repU w r if w represents a lower bound of r›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">repL</span> <span class="main">::</span><span class="quoted"><span class="quoted">"word <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">repL</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">r'</span><span class="main">.</span> <span class="bound">r'</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> repe <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="bound">r'</span>"</span></span>

<span class="keyword1" id="Interval_Word32-repL_geq"><span class="command">lemma</span></span> repL_geq<span class="main">:</span><span class="quoted"><span class="quoted">"repL <span class="free">w</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">r'</span> <span class="main">≥</span> <span class="free">r</span> <span class="main">⟹</span> repL <span class="free">w</span> <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> repL_def
  <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹repP (l,u) r  iff l and u encode lower and upper bounds of r›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">repP</span> <span class="main">::</span><span class="quoted"><span class="quoted">"word <span class="main">*</span> word <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">repP</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">w1</span><span class="main">,</span> <span class="bound">w2</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">in</span> repL <span class="bound">w1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> repU <span class="bound">w2</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span> 


<span class="keyword1" id="Interval_Word32-int_not_posinf"><span class="command">lemma</span></span> int_not_posinf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>sint <span class="free">ra</span><span class="main">)</span> <span class="main">&lt;</span>  real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span> <span class="main">&lt;</span>  real_of_int <span class="main">(</span>sint <span class="free">ra</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ra</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b1 b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
<span class="keyword1" id="Interval_Word32-int_not_neginf"><span class="command">lemma</span></span> int_not_neginf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">" real_of_int <span class="main">(</span>sint <span class="free">ra</span><span class="main">)</span> <span class="main">&lt;</span>  real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">" real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span> <span class="main">&lt;</span>  real_of_int <span class="main">(</span>sint <span class="free">ra</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ra</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b1 b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-int_not_undef"><span class="command">lemma</span></span> int_not_undef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>sint <span class="free">ra</span><span class="main">)</span> <span class="main">&lt;</span>  real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span>sint <span class="free">ra</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ra</span> <span class="main">≠</span> NEG_INF<span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b1 b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-sint_range"><span class="command">lemma</span></span> sint_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>sint <span class="free">ra</span><span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span>sint <span class="free">ra</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">ra</span>  <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>  <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b1 b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-word_size_neg"><span class="command">lemma</span></span> word_size_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> Word.word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> size <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-uint_distinct"><span class="command">lemma</span></span> uint_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w1</span> <span class="free">w2</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> <span class="free">w2</span> <span class="main">⟹</span> uint <span class="free">w1</span> <span class="main">≠</span> uint <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminary lemmas›</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Case analysis lemmas›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Case analysis principle for pairs of intervals, used in proofs of arithmetic operations›</span></span>
<span class="keyword1" id="Interval_Word32-ivl_zero_case"><span class="command">lemma</span></span> ivl_zero_case<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l1</span> <span class="free">u1</span> <span class="free">l2</span> <span class="free">u2</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ivl1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l1</span> <span class="main">≤</span> <span class="free">u1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ivl2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l2</span> <span class="main">≤</span> <span class="free">u2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u1</span> <span class="main">∧</span> <span class="free">l2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u2</span><span class="main">)</span>
<span class="main">∨</span><span class="main">(</span><span class="free">l1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">l2</span><span class="main">)</span>
<span class="main">∨</span><span class="main">(</span><span class="free">l1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u1</span> <span class="main">∧</span> <span class="free">u2</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>
<span class="main">∨</span><span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="free">l1</span> <span class="main">∧</span> <span class="free">l2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u2</span><span class="main">)</span>
<span class="main">∨</span><span class="main">(</span><span class="free">u1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">l2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u2</span><span class="main">)</span>
<span class="main">∨</span><span class="main">(</span><span class="free">u1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">u2</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>
<span class="main">∨</span><span class="main">(</span><span class="free">u1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">l2</span><span class="main">)</span>
<span class="main">∨</span><span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="free">l1</span> <span class="main">∧</span> <span class="free">u2</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>
<span class="main">∨</span><span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="free">l1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">l2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ivl1 ivl2 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_cases<span class="main">)</span>

<span class="keyword1" id="Interval_Word32-case_ivl_zero"><span class="command">lemma</span></span> case_ivl_zero
<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> ZeroZero ZeroPos ZeroNeg PosZero NegZero NegNeg NegPos PosNeg PosPos<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l1</span> <span class="free">u1</span> <span class="free">l2</span> <span class="free">u2</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">l1</span> <span class="main">≤</span> <span class="free">u1</span> <span class="main">⟹</span>
   <span class="free">l2</span> <span class="main">≤</span> <span class="free">u2</span> <span class="main">⟹</span> 
<span class="main">(</span><span class="main">(</span><span class="free">l1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u1</span> <span class="main">∧</span> <span class="free">l2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">(</span><span class="free">l1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">l2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">(</span><span class="free">l1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u1</span> <span class="main">∧</span> <span class="free">u2</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="main">(</span><span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="free">l1</span> <span class="main">∧</span> <span class="free">l2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">(</span><span class="free">u1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">l2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">u2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">(</span><span class="free">u1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">u2</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">(</span><span class="free">u1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">l2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="free">l1</span> <span class="main">∧</span> <span class="free">u2</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="free">l1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">l2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ivl_zero_case<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l1</span></span> <span class="quoted"><span class="free">u1</span></span> <span class="quoted"><span class="free">l2</span></span> <span class="quoted"><span class="free">u2</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-case_inf2"><span class="command">lemma</span></span> case_inf2<span class="main">[</span><span class="operator">case_names</span> PosPos PosNeg PosNum NegPos NegNeg NegNum NumPos NumNeg NumNum<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span> <span class="bound">P</span><span class="main">.</span>
      <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Interval_Word32-case_pu_inf"><span class="command">lemma</span></span> case_pu_inf<span class="main">[</span><span class="operator">case_names</span> PosAny AnyPos NegNeg NegNum NumNeg NumNum<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span> <span class="bound">P</span><span class="main">.</span>
      <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Interval_Word32-case_pl_inf"><span class="command">lemma</span></span> case_pl_inf<span class="main">[</span><span class="operator">case_names</span> NegAny AnyNeg PosPos PosNum NumPos NumNum<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span> <span class="bound">P</span><span class="main">.</span>
      <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="bound">w1</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="bound">w2</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="bound">P</span> <span class="bound">w1</span> <span class="bound">w2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Interval_Word32-word_trichotomy"><span class="command">lemma</span></span> word_trichotomy<span class="main">[</span><span class="operator">case_names</span> Less Equal Greater<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w1</span> <span class="free">w2</span> <span class="main">::</span> <span class="quoted">word</span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="keyword1">&lt;s</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">w1</span> <span class="main">=</span> <span class="free">w2</span>  <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">w2</span> <span class="keyword1">&lt;s</span> <span class="free">w1</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> signed.linorder_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-case_times_inf"><span class="command">lemma</span></span> case_times_inf
 <span class="main">[</span><span class="operator">case_names</span> 
  PosPos NegPos PosNeg NegNeg 
  PosLo PosHi PosZero NegLo NegHi NegZero
  LoPos HiPos ZeroPos LoNeg HiNeg ZeroNeg
  AllFinite<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w1</span> <span class="free">w2</span> <span class="free">P</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> np<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">≠</span> NEG_INF <span class="main">∧</span> <span class="free">w2</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ph<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">≠</span> POS_INF <span class="main">∧</span> <span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free">w2</span>   <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pz<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">≠</span> NEG_INF <span class="main">∧</span> <span class="free">w2</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nh<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">≠</span> POS_INF <span class="main">∧</span> <span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> lp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">≠</span> NEG_INF <span class="main">∧</span> <span class="free">w1</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> hp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">≠</span> POS_INF <span class="main">∧</span> <span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free">w1</span> <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">=</span> <span class="free">w1</span> <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ln<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">≠</span> NEG_INF <span class="main">∧</span> <span class="free">w1</span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> hn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="main">≠</span> POS_INF <span class="main">∧</span> <span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free">w1</span> <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">=</span> <span class="free">w1</span> <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> allFinite<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF <span class="main">∧</span> <span class="free">w1</span> <span class="main">≠</span> POS_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">≠</span> NEG_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">P</span> <span class="free">w1</span> <span class="free">w2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> word_trichotomy<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Less <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w1l<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">&lt;s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> word_trichotomy<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Less
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> nn nl ln nz zn allFinite w1l lp pl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Equal 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> nn nl ln nz zn  w1l allFinite lp pz
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Greater
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span>  nh np zp lp w1l allFinite ln ph
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Equal <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w1z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> word_trichotomy<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Less
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> zn allFinite w1z nl pl zp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Equal
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> w1z allFinite
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Greater
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> allFinite zp w1z nh ph zn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Greater <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w1h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free">w1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> word_trichotomy<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">w2</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Less
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> pn pl hn  w1h allFinite hp nl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Equal
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> pz pz allFinite w1h hn hp nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Greater
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> pp ph hp w1h allFinite hn nh <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Trivial arithmetic lemmas›</span></span>

<span class="keyword1" id="Interval_Word32-max_diff_pos"><span class="command">lemma</span></span> max_diff_pos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="numeral">9223372034707292161</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-max_less"><span class="command">lemma</span></span> max_less<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">9223372039002259455</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-sints64"><span class="command">lemma</span></span> sints64<span class="main">:</span><span class="quoted"><span class="quoted">"sints <span class="numeral">64</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">63</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">63</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sints_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">64</span></span><span class="main">]</span> range_sbintrunc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">63</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Interval_Word32-sints32"><span class="command">lemma</span></span> sints32<span class="main">:</span><span class="quoted"><span class="quoted">"sints <span class="numeral">32</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sints_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">32</span></span><span class="main">]</span> range_sbintrunc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">31</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Interval_Word32-upcast_max"><span class="command">lemma</span></span> upcast_max<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast<span class="main">(</span><span class="numeral">0x80000001</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">=</span>sint<span class="main">(</span><span class="main">(</span><span class="numeral">0x80000001</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-upcast_min"><span class="command">lemma</span></span> upcast_min<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFFFFFF80000001</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-min_extend_neg"><span class="command">lemma</span></span> min_extend_neg<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-min_extend_val'"><span class="command">lemma</span></span> min_extend_val'<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-min_extend_val"><span class="command">lemma</span></span> min_extend_val<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="numeral">0xFFFFFFFF80000001</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Interval_Word32-range2s"><span class="command">lemma</span></span> range2s<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic operations›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This section defines operations which conservatively compute upper and lower bounds of 
 arithmetic functions given upper and lower bounds on their arguments. Each function comes with a 
 proof that it rounds in the advertised direction.
›</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Addition upper bound›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Upper bound of w1 + w2›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pu</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> 
<span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> POS_INF
 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> POS_INF
 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> NEG_INF 
   <span class="keyword1">else</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">in</span>
     <span class="keyword1">if</span> <span class="main">(</span><span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">then</span> NEG_INF
     <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span><span class="main">)</span>
 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">in</span>
   <span class="keyword1">if</span> <span class="main">(</span><span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">then</span> NEG_INF
   <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span>
 <span class="keyword1">else</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">in</span>
   <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">then</span> POS_INF
   <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">then</span> NEG_INF
   <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Interval_Word32-scast_down_range"><span class="command">lemma</span></span> scast_down_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>len Word.word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>len<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w</span> <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w</span><span class="main">)</span><span class="main">::</span><span class="tfree">'b</span> Word.word<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> word_sint.Abs_inverse <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Interval_Word32-pu_lemma"><span class="command">lemma</span></span> pu_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w1</span> <span class="free">w2</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> up1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> up2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"pu <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> scast_eq1<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w1</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> scast_eq2<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="numeral">0x80000001</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
  <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x80000001</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> scast_eq3<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w2Geq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≥</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> sints32 Word.word_size 
      scast_eq1 upcast_max scast_eq3 len32 mem_Collect_eq 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sint.Rep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main"><span class="main">]</span></span> sints32 
        scast_eq3 len32<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> sints32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2Less<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">9223372039002259455</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w2Range<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
     <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
   <span class="main">∧</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
     <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Word.word_size scast_eq1 upcast_max sints64 max_less<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> max_diff_pos max_less w2Less w2Geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w2case1a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
            <span class="main">=</span>  sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> w2Range<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> w1Lower<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≥</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> sints32 Word.word_size scast_eq1 scast_eq2 
      scast_eq3 len32 mem_Collect_eq 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w1Leq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sint.Rep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main"><span class="main">]</span></span> sints32 scast_eq1 len32<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> sints32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w1Less<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">9223372039002259455</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w1MinusBound<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
  <span class="main">∧</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
    <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
    Word.word_size<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span> 
    Word.word_size<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
    scast_eq3 scast_eq2 
    word_sint.Rep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
    word_sint.Rep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">0x80000001</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
    word_sint.Rep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
    word_sint.Rep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
    sints64 sints32<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> w1Lower w1Less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w1case1a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
             <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> w1MinusBound<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> w1case1a'<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> 
        <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> min_extend_val w1case1a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w1Leq'<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neg64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> 
            <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> arith<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>   
            geq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">≥</span><span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> equiv1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> geq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">≥</span><span class="free">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> equiv2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> up1 up2 <span class="keyword1"><span class="command">unfolding</span></span> repU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> case_pu_inf<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w1.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">w1</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">w2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> PosAny <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repe.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AnyPos
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegNeg
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">using</span></span> up1 up2 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegNum
  <span class="keyword3"><span class="command">assume</span></span> neq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> NEG_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span> <span class="main">+</span> scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span>
  <span class="keyword1"><span class="command">have</span></span> leq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> equiv1 neq1 eq2 neq3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> leq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv2 neq1 eq2 neq3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">⟹</span> NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> up1 up2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repe.simps word_sle_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> w2case1a
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq2 scast_eq3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r'
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">≤</span> <span class="skolem">r'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r'</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r2</span> <span class="main">≤</span> signed <span class="free">w2</span>›</span></span> <span class="quoted"><span class="quoted">‹sint <span class="free">w2</span> <span class="main">≤</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sint <span class="free">w2</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_le_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹signed <span class="free">w2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">≤</span> <span class="skolem">r'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r'</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r2</span> <span class="main">≤</span> signed <span class="free">w2</span>›</span></span> <span class="quoted"><span class="quoted">‹signed <span class="free">w2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
  <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF<span class="main">)</span> <span class="main">⟹</span> scast <span class="var">?sum</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repe.simps word_sle_def up1 up2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> sint <span class="main">(</span>scast <span class="free">w2</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> leq1 geq1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> leq2 geq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span> <span class="main">≤</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bound1 bound2
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">linarith</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_le<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> min_extend_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> case1a<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span>  sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> w2Range<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">&lt;</span> sint <span class="free">w2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sintw2_bound case1a min_extend_val' scast_eq3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sint <span class="free">w2</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> less_add_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> case1a scast_eq3 min_extend_val' word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> w2bound
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
                   <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>
                 <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> min_extend_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> 
            <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> min_extend_val case1a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">=</span> signed <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">64</span> <span class="main">→</span> <span class="numeral">32</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w2</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> a b min_extend_val' scast_eq3 leq2 case1a <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> range2a<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
      <span class="main">∧</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
        <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Word.word_size scast_eq1 upcast_max sints64 sints32 max_less<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> max_diff_pos max_less w2Geq w2Less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> case2a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
                <span class="main">=</span>  sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> range2a<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> neg64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> 
                <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> neg64 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">=</span> sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint<span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> case2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w2</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">&lt;</span> sint <span class="free">w2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sintw2_bound case2a min_extend_val' scast_eq3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sint <span class="free">w2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> less_add_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> case2a b min_extend_val'
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> w2bound
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
                  <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> downcast a b min_extend_val'
        <span class="keyword1"><span class="command">using</span></span> range2s<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w2</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> d<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> notLeq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gr<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> case2a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> w2Range<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> neg64
      <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> neg64 <span class="keyword1"><span class="command">using</span></span> notLeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">=</span> sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint<span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> case2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">0x7FFFFFFF</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">&lt;</span> sint <span class="free">w2</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sintw2_bound case2a c scast_eq3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sint <span class="free">w2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> less_add_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> case2a scast_eq3
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> w2bound
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
                   <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sintEq<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
          <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">using</span></span> downcast <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">&lt;</span> sint <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">64</span> <span class="main">→</span> <span class="numeral">32</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w2</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sintEq  
        <span class="keyword1"><span class="command">using</span></span> gr of_int_less_iff of_int_minus of_int_numeral <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> castEquiv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>scast <span class="var">?sum</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> up1 up2 case1 case2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> letRep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span> <span class="main">=</span> <span class="var">?sum</span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF <span class="keyword1">then</span> NEG_INF <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> case1 case2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pu <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> letRep eq2 neq1 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumNeg
  <span class="keyword3"><span class="command">assume</span></span> neq3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span> <span class="main">+</span> scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span>
  <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">⟹</span> NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> up1 up2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repe.simps word_sle_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> w1case1a min_extend_neg 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq1 eq2 neq3 repINT repU_def repe.simps repeInt_simps 
        up2 word_sless_alt<span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> repINT repU_def repe.simps repeInt_simps up2 word_sless_alt
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r'</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">‹signed <span class="free">w1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> signed <span class="free">w1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a2 a4 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a1 a3 h3 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> dual_order.trans of_int_le_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h1 h2 add.right_neutral add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> leq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> leq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> equiv1 equiv2 neq1 eq2 neq3 <span class="keyword1"><span class="command">unfolding</span></span> repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> case1a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
             <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> w1MinusBound<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF<span class="main">)</span> <span class="main">⟹</span> scast <span class="var">?sum</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repe.simps word_sle_def up1 up2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="comment1">(*r1 + r2*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> leq1 leq2 geq1 geq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leq1 leq2 <span class="main">)</span>
       <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> min_extend_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">&lt;</span> sint <span class="free">w1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> sintw2_bound case1a min_extend_val' scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sint <span class="free">w1</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> less_add_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> w1case1a 
         <span class="keyword1"><span class="command">using</span></span> w2bound word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> scast_eq1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>
                   <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
                 <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> min_extend_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹signed <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">64</span> <span class="main">→</span> <span class="numeral">32</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w1</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span>signed <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w1</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">(</span>real_of_int <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">)</span> <span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scast_eq1 leq2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> w1case1a'
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹signed <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w1</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">=</span>
        signed <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>signed <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">::</span> <span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span>  <span class="numeral">2147483647</span> 
        <span class="main">=</span> <span class="main">(</span>signed <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> neg64 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">&lt;</span> sint <span class="free">w1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sintw2_bound case1a min_extend_val' scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sint <span class="free">w1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> less_add_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> case1a scast_eq1 w1case1a'
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> w2bound
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
                   <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> downcast min_extend_val' w1case1a' scast_eq1 arith<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> w1Leq'<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> notLeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gr<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> neg64 <span class="keyword1"><span class="command">using</span></span> notLeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">&lt;</span> sint <span class="free">w1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sintw2_bound case1a min_extend_val' scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sint <span class="free">w1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> less_add_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> case1a scast_eq1 w1case1a'
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> w2bound
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> 
        <span class="main">&lt;</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span> gr of_int_less_iff of_int_minus of_int_numeral <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> letUp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span><span class="main">=</span><span class="var">?sum</span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF <span class="keyword1">then</span> NEG_INF <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span><span class="main">+</span><span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> case1 case2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> puSimp<span class="main">:</span><span class="quoted"><span class="quoted">"pu <span class="free">w1</span> <span class="free">w2</span><span class="main">=</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span> <span class="main">=</span> <span class="var">?sum</span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF <span class="keyword1">then</span> NEG_INF <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neq3 neq1 eq2 equiv1 leq2 repeInt_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pu <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>      
      <span class="keyword1"><span class="command">using</span></span> letUp puSimp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumNum
  <span class="keyword3"><span class="command">assume</span></span> notinf1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> notinf2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> notneginf1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> notneginf2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span> <span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> inf_case<span class="main">:</span><span class="quoted"><span class="quoted">"scast POS_INF <span class="keyword1">&lt;=s</span> <span class="var">?sum</span> <span class="main">⟹</span> POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> repU_def repePos_simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.strict_trans not_less order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> truth<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
     <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
   <span class="main">∧</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
     <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">]</span>
      Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">]</span>
    scast_eq1 scast_eq3
    word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span>
    word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span>
    word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">]</span>
    word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">]</span>
    sints64 sints32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> sint_eq<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> signed_arith_sint<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">,</span> <span class="operator">OF</span> truth<span class="main">]</span>
      scast_eq1 scast_eq3
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bigOne<span class="main">:</span><span class="quoted"><span class="quoted">"scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
    <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≥</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">.</span> <span class="bound">r'</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> sint_eq <span class="keyword1"><span class="command">unfolding</span></span> word_sle_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_leq<span class="main">:</span> <span class="quoted"><span class="quoted">‹real_of_int <span class="main">(</span>sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>›</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_le_iff<span class="main">)</span>
     <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
       bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
       bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≥</span> <span class="free">r2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> up1 up2 <span class="keyword1"><span class="command">unfolding</span></span> repU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> somethingA<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">≤</span>  sint <span class="free">w1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> somethingB<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>  <span class="main">≤</span>  sint <span class="free">w2</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span>›</span></span>  word_sle_def notinf1 notinf2 
         bound1 bound2 <span class="keyword1"><span class="command">unfolding</span></span> repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> something<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span>  sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> somethingA somethingB add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≥</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">.</span> <span class="bound">r'</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> bound1 bound2 add_mono something sum_leq 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">w1</span> <span class="main">+</span>
         signed_real_of_word <span class="free">w2</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> anImp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r'</span><span class="main">.</span>  <span class="main">(</span><span class="bound">r'</span><span class="main">≥</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span> <span class="main">∧</span> <span class="bound">r'</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
     <span class="main">∧</span> <span class="bound">r'</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> anEq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> bigTwo<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">¬</span><span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≥</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">.</span> <span class="bound">r'</span> <span class="main">=</span> 
      <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="bound">r'</span> <span class="main">&lt;</span>  <span class="numeral">0x7FFFFFFF</span> <span class="main">∧</span>  <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">r'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> interval_int<span class="main">:</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span> <span class="main">&lt;</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> word_sle_eq POS_INF_def NEG_INF_def <span class="keyword1"><span class="command">using</span></span> sint_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> interval<span class="main">:</span> <span class="quoted"><span class="quoted">‹real_of_int <span class="main">(</span>sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span><span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>›</span></span>
       <span class="quoted"><span class="quoted">‹real_of_int <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span> real_of_int <span class="main">(</span>sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span><span class="main">)</span>›</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_less_iff<span class="main">)</span>
     <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
       bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
       bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≥</span> <span class="free">r2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> up1 up2 <span class="keyword1"><span class="command">unfolding</span></span> repU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> somethingA<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">≤</span>  sint <span class="free">w1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> somethingB<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>  <span class="main">≤</span>  sint <span class="free">w2</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> word_sle_def notinf1 notinf2 bound1 bound2 <span class="keyword1"><span class="command">unfolding</span></span> repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> something<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span>  sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> somethingA somethingB add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bound1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
           r1w1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> w1U<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> w1L<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> repe.simps
       <span class="keyword1"><span class="command">using</span></span> notinf1 notinf2 notneginf1 notneginf2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bound2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
           r2w1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> w2U<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> w2L<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> repe.simps
       <span class="keyword1"><span class="command">using</span></span> notinf1 notinf2 notneginf1 notneginf2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
         <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> scast_down_range<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> sint_eq <span class="keyword1"><span class="command">using</span></span> sints32 interval_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cast_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
                      <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span> 
                    <span class="main">=</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> scast_down_range sints32 interval_int sint_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> something <span class="keyword2"><span class="keyword">and</span></span> cast_eq 
     <span class="keyword1"><span class="command">have</span></span> r12_sint_scast<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> 
       <span class="main">=</span> <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
         <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> r1w1 w1U w1L r2w1 w2U w2L <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
       <span class="keyword1"><span class="command">using</span></span> bound1 bound2 add_mono r12_sint_scast cast_eq interval 
       <span class="quoted"><span class="quoted">‹<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>scast <span class="main">(</span>scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> neg_inf_case<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span>NEG_INF<span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">⟹</span> NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> repU_def NEG_INF_def repe.simps<span class="main">)</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> anEq<span class="main">)</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> geq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r'</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r'</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bigOne <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≥</span>plus <span class="free">r1</span> <span class="free">r2</span><span class="main">.</span>
       <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="bound">r'</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">∧</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">r</span><span class="main">)</span> 
     <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span>  <span class="main">1</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="bound">r'</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≤</span> real_of_int <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="bound">w</span> 
        <span class="main">∧</span> <span class="bound">r'</span> <span class="main">=</span> real_of_int <span class="main">(</span>sint <span class="bound">w</span><span class="main">)</span>
        <span class="main">∧</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> 
        <span class="main">∧</span> less <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> leq anImp geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> int_case<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span> 
              <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
              <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>scast <span class="var">?sum</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
     <span class="keyword3"><span class="command">assume</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span>"</span></span>
     <span class="keyword3"><span class="command">assume</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
     <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'</span></span><span class="main">::</span><span class="quoted">real</span>  
       <span class="keyword2"><span class="keyword">where</span></span> rDef<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
                        <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> r12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span><span class="main">≥</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> boundU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">&lt;</span>  <span class="numeral">0x7FFFFFFF</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> boundL<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">r'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> bigTwo<span class="main">[</span><span class="operator">OF</span> bound1 bound2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span><span class="main">::</span><span class="quoted">word</span> 
     <span class="keyword2"><span class="keyword">where</span></span> wdef<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> wr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> r12 bound1 bound2 rDef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> repU_def repe.simps 
       <span class="keyword1"><span class="command">using</span></span> r12 wdef rDef boundU boundL wr  
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> almost<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">=</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">in</span> 
     <span class="keyword1">if</span> scast POS_INF <span class="keyword1">&lt;=s</span> <span class="bound">sum</span> <span class="keyword1">then</span> POS_INF 
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF <span class="keyword1">then</span> NEG_INF 
    <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span><span class="var">?sum</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> inf_case Let_def int_case neg_inf_case <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
     <span class="keyword1"><span class="command">using</span></span> inf_case Let_def int_case neg_inf_case 
     <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>scast POS_INF<span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span>"</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>scast <span class="free">w1</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> scast NEG_INF 
                <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>scast POS_INF<span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> 
                <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>scast <span class="free">w1</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> scast NEG_INF 
             <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">w</span> <span class="main">=</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">in</span> 
                <span class="keyword1">if</span> scast POS_INF <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="bound">w</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>  <span class="keyword1">then</span> POS_INF 
                <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">w</span> <span class="keyword1">&lt;=s</span> scast NEG_INF <span class="keyword1">then</span> NEG_INF 
                <span class="keyword1">else</span> scast <span class="bound">w</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> neg_inf_case <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">using</span></span> int_case <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> inf_case Let_def int_case neg_inf_case 
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
     <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>scast POS_INF<span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span>"</span></span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>scast <span class="free">w1</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> scast NEG_INF"</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>scast <span class="free">w1</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> scast NEG_INF 
         <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span>scast POS_INF<span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">w</span> <span class="main">=</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">in</span> 
         <span class="keyword1">if</span> scast POS_INF <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="bound">w</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">then</span> POS_INF 
         <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">w</span> <span class="keyword1">&lt;=s</span> scast NEG_INF <span class="keyword1">then</span> NEG_INF 
         <span class="keyword1">else</span> scast <span class="bound">w</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> a1 neg_inf_case <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> int_case <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> notinf1 notinf2 notneginf1 notneginf2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lower bound of w1 + w2›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pl</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> 
<span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> NEG_INF
 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> NEG_INF
 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> POS_INF 
   <span class="keyword1">else</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">in</span>
     <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span><span class="main">(</span><span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">then</span> POS_INF
     <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span><span class="main">)</span>
 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">in</span>
   <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span><span class="main">(</span><span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>  <span class="keyword1">then</span> POS_INF
   <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span>
 <span class="keyword1">else</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">in</span>
   <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">then</span> POS_INF
   <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">sum</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">then</span> NEG_INF
   <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Addition lower bound›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness of lower bound of w1 + w2›</span></span>
<span class="keyword1" id="Interval_Word32-pl_lemma"><span class="command">lemma</span></span> pl_lemma<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> lo1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> lo2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pl <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> scast_eq1<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w1</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> scast_eq2<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="numeral">0x80000001</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">=</span>sint<span class="main">(</span><span class="main">(</span><span class="numeral">0x80000001</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> scast_eq3<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> sints64<span class="main">:</span><span class="quoted"><span class="quoted">"sints <span class="numeral">64</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">63</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">63</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sints_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">64</span></span><span class="main">]</span> range_sbintrunc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">63</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> sints32<span class="main">:</span><span class="quoted"><span class="quoted">"sints <span class="numeral">32</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sints_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">32</span></span><span class="main">]</span> range_sbintrunc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">31</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> thing1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="numeral">9223372034707292161</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> sints32 mem_Collect_eq
    Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">]</span> scast_eq1 scast_eq2 scast_eq3 len32 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> thing4<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> scast_down_range sint_ge sints_num
    <span class="keyword1"><span class="command">using</span></span> scast_eq3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> aLeq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">9223372039002259455</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> thing2<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="numeral">9223372039002259455</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> thing4 aLeq2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_group_add_class.ab_left_minus add.commute add_mono neg_le_iff_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> aLeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">9223372039002259455</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bLeq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sint.Rep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main"><span class="main">]</span></span> sints32 
        scast_eq3 len32<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> sints32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> thing3<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≤</span> <span class="numeral">9223372034707292160</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> aLeq bLeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> truth<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
    <span class="main">∧</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
      <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
    Word.word_size<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span> 
    Word.word_size<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
    scast_eq1 scast_eq2 
    sints64 sints32 thing2 thing1 thing3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> case1a<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
             <span class="main">=</span>  sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> truth<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> case1b<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> arith<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> neg64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> 
            <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>   
            geq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">≤</span><span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> equiv1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> geq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">≤</span><span class="free">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> equiv2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> lo1 lo2 <span class="keyword1"><span class="command">unfolding</span></span> repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> case_pl_inf<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w1.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">w1</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">w2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> NegAny
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repL_def repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> lo1 lo2 linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AnyNeg
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repL_def repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosPos
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">using</span></span> lo1 lo2 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repL_def repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosNum
  <span class="keyword3"><span class="command">assume</span></span> neq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span> <span class="main">+</span> scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span>
  <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span> <span class="main">⟹</span> POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lo1 lo2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repL_def repe.simps word_sle_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> case1a case1b 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq1 eq2 neq3 repINT repL_def repe.simps 
      repeInt_simps lo2 word_sless_alt<span class="main">)</span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r'</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="free">w2</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> scast_eq3
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"signed <span class="free">w2</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a2 a4 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a1 a3 h3 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> of_int_le_0_iff le_add_same_cancel2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> of_int_0 of_int_le_iff order_trans signed_take_bit_nonnegative_iff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> h1 h2 h3 add.right_neutral add_mono  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> leq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≥</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> equiv1 neq1 eq2 neq3 
    <span class="keyword1"><span class="command">unfolding</span></span> repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> leq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv2 neq1 eq2 neq3
    <span class="keyword1"><span class="command">unfolding</span></span> repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
  <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>scast POS_INF <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span> <span class="main">⟹</span> scast <span class="var">?sum</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repL_def repe.simps word_sle_def lo1 lo2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="comment1">(*r1 + r2*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="main">(</span>scast <span class="free">w2</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> leq1 geq1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="free">r2</span> "</span></span>
          <span class="keyword1"><span class="command">using</span></span> leq2 geq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bound1 bound2
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
       <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">&gt;</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
       <span class="keyword1"><span class="command">have</span></span> case1a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span>  sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> truth<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">=</span> sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint<span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> case1a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="numeral">0x7FFFFFFF</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">+</span> <span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="numeral">0x7FFFFFFF</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> sintw2_bound case1a c1 scast_eq3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> add_less_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span>  <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> case1a scast_eq3 c1 
         <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> w2bound 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>
        <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>
                 <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>
            <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> case1a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leq2<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span>  <span class="numeral">2147483647</span> 
        <span class="main">=</span> <span class="main">(</span>signed <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a b c d scast_eq3 f leq2 of_int_numeral 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> truth2a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
        <span class="main">∧</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
          <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
            Word.word_size<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
            Word.word_size<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
            scast_eq1 scast_eq2 sints64 sints32 thing2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> thing1 thing2 thing3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> case2a<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> truth2a<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> min_cast<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">&gt;</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> neg64 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">=</span> sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint<span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> case2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="numeral">0x7FFFFFFF</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="numeral">0x7FFFFFFF</span> <span class="main">&gt;</span> sint <span class="free">w2</span> <span class="main">+</span> <span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sintw2_bound case2a c scast_eq3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span>  <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> case2a scast_eq3 c
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> sints32 len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> w2bound 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
        <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> downcast a scast_eq3 c
        <span class="keyword1"><span class="command">using</span></span> w2bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> notLeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gr<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="numeral">2147483647</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> case2a<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> truth<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> min_cast<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> neg64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> 
                <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> neg64 <span class="keyword1"><span class="command">using</span></span> notLeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">=</span> sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint<span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> case2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="numeral">0x7FFFFFFF</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">≠</span> <span class="free">w2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neq3 <span class="keyword1"><span class="command">unfolding</span></span> NEG_INF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">≠</span> sint <span class="free">w2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">≠</span> sint <span class="free">w2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483648</span> <span class="main">≠</span> <span class="free">w2</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repe.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> equiv2<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">-</span> <span class="numeral">2147483648</span><span class="main">::</span>word<span class="main">)</span> <span class="main">≠</span> sint <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> word_sint.Rep_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483648</span> <span class="main">≠</span> sint <span class="free">w2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> sints32 len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> neq3 n1 n2
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">&lt;</span> sint <span class="free">w2</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sintw2_bound case2a c scast_eq3 d <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span>  <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sints32 len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> w2bound word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> 
          c case2a scast_eq3 sintw2_bound
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>
                   <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sintEq<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">=</span>
          sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">using</span></span> downcast <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span>
          <span class="main">&lt;</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sintEq  
        <span class="keyword1"><span class="command">using</span></span> gr of_int_less_iff of_int_minus of_int_numeral c case2a scast_eq3 w2bound
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span> <span class="main">=</span> <span class="var">?sum</span> <span class="keyword1">in</span> <span class="keyword1">if</span> scast POS_INF <span class="keyword1">&lt;=s</span> <span class="bound">sum</span> <span class="keyword1">then</span> POS_INF <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> case1 case2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> lo1 lo2 neq1 eq2 neq3 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumPos
    <span class="keyword3"><span class="command">assume</span></span> neq3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> neq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span> <span class="main">+</span> scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span>
    <span class="keyword1"><span class="command">have</span></span> thing1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="numeral">9223372034707292161</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span> <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> scast_eq1 scast_eq2 scast_eq3
        Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">]</span> sints32 len32 mem_Collect_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> thing4<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> scast_down_range sint_ge sints_num scast_eq3 scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">have</span></span> aLeq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">9223372039002259455</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> thing2<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="numeral">9223372039002259455</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> thing4 aLeq2 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_group_add_class.ab_left_minus add.commute add_mono neg_le_iff_le<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> aLeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">9223372039002259455</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> bLeq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sint.Rep<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main"><span class="main">]</span></span> sints32 
          scast_eq1 len32<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> sints32
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">have</span></span> thing3<span class="main">:</span><span class="quoted"><span class="quoted">" sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≤</span> <span class="numeral">9223372034707292160</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> aLeq bLeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> truth<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>
                 <span class="main">∧</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
                   <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
      Word.word_size<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
      Word.word_size<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main"><span class="main">]</span></span>
      scast_eq3 scast_eq2 sints64 sints32 thing2 thing1 thing3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> case1a<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> signed_arith_sint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> truth<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> case1b<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="numeral">0x7FFFFFFF</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> 
          <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g case1a 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span><span class="quoted"><span class="quoted">"scast POS_INF <span class="keyword1">&lt;=s</span> <span class="var">?sum</span> <span class="main">⟹</span> POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lo1 lo2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repL_def repe.simps word_sle_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> case1a case1b 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq1 eq2 neq3 repINT repL_def 
            repe.simps repeInt_simps lo2 word_sless_alt<span class="main">)</span> <span class="comment1">(* close 4 goals *)</span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r'</span>
        <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> 
          <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> <span class="main">+</span> sint<span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> case1a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="numeral">2147483647</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> scast_eq1 h3 h4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"signed <span class="free">w1</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> a2 a4 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span>  <span class="numeral">2147483647</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> a3 h3 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">w1</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> h1 h2 add.right_neutral add_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> leq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≥</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> leq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> equiv1 equiv2 neq1 eq2 neq3 <span class="keyword1"><span class="command">unfolding</span></span> repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> neg64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0xFFFFFFFF80000001</span><span class="main">)</span> 
              <span class="main">=</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>scast POS_INF <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span> <span class="main">⟹</span> scast <span class="var">?sum</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repL_def repe.simps word_sle_def lo1 lo2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="main">(</span>scast <span class="free">w1</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span>  <span class="numeral">2147483647</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> leq1 geq2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> leq2 geq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound1 bound2
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leq1 leq2 <span class="main">)</span>
         <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">&gt;</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0x7FFFFFFF</span> <span class="main">&gt;</span> sint <span class="free">w1</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> sintw2_bound case1a d scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> sint <span class="free">w1</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> add_less_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> case1a e 
           <span class="keyword1"><span class="command">using</span></span> w2bound word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> arith<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
                     <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>
                   <span class="main">=</span> sint<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="numeral">2147483647</span>
          <span class="main">=</span> <span class="main">(</span><span class="main">(</span>signed_real_of_word <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a b c d e f 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">)</span> <span class="main">+</span> <span class="numeral">2147483647</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">=</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span>  <span class="main">(</span>real_of_int <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> e leq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> b c d of_int_numeral
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> neg64 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0x7FFFFFFF</span> <span class="main">&gt;</span> sint <span class="free">w1</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sintw2_bound case1a d scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> sint <span class="free">w1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> add_less_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> case1a e c 
          <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> w2bound
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sints32 len32<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> arith<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
          <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> downcast d e c arith<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> d2<span class="main">]</span> sintw2_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> notLeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2147483647</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">&gt;</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintw2_bound<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> neg64 <span class="keyword1"><span class="command">using</span></span> notLeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0x7FFFFFFF</span> <span class="main">&gt;</span> sint <span class="free">w1</span> <span class="main">+</span> <span class="main">(</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sintw2_bound case1a d scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> useful<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&gt;</span> sint <span class="free">w1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> add_less_same_cancel2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span>  <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> case1a e
          <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span>
            sints32 len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> useful
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">≠</span> <span class="free">w1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neq3 <span class="keyword1"><span class="command">unfolding</span></span> NEG_INF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">≠</span> sint <span class="free">w1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> word_sint.Rep_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">≠</span> sint <span class="free">w1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483648</span> <span class="main">≠</span> <span class="free">w1</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repe.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> equiv1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> int_not_undef<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">-</span> <span class="numeral">2147483648</span><span class="main">::</span>word<span class="main">)</span> <span class="main">≠</span> sint <span class="free">w1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> word_sint.Rep_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483648</span> <span class="main">≠</span> sint <span class="free">w1</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> 
            sints32 len32<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span>"</span></span><span class="main">]</span> n1 n2 neq3 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> d d2 <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">&lt;</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
          <span class="main">=</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> case1a rightSize scast_down_range scast_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">&lt;</span> sint <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">64</span> <span class="main">→</span> <span class="numeral">32</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w1</span> <span class="main">+</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d3 d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span> <span class="main">=</span> <span class="var">?sum</span> <span class="keyword1">in</span> <span class="keyword1">if</span> scast POS_INF <span class="keyword1">&lt;=s</span> <span class="bound">sum</span> <span class="keyword1">then</span> POS_INF <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> case1 case2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> neq1 eq2 neq3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumNum
  <span class="keyword3"><span class="command">assume</span></span> notinf1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> notinf2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> notneginf1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> notneginf2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span> <span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> truth<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
    <span class="main">∧</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
      <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>size <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">]</span> 
      Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">]</span>
      scast_eq1 scast_eq3 sints64 sints32
      word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span>
      word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> sint_eq<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> signed_arith_sint<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word"</span></span><span class="main">,</span> <span class="operator">OF</span> truth<span class="main">]</span>
      scast_eq1 scast_eq3
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bigOne<span class="main">:</span><span class="quoted"><span class="quoted">"scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
    <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≤</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">.</span> <span class="bound">r'</span> <span class="main">≤</span>  <span class="main">-</span><span class="numeral">0x7FFFFFFF</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_leq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> sum_leq'<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sint_eq <span class="keyword1"><span class="command">unfolding</span></span> word_sle_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
      bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lo1 lo2 <span class="keyword1"><span class="command">unfolding</span></span> repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> somethingA<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> sint <span class="free">w1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> somethingB<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> sint <span class="free">w2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> bound1 bound2 <span class="quoted"><span class="quoted">‹scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">-</span><span class="numeral">0x7FFFFFFF</span>›</span></span> word_sle_def notinf1 notinf2 
      <span class="keyword1"><span class="command">unfolding</span></span> repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> something<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span>  sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> somethingA somethingB add_mono 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≤</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">.</span> <span class="bound">r'</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> bound1 bound2 add_mono something sum_leq'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">w1</span> <span class="main">+</span> signed_real_of_word <span class="free">w2</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> anImp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r'</span><span class="main">.</span>  <span class="main">(</span><span class="bound">r'</span><span class="main">≥</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span> <span class="main">∧</span> <span class="bound">r'</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">r'</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">r</span> 
        <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> anEq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bigTwo<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">¬</span><span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≤</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">.</span> <span class="bound">r'</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>
                      <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span> <span class="main">(</span><span class="bound">r'</span> <span class="main">&lt;</span>  <span class="numeral">0x7FFFFFFF</span> <span class="main">∧</span>  <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">r'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_leq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span> <span class="main">&lt;</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> word_sle_eq <span class="keyword1"><span class="command">using</span></span> sint_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_leq'<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_geq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> word_sle_eq <span class="keyword1"><span class="command">using</span></span> sint_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_geq'<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
      bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> lo1 lo2 <span class="keyword1"><span class="command">unfolding</span></span> repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> somethingA<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">≤</span>  sint <span class="free">w1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> somethingB<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> sint <span class="free">w2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> word_sle_def notinf1 notinf2 bound1 bound2 <span class="keyword1"><span class="command">unfolding</span></span> repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> something<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span>  sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> somethingA somethingB add_mono 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bound1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
          r1w1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> w1U<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> w1L<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> repe.simps
      <span class="keyword1"><span class="command">using</span></span> notinf1 notinf2 notneginf1 notneginf2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bound2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
          r2w1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> w2U<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> w2L<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> repe.simps
      <span class="keyword1"><span class="command">using</span></span> notinf1 notinf2 notneginf1 notneginf2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
        <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> scast_down_range<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> sint_eq <span class="keyword1"><span class="command">using</span></span> sints32 sum_geq sum_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cast_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
        <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scast_down_range sints32 sum_geq sum_leq sint_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> something <span class="keyword2"><span class="keyword">and</span></span> cast_eq 
    <span class="keyword1"><span class="command">have</span></span> r12_sint_scast<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> 
      <span class="main">=</span> <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1w1 w1U w1L r2w1 w2U w2L 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> leq_ref<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">==&gt;</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> r12_sint_scast cast_eq leq_ref r2w1 r1w1 add_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quoted"><span class="free">r2</span></span><span class="main">]</span> bound1 bound2
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> bound1 bound2 add_mono r12_sint_scast cast_eq sum_leq sum_leq' sum_geq' sum_geq
      <span class="quoted"><span class="quoted">‹<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>scast <span class="main">(</span>scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> neg_inf_case<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span>NEG_INF<span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>  <span class="main">⟹</span> NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> repL_def NEG_INF_def repe.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> anEq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> geq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r'</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r'</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bigOne <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≤</span>plus <span class="free">r1</span>  <span class="free">r2</span><span class="main">.</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="bound">r'</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">∧</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">r</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span>  <span class="main">1</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="bound">r'</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="bound">w</span> <span class="main">∧</span>
           <span class="bound">r'</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> 
        <span class="main">∧</span> less <span class="main">(</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>uminus <span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leq geq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.strict_trans linorder_not_le order_less_irrefl<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> bigThree<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">0x7FFFFFFF</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
    <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≤</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">.</span> <span class="numeral">2147483647</span> <span class="main">≤</span> <span class="bound">r'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0x7FFFFFFF</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">0x7FFFFFFF</span> <span class="main">≤</span> sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span> "</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> sum_leq'<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="numeral">2147483647</span> <span class="main">≤</span>  <span class="main">(</span>sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sint_eq <span class="keyword1"><span class="command">unfolding</span></span> word_sle_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> 
      bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lo1 lo2 <span class="keyword1"><span class="command">unfolding</span></span> repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> somethingA<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>  <span class="main">≤</span>  sint <span class="free">w1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> somethingB<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>  <span class="main">≤</span>  sint <span class="free">w2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ <span class="numeral">0x7FFFFFFF</span> <span class="keyword1">&lt;=s</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> ›</span></span> word_sle_def notinf1 notinf2
        bound1 bound2 repe.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> something<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span>  sint <span class="free">w1</span> <span class="main">+</span> sint <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> somethingA somethingB add_mono of_int_add  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">r'</span></span><span class="main">≤</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">.</span>  <span class="main">(</span><span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">r'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> bound1 bound2 add_mono something sum_leq' order.trans
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bound2 notinf2 notneginf2 repe.cases<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bound1 notinf1 notneginf1 repe.cases<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 sum_leq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">+</span> <span class="free">r1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> add_left_mono add_right_mono bound1 bound2 order.trans<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span> <span class="main">∧</span>  <span class="numeral">2147483647</span> <span class="main">≤</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> inf_case<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span> <span class="main">⟹</span> POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
          <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
             <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span>  repL_def repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0x7FFFFFFF</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
             <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> geq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r'</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0x7FFFFFFF</span> <span class="main">≤</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bigThree <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> repL_def repe.simps <span class="keyword1"><span class="command">using</span></span> leq geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> int_case<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span><span class="main">)</span> 
    <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="var">?sum</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
    <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>scast <span class="var">?sum</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> scast <span class="free">w1</span> <span class="main">+</span> scast <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'</span></span><span class="main">::</span><span class="quoted">real</span>  
      <span class="keyword2"><span class="keyword">where</span></span> rDef<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> 
                     <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> r12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span><span class="main">≤</span><span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> boundU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">&lt;</span>  <span class="numeral">0x7FFFFFFF</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> boundL<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">-</span><span class="numeral">0x7FFFFFFF</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">r'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bigTwo<span class="main">[</span><span class="operator">OF</span> bound1 bound2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span><span class="main">::</span><span class="quoted">word</span> 
    <span class="keyword2"><span class="keyword">where</span></span> wdef<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> wr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r12 bound1 bound2 rDef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> repL_def repe.simps 
      <span class="keyword1"><span class="command">using</span></span> r12 wdef rDef boundU boundL wr  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">sum</span> <span class="main">=</span> <span class="var">?sum</span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> scast POS_INF <span class="keyword1">&lt;=s</span> <span class="bound">sum</span> <span class="keyword1">then</span> POS_INF 
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF <span class="keyword1">then</span> NEG_INF 
    <span class="keyword1">else</span> scast <span class="bound">sum</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">+</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?sum</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="keyword1">&lt;=s</span> scast NEG_INF"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> inf_case neg_inf_case int_case <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> notinf1 notinf2 notneginf1 notneginf2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Max function›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Maximum of w1 + w2 in 2s-complement›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wmax</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wmax</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="keyword1">&lt;s</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness of wmax›</span></span>
<span class="keyword1" id="Interval_Word32-wmax_lemma"><span class="command">lemma</span></span> wmax_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span>max <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> case_inf2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w1.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">w1</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">w2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> PosPos
  <span class="keyword1"><span class="command">from</span></span> PosPos eq1 eq2
  <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqInf<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> PosPos <span class="keyword1"><span class="command">unfolding</span></span> wmax.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> pos_eq<span class="main">:</span><span class="quoted"><span class="quoted">"POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repPOS_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> pos_eq eqInf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosNeg
  <span class="keyword1"><span class="command">from</span></span> PosNeg 
  <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq1 eq2 wmax.simps PosNeg word_sless_def word_sle_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repPOS_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosNum
  <span class="keyword1"><span class="command">from</span></span> PosNum eq1 eq2
  <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bound2a<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bound2b<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> PosNum bound2b 
    <span class="keyword1"><span class="command">unfolding</span></span> wmax.simps word_sless_def word_sle_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> repPOS_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2a bound2b word_sless_alt le_max_iff_disj 
    <span class="keyword1"><span class="command">unfolding</span></span> eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegPos
  <span class="keyword1"><span class="command">from</span></span> NegPos eq1 eq2
  <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> NegPos word_sless_def word_sle_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repPOS_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegNeg
  <span class="keyword1"><span class="command">from</span></span> NegNeg eq1 eq2
  <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repNEG_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 bound1 bound2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> NegNeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegNum
  <span class="keyword1"><span class="command">from</span></span> NegNum eq1 eq2
  <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"max <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> NegNum assms<span class="main">(</span>2<span class="main">)</span> bound2a eq3 repeInt_simps bound1 bound2a bound2b
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl max.bounded_iff max_def not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> extra_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>wmax <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> bound2a eq3 NegNum repeInt_simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmax <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repINT<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> extra_eq eq3 bound2a bound2b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq extra_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumPos
  <span class="keyword1"><span class="command">from</span></span> NumPos eq1 eq2
  <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="free">r2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound1a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound1b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> NumPos p2 eq1 eq2 assms<span class="main">(</span>1<span class="main">)</span> bound1b p2 repeInt_simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> res3<span class="main">:</span><span class="quoted"><span class="quoted">"POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> repPOS_INF NumPos bound2 le_max_iff_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> res1 res3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumNeg
  <span class="keyword1"><span class="command">from</span></span> NumNeg eq1 eq2
  <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound1a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound1b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"max <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmax <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bound1b bound2 NumNeg less_trans wmax.simps of_int_less_iff 
      word_sless_alt rw1 antisym_conv2 less_imp_le max_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> res2<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmax <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repINT<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1a bound1b bound2 NumNeg leD leI less_trans n2 wmax.simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> res1 res2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumNum
  <span class="keyword1"><span class="command">from</span></span> NumNum eq1 eq2
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound1a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound1b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"max <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmax <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 bound1a bound1b bound2a bound2b
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def word_sless_alt not_less<span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> res2<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmax <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> repINT<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1a bound1b bound2a bound2b
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹max <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmax <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> eq2 min_less_iff_disj<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> res1 res2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Interval_Word32-max_repU1"><span class="command">lemma</span></span> max_repU1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">x</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> wmax_lemma assms repU_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_max_iff_disj<span class="main">)</span>
  
<span class="keyword1" id="Interval_Word32-max_repU2"><span class="command">lemma</span></span> max_repU2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wmax <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wmax_lemma assms repU_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_max_iff_disj<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Product of w1 * w2 with bounds checking›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wtimes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wtimes</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> POS_INF
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> NEG_INF
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> NEG_INF
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> POS_INF
  
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="keyword1">then</span> NEG_INF 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">then</span> POS_INF 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="keyword1">then</span> POS_INF 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">then</span> NEG_INF 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> 
  
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> NEG_INF 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> POS_INF 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> <span class="main">0</span>
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="keyword1">&lt;s</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> POS_INF 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">0</span> <span class="keyword1">&lt;s</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> NEG_INF 
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> <span class="main">0</span> 
  
  <span class="keyword1">else</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">prod</span><span class="main">::</span><span class="numeral">64</span> Word.word <span class="main">=</span> <span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>scast <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
   <span class="keyword1">if</span> <span class="bound">prod</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span>scast NEG_INF<span class="main">)</span> <span class="keyword1">then</span> NEG_INF
   <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>scast POS_INF<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="bound">prod</span> <span class="keyword1">then</span> POS_INF
   <span class="keyword1">else</span> <span class="main">(</span>scast <span class="bound">prod</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication upper bound›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Product of 32-bit numbers fits in 64 bits›</span></span>
<span class="keyword1" id="Interval_Word32-times_upcast_lower"><span class="command">lemma</span></span> times_upcast_lower<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">2147483648</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">2147483648</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="numeral">2147483648</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="numeral">2147483648</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">4611686018427387904</span> <span class="main">≤</span>  <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">4611686018427387904</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> is_neg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">4611686018427387904</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a5 a6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_mult_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2147483648</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2147483648</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="numeral">2147483648</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 a5 a6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2147483648</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="numeral">2147483648</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 a5 a6 h2 
        <span class="keyword1"><span class="command">using</span></span> mult_left_mono_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h2 h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> case3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483648</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="numeral">2147483648</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2147483648</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 a5 a6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2147483648</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483648</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 a5 a6 h2 
        <span class="keyword1"><span class="command">using</span></span> mult_left_mono_neg mult_right_mono_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h2 h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> case4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a5 a6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_mult_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> case1 case2 case3 case4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Product of 32-bit numbers fits in 64 bits›</span></span>
<span class="keyword1" id="Interval_Word32-times_upcast_upper"><span class="command">lemma</span></span> times_upcast_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span><span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">2147483648</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">-</span><span class="numeral">2147483648</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="numeral">2147483648</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="numeral">2147483648</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="numeral">4611686018427387904</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="numeral">4611686018427387904</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483648</span> <span class="main">*</span> <span class="numeral">2147483648</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="numeral">2147483648</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 a5 a6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="numeral">2147483648</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 a5 a6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483648</span> <span class="main">*</span> <span class="numeral">2147483648</span> <span class="main">≥</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a5 a6 mult_nonneg_nonpos2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> case3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483648</span> <span class="main">*</span> <span class="numeral">2147483648</span> <span class="main">≥</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a5 a6 mult_nonneg_nonpos <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> case4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2147483648</span> <span class="main">*</span> <span class="main">-</span><span class="numeral">2147483648</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="numeral">2147483648</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 a5 a6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">-</span><span class="numeral">2147483648</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 a5 a6 mult_left_mono_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="numeral">4611686018427387904</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> case1 case2 case3 case4
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness of 32x32 bit multiplication›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Exact multiplication›</span></span>
<span class="keyword1" id="Interval_Word32-wtimes_exact"><span class="command">lemma</span></span> wtimes_exact<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">r1</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">r2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wtimes <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> POS_cast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint POS_INF"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> POS_sint<span class="main">:</span><span class="quoted"><span class="quoted">"sint POS_INF <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">-</span><span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w1_cast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> w2_cast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> NEG_cast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">=</span> sint NEG_INF"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word.sint_up_scast<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Word.is_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> rangew1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">..</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">}</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> sints32 len32 mem_Collect_eq POS_cast w1_cast 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> rangew2<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span><span class="main">..</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">}</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> word_sint.Rep<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">32</span> Word.word"</span></span><span class="main">]</span> sints32 len32 mem_Collect_eq POS_cast w2_cast 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> case_times_inf<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">w1</span></span> <span class="quoted"><span class="free">w2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> PosPos <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"PosInf <span class="main">≤</span> <span class="free">r1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  a2<span class="main">:</span> <span class="quoted"><span class="quoted">"PosInf <span class="main">≤</span> <span class="free">r2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosPos"</span> eq1 eq2 repe.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">e</span><span class="main">::</span>real<span class="main">.</span>  <span class="main">1</span> <span class="main">≤</span> max <span class="main">(</span> <span class="main">(</span>numeral <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">e</span><span class="main">::</span>real<span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> max <span class="main">(</span> <span class="main">(</span>numeral <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_max_iff_disj<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 <span class="quoted">"PosPos"</span> eq1 eq2 repe.simps
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"PosInf <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosPos"</span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegPos
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"NegPos"</span> <span class="keyword1"><span class="command">have</span></span> notPos<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> POS_INF_def NEG_INF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"NegInf <span class="main">≥</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq1 <span class="quoted">"NegPos"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"PosInf <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq2 <span class="quoted">"NegPos"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int Numeral1 <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="numeral">3</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 a2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f5 f4 mult_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 a2 fact <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps <span class="quoted">"NegPos"</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosNeg
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"PosInf <span class="main">≤</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq1 <span class="quoted">"PosNeg"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">" NegInf <span class="main">≥</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq2 <span class="quoted">"PosNeg"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>  NegInf <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="bound">ea</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="bound">e</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">ea</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ea</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span>  NegInf"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span>  NegInf"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 a1 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="bound">ea</span> <span class="bound">eb</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">ea</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="bound">eb</span> <span class="keyword1">then</span> <span class="bound">e</span> <span class="main">≤</span> <span class="bound">eb</span> <span class="keyword1">else</span> <span class="bound">e</span> <span class="main">≤</span> <span class="bound">ea</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">e</span> <span class="main">≤</span> <span class="bound">ea</span> <span class="main">∨</span> <span class="bound">e</span> <span class="main">≤</span> <span class="bound">eb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span>  <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f5 f4 f3 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> rule<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">r1</span> <span class="main">≥</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">-</span><span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> f5 mult_less_cancel_left_pos 
        mult_minus1_right neg_le_iff_le not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> NegInf"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosNeg"</span> f6 fact rule<span class="main">[</span><span class="operator">of</span> <span class="quoted">PosInf</span><span class="main">]</span> a1
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosNeg"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegNeg
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≥</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq1 <span class="quoted">"NegNeg"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max.bounded_iff max_def one_le_numeral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">-</span><span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≥</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq2 <span class="quoted">"NegNeg"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="bound">ea</span> <span class="bound">eb</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">e</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="bound">ea</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">eb</span> <span class="main">∨</span> <span class="bound">eb</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">≤</span> <span class="bound">eb</span> <span class="main">*</span> <span class="bound">ea</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>  <span class="main">1</span> <span class="main">=</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="bound">ea</span> <span class="bound">eb</span><span class="main">.</span> <span class="main">(</span><span class="bound">ea</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="bound">e</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">ea</span> <span class="main">≤</span> <span class="bound">eb</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">eb</span> <span class="main">≤</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_le_trans not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">≤</span>  <span class="main">(</span><span class="numeral">2147483647</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="numeral">2147483647</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">*</span> <span class="free">r1</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="numeral">2147483647</span> <span class="main">*</span> <span class="free">r1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_minus_left<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="numeral">2147483647</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="numeral">2147483647</span> <span class="main">=</span> <span class="main">-</span>  <span class="main">1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span>  <span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f8 f7 f5 f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>  <span class="numeral">2147483647</span> <span class="main">=</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="free">r2</span> <span class="main">*</span>  <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span>  <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span>  <span class="main">1</span> <span class="main">*</span> <span class="main">(</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">*</span>  <span class="main">1</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">*</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">*</span>  <span class="main">1</span><span class="main">)</span> <span class="main">=</span>  <span class="numeral">2147483647</span> <span class="main">*</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f12 f6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> mult_minus_left<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">1</span> <span class="main">*</span> <span class="free">r1</span> <span class="main">≤</span>  <span class="main">1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f5 f4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">-</span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span>  <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="free">r2</span> <span class="main">*</span>  <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 f11 h1 mult_left_mono_neg minus_mult_right mult_minus1_right neg_0_le_iff_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">*</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f11 f10 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_minus_left mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">*</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f9 f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 a2 h1 fact
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps <span class="quoted">"NegNeg"</span> mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosLo
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"PosLo"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="quoted">"PosLo"</span> 
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosLo"</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"PosLo"</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lower2 rw2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">r</span> <span class="main">&lt;</span> <span class="free">r1</span> <span class="main">*</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f4 less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f5 f4 upper lower2 rw2 mult_left_mono
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r1</span>›</span></span> dual_order.order_iff_strict f5 mult_left_mono rw2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> upper lower2  rw2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosLo"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosHi
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"PosHi"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="quoted">"PosHi"</span> 
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosHi"</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"PosHi"</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> upper <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rw2 lower2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span>  mult_left_mono mult.right_neutral of_int_1_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"PosInf <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> upper lower2 rw2 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span>›</span></span> mult_numeral_1_right numeral_One of_int_1_le_iff zero_le_one
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">using</span></span> mult_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2147483647</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="main">(</span><span class="free">w2</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosHi"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosZero
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"PosZero"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="quoted">"PosZero"</span>
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosZero"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>   
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"PosZero"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosZero"</span> rw2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"PosZero"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegHi
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"NegHi"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="quoted">"NegHi"</span> 
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">r1</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> low<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"NegHi"</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> low <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"NegHi"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upper<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"NegHi"</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> mylem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟹</span>  <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">≥</span> <span class="main">-</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> leD leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leD leI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">≥</span> <span class="main">-</span><span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a5 a4 h1 h2 h3 h6 h5 a5 dual_order.trans leD mult.right_neutral
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.order_iff_strict mult_less_cancel_left2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> prereqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> 
      <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span> "</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rw1 rw2 <span class="quoted">"NegHi"</span> lower2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper lower1 lower2 rw1 rw2 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> mylem<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">"<span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span><span class="main">]</span> prereqs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"NegHi"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegLo
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"NegLo"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="quoted">"NegLo"</span> 
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">r1</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> low<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"NegLo"</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def dual_order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"NegLo"</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upper<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"NegLo"</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hom<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2147483647</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> mylem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span>   <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="main">-</span><span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">≥</span> <span class="main">-</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> leD leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leD leI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">≥</span> <span class="main">-</span><span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  a1 a2 a3 a4 h1 h2 h5 dual_order.trans mult.right_neutral
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute neg_0_less_iff_less mult_le_cancel_iff1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 h1 h2 h3 h4 h5 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> prereqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="free">r1</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rw1 rw2 <span class="quoted">"NegLo"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹sint <span class="free">w2</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> low <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_int_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">w2</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> upper lower1 rw1 rw2
      mylem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2147483647</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"NegLo"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegZero
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"NegZero"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="quoted">"NegZero"</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"NegZero"</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"NegZero"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> LoPos
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"LoPos"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="quoted">"LoPos"</span> 
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"LoPos"</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"LoPos"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lower2 rw1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">*</span> <span class="free">r1</span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.order_iff_strict mult_right_mono f5  mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">*</span> <span class="free">r1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> f4 less_le_trans not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f5 f4 rw1 less_le_trans not_le mult.commute rw1 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> NegInf"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rw1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"LoPos"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> HiPos
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"HiPos"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="quoted">"HiPos"</span>
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"HiPos"</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def dual_order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"HiPos"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="free">r2</span> <span class="main">*</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lower2 rw2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> mult_left_mono mult.right_neutral of_int_1_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper lower2 rw2 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> mult_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">‹signed_real_of_word <span class="free">w1</span>›</span></span> <span class="quoted"><span class="numeral">2147483647</span></span> <span class="quoted"><span class="free">r2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"HiPos"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ZeroPos
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"ZeroPos"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="quoted">"ZeroPos"</span> 
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"ZeroPos"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>   
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"ZeroPos"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lower1 rw2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"ZeroPos"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> ZeroNeg
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"ZeroNeg"</span> 
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="quoted">"ZeroNeg"</span> 
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">r2</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"ZeroNeg"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>   
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps <span class="quoted">"ZeroNeg"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lower1 rw2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"ZeroNeg"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> LoNeg
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"LoNeg"</span>
  <span class="keyword1"><span class="command">have</span></span> w2NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="quoted">"LoNeg"</span> 
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">r2</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> low<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"LoNeg"</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> low <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹sint <span class="free">w1</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"LoNeg"</span> upper <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"LoNeg"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upper repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hom<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="numeral">2147483647</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> mylem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span>   <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="main">-</span><span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">≥</span> <span class="main">-</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> leD leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  leD leI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">≥</span> <span class="main">-</span><span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  a1 a2 a3 a4 h1 h2 h5 dual_order.trans mult_left_mono mult.right_neutral mult.commute
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.order_iff_strict mult_minus_right mult_zero_right neg_le_iff_le<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 h1 h2 h3 h4 h5 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> prereqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2147483647</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="free">r2</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rw1 rw2 <span class="quoted">"LoNeg"</span> lower2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def lower2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2147483647</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper lower1 lower2 rw1 rw2 mylem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2147483647</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> prereqs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>word_sless_def word_sle_def mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"LoNeg"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> HiNeg
  <span class="keyword1"><span class="command">from</span></span> HiNeg
  <span class="keyword1"><span class="command">have</span></span> w1NotPinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w1NotNinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="free">r2</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> HiNeg eq2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> low<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> HiNeg 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.order_iff_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> low <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹sint <span class="free">w1</span> <span class="main">≥</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps HiNeg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upper<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> repe.simps HiNeg  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> mylem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟹</span>  <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">real</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">≥</span> <span class="main">-</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  leD leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  leD leI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">≥</span> <span class="main">-</span><span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4 h1 h2 h3 h6 h5 a5 dual_order.trans less_eq_real_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_less_cancel_left1 not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> prereqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
               <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real <span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rw1 rw2 HiNeg lower2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2147483647</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> upper lower1 lower2 rw1 rw2 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_def word_sle_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> mylem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">-</span> <span class="numeral">2147483647</span><span class="main">)</span>"</span></span><span class="main">]</span> prereqs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> HiNeg <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> AllFinite
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?prod</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">consider</span></span> 
      <span class="main">(</span>ProdNeg<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="var">?prod</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span> 
    <span class="main">|</span> <span class="main">(</span>ProdPos<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?prod</span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>ProdFin<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?prod</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> 
              <span class="main">∧</span>  <span class="main">¬</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?prod</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> ProdNeg
    <span class="keyword1"><span class="command">have</span></span> bigLeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">4611686018427387904</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="numeral">9223372036854775807</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> set_cast<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">..</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>real_of_int <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">..</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
     sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word_Lemmas.signed_arith_sint<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> rangew1 rangew2 w1_cast w2_cast 
     <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span><span class="main">]</span> 
     <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span><span class="main">]</span>
     <span class="keyword1"><span class="command">using</span></span> times_upcast_upper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span>"</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w2</span>"</span></span><span class="main">]</span>
     <span class="keyword1"><span class="command">using</span></span> times_upcast_lower<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span>"</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w2</span>"</span></span><span class="main">]</span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?prod</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sint_leq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="var">?prod</span> <span class="main">≤</span> sint <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> word_sle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> neqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="quoted"><span class="quoted">" <span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AllFinite word_sless_def signed.not_less_iff_gr_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neqs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neqs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> AllFinite ProdNeg  w1_cast w2_cast rw1 rw2 sint_leq  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps eq3<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_le_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted">real</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ProdPos
    <span class="keyword1"><span class="command">have</span></span> bigLeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">4611686018427387904</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="numeral">9223372036854775807</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> set_cast<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">..</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>real_of_int <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">..</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word_Lemmas.signed_arith_sint<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> rangew1 rangew2 POS_cast POS_sint w1_cast w2_cast
      <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> times_upcast_upper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span>"</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> times_upcast_lower<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span>"</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w2</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> cast<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?prod</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sint_leq<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">≤</span> sint <span class="var">?prod</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> word_sle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> neqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="quoted"><span class="quoted">" <span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AllFinite word_sless_def signed.not_less_iff_gr_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> repe.simps AllFinite neqs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> repe.simps AllFinite neqs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> prodHi<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> PosInf"</span></span>
      <span class="keyword1"><span class="command">using</span></span> w1_cast w2_cast rw1 rw2 sint_leq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq3<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_le_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted">real</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> infs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> NEG_INF <span class="keyword1">&lt;s</span> <span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> POS_INF"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> casted<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> POS_INF <span class="keyword1">&lt;=s</span> <span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w1</span> <span class="main">*</span> <span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cast <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> almostContra<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> NEG_INF <span class="keyword1">&lt;s</span> <span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w1</span> <span class="main">*</span> <span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> infs cast  signed.order.strict_trans2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> contra<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w1</span> <span class="main">*</span> <span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> <span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="keyword1">SCAST</span><span class="main">(</span><span class="numeral">32</span> <span class="main">→</span> <span class="numeral">64</span><span class="main">)</span> NEG_INF<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq3 almostContra <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> wtimesCase<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neqs ProdPos almostContra wtimes.simps AllFinite ProdPos
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps Let_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> prodHi
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>      
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span><span class="main">*</span><span class="free">r2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wtimesCase<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> prodHi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ProdFin
    <span class="keyword1"><span class="command">have</span></span> bigLeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">4611686018427387904</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="numeral">9223372036854775807</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> set_cast<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">..</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span>real_of_int <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">..</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span><span class="quoted"><span class="quoted">"sint<span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> sint <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Word_Lemmas.signed_arith_sint<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> rangew1 rangew2 POS_cast POS_sint w1_cast w2_cast 
      <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> times_upcast_upper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span>"</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> times_upcast_lower<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sint <span class="free">w1</span>"</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">w2</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ProdFin <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?prod</span> <span class="keyword1">&lt;=s</span> <span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintGe<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="var">?prod</span><span class="main">)</span> <span class="main">&gt;</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast NEG_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> word_sle_def dual_order.order_iff_strict signed.linear 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> ProdFin <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="keyword1">&lt;=s</span> <span class="var">?prod</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sintLe<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast POS_INF<span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> sint <span class="main">(</span><span class="var">?prod</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> word_sle_def dual_order.order_iff_strict signed.linear 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> neqs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span> <span class="quoted"><span class="quoted">" <span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AllFinite word_sless_def signed.not_less_iff_gr_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> eq1 <span class="keyword1"><span class="command">have</span></span> rw1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neqs <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> eq2 <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neqs <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> rw1 rw2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span><span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> rightSize<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> sints <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sintLe sintGe sints32 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> downcast<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>
                 <span class="main">=</span> sint <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scast_down_range<span class="main">[</span><span class="operator">OF</span> rightSize<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> 
      <span class="main">=</span> real_of_int<span class="main">(</span>sint<span class="main">(</span><span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rw1 rw2 eq3 POS_cast POS_sint w1_cast w2_cast downcast 
        <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span> <span class="main">*</span> sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> res_up<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> 
               <span class="main">&lt;</span> sint POS_INF"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rw1 rw2 eq3 POS_cast POS_sint w1_cast w2_cast downcast
        <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span> <span class="main">*</span> sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹sint <span class="main">(</span>scast <span class="free">w1</span> <span class="main">*</span> scast <span class="free">w2</span><span class="main">)</span> <span class="main">&lt;</span> sint <span class="main">(</span>scast POS_INF<span class="main">)</span>›</span></span> 
          of_int_eq_iff res_eq 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> res_lo<span class="main">:</span><span class="quoted"><span class="quoted">"sint NEG_INF 
               <span class="main">&lt;</span> sint <span class="main">(</span>scast <span class="main">(</span><span class="main">(</span><span class="main">(</span>scast <span class="free">w1</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>scast <span class="free">w2</span><span class="main">)</span><span class="main">::</span><span class="numeral">64</span> Word.word<span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rw1 rw2 eq3 POS_cast POS_sint w1_cast w2_cast NEG_cast downcast
        <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span> <span class="main">*</span> sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹sint <span class="main">(</span>scast NEG_INF<span class="main">)</span> <span class="main">&lt;</span> sint <span class="main">(</span>scast <span class="free">w1</span> <span class="main">*</span> scast <span class="free">w2</span><span class="main">)</span>›</span></span> 
        of_int_eq_iff res_eq 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scast <span class="var">?prod</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> res_eq res_up res_lo 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> repeInt_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> AllFinite ProdFin <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication upper bound›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Upper bound of multiplication from upper and lower bounds›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> word <span class="main">⇒</span> word <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tu</span> <span class="free"><span class="bound"><span class="entity">w1l</span></span></span> <span class="free"><span class="bound"><span class="entity">w1u</span></span></span> <span class="free"><span class="bound"><span class="entity">w2l</span></span></span> <span class="free"><span class="bound"><span class="entity">w2u</span></span></span> <span class="main">=</span> 
 wmax <span class="main">(</span>wmax <span class="main">(</span>wtimes <span class="free"><span class="bound"><span class="entity">w1l</span></span></span> <span class="free"><span class="bound"><span class="entity">w2l</span></span></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free"><span class="bound"><span class="entity">w1u</span></span></span> <span class="free"><span class="bound"><span class="entity">w2l</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>wmax <span class="main">(</span>wtimes <span class="free"><span class="bound"><span class="entity">w1l</span></span></span> <span class="free"><span class="bound"><span class="entity">w2u</span></span></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free"><span class="bound"><span class="entity">w1u</span></span></span> <span class="free"><span class="bound"><span class="entity">w2u</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Interval_Word32-tu_lemma"><span class="command">lemma</span></span> tu_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> u1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> u2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tu <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rl1</span></span> <span class="skolem"><span class="skolem">rl2</span></span> <span class="skolem"><span class="skolem">ru1</span></span> <span class="skolem"><span class="skolem">ru2</span></span> <span class="main">::</span> <span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">where</span></span> gru1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≥</span> <span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gru2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> grl1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> grl2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> eru1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ru1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eru2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ru2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> erl1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">rl1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> erl2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">rl2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> u1 u2 l1 l2 <span class="keyword1"><span class="command">unfolding</span></span> repU_def repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> timesuu<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtimes_exact<span class="main">[</span><span class="operator">OF</span> eru1 eru2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> timesul<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtimes_exact<span class="main">[</span><span class="operator">OF</span> eru1 erl2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> timeslu<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtimes_exact<span class="main">[</span><span class="operator">OF</span> erl1 eru2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> timesll<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtimes_exact<span class="main">[</span><span class="operator">OF</span> erl1 erl2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> maxt12<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span>  wmax_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> timesll timesul<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> maxt34<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span>  wmax_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> timeslu timesuu<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bigMax<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="main">(</span>wmax <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>wmax <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="main">(</span>max <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>max <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wmax_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> maxt12 maxt34<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">maxt12val</span></span> <span class="main">::</span> <span class="quoted">real</span> 
    <span class="keyword2"><span class="keyword">where</span></span> maxU12<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> max <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> maxt12 <span class="keyword1"><span class="command">unfolding</span></span> repU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">maxt34val</span></span> <span class="main">::</span> <span class="quoted">real</span> 
    <span class="keyword2"><span class="keyword">where</span></span> maxU34<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> max <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> maxt34 <span class="keyword1"><span class="command">unfolding</span></span> repU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> bigMaxU<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="main">(</span>wmax <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>wmax <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> max <span class="main">(</span>max <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>max <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigMax <span class="keyword1"><span class="command">unfolding</span></span> repU_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ivl1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="skolem">ru1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> grl1 gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ivl2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="skolem">ru2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> grl2 gru2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tu <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> ivl1 ivl2
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> case_ivl_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> ZeroZero
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> geq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> geq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tu <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> geq1 geq2 grl2 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> geq1 geq2 grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up eru1 eru2 erl1 erl2 repU_def timesuu tu.simps
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wmax.elims<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> geq1 geq2 grl2 gru2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span>
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.coboundedI1 max.commute maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  repU_def  tu.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span> geq1 geq2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> repU_def tu.simps timesuu
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max.coboundedI1 max.commute maxt34<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span> geq1 geq2 grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>›</span></span> less_eq_real_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_mono_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span> geq1 geq2 grl1 grl2 gru1 gru2 <span class="quoted"><span class="quoted">‹<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>›</span></span>  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_mono_neg mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.commute maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_repU1 repU_def timesll tu.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ZeroPos
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">assume</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span> mult_left_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span> mult_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.coboundedI1 max.commute maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repU_def tu.simps<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword3"><span class="command">assume</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span> mult_left_mono 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_less_0_iff less_le_trans not_less<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span> mult_right_mono 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.coboundedI1 max.commute maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repU_def tu.simps<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ZeroNeg
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 mult_less_0_iff less_le_trans not_less
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span> mult_right_mono 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.commute maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_repU2 max_repU1 repU_def timesll tu.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds  grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_mono_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 mult.commute
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_mono_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.commute maxt34 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_repU1 repU_def timesll tu.simps<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tu <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> case1 case2 le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PosZero
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span> mult_left_mono 
        <span class="keyword1"><span class="command">using</span></span> leD leI less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span> mult_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.coboundedI1 max.commute maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repU_def tu.simps<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> r1 bounds grl2 gru2 gru1 leD leI less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"2"</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
        <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
            max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.coboundedI1 max.commute maxt34
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repU_def tu.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> NegZero
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"1"</span> bounds grl1 grl2 gru1 gru2 mult_less_0_iff not_less
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"1"</span> bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.commute maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_repU1 repU_def timesul tu.simps<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">have</span></span> lower<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"2"</span> bounds grl1 grl2 gru1 gru2 less_eq<span class="main">(</span>1<span class="main">)</span> less_le_trans not_less 
          mult_le_cancel_left
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"2"</span> bounds grl1 grl2 gru1 gru2 mult.commute not_le lower mult_le_cancel_left
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
          max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.commute maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_repU1 repU_def timesll tu.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> NegNeg
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl2 r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds  grl1 grl2 gru1 gru2 less_eq<span class="main">(</span>1<span class="main">)</span>  mult_le_cancel_left less_le_trans not_less
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 mult.commute not_le lower1 lower2 mult_le_cancel_left
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
    <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max_repU2 max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> 
        max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max.commute maxt34 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_repU1 repU_def timesll tu.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> NegPos
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> upper1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> upper2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru2 r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 not_less upper1 lower2 mult_le_cancel_left
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 upper1 r2 mult_right_mono gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
    <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims maxt34
        max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_repU1 repU_def timesul tu.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PosNeg
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">∧</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans grl2 r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> upper1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans gru1 u1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">have</span></span> upper2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 not_less upper2 lower1 mult_le_cancel_left 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 lower1 r2 not_less gru2 gru1 grl1 grl2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_le_cancel_left mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
    <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tu <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max.coboundedI1 max.commute maxt34
        max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repU_def tu.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PosPos
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> upper1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans gru1 u1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">have</span></span> upper2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans gru2 u2 r2 bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 mult_left_mono leD leI less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 mult_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
    <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims max.coboundedI1 max.commute maxt34
        max_repU2<span class="main">[</span><span class="operator">OF</span> bigMaxU<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> maxU12<span class="main">]</span> max_repU2<span class="main">[</span><span class="operator">OF</span> maxU34<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repU_def tu.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Minimum function›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Minimum of 2s-complement words›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wmin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wmin</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="keyword1">&lt;s</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span>"</span></span>
                                            
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness of wmin›</span></span>
<span class="keyword1" id="Interval_Word32-wmin_lemma"><span class="command">lemma</span></span> wmin_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span>min <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> case_inf2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w1.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">w1</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">w2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> PosPos
  <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> POS_INF"</span></span>   
     <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqInf<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 p2 <span class="keyword1"><span class="command">unfolding</span></span> wmin.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> pos_eq<span class="main">:</span><span class="quoted"><span class="quoted">"POS_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repPOS_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2 <span class="keyword1"><span class="command">unfolding</span></span> eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> pos_eq eqInf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosNeg
  <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> n2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">ra</span></span> <span class="main">::</span> <span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">where</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="skolem">ra</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 n2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq1 eq2 wmin.simps p1 n2 word_sless_def word_sle_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repNEG_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PosNum
  <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> np2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nn2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound2a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound2b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 np2 nn2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span> sint <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bound1 bound2b dual_order.trans eq2 min_def not_less<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmin <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> repINT<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2a bound2b bound2b p1 <span class="keyword1"><span class="command">unfolding</span></span> eq1 eq2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bound2b less_eq_real_def not_less of_int_less_iff p1 wmin.simps word_sless_alt<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegPos
  <span class="keyword3"><span class="command">assume</span></span> n1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> NEG_INF"</span></span>   
  <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
  <span class="keyword1"><span class="command">have</span></span>  bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n1 p2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq1 eq2 wmin.simps n1 p2 word_sless_def word_sle_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repNEG_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2 <span class="keyword1"><span class="command">unfolding</span></span> eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegNeg
  <span class="keyword3"><span class="command">assume</span></span> n1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> NEG_INF"</span></span>                 
  <span class="keyword3"><span class="command">assume</span></span> n2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n1 n2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repNEG_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 bound1 bound2 <span class="keyword1"><span class="command">unfolding</span></span> NEG_INF_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n1 n2 <span class="keyword1"><span class="command">unfolding</span></span> NEG_INF_def wmin.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NegNum
  <span class="keyword3"><span class="command">assume</span></span> n1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">=</span> NEG_INF"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>  nn2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  np2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound2a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound2b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n1 nn2 np2 eq2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> eqNeg<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n1 assms<span class="main">(</span>2<span class="main">)</span> bound2a eq2 n1 repeInt_simps  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neg_eq<span class="main">:</span><span class="quoted"><span class="quoted">"NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repNEG_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1 bound2a bound2b eq1 min_le_iff_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eqNeg neg_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumPos
  <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> POS_INF"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>  nn1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>  np1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound1a<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound1b<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nn1 np1 p2 eq2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> <span class="free">w1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p2 eq1 eq2  assms<span class="main">(</span>1<span class="main">)</span> bound1b p2 repeInt_simps  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_sless_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> res2<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 bound1a bound1b bound2 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_le less_le_trans min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> res3<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmin <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repINT<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> p2 bound1a res1 bound1a bound1b bound2 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> res1 res2 res3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumNeg
  <span class="keyword3"><span class="command">assume</span></span> nn1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> np1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> n2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound1a<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound1b<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nn1 np1 n2 eq2 eq1 eq2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n2 bound1b
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min.absorb_iff2 min_def n2 not_less of_int_less_iff wmin.simps word_sless_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> res2<span class="main">:</span><span class="quoted"><span class="quoted">"NEG_INF <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repNEG_INF<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 bound1a bound1b bound2 min_le_iff_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> res1 res2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> NumNum
  <span class="keyword3"><span class="command">assume</span></span> np1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nn1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> np2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nn2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  bound1a<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  bound1b<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  bound2a<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  bound2b<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nn1 np1 nn2 np2 eq2 eq1 eq2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">rep_simps</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmin <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 bound1a bound1b bound2a bound2b 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def word_sless_alt not_less<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> res2<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmin <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> repINT<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bound1a bound1b bound2a bound2b
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹min <span class="free">r1</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wmin <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> eq2 min_less_iff_disj<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="free">r1</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> res1 res2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>    
    
<span class="keyword1" id="Interval_Word32-min_repU1"><span class="command">lemma</span></span> min_repU1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> wmin_lemma assms repL_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> min_le_iff_disj<span class="main">)</span>

<span class="keyword1" id="Interval_Word32-min_repU2"><span class="command">lemma</span></span> min_repU2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wmin <span class="free">w1</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wmin_lemma assms repL_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> min_le_iff_disj<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication lower bound›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Multiplication lower bound›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> word <span class="main">⇒</span> word <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tl</span> <span class="free"><span class="bound"><span class="entity">w1l</span></span></span> <span class="free"><span class="bound"><span class="entity">w1u</span></span></span> <span class="free"><span class="bound"><span class="entity">w2l</span></span></span> <span class="free"><span class="bound"><span class="entity">w2u</span></span></span> <span class="main">=</span>
  wmin <span class="main">(</span>wmin <span class="main">(</span>wtimes <span class="free"><span class="bound"><span class="entity">w1l</span></span></span> <span class="free"><span class="bound"><span class="entity">w2l</span></span></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free"><span class="bound"><span class="entity">w1u</span></span></span> <span class="free"><span class="bound"><span class="entity">w2l</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span>wmin <span class="main">(</span>wtimes <span class="free"><span class="bound"><span class="entity">w1l</span></span></span> <span class="free"><span class="bound"><span class="entity">w2u</span></span></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free"><span class="bound"><span class="entity">w1u</span></span></span> <span class="free"><span class="bound"><span class="entity">w2u</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness of multiplication lower bound›</span></span>
<span class="keyword1" id="Interval_Word32-tl_lemma"><span class="command">lemma</span></span> tl_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> u1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> u2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rl1</span></span> <span class="skolem"><span class="skolem">rl2</span></span> <span class="skolem"><span class="skolem">ru1</span></span> <span class="skolem"><span class="skolem">ru2</span></span> <span class="main">::</span> <span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">where</span></span> gru1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≥</span> <span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gru2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="free">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> grl1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> grl2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> eru1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ru1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eru2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ru2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> erl1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">rl1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> erl2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">rl2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> u1 u2 l1 l2 <span class="keyword1"><span class="command">unfolding</span></span> repU_def repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> timesuu<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtimes_exact<span class="main">[</span><span class="operator">OF</span> eru1 eru2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> timesul<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtimes_exact<span class="main">[</span><span class="operator">OF</span> eru1 erl2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> timeslu<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtimes_exact<span class="main">[</span><span class="operator">OF</span> erl1 eru2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> timesll<span class="main">:</span><span class="quoted"><span class="quoted">"wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wtimes_exact<span class="main">[</span><span class="operator">OF</span> erl1 erl2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> maxt12<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span>  wmin_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> timesll timesul<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> maxt34<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span>  wmin_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> timeslu timesuu<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bigMax<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="main">(</span>wmin <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>wmin <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> min <span class="main">(</span>min<span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wmin_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> maxt12 maxt34<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">maxt12val</span></span> <span class="main">::</span> <span class="quoted">real</span> 
    <span class="keyword2"><span class="keyword">where</span></span> maxU12<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> min <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> maxt12 <span class="keyword1"><span class="command">unfolding</span></span> repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">maxt34val</span></span> <span class="main">::</span> <span class="quoted">real</span> 
    <span class="keyword2"><span class="keyword">where</span></span> maxU34<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> min <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> maxt34 <span class="keyword1"><span class="command">unfolding</span></span> repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> bigMaxU<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="main">(</span>wmin <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>wmin <span class="main">(</span>wtimes <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span>wtimes <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> min <span class="main">(</span>min <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min <span class="main">(</span><span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigMax <span class="keyword1"><span class="command">unfolding</span></span> repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ivl1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="skolem">ru1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> grl1 gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ivl2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="skolem">ru2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> grl2 gru2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tl <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> ivl1 ivl2
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> case_ivl_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> ZeroZero        
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> geq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> geq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> geq3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> geq4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> geq1 geq2 geq3 geq4 grl2 gru2 mult_le_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span>  <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span>  geq1 geq2 grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up eru1 eru2 erl1 erl2 min_repU1 min_repU2 
          repL_def repU_def timeslu tl.simps wmin.elims
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bigMax min_le_iff_disj<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> geq1 geq2 grl2 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_le_cancel_left  geq3 leD<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> geq1 geq2 grl2 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_mono grl1<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> up maxU12 min_repU2 repL_def tl.simps min.coboundedI1 maxt34<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span> geq1 geq2 grl2 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span> geq1 geq2 grl1 grl2 gru1 gru2 mult_minus_right mult_right_mono
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_mono_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmin.elims min_repU2 min_repU1 maxt34 timesul
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def tl.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span> geq1 geq2 grl1 grl2 gru1 gru2 <span class="quoted"><span class="quoted">‹<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>›</span></span> 
          mult_less_0_iff  less_eq_real_def not_less
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span> geq1 geq2 grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_less_0_iff  not_less<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> up maxU12 maxU34 wmin.elims min_repU1 min_repU2 repL_def timesul tl.simps<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ZeroPos
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> r2 bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> r2 bounds grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def timesll tl.simps up maxU12 maxU34 wmin.elims min_repU2 min_repU1<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> r2 bounds grl1 grl2 gru1 gru2 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> r2 bounds grl1 grl2 gru1 gru2 mult_le_cancel_left
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> r2 bounds grl1 grl2 gru1 gru2 mult_le_0_iff mult_le_cancel_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> up maxU12 wmin.elims min_repU2 min.coboundedI1 maxt34 repL_def tl.simps<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ZeroNeg
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">∧</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>Pos<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>Neg<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Pos
      <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Pos r2 bounds grl1 grl2 gru1 gru2 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Pos bounds grl1 grl2 gru1 gru2 mult_le_cancel_left
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">::</span>real<span class="main">.</span>  <span class="main">(</span><span class="main">-</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">-</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">b</span> <span class="main">≤</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Pos r2 bounds grl1 grl2 gru1 gru2 p1 p2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_mono_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> up maxU12 maxU34 wmin.elims min_repU2 min_repU1 repL_def timesul tl.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Neg
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Neg r2 bounds  grl1 grl2 gru1 gru2 mult_le_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Neg r2 zero_le_mult_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmin.elims min_repU2 min_repU1 
        min.coboundedI1 min.commute maxt34 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def tl.simps<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PosZero
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r1 bounds grl1 grl2 gru1 gru2 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"1"</span> bounds grl1 grl2 gru1 gru2 mult_le_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"1"</span> bounds grl1 grl2 gru1 gru2 zero_le_mult_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmax.elims min_repU2 min_repU1 
        min.coboundedI1 min.commute maxt12 maxt34 repL_def timesll tl.simps
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>          
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"2"</span> bounds bound grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">using</span></span> mult_left_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 <span class="quoted">"2"</span> bounds bound grl2 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_mono_neg gru1 mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmin.elims min_repU2 min_repU1 maxt34
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def timesul tl.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> NegZero
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ru2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r1  bounds grl1 grl2 gru1 gru2 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">assume</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds bound grl1 grl2 gru1 gru2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_le_cancel_left leD<span class="main">)</span>  
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 mult_right_mono 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU min_repU2 min_repU1 min.coboundedI1 maxt34
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min_repU2 repL_def tl.simps<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword3"><span class="command">assume</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> lower<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds  grl1 grl2 gru1 gru2 mult_le_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> r1 r2 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_mult_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
      <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmin.elims min_repU2 min_repU1 
        min.coboundedI1 min.commute maxt34
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def tl.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> NegNeg
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl2 r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds  grl1 grl2 gru1 gru2
      <span class="keyword1"><span class="command">using</span></span>    not_less mult_le_cancel_left
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 mult_le_cancel_left mult.commute not_le lower1 lower2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
    <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU 
      wmin.elims min_repU2 min_repU1 
      min.coboundedI1 min.commute maxt34 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def tl.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> NegPos
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> upper1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> upper2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru2 r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 less_le_trans upper1 lower2 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_le_cancel_left not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 upper1 r2 mult_right_mono mult_le_0_iff grl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
    <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmin.elims min_repU2 min_repU1 maxt12 maxt34 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def timeslu tl.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PosNeg
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">∧</span> <span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans gru2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans grl2 r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> upper1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans gru1 u1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">have</span></span> upper2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2 mult_left_mono less_le_trans not_less
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 lower1 r2 not_less gru2 gru1 grl1 grl2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_le_cancel_left  mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
    <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">l<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">l<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">u<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU wmin.elims min_repU2 min_repU1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def timesul tl.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PosPos
    <span class="keyword3"><span class="command">assume</span></span> bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">rl2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds dual_order.trans grl2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lower1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lower2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> upper1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans gru1 u1 r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">have</span></span> upper2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ru2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans gru2 u2 r2 bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2
      <span class="keyword1"><span class="command">using</span></span> mult_left_mono 
      <span class="keyword1"><span class="command">using</span></span> leD leI less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 r2 bounds grl1 grl2 gru1 gru2
      <span class="keyword1"><span class="command">using</span></span> mult_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> g1 <span class="keyword2"><span class="keyword">and</span></span> g2
    <span class="keyword1"><span class="command">have</span></span> up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rl1</span> <span class="main">*</span> <span class="skolem">rl2</span> <span class="main">≤</span> <span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> up maxU12 maxU34 bigMaxU min_repU2 min_repU1 min.coboundedI1 maxt12 maxt34
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> repL_def tl.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Most significant bit only changes under successor when all other bits are 1›</span></span>
<span class="keyword1" id="Interval_Word32-msb_succ"><span class="command">lemma</span></span> msb_succ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> Word.word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neq1<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≠</span> <span class="numeral">0xFFFFFFFF</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neq2<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≠</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"msb <span class="main">(</span><span class="free">w</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> msb <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="numeral">0xFFFFFFFF</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> neqneg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> neqneg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> neq1 neq2  <span class="keyword1"><span class="command">unfolding</span></span> msb_big
    <span class="keyword1"><span class="command">using</span></span> word_le_make_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0x80000000</span>"</span></span><span class="main">]</span> 
          word_le_make_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> "</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0x80000000</span>"</span></span><span class="main">]</span>
          neqneg1 neqneg2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Negation commutes with msb except at edge cases›</span></span>
<span class="keyword1" id="Interval_Word32-msb_non_min"><span class="command">lemma</span></span> msb_non_min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> Word.word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neq1<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neq2<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>len_of <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"msb <span class="main">(</span>uminus <span class="free">w</span><span class="main">)</span> <span class="main">=</span> HOL.Not<span class="main">(</span>msb<span class="main">(</span><span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> fact1<span class="main">:</span><span class="quoted"><span class="quoted">"uminus <span class="free">w</span> <span class="main">=</span> word_succ <span class="main">(</span><span class="main">~~</span> <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> twos_complement<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fact2<span class="main">:</span><span class="quoted"><span class="quoted">"msb <span class="main">(</span><span class="main">~~</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> HOL.Not<span class="main">(</span>msb <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> word_ops_msb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> neqneg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> not_undef<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="numeral">0x80000000</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> neqneg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">31</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">~~</span> <span class="free">w</span> <span class="main">≠</span> <span class="main">~~</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bit.compl_eq_compl_iff<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">~~</span> <span class="free">w</span><span class="main">)</span> <span class="main">≠</span> <span class="numeral">0xFFFFFFFF</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> uintNeq1<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="main">(</span><span class="main">~~</span> <span class="free">w</span><span class="main">)</span> <span class="main">≠</span> <span class="numeral">0xFFFFFFFF</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uint_distinct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">~~</span><span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0xFFFFFFFF</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">~~</span> <span class="free">w</span> <span class="main">≠</span> <span class="main">~~</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bit.compl_eq_compl_iff<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">~~</span> <span class="free">w</span><span class="main">)</span> <span class="main">≠</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> uintNeq2<span class="main">:</span><span class="quoted"><span class="quoted">" uint <span class="main">(</span><span class="main">~~</span> <span class="free">w</span><span class="main">)</span> <span class="main">≠</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uint_distinct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">~~</span><span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0x7FFFFFFF</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fact3<span class="main">:</span><span class="quoted"><span class="quoted">"msb <span class="main">(</span><span class="main">(</span><span class="main">~~</span><span class="free">w</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> msb <span class="main">(</span><span class="main">~~</span><span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> msb_succ<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">~~</span><span class="free">w</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> neq1 neq2 uintNeq1 uintNeq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"msb <span class="main">(</span>uminus <span class="free">w</span><span class="main">)</span> <span class="main">=</span> HOL.Not<span class="main">(</span>msb<span class="main">(</span><span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fact1 fact2 fact3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_succ_p1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Only 0x80000000 preserves msb=1 under negation›</span></span>
<span class="keyword1" id="Interval_Word32-msb_min_neg"><span class="command">lemma</span></span> msb_min_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span><span class="main">::</span><span class="quoted"><span class="quoted">"word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> msb1<span class="main">:</span><span class="quoted"><span class="quoted">"msb <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> msb2<span class="main">:</span><span class="quoted"><span class="quoted">"msb <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>len_of <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹msb <span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> word_msb_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹uint <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹uint <span class="free">w</span> <span class="main">≠</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹msb <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> msb <span class="free">w</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> msb_non_min<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Only 0x00000000 preserves msb=0 under negation›</span></span>
<span class="keyword1" id="Interval_Word32-msb_zero"><span class="command">lemma</span></span> msb_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span><span class="main">::</span><span class="quoted"><span class="quoted">"word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> msb1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> msb <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> msb2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> msb <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> msb1 msb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≠</span> uint <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> uint_distinct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span>"</span></span><span class="main">]</span> neq eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> msb1 msb2 minus_zero msb_non_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finite numbers alternate msb under negation›</span></span>
<span class="keyword1" id="Interval_Word32-msb_pos"><span class="command">lemma</span></span> msb_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span><span class="main">::</span><span class="quoted"><span class="quoted">"word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> msb1<span class="main">:</span><span class="quoted"><span class="quoted">"msb <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> msb2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> msb <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span> <span class="main">..</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span> <span class="main">..</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> msb1 msb2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> word_msb_sint
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> neg_equal_0_iff_equal not_le word_less_1<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> imp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≥</span> <span class="numeral">0x80000000</span> <span class="main">⟹</span> False"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> geq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≥</span> <span class="numeral">0x80000000</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msb <span class="free">w</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> msb_big <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> msb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> mylem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span><span class="main">::</span>word<span class="main">.</span> uint <span class="bound">w1</span> <span class="main">≥</span> uint <span class="bound">w2</span> <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≥</span> <span class="bound">w2</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> w1 w2 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_le_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">have</span></span> mylem2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span><span class="main">::</span>word<span class="main">.</span>  <span class="bound">w1</span> <span class="main">&gt;</span>  <span class="bound">w2</span> <span class="main">⟹</span> uint <span class="bound">w1</span> <span class="main">&gt;</span> uint <span class="bound">w2</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> w1 w2 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_less_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">have</span></span> gr_to_geq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">&gt;</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">≥</span> <span class="numeral">0x80000000</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mylem<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> mylem2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">0x7FFFFFFF</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> taut<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="numeral">0x7FFFFFFF</span> <span class="main">∨</span> <span class="free">w</span> <span class="main">&gt;</span> <span class="numeral">0x7FFFFFFF</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="numeral">0x7FFFFFFF</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> imp taut gr_to_geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> set_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>uint <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>minus<span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span>  <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">::</span>word set<span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span>minus<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>minus <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">}</span><span class="main">::</span>int set<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_le_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> lower<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">xa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">≤</span> <span class="numeral">2147483647</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_range<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">32</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> range <span class="main">(</span>uint<span class="main">::</span>word <span class="main">⇒</span> int<span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> word_uint.Rep_range uints_num <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span><span class="main">::</span><span class="quoted">word</span>  <span class="keyword2"><span class="keyword">where</span></span> xaw<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">=</span> uint <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="numeral">0x7FFFFFFF</span><span class="main">}</span> "</span></span> 
        <span class="keyword1"><span class="command">using</span></span> lower upper <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_le_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> uint_distinct uint_distinct main image_eqI word_le_def xaw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> uint_distinct uint_distinct main image_eqI
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Interval_Word32-msb_neg"><span class="command">lemma</span></span> msb_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span><span class="main">::</span><span class="quoted"><span class="quoted">"word"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> msb1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> msb <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> msb2<span class="main">:</span><span class="quoted"><span class="quoted">"msb <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">..</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> mylem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span><span class="main">::</span>word<span class="main">.</span> uint <span class="bound">w1</span> <span class="main">≥</span> uint <span class="bound">w2</span> <span class="main">⟹</span> <span class="bound">w1</span> <span class="main">≥</span> <span class="bound">w2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_le_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> mylem2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span><span class="main">::</span>word<span class="main">.</span>  <span class="bound">w1</span> <span class="main">&gt;</span>  <span class="bound">w2</span> <span class="main">⟹</span> uint <span class="bound">w1</span> <span class="main">&gt;</span> uint <span class="bound">w2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_less_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> gr_to_geq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">&gt;</span> <span class="numeral">0x80000000</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">≥</span> <span class="numeral">0x80000001</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mylem<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> mylem2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">0x80000000</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> taut<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="numeral">0x80000000</span> <span class="main">∨</span> <span class="numeral">0x80000000</span> <span class="main">&lt;</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> imp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="numeral">0x80000000</span> <span class="main">⟹</span> False"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> geq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="numeral">0x80000000</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>msb <span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> msb_big <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">w</span>"</span></span><span class="main">]</span> msb_big <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msb2<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> msb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">..</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> msb1 msb2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> word_msb_sint
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">0x80000001</span> <span class="main">≤</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> imp taut gr_to_geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> set_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>uint <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">..</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">::</span>word set<span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">..</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_le_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> w <span class="keyword1"><span class="command">using</span></span> uint_lt <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> lower<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2147483649</span> <span class="main">≤</span> <span class="skolem">xa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> upper<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">≤</span> <span class="numeral">4294967295</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_range<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">0x80000000</span> <span class="main">..</span> <span class="numeral">0xFFFFFFFF</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> range <span class="main">(</span>uint<span class="main">::</span>word <span class="main">⇒</span> int<span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> word_uint.Rep_range uints_num <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span><span class="main">::</span><span class="quoted">word</span>  <span class="keyword2"><span class="keyword">where</span></span> xaw<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">=</span> uint <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> the_in<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">0x80000001</span> <span class="main">..</span> <span class="numeral">0xFFFFFFFF</span><span class="main">}</span> "</span></span> 
          <span class="keyword1"><span class="command">using</span></span> lower upper
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> word_le_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> the_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">0xFFFFFFFF</span><span class="main">::</span>word<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> the_in the_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">0x80000001</span> <span class="main">..</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> uint_distinct uint_distinct main image_eqI word_le_def xaw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">..</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> uint_distinct uint_distinct main image_eqI
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹2s-complement commutes with negation except edge cases›</span></span>
<span class="keyword1" id="Interval_Word32-sint_neg_hom"><span class="command">lemma</span></span> sint_neg_hom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> Word.word"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>len_of <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sint<span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>sint <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> word_sint_msb_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> msb_min_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> msb_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msb_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> msb1<span class="main">:</span><span class="quoted"><span class="quoted">"msb <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> msb2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> msb <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span> <span class="main">..</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">32</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> msb_pos<span class="main">[</span><span class="operator">OF</span> msb1 msb2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span> <span class="main">..</span> <span class="numeral">0x7FFFFFFF</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> size<span class="main">:</span><span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="free">w</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> lem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span>   <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x n
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Divides.zmod_zminus1_eq_if<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span>  <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> lem_rule<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">32</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> 
      <span class="main">⟹</span> <span class="main">(</span><span class="main">-</span> uint <span class="free">w</span> <span class="keyword1">mod</span>  <span class="numeral">4294967296</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">4294967296</span> <span class="main">=</span> <span class="main">-</span> uint <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span>"</span></span> <span class="quoted"><span class="numeral">32</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> almost<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> uint <span class="free">w</span> <span class="keyword1">mod</span> <span class="numeral">4294967296</span> <span class="main">-</span> <span class="numeral">4294967296</span> <span class="main">=</span> <span class="main">-</span> uint <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> lem_rule<span class="main">)</span>  
      <span class="keyword1"><span class="command">using</span></span> bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"uint <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> size <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> uint <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bound
    <span class="keyword1"><span class="command">unfolding</span></span> Word.uint_word_ariths word_size_neg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> size almost<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≠</span> <span class="numeral">0x80000000</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> msb1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> msb <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> msb2<span class="main">:</span><span class="quoted"><span class="quoted">"msb <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">0x80000001</span><span class="main">..</span> <span class="numeral">0xFFFFFFFF</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> msb1 msb2 msb_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> size<span class="main">:</span><span class="quoted"><span class="quoted">"size <span class="main">(</span><span class="free">w</span><span class="main">::</span><span class="numeral">32</span> Word.word<span class="main">)</span> <span class="main">=</span> <span class="numeral">32</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Word.word_size<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span>   <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x n
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Divides.zmod_zminus1_eq_if<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span>  <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">from</span></span> bound 
  <span class="keyword1"><span class="command">have</span></span>  wLeq<span class="main">:</span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≤</span> <span class="numeral">4294967295</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wGeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2147483649</span> <span class="main">≤</span> uint <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> wLeq <span class="keyword1"><span class="command">have</span></span> wLeq'<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">≤</span> <span class="numeral">4294967296</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4294967296</span><span class="main">)</span><span class="main">)</span>
            <span class="main">=</span> <span class="main">(</span>uint <span class="free">w</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4294967296</span> <span class="main">≤</span> <span class="numeral">4294967296</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>uint <span class="free">w</span> <span class="main">≤</span> <span class="numeral">4294967296</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">ia</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="bound">ia</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zmod_le_nonneg_dividend<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"uint <span class="free">w</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4294967296</span> <span class="main">≤</span> <span class="numeral">4294967296</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f4 f3 wLeq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span> <span class="main">+</span> <span class="main">-</span> <span class="numeral">4294967296</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> <span class="numeral">4294967296</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">4294967296</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>uint <span class="free">w</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4294967296</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span> 
           <span class="main">=</span> <span class="main">(</span><span class="numeral">4294967296</span> <span class="main">≤</span> uint <span class="free">w</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4294967296</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">4294967296</span> <span class="main">≤</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="bound">x0</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x1</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="bound">x1</span> <span class="keyword1">mod</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x1</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x1</span> <span class="keyword1">mod</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> uint <span class="free">w</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wGeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4294967296</span> <span class="main">≤</span> uint <span class="free">w</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4294967296</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> uint <span class="free">w</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4294967296</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f14 f13 f12 f11 f10 f9 f8 f7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> int_mod_ge<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"uint <span class="main">(</span><span class="main">-</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> size <span class="free">w</span> <span class="main">-</span> uint <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f6
    <span class="keyword1"><span class="command">unfolding</span></span> Word.uint_word_ariths  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> size f4<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹2s-complement encoding is injective›</span></span>
<span class="keyword1" id="Interval_Word32-sint_dist"><span class="command">lemma</span></span> sint_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span><span class="quoted">word</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sint <span class="free">x</span> <span class="main">≠</span> sint <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Negation›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wneg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wneg</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> NEG_INF <span class="keyword1">then</span> POS_INF <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> POS_INF <span class="keyword1">then</span> NEG_INF <span class="keyword1">else</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹word negation is correct›</span></span>
<span class="keyword1" id="Interval_Word32-wneg_lemma"><span class="command">lemma</span></span> wneg_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">r</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wneg <span class="free">w</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">-</span><span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repe.cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> repNEG_INF repPOS_INF <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ra
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="skolem">ra</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="skolem">ra</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> bounda<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="skolem">ra</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint POS_INF<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> boundb<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint NEG_INF<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="skolem">ra</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> raNeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">≠</span> <span class="numeral">2147483647</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sint_range<span class="main">[</span><span class="operator">OF</span> bounda boundb<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> raNeqUndef<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">≠</span> <span class="numeral">2147483648</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> int_not_undef<span class="main">[</span><span class="operator">OF</span> bounda boundb<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uint <span class="skolem">ra</span> <span class="main">≠</span> uint <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>word<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> uint_distinct<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> raNeqUndef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> raNeqUndefUint<span class="main">:</span><span class="quoted"><span class="quoted">"uint <span class="skolem">ra</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> len_of <span class="keyword1">TYPE</span><span class="main">(</span><span class="numeral">31</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"wneg <span class="free">w</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wneg <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> repINT<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> sint_range<span class="main">[</span><span class="operator">OF</span> bounda boundb<span class="main">]</span> sint_neg_hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ra</span></span><span class="main">,</span> <span class="operator">OF</span> raNeqUndefUint<span class="main">]</span>
      raNeq raNeqUndefUint raNeqUndef eq 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> res2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span> <span class="main">=</span>  <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>wneg <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq bounda boundb i sint_neg_hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ra</span></span><span class="main">,</span> <span class="operator">OF</span> raNeqUndefUint<span class="main">]</span> raNeq raNeqUndef eq
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> res1 res2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Comparison›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wgreater</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wgreater</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> <span class="main">(</span>sint <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">&gt;</span> sint <span class="free"><span class="bound"><span class="entity">w2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Interval_Word32-neg_less_contra"><span class="command">lemma</span></span> neg_less_contra<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> Suc <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Comparison &lt; is correct›</span></span>
<span class="keyword1" id="Interval_Word32-wgreater_lemma"><span class="command">lemma</span></span> wgreater_lemma<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">r1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">⟹</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free">r2</span> <span class="main">⟹</span> wgreater <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="free">r1</span> <span class="main">&gt;</span> <span class="free">r2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repL_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>
    <span class="keyword3"><span class="command">assume</span></span> sint_le<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w1</span> <span class="main">&gt;</span> sint <span class="free">w2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sless<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span> <span class="keyword1">&lt;s</span> <span class="free">w1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> word_sless_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> r1_leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">r1</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> r2_leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> wr1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> wr2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> greater<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> wr1 wr2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4 <span class="keyword1"><span class="command">using</span></span> sless sint_le
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_trans not_le<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">&gt;</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1_leq r2_leq greater <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Comparison $\geq$ of words›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wgeq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wgeq</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span>
<span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> NEG_INF<span class="main">)</span>
  <span class="main">∨</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w1</span></span></span> <span class="main">=</span> POS_INF<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
<span class="main">(</span>sint <span class="free"><span class="bound"><span class="entity">w2</span></span></span> <span class="main">≤</span> sint <span class="free"><span class="bound"><span class="entity">w1</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Comparison $\geq$ of words is correct›</span></span>
<span class="keyword1" id="Interval_Word32-wgeq_lemma"><span class="command">lemma</span></span> wgeq_lemma<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span> <span class="main">⟹</span> <span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span> <span class="main">⟹</span> wgeq <span class="free">w1</span> <span class="free">w2</span> <span class="main">⟹</span> <span class="free">r1</span> <span class="main">≥</span> <span class="free">r2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> wgeq.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">w2</span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free">w1</span> <span class="main">=</span> NEG_INF <span class="main">∨</span> <span class="free">w2</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free">w1</span> <span class="main">=</span> POS_INF<span class="main">)</span> <span class="main">∧</span> sint <span class="free">w2</span> <span class="main">≤</span> sint <span class="free">w1</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span><span class="free">r2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sint_le<span class="main">:</span><span class="quoted"><span class="quoted">"sint <span class="free">w2</span> <span class="main">≤</span> sint <span class="free">w1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sless<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w2</span> <span class="keyword1">&lt;=s</span> <span class="free">w1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> word_sless_alt word_sle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>  r1_leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r2_leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">≤</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wr1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wr2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 a2 <span class="keyword1"><span class="command">unfolding</span></span> repU_def repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> check1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">w1</span> <span class="main">=</span> NEG_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> NEG_INF<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> check2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">w1</span> <span class="main">=</span> POS_INF <span class="main">∧</span> <span class="free">w2</span> <span class="main">=</span> POS_INF<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r'<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="skolem">r'<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sless sint_le check1 check2 repe.simps wr2 wr1
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≥</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1_leq r2_leq less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Absolute value›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Absolute value of word›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wabs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"word <span class="main">⇒</span> word"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wabs</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">=</span> <span class="main">(</span>wmax <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">(</span>wneg <span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correctness of wmax›</span></span>
<span class="keyword1" id="Interval_Word32-wabs_lemma"><span class="command">lemma</span></span> wabs_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">r</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wabs <span class="free">w</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span>abs <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> w<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="free">w</span> <span class="main">(</span>wneg <span class="free">w</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> max <span class="free">r</span> <span class="main">(</span><span class="main">-</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wmax_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq wneg_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span><span class="quoted"><span class="quoted">"max <span class="free">r</span> <span class="main">(</span><span class="main">-</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> abs <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> w r <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> more_real_of_word_simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span></span></span></span></span></span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Finite_String">
<div class="head">
<h1>Theory Finite_String</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Finite Strings›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finite-String.thy implements a type of strings whose lengths are bounded by a constant defined
    at "proof-time", by taking a sub-type of the built-in string type. A finite length bound is
    important for applications in real analysis, specifically the Differential-Dynamic-Logic (dL) 
    entry, because finite-string identifiers are used as the index of a real vector, only forming a
    Euclidean space if identifiers are finite.

    We include finite strings in this AFP entry both to promote using it as the basis of future
    versions of the dL entry and simply in case the typeclass instances herein are useful. One could
    imagine using this type in file formats with fixed-length fields.›</span></span>
<span class="comment1">(*  Author:     Brandon Bohrer*)</span>

<span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Finite_String"</span>
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../../HOL/HOL/Main.html">Main</a> 
    <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Int.html">HOL-Library.Code_Target_Int</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory uses induction on pairs of lists often: give names to the cases›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> list_induct2'<span class="main">[</span><span class="operator">case_names</span> BothNil LeftCons RightCons BothCons<span class="main">]</span> <span class="main">=</span> List.list_induct2'

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Set a hard-coded global maximum string length›</span></span>
<span class="keyword1"><span class="command">definition</span></span> max_str<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">MAX_STR</span> <span class="main">=</span> <span class="numeral">20</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finite strings are strings whose size is within the maximum›</span></span>
<span class="keyword1"><span class="command">typedef</span></span> fin_string <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">::</span>string<span class="main">.</span> size <span class="bound">s</span> <span class="main">≤</span> MAX_STR<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> Rep_fin_string Abs_fin_string
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">Nil</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_str<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lift definition of string length›</span></span>
<span class="keyword1"><span class="command">setup_lifting</span></span>  Finite_String.fin_string.type_definition_fin_string 
<span class="keyword1"><span class="command">lift_definition</span></span> ilength<span class="main">::</span><span class="quoted"><span class="quoted">"fin_string <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">length</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Product of types never decreases cardinality›</span></span>
<span class="keyword1" id="Finite_String-card_prod_finite"><span class="command">lemma</span></span> card_prod_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span><span class="main">::</span> <span class="quoted"><span class="quoted">"char set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S</span><span class="main">::</span><span class="quoted"><span class="quoted">"string set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">C</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">C</span> <span class="main">*</span> card <span class="free">S</span> <span class="main">≥</span> card <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cons</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cons</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finite strings are finite›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> fin_string <span class="main">::</span> <span class="quoted">finite</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword1"><span class="command">have</span></span> any<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> card <span class="main">{</span><span class="bound">s</span><span class="main">::</span>string<span class="main">.</span> length <span class="bound">s</span> <span class="main">≤</span> <span class="bound">i</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> i
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">s</span><span class="main">::</span>string<span class="main">.</span> length <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span>char set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ih</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">::</span>string<span class="main">.</span> length <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?prod</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?c</span> <span class="main">×</span> <span class="var">?ih</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cons <span class="main">`</span> <span class="var">?prod</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">::</span>string<span class="main">.</span> length <span class="bound">s</span> <span class="main">≤</span> Suc <span class="skolem">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="main">[]</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> IHfin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?ih</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH card_ge_0_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> finChar<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_ge_0_finite finite_code <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> finiteProd<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?prod</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Groups_Big.card_cartesian_product IHfin finChar <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> cardCons<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="var">?b</span> <span class="main">=</span> card <span class="var">?prod</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Finite_Set.card_image<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> finiteCons<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cardCons finiteProd card_ge_0_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> finiteB<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_insert finiteCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I cons.simps image_eqI mem_Collect_eq mem_Sigma_iff<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> rl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?B</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> isCons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lr rl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> finiteB isCons IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card.insert_remove<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command">note</span></span> finMax <span class="main">=</span> card_ge_0_finite<span class="main">[</span><span class="operator">OF</span> spec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> any<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted">MAX_STR</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> Abs_fin_string <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> length <span class="bound">s</span> <span class="main">≤</span> MAX_STR<span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Abs_fin_string_cases finMax <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> univEq<span class="main">:</span><span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> Abs_fin_string <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> length <span class="bound">s</span> <span class="main">≤</span> MAX_STR<span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Abs_fin_string_cases  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong UNIV_I top_empty_eq top_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">::</span> fin_string set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> univEq fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV<span class="main">::</span>fin_string set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Characters are linearly ordered by their code value›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> char <span class="main">::</span> <span class="quoted">linorder</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_char</span></span> <span class="keyword2"><span class="keyword">where</span></span>
less_eq_char<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">less_eq_char</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> int_of_char <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> int_of_char <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_char</span></span> <span class="keyword2"><span class="keyword">where</span></span>
less_char<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">less_char</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> int_of_char <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> int_of_char <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_char less_eq_char int_of_char_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finite strings are linearly ordered, lexicographically›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> fin_string <span class="main">::</span> <span class="quoted">linorder</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lleq_charlist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"char list <span class="main">⇒</span> char list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">lleq_charlist</span> Nil Nil <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lleq_charlist</span> Nil <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lleq_charlist</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Nil <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lleq_charlist</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="free">lleq_charlist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">less_charlist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"char list <span class="main">⇒</span> char list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">less_charlist</span> Nil Nil <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_charlist</span> Nil <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_charlist</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Nil <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">less_charlist</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="free">less_charlist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_fin_string</span><span class="main">::</span><span class="quoted"><span class="quoted">"fin_string <span class="main">⇒</span> fin_string <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">lleq_charlist</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_fin_string</span><span class="main">::</span><span class="quoted"><span class="quoted">"fin_string <span class="main">⇒</span> fin_string <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_charlist</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Finite_String-lleq_head"><span class="command">lemma</span></span> lleq_head<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L1</span> <span class="free">L2</span> <span class="free">x</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> lleq_charlist <span class="free">L2</span> <span class="bound">z</span> <span class="main">⟹</span> lleq_charlist <span class="free">L1</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"lleq_charlist <span class="free">L1</span> <span class="free">L2</span>"</span></span>
  <span class="quoted"><span class="quoted">"lleq_charlist <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">L2</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lleq_charlist <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">L1</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.list_induct2'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Finite_String-lleq_less"><span class="command">lemma</span></span> lleq_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>less_charlist <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lleq_charlist <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="main">¬</span> lleq_charlist <span class="free">y</span>  <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.list_induct2'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Finite_String-lleq_refl"><span class="command">lemma</span></span> lleq_refl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lleq_charlist <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Finite_String-lleq_trans"><span class="command">lemma</span></span> lleq_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lleq_charlist <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> lleq_charlist <span class="free">y</span> <span class="free">z</span> <span class="main">⟹</span> lleq_charlist <span class="free">x</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> BothNil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LeftCons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> lleq_charlist.elims<span class="main">(</span>2<span class="main">)</span> lleq_charlist.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RightCons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BothCons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> lleq_head<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">ys</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a list
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_String-lleq_antisym"><span class="command">lemma</span></span> lleq_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lleq_charlist <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> lleq_charlist <span class="free">y</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LeftCons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">=</span><span class="free">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>RightCons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">ys</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>BothCons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Finite_String-lleq_dichotomy"><span class="command">lemma</span></span> lleq_dichotomy<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lleq_charlist <span class="free">x</span> <span class="free">y</span> <span class="main">∨</span> lleq_charlist <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> List.list_induct2'<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> less_eq_fin_string_def less_fin_string_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lleq_less lleq_refl lleq_trans lleq_dichotomy<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> lleq_antisym less_eq_fin_string_def less_fin_string_def Rep_fin_string_inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">string_expose</span><span class="main">::</span><span class="quoted"><span class="quoted">"string <span class="main">⇒</span> <span class="main">(</span>unit <span class="main">+</span> <span class="main">(</span>char <span class="main">*</span> string<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">string_expose</span> Nil <span class="main">=</span> Inl <span class="main">()</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">string_expose</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> Inr<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">string_cons</span><span class="main">::</span><span class="quoted"><span class="quoted">"char <span class="main">⇒</span> string <span class="main">⇒</span> string"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">string_cons</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> length <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≥</span> MAX_STR <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lift_definition</span></span> fin_string_empty<span class="main">::</span><span class="quoted">fin_string</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted">''''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_str<span class="main">)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> fin_string_cons<span class="main">::</span><span class="quoted"><span class="quoted">"char <span class="main">⇒</span> fin_string <span class="main">⇒</span> fin_string"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"string_cons"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lift_definition</span></span> fin_string_expose<span class="main">::</span><span class="quoted"><span class="quoted">"fin_string <span class="main">⇒</span> <span class="main">(</span>unit <span class="main">+</span> <span class="main">(</span>char<span class="main">*</span>fin_string<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">string_expose</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.trans less_imp_le pred_sum.simps string_expose.elims<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.trans impossible_Cons le_cases string_expose.elims<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Helper functions for enum typeclass instance›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fin_string_upto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> fin_string list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">fin_string_upto</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span>fin_string_empty<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fin_string_upto</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> 
 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">fin_string_upto</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">ab</span> <span class="main">=</span>  <span class="main">(</span>enum_class.enum<span class="main">::</span>char list<span class="main">)</span> <span class="keyword1">in</span>
  fin_string_empty <span class="main">#</span> concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">c</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fin_string_cons <span class="bound">c</span>  <span class="bound">s</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">ab</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Finite_String-mem_appL"><span class="command">lemma</span></span> mem_appL<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="free">L1</span> <span class="free">x</span> <span class="main">⟹</span> List.member <span class="main">(</span><span class="free">L1</span> <span class="main">@</span> <span class="free">L2</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">L1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">L2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_rec<span class="main">)</span>

<span class="keyword1" id="Finite_String-mem_appR"><span class="command">lemma</span></span> mem_appR<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="free">L2</span> <span class="free">x</span> <span class="main">⟹</span> List.member <span class="main">(</span><span class="free">L1</span> <span class="main">@</span> <span class="free">L2</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">L1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">L2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_rec<span class="main">)</span>

<span class="keyword1" id="Finite_String-mem_app_or"><span class="command">lemma</span></span> mem_app_or<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="main">(</span><span class="free">L1</span> <span class="main">@</span> <span class="free">L2</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> List.member <span class="free">L1</span> <span class="free">x</span> <span class="main">∨</span> List.member <span class="free">L2</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> member_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Finite_String-fin_string_nil"><span class="command">lemma</span></span> fin_string_nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>fin_string_upto <span class="free">n</span><span class="main">)</span> fin_string_empty"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_rec Let_def fin_string_empty_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹List of every string. Not practical for code generation but used to show strings are an enum›</span></span>
<span class="keyword1"><span class="command">definition</span></span> vals_def<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">vals</span> <span class="main">≡</span> fin_string_upto MAX_STR"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fin_string_enum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fin_string list"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fin_string_enum</span> <span class="main">=</span> vals"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fin_string_enum_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_string <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fin_string_enum_all</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span><span class="main">.</span> list_all <span class="bound">f</span> vals<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fin_string_enum_ex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_string <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fin_string_enum_ex</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span><span class="main">.</span> list_ex <span class="bound">f</span> vals<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Induct on the length of a bounded list, with access to index of element›</span></span>
<span class="keyword1" id="Finite_String-length_induct"><span class="command">lemma</span></span> length_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">L</span> <span class="main">≤</span> MAX_STR"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> BC<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">[]</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span>  <span class="free">P</span> <span class="bound">xs</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">L</span> <span class="main">(</span>length <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span>  length <span class="free">L</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">≤</span> MAX_STR <span class="main">⟹</span> <span class="free">P</span> <span class="free">L</span> <span class="main">(</span>length <span class="free">L</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">L</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> BC <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">L</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> it<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">L</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">using</span></span> IS<span class="main">[</span><span class="operator">OF</span> it<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> BC IS len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Induct on length of fin-string›</span></span>
<span class="keyword1" id="Finite_String-ilength_induct"><span class="command">lemma</span></span> ilength_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> BC<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> fin_string_empty <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span>  <span class="free">P</span> <span class="bound">xs</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Abs_fin_string <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> Rep_fin_string <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">L</span> <span class="main">(</span>ilength <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">L</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> ilength_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_fin_string_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> y
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">=</span> Abs_fin_string <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">" length <span class="skolem">y</span> <span class="main">≤</span> MAX_STR "</span></span>
    <span class="keyword1"><span class="command">have</span></span> main<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="free">L</span> <span class="main">=</span> Abs_fin_string <span class="skolem">y</span> <span class="main">⟹</span> length <span class="skolem">y</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">≤</span> MAX_STR 
        <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Abs_fin_string <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> k
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="free">L</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> k <span class="keyword1"><span class="command">using</span></span> BC <span class="keyword1"><span class="command">unfolding</span></span> fin_string_empty_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a y k L
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">=</span> Abs_fin_string <span class="skolem">y</span> <span class="main">⟹</span> length <span class="skolem">y</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="bound">k</span> <span class="main">≤</span> MAX_STR 
            <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Abs_fin_string <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> Abs_fin_string <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> str<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> MAX_STR"</span></span>
          <span class="keyword1"><span class="command">have</span></span> yLen<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">y</span> <span class="main">&lt;</span> MAX_STR"</span></span> <span class="keyword1"><span class="command">using</span></span> l str <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> it<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Abs_fin_string <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">y</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Abs_fin_string <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> refl<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> L l str <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Abs_fin_string <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> IS<span class="main">[</span><span class="operator">OF</span> it<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_string_cons_def Abs_fin_string_inverse<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"MAX_STR <span class="main">≤</span> length <span class="main">(</span>Rep_fin_string <span class="main">(</span>Abs_fin_string <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> yLen <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l yLen Abs_fin_string_inverse<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> main<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> BC IS a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Finite_String-enum_chars"><span class="command">lemma</span></span> enum_chars<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="main">(</span>enum_class.enum<span class="main">::</span>char list<span class="main">)</span><span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Enum.enum_class.enum_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Finite_String-member_concat"><span class="command">lemma</span></span> member_concat<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="main">(</span>concat <span class="free">LL</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">L</span><span class="main">.</span> List.member <span class="free">LL</span> <span class="bound">L</span> <span class="main">∧</span> List.member <span class="bound">L</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹fin-string-upto k enumerates all strings up to length $min(k,MAX\_STR)$›</span></span>
<span class="keyword1" id="Finite_String-fin_string_length"><span class="command">lemma</span></span> fin_string_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L</span><span class="main">::</span><span class="quoted">string</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">L</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Len<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">L</span> <span class="main">≤</span> MAX_STR"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>fin_string_upto <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> BC<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> MAX_STR <span class="main">⟶</span> length <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> 
    List.member <span class="main">(</span>fin_string_upto <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="main">[]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> j 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_string_empty_def member_rec<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> IS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span>
      <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">≤</span>MAX_STR <span class="main">⟶</span> length <span class="bound">xs</span><span class="main">=</span><span class="bound">k</span> <span class="main">⟶</span> List.member <span class="main">(</span>fin_string_upto <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="bound">xs</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span>Suc <span class="bound">k</span><span class="main">.</span> Suc <span class="bound">k</span> <span class="main">≤</span> MAX_STR <span class="main">⟶</span> length <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> Suc <span class="bound">k</span> 
        <span class="main">⟶</span> List.member <span class="main">(</span>fin_string_upto <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> k x xs
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="skolem">k</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">≤</span> MAX_STR <span class="main">⟶</span> length <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">k</span> 
        <span class="main">⟶</span> List.member <span class="main">(</span>fin_string_upto <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">≥</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="skolem">k</span> <span class="main">≤</span> MAX_STR <span class="main">⟹</span> length <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">k</span> 
        <span class="main">⟹</span> List.member <span class="main">(</span>fin_string_upto <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="skolem">xs</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> j
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> kj<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> sucMax<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">≤</span> MAX_STR"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> ilen<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">k</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">jj</span></span> <span class="keyword2"><span class="keyword">where</span></span> jj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">jj</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kj Suc_le_D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> kMax<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> MAX_STR"</span></span> <span class="keyword1"><span class="command">using</span></span> jj kj Suc_le_D ilen
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_Suc_le sucMax<span class="main">)</span>
           <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="main">(</span>fin_string_upto <span class="main">(</span><span class="skolem">jj</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="skolem">xs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">jj</span>"</span></span><span class="main">]</span> kj jj ilen  Suc_leD sucMax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"Abs_fin_string <span class="main">[]</span> <span class="main">≠</span> Abs_fin_string <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Abs_fin_string_inverse fin_string_empty.abs_eq fin_string_empty.rep_eq 
              len length_Cons list.distinct<span class="main">(</span>1<span class="main">)</span> mem_Collect_eq
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ilen sucMax<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> univ<span class="main">:</span><span class="quoted"><span class="quoted">" set enum_class.enum  <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">::</span>char set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> enum_chars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>fin_string_upto <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_rec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fin_string_empty_def<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> len sucMax 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_rec fin_string_empty_def fin_string_cons_def
                Abs_fin_string_inverse Rep_fin_string_inverse neq<span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?witLL</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> map <span class="main">(</span>map_fun Rep_fin_string Abs_fin_string <span class="main">(</span>string_cons <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>fin_string_upto <span class="skolem">jj</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_fin_string <span class="skolem">xs</span> <span class="main">∈</span> set <span class="main">(</span>fin_string_upto <span class="skolem">jj</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> member_def res<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"Abs_fin_string <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> Abs_fin_string 
                      <span class="main">(</span><span class="keyword1">if</span> MAX_STR <span class="main">≤</span> length <span class="main">(</span>Rep_fin_string <span class="main">(</span>Abs_fin_string <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> 
                       <span class="keyword1">then</span> Rep_fin_string <span class="main">(</span>Abs_fin_string <span class="skolem">xs</span><span class="main">)</span>
                       <span class="keyword1">else</span> <span class="skolem">x</span> <span class="main">#</span> Rep_fin_string <span class="main">(</span>Abs_fin_string <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Abs_fin_string_inverse ilen kMax <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">LL</span><span class="main">.</span> <span class="main">(</span>List.member <span class="main">(</span>map <span class="var">?witLL</span> enum_class.enum<span class="main">)</span> <span class="bound">LL</span><span class="main">)</span> 
                          <span class="main">∧</span> List.member <span class="bound">LL</span> <span class="main">(</span>Abs_fin_string <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?witLL</span></span> <span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> member_def univ<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> f1 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>concat <span class="main">(</span>map <span class="var">?witLL</span> enum_class.enum<span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>Abs_fin_string <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> member_concat ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>fin_string_upto <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> impl<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">L</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> List.member <span class="main">(</span>fin_string_upto <span class="free">k</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="free">L</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> len Len 
    length_induct<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">L</span> <span class="bound">k</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> MAX_STR <span class="main">⟶</span> length <span class="bound">L</span> <span class="main">=</span> <span class="bound">k</span> 
        <span class="main">⟶</span> List.member <span class="main">(</span>fin_string_upto <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Abs_fin_string <span class="bound">L</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">,</span> <span class="operator">OF</span> Len BC IS<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> impl len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Finite_String-fin_string_upto_length"><span class="command">lemma</span></span> fin_string_upto_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>fin_string_upto <span class="free">n</span><span class="main">)</span> <span class="free">L</span> <span class="main">⟹</span> ilength <span class="free">L</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">L</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_string_empty_def Let_def ilength_def fin_string_cons_def 
     Rep_fin_string_inverse Abs_fin_string_inverse member_rec<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">L</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?witLL</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> map<span class="main">(</span>map_fun Rep_fin_string Abs_fin_string<span class="main">(</span>string_cons <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>fin_string_upto <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> len<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">L</span><span class="main">.</span> List.member <span class="main">(</span>fin_string_upto <span class="skolem">n</span><span class="main">)</span> <span class="bound">L</span> <span class="main">⟹</span> length <span class="main">(</span>Rep_fin_string <span class="bound">L</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> mem<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="main">(</span>concat <span class="main">(</span>map <span class="var">?witLL</span> enum_class.enum<span class="main">)</span><span class="main">)</span> <span class="skolem">L</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> L<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="main">(</span>fin_string_upto <span class="skolem">n</span><span class="main">)</span> <span class="skolem">L</span> <span class="main">⟹</span> length <span class="main">(</span>Rep_fin_string <span class="skolem">L</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="skolem">n</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> len<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">L</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="main">(</span>concat <span class="main">(</span>map <span class="var">?witLL</span> enum_class.enum<span class="main">)</span><span class="main">)</span> <span class="skolem">L</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">LL</span></span> <span class="keyword2"><span class="keyword">where</span></span> conc<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="main">(</span>map <span class="var">?witLL</span> enum_class.enum<span class="main">)</span> <span class="skolem">LL</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> concmem<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="skolem">LL</span> <span class="skolem">L</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> member_concat a <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> fin_string_cons <span class="skolem">c</span> <span class="skolem">cs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span><span class="quoted"><span class="quoted">"List.member <span class="main">(</span>fin_string_upto <span class="skolem">n</span><span class="main">)</span> <span class="skolem">cs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a conc <span class="keyword1"><span class="command">unfolding</span></span> member_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> c d cs
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"MAX_STR <span class="main">≤</span> length <span class="main">(</span>Rep_fin_string <span class="skolem">cs</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_fin_string_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Rep_fin_string_inverse fin_string_cons.rep_eq string_cons.simps<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ilength <span class="main">(</span>fin_string_cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> len<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> ilength_def fin_string_cons_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_fin_string_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> c fin_string_cons.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>Rep_fin_string <span class="skolem">L</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c ilength.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹fin-string-upto produces no duplicate identifiers›</span></span>
<span class="keyword1" id="Finite_String-distinct_upto"><span class="command">lemma</span></span> distinct_upto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> MAX_STR <span class="main">⟹</span> distinct <span class="main">(</span>fin_string_upto <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword1"><span class="command">have</span></span> jLen<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">≤</span> MAX_STR"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"distinct <span class="main">(</span>fin_string_upto <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> distinct_char<span class="main">:</span><span class="quoted"><span class="quoted">"distinct <span class="main">(</span>enum_class.enum<span class="main">::</span> char list<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_map enum_char_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> diseq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="main">(</span>fin_string_upto <span class="skolem">j</span><span class="main">)</span> <span class="main">⟹</span>  fin_string_empty <span class="main">≠</span> fin_string_cons <span class="bound">x</span> <span class="bound">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Rep_fin_string_inverse jLen <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_string_empty_def fin_string_cons_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> fin_string_empty.rep_eq le_zero_eq list.size not_less_eq_eq zero_le Abs_fin_string_inject
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x xa <span class="keyword1"><span class="command">using</span></span> diseq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> distinct_concat<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_map<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> distinct_char<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_inj_on<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> injI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_string_cons_def<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">xa</span> <span class="bound">x</span><span class="main">.</span> Abs_fin_string 
        <span class="main">(</span><span class="keyword1">if</span> MAX_STR <span class="main">≤</span> length <span class="main">(</span>Rep_fin_string <span class="bound">xa</span><span class="main">)</span> 
         <span class="keyword1">then</span> Rep_fin_string <span class="bound">xa</span> 
         <span class="keyword1">else</span> <span class="bound">x</span> <span class="main">#</span> Rep_fin_string <span class="bound">xa</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">∈</span>set <span class="main">(</span>fin_string_upto <span class="skolem">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?l</span> <span class="bound">xa</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?l</span> <span class="bound">xa</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">(</span>List.member <span class="main">(</span>fin_string_upto <span class="skolem">j</span><span class="main">)</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">⟹</span> <span class="var">?l</span> <span class="bound">xa</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?l</span> <span class="bound">xa</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  member_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_fin_string <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> Abs_fin_string <span class="main">[</span><span class="skolem">y</span><span class="main">]</span> <span class="main">∨</span> <span class="main">(</span>MAX_STR<span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a2 fin_string_empty.rep_eq fin_string_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_fin_string_inverse jLen le_zero_eq length_Cons list.inject list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
            mem_Collect_eq nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_less_eq_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ys
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_string_cons_def<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">char</span>
      <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> set enum_class.enum"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> ys<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ys</span><span class="main">=</span>map<span class="main">(</span>map_fun Rep_fin_string Abs_fin_string <span class="main">(</span>string_cons <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fin_string_upto <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"distinct<span class="main">(</span>map<span class="main">(</span>map_fun Rep_fin_string Abs_fin_string <span class="main">(</span>string_cons <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fin_string_upto <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> distinct_map <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y
          <span class="keyword1"><span class="command">using</span></span> jLen fin_string_upto_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> fin_string_upto_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> List.member_def ilength_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Rep_fin_string_inverse fin_string_cons.rep_eq le_trans
              list.inject not_less_eq_eq string_cons.simps<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_string_cons_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> c ca xa xb xc
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"MAX_STR <span class="main">≤</span> length <span class="main">(</span>Rep_fin_string <span class="skolem">xa</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> fin_string_upto_length jLen ilength.rep_eq le_trans member_def not_less_eq_eq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"MAX_STR <span class="main">≤</span> length <span class="main">(</span>Rep_fin_string <span class="skolem">xb</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> fin_string_upto_length jLen ilength.rep_eq le_trans member_def not_less_eq_eq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"MAX_STR <span class="main">≤</span> length <span class="main">(</span>Rep_fin_string <span class="skolem">xc</span><span class="main">)</span>"</span></span><span class="main">)</span> 
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> Rep_fin_string_inverse fin_string_cons.rep_eq list.inject string_cons.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finite strings are an enumeration type›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> fin_string <span class="main">::</span> <span class="quoted">enum</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">enum_fin_string</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> enum_fin_string_def<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">enum_fin_string</span> <span class="main">≡</span> fin_string_enum"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">enum_all_fin_string</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> enum_all_fin_string<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">enum_all_fin_string</span> <span class="main">≡</span> fin_string_enum_all"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">enum_ex_fin_string</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> enum_ex_fin_string<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">enum_ex_fin_string</span> <span class="main">≡</span> fin_string_enum_ex"</span></span>
<span class="keyword1" id="Finite_String-enum_ALL"><span class="command">lemma</span></span> enum_ALL<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV<span class="main">::</span>fin_string set<span class="main">)</span> <span class="main">=</span> set enum_class.enum"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>enum_fin_string_def fin_string_enum_def vals_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> fin_string_length List.member_def mem_Collect_eq Abs_fin_string_cases<span class="main">)</span>

<span class="keyword1" id="Finite_String-vals_ALL"><span class="command">lemma</span></span> vals_ALL<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="main">(</span>vals<span class="main">::</span>fin_string list<span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">using</span></span> enum_ALL vals_def Rep_fin_string fin_string_length ilength.rep_eq member_def 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Rep_fin_string_inverse UNIV_eq_I mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="Finite_String-setA"><span class="command">lemma</span></span> setA<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">L</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all <span class="free">P</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list.pred_set<span class="main">)</span>

<span class="keyword1" id="Finite_String-setE"><span class="command">lemma</span></span> setE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">y</span> <span class="main">∈</span> set <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_ex <span class="free">P</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set P  list_ex_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">instance</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> enum_ALL<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_string_enum_all_def list_all_iff vals_ALL setA setE enum_all_fin_string
      enum_ALL fin_string_enum_def vals_def enum_fin_string_def distinct_upto list_ex_iff 
      enum_ex_fin_string fin_string_enum_ex_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> fin_string <span class="main">::</span> <span class="quoted">equal</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">equal_fin_string</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fin_string <span class="main">⇒</span> fin_string <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">equal_fin_string</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equal_fin_string_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Interpreter">
<div class="head">
<h1>Theory Interpreter</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Interpreter.thy defines a simple programming language over interval-valued variables and executable
semantics (interpreter) for that language. We then prove that the interpretation of interval terms
is a sound over-approximation of a real-valued semantics of the same language.

Our language is a version of first order dynamic logic-style regular programs.
We use a finite identifier space for compatibility with Differential-Dynamic-Logic, where identifier
finiteness is required to treat program states as Banach spaces to enable differentiation.
›</span></span>
<span class="comment1">(* Author:     Brandon Bohrer *)</span>
<span class="keyword1"><span class="command">theory</span></span> Interpreter
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
  <a href="Finite_String.html">Finite_String</a>
  <a href="Interval_Word32.html">Interval_Word32</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Syntax›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Our term language supports variables, polynomial arithmetic, and extrema. This choice was made
   based on the needs of the original paper and could be extended if necessary.›</span></span>
<span class="keyword1"><span class="command">datatype</span></span>  trm <span class="main">=</span>
  Var <span class="quoted">fin_string</span>
<span class="main">|</span> Const <span class="quoted">lit</span>
<span class="main">|</span> Plus <span class="quoted">trm</span> <span class="quoted">trm</span>
<span class="main">|</span> Times <span class="quoted">trm</span> <span class="quoted">trm</span>
<span class="main">|</span> Neg <span class="quoted">trm</span>
<span class="main">|</span> Max <span class="quoted">trm</span> <span class="quoted">trm</span>
<span class="main">|</span> Min <span class="quoted">trm</span> <span class="quoted">trm</span>
<span class="main">|</span> Abs <span class="quoted">trm</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Our statement language is nondeterministic first-order regular programs.
 This coincides with the discrete subset of hybrid programs from the dL entry.

Our assertion language are the formulas of first-order dynamic logic›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> prog <span class="main">=</span>
  Assign <span class="quoted">fin_string</span> <span class="quoted"><span class="quoted">"trm"</span></span>     <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">:=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 10<span class="main">)</span>
<span class="main">|</span> AssignAny <span class="quoted">fin_string</span>                
<span class="main">|</span> Test <span class="quoted"><span class="quoted">"formula"</span></span>              <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">?</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="main">|</span> Choice <span class="quoted"><span class="quoted">"prog"</span></span> <span class="quoted"><span class="quoted">"prog"</span></span>        <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∪∪</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 10<span class="main">)</span>
<span class="main">|</span> Sequence <span class="quoted"><span class="quoted">"prog"</span></span>  <span class="quoted"><span class="quoted">"prog"</span></span>     <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 8<span class="main">)</span>
<span class="main">|</span> Loop <span class="quoted"><span class="quoted">"prog"</span></span>                 <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">**</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">and</span></span> formula <span class="main">=</span>
  Geq <span class="quoted"><span class="quoted">"trm"</span></span> <span class="quoted"><span class="quoted">"trm"</span></span>
<span class="main">|</span> Not <span class="quoted"><span class="quoted">"formula"</span></span>                        <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">!</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="main">|</span> And <span class="quoted"><span class="quoted">"formula"</span></span> <span class="quoted"><span class="quoted">"formula"</span></span>              <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&amp;&amp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 8<span class="main">)</span>
<span class="main">|</span> Exists <span class="quoted">fin_string</span> <span class="quoted"><span class="quoted">"formula"</span></span>
<span class="main">|</span> Diamond <span class="quoted"><span class="quoted">"prog"</span></span> <span class="quoted"><span class="quoted">"formula"</span></span>               <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⟨</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⟩</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 10<span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Derived forms›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Or</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula <span class="main">⇒</span> formula <span class="main">⇒</span> formula"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">||</span>"</span> 7<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> or_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">Or</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> Not <span class="main">(</span>And <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Equals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trm <span class="main">⇒</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> equals_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">Equals</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="main">=</span> <span class="main">(</span>And <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span><span class="main">)</span> <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Greater</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trm <span class="main">⇒</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> greater_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">Greater</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="main">=</span> Not <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Leq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trm <span class="main">⇒</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> leq_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">Leq</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="main">=</span> <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> trm <span class="main">⇒</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> less_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">Less</span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span> <span class="main">=</span> <span class="main">(</span>Not <span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ</span></span></span> <span class="free"><span class="bound"><span class="entity">θ'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ States over reals vs. word intervals which contain them›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> rstate <span class="main">=</span> <span class="quoted"><span class="quoted">"fin_string <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> wstate <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_string <span class="main">+</span> fin_string<span class="main">)</span> <span class="main">⇒</span> word"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wstate</span><span class="main">::</span><span class="quoted"><span class="quoted">"wstate <span class="main">⇒</span> prop"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> wstate_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">wstate</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> word <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">(</span>Inl <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> word <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">(</span>Inr <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interpretation of a term in a state›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">rtsem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> rstate <span class="main">⇒</span> real  <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[</span>_<span class="keyword1">]</span>_ <span class="keyword1">↓</span> _<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> 
  rtsem_Const<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_bword <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Const <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> rtsem_Var<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> rtsem_Plus<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Plus <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> rtsem_Times<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Times <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> rtsem_Max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Max <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="main">(</span>max <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> rtsem_Min<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Min <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="main">(</span>min <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> rtsem_Abs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Abs <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="main">(</span>abs <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> rtsem_Neg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Neg <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span> 
    rtsem_Const_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="main">(</span>Const <span class="free">w</span><span class="main">)</span><span class="main">]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rtsem_Var_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Var <span class="free">x</span><span class="main">]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rtsem_PlusU_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Plus <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rtsem_TimesU_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Times <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rtsem_Max_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Max <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span> <span class="free">ν</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rtsem_Min_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Min <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span> <span class="free">ν</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rtsem_Abs_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Abs <span class="free">θ</span><span class="main">]</span> <span class="free">ν</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rtsem_Neg_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Neg <span class="free">θ</span><span class="main">]</span> <span class="free">ν</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set <span class="main">⇒</span> real set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;<span class="hidden">⇩</span><sub>S</sub></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_less</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_geq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real set <span class="main">⇒</span> real set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≥<span class="hidden">⇩</span><sub>S</sub></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_geq</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interpretation of an assertion in a state›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">rfsem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula <span class="main">⇒</span> rstate <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[</span>_<span class="keyword1">]</span>_<span class="keyword3">)</span> <span class="keyword1">⇂</span> _"</span> 20<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  rGreaterT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Greater <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> rGreaterF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Greater <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> rGeqT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Geq <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> rGeqF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Geq <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> rEqualsT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Equals <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> rEqualsF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Equals <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> rAndT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> rAndF1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> rAndF2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> rOrT1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> rOrT2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> rOrF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span> <span class="main">;</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> rNotT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> rNotF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> True<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇂</span></span> False<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span>
    rfsem_Greater_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Greater <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="free">ν</span> <span class="main">⇂</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rfsem_Geq_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Geq <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="free">ν</span> <span class="main">⇂</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rfsem_Equals_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Equals <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="free">ν</span> <span class="main">⇂</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rfsem_And_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>And <span class="free">φ</span>  <span class="free">ψ</span><span class="main">]</span><span class="free">ν</span> <span class="main">⇂</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rfsem_Or_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="main">(</span>Or <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">]</span><span class="free">ν</span> <span class="main">⇂</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rfsem_Not_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Not <span class="free">φ</span><span class="main">]</span><span class="free">ν</span> <span class="main">⇂</span> <span class="free">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interpretation of a program is a transition relation on states›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">rpsem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"prog <span class="main">⇒</span> rstate <span class="main">⇒</span>  rstate <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[</span>_<span class="keyword1">]</span>_<span class="keyword3">)</span> <span class="keyword1">⇃</span> _"</span> 20<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  rTest<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">⇂</span> True<span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="main">?</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> rSeq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> rAssign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Assign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> rChoice1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Choice <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> rChoice2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[</span></span>Choice <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">⇃</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span>
    rpsem_Test_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="main">?</span> <span class="free">φ</span><span class="main">]</span><span class="free">ν</span> <span class="main">⇃</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rpsem_Seq_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">α</span><span class="main">;;</span> <span class="free">β</span><span class="main">]</span><span class="free">ν</span> <span class="main">⇃</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rpsem_Assign_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">]</span><span class="free">ν</span> <span class="main">⇃</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> rpsem_Choice_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Choice <span class="free">α</span> <span class="free">β</span><span class="main">]</span><span class="free">ν</span> <span class="main">⇃</span> <span class="free">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Upper bound of arbitrary term›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wtsemU</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm <span class="main">⇒</span> wstate <span class="main">⇒</span>  word <span class="main">*</span> word "</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[</span>_<span class="keyword1">]&lt;&gt;</span>_<span class="keyword3">)</span>"</span> 20<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span>Const <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Rep_bword <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">::</span>word<span class="main">,</span> Rep_bword <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> wVarU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> wPlusU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span>Plus <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">l1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span> 
   <span class="keyword1">let</span> <span class="main">(</span><span class="bound">l2</span><span class="main">,</span> <span class="bound">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span>
   <span class="main">(</span>pl <span class="bound">l1</span> <span class="bound">l2</span><span class="main">,</span> pu <span class="bound">u1</span> <span class="bound">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> wTimesU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">l1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span> 
   <span class="keyword1">let</span> <span class="main">(</span><span class="bound">l2</span><span class="main">,</span> <span class="bound">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span>
   <span class="main">(</span>tl <span class="bound">l1</span> <span class="bound">u1</span> <span class="bound">l2</span> <span class="bound">u2</span><span class="main">,</span> tu <span class="bound">l1</span> <span class="bound">u1</span> <span class="bound">l2</span> <span class="bound">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> wMaxU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="main">(</span>Max <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">l1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span> 
   <span class="keyword1">let</span> <span class="main">(</span><span class="bound">l2</span><span class="main">,</span> <span class="bound">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span>
  <span class="main">(</span>wmax <span class="bound">l1</span> <span class="bound">l2</span><span class="main">,</span> wmax <span class="bound">u1</span> <span class="bound">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> wMinU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="main">(</span>Min <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">l1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span> 
   <span class="keyword1">let</span> <span class="main">(</span><span class="bound">l2</span><span class="main">,</span> <span class="bound">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span>
  <span class="main">(</span>wmin <span class="bound">l1</span> <span class="bound">l2</span><span class="main">,</span> wmin <span class="bound">u1</span> <span class="bound">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> wNegU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">)</span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span>
   <span class="main">(</span>wneg <span class="bound">u</span><span class="main">,</span> wneg <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> wAbsU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[</span></span><span class="main">(</span>Abs <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">l1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">]&lt;&gt;</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1">in</span> 
  <span class="main">(</span>wmax <span class="bound">l1</span> <span class="main">(</span>wneg <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> wmax <span class="bound">u1</span> <span class="main">(</span>wneg <span class="bound">l1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">wfsem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula <span class="main">⇒</span> wstate <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[[</span>_<span class="keyword1">]]</span>_ <span class="keyword1">↓</span> _<span class="keyword3">)</span>"</span> 20<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  wGreaterT<span class="main">:</span><span class="quoted"><span class="quoted">"wgreater <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="main">(</span>Greater <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> wGreaterF<span class="main">:</span><span class="quoted"><span class="quoted">"wgeq <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="main">(</span>Greater <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> wGeqT<span class="main">:</span><span class="quoted"><span class="quoted">"wgeq <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> wGeqF<span class="main">:</span><span class="quoted"><span class="quoted">"wgreater <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="main">(</span>Geq <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> wEqualsT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
             <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">≠</span> NEG_INF<span class="main">)</span><span class="main">;</span> 
             <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span> <span class="main">≠</span> POS_INF<span class="main">)</span><span class="main">⟧</span> 
         <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>Equals <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> wEqualsF1<span class="main">:</span><span class="quoted"><span class="quoted">"wgreater <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main"><span class="free">[[</span></span>Equals <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> wEqualsF2<span class="main">:</span><span class="quoted"><span class="quoted">"wgreater <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]&lt;&gt;</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main"><span class="free">[[</span></span>Equals <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">θ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">]]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> wAndT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">;</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> wAndF1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> wAndF2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> wOrT1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> wOrT2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>Or <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> wOrF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">;</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>And <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> wNotT<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>Not <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> wNotF<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> True<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>Not <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> False<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span>
    wfsem_Gr_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span><span class="free">Le</span> <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> wfsem_And_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span>And <span class="free">φ</span> <span class="free">ψ</span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> wfsem_Or_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span>Or <span class="free">φ</span> <span class="free">ψ</span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> wfsem_Not_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span>Not <span class="free">φ</span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> wfsem_Equals_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span>Equals <span class="free">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Program semantics›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">wpsem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"prog <span class="main">⇒</span>  wstate <span class="main">⇒</span> wstate <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[[</span>_<span class="keyword1">]]</span>_ <span class="keyword1">↓</span> _<span class="keyword3">)</span>"</span> 20<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  wTest<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">]]</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">↓</span> True<span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="main">?</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free">]]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> wSeq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]]</span></span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> wAssign<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">(</span><span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">:=</span> snd<span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">:=</span> fst<span class="main">(</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main">]&lt;&gt;</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>Assign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">θ</span></span></span><span class="main"><span class="free">]]</span></span> <span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> wChoice1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>Choice <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> wChoice2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span>Choice <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="free"><span class="bound"><span class="entity">β</span></span></span><span class="main"><span class="free">]]</span></span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span>
    wpsem_Test_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span>Test <span class="free">φ</span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> wpsem_Seq_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span><span class="free">α</span><span class="main">;;</span> <span class="free">β</span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> wpsem_Assign_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span>Assign <span class="free">x</span> <span class="free">θ</span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> wpsem_Choice_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span>Choice <span class="free">α</span> <span class="free">β</span><span class="main">]]</span><span class="free">ν</span> <span class="main">↓</span> <span class="free">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> real_max_mono <span class="main">=</span>  Lattices.linorder_class.max.mono  
<span class="keyword1"><span class="command">lemmas</span></span> real_minus_le_minus <span class="main">=</span> Groups.ordered_ab_group_add_class.neg_le_iff_le

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interval state consists of upper and lower bounds for each real variable›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">represents_state</span><span class="main">::</span><span class="quoted"><span class="quoted">"wstate <span class="main">⇒</span> rstate <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">REP</span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> REPI<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">(</span>Inl <span class="bound">x</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="main">(</span>Inr <span class="bound">x</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ν</span></span></span> <span class="keyword1"><span class="free">REP</span></span> <span class="free"><span class="bound"><span class="entity">ν'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_simps</span></span> repstate_simps<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="keyword1">REP</span> <span class="free">ν'</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Soundness proofs›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interval term valuation soundly contains real valuation›</span></span>
<span class="keyword1" id="Interpreter-trm_sound"><span class="command">lemma</span></span> trm_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">θ</span><span class="main">::</span><span class="quoted"><span class="quoted">"trm"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">θ</span><span class="main">]</span><span class="free">ν'</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="free">ν'</span><span class="main">)</span> <span class="main">⟹</span>   <span class="main">(</span><span class="main">[</span><span class="free">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtsem.induct<span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> rtsem_Const 
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">r</span> <span class="skolem">ν'</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Rep_bword <span class="skolem">w</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">r</span> <span class="main">⟹</span> <span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span>Const <span class="skolem">w</span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> repU_def repL_def repP_def repe.simps <span class="dynamic"><span class="dynamic">rep_simps</span></span> repstate_simps 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> rtsem_Var
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">ν'</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span>Var <span class="skolem">x</span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">ν'</span> <span class="skolem">x</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def repL_def repP_def repe.simps <span class="dynamic"><span class="dynamic">rep_simps</span></span> repstate_simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> rtsem_Plus
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ν'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"rstate"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">r1</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">r2</span>
   <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r1</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">assume</span></span> eval2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r2</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        lu1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> lu2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH1 IH2 repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> lu1 <span class="keyword2"><span class="keyword">and</span></span> lu2 <span class="keyword1"><span class="command">have</span></span>
        lu1'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> lu2'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1 lu1 <span class="keyword1"><span class="command">unfolding</span></span> repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> u1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1 lu1 <span class="keyword1"><span class="command">unfolding</span></span> repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH2 lu2 <span class="keyword1"><span class="command">unfolding</span></span> repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> u2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH2 lu2 <span class="keyword1"><span class="command">unfolding</span></span> repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="main">(</span>Plus <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pl <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">,</span> pu <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>  
   <span class="keyword1"><span class="command">using</span></span> lu1' lu2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lBound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>pl <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">r1</span> <span class="main">+</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l1 l2 pl_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> uBound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>pu <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="skolem">r1</span> <span class="main">+</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pu_lemma<span class="main">[</span><span class="operator">OF</span> u1 u2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pl <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">,</span> pu <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="main">(</span><span class="skolem">r1</span> <span class="main">+</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> repP_def Let_def <span class="keyword1"><span class="command">using</span></span> lBound uBound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>Plus <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span> <span class="main">+</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lu1' lu2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> rtsem_Times
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ν'</span> <span class="skolem">r1</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">r2</span>
   <span class="keyword3"><span class="command">assume</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r1</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> eval2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r2</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        lu1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span> "</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> lu2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH1 IH2 repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1 lu1 <span class="keyword1"><span class="command">unfolding</span></span> repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> u1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH1 lu1 <span class="keyword1"><span class="command">unfolding</span></span> repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH2 lu2 <span class="keyword1"><span class="command">unfolding</span></span> repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> u2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH2 lu2 <span class="keyword1"><span class="command">unfolding</span></span> repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="main">(</span>Times <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span>  <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tl <span class="skolem">l1</span> <span class="skolem">u1</span> <span class="skolem">l2</span> <span class="skolem">u2</span><span class="main">,</span> tu <span class="skolem">l1</span> <span class="skolem">u1</span> <span class="skolem">l2</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>  
   <span class="keyword1"><span class="command">using</span></span> lu1 lu2 <span class="keyword1"><span class="command">unfolding</span></span> wTimesU Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> lBound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">l1</span> <span class="skolem">u1</span> <span class="skolem">l2</span> <span class="skolem">u2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="skolem">r1</span> <span class="main">*</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l1 u1 l2 u2 tl_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> uBound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>tu <span class="skolem">l1</span> <span class="skolem">u1</span> <span class="skolem">l2</span> <span class="skolem">u2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="skolem">r1</span> <span class="main">*</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l1 u1 l2 u2 tu_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">l1</span> <span class="skolem">u1</span> <span class="skolem">l2</span> <span class="skolem">u2</span><span class="main">,</span> tu <span class="skolem">l1</span> <span class="skolem">u1</span> <span class="skolem">l2</span> <span class="skolem">u2</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="main">(</span><span class="skolem">r1</span> <span class="main">*</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> repP_def Let_def <span class="keyword1"><span class="command">using</span></span> lBound uBound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Times <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span> <span class="main">*</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lu1 lu2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> rtsem_Max
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ν'</span> <span class="skolem">r1</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">r2</span>
   <span class="keyword3"><span class="command">assume</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> eval2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        lu1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> lu2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH1 IH2 repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> IH1 IH2 
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub1</span></span> <span class="skolem"><span class="skolem">ub2</span></span> <span class="skolem"><span class="skolem">lb1</span></span> <span class="skolem"><span class="skolem">lb2</span></span><span class="main">::</span> <span class="quoted">real</span> 
   <span class="keyword2"><span class="keyword">where</span></span> urep1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ub1</span> <span class="main">≥</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ub1</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span>   urep2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ub2</span> <span class="main">≥</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ub2</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>   lrep1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lb1</span> <span class="main">≤</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">lb1</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span>   lrep2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lb2</span> <span class="main">≤</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">lb2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> repP_def repU_def repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> lbound<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> max <span class="skolem">r1</span> <span class="skolem">r2</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.trans fst_conv le_cases lrep1 lrep2 lu1 lu2 max_def repL_def wmax.elims<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> ubound<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> max <span class="skolem">r1</span> <span class="skolem">r2</span>"</span></span>     
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> real_max_mono lu1 lu2 repU_def snd_conv urep1 urep2 wmax_lemma<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>trm.Max <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>wmax <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">,</span> wmax <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> lu1 lu2 <span class="keyword1"><span class="command">unfolding</span></span> wMaxU Let_def 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>trm.Max <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> max <span class="skolem">r1</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> repP_def
    <span class="keyword1"><span class="command">using</span></span> lbound ubound lu1 lu2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> rtsem_Min
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ν'</span> <span class="skolem">r1</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">r2</span>
   <span class="keyword3"><span class="command">assume</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> eval2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        lu1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> lu2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH1 IH2 repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> IH1 IH2 
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub1</span></span> <span class="skolem"><span class="skolem">ub2</span></span> <span class="skolem"><span class="skolem">lb1</span></span> <span class="skolem"><span class="skolem">lb2</span></span><span class="main">::</span> <span class="quoted">real</span> 
   <span class="keyword2"><span class="keyword">where</span></span> urep1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ub1</span> <span class="main">≥</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ub1</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span>   urep2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ub2</span> <span class="main">≥</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ub2</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>   lrep1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lb1</span> <span class="main">≤</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">lb1</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span>   lrep2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lb2</span> <span class="main">≤</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">lb2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> prod.case_eq_if repP_def  repU_def repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> lbound<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> min <span class="skolem">r1</span> <span class="skolem">r2</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv lrep1 lrep2 lu1 lu2 min.mono repL_def wmin_lemma<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> ubound<span class="main">:</span><span class="quoted"><span class="quoted">"wmin <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> min <span class="skolem">r1</span> <span class="skolem">r2</span>"</span></span>     
     <span class="keyword1"><span class="command">using</span></span> lu1 lu2 min_le_iff_disj repU_def urep1 urep2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>Min <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>wmin <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">,</span> wmin <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> lu1 lu2 <span class="keyword1"><span class="command">unfolding</span></span> wMinU Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Min <span class="skolem">θ<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">θ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> min <span class="skolem">r1</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> repP_def
    <span class="keyword1"><span class="command">using</span></span> lbound ubound lu1 lu2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> rtsem_Neg
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">θ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ν'</span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> eval<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ</span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span>  <span class="keyword2"><span class="keyword">where</span></span> 
        lu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> IH repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> IH 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="skolem"><span class="skolem">lb</span></span><span class="main">::</span> <span class="quoted">real</span> 
   <span class="keyword2"><span class="keyword">where</span></span> urep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ub</span> <span class="main">≥</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ub</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span>   lrep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lb</span> <span class="main">≤</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">lb</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  repP_def repU_def repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ubound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>wneg <span class="skolem">u1</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span>uminus <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> real_minus_le_minus lu repL_def snd_conv urep wneg_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lbound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>wneg <span class="skolem">l1</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span>uminus <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_minus_le_minus lu repU_def lrep wneg_lemma
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Neg <span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="main">-</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> repP_def Let_def <span class="keyword1"><span class="command">using</span></span> ubound lbound lu 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> rtsem_Abs
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">θ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"trm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ν'</span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> eval<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ</span><span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">u1</span></span>  <span class="keyword2"><span class="keyword">where</span></span> 
        lu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span> <span class="free">ν</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> IH repP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> IH 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="skolem"><span class="skolem">lb</span></span><span class="main">::</span> <span class="quoted">real</span> 
   <span class="keyword2"><span class="keyword">where</span></span> urep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ub</span> <span class="main">≥</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">ub</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span>   lrep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lb</span> <span class="main">≤</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">lb</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> prod.case_eq_if repP_def  repU_def repL_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lbound<span class="main">:</span><span class="quoted"><span class="quoted">"wmax <span class="skolem">l1</span> <span class="main">(</span>wneg <span class="skolem">u1</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span>abs <span class="skolem">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repL_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"max <span class="skolem">lb</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">ub</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>  
    <span class="keyword1"><span class="command">using</span></span> lrep wmax_lemma lu urep wneg_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ubound<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>wmax <span class="skolem">u1</span> <span class="main">(</span>wneg <span class="skolem">l1</span><span class="main">)</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>U</sub></span> <span class="main">(</span>abs <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repU_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"max <span class="skolem">ub</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">lb</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> lrep wmax_lemma lu urep wneg_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Abs <span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>P</sub></span> abs <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> repP_def Let_def ubound lbound lu lu wAbsU <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Every word represents some real›</span></span>
<span class="keyword1" id="Interpreter-word_rep"><span class="command">lemma</span></span> word_rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">bw</span><span class="main">::</span>bword<span class="main">.</span> <span class="main">∃</span><span class="bound">r</span><span class="main">::</span>real<span class="main">.</span> Rep_bword <span class="bound">bw</span> <span class="keyword1">≡<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bw</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> weq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> Rep_bword <span class="skolem">bw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> negInfCase<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> NEG_INF <span class="main">⟹</span> <span class="var">?thesis</span> <span class="skolem">bw</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> weq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> posInfCase<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> POS_INF <span class="main">⟹</span> <span class="var">?thesis</span> <span class="skolem">bw</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="numeral">31</span><span class="main">)</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> weq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repe.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> boundU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="skolem">w</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> sint <span class="main">(</span>Rep_bword <span class="skolem">bw</span><span class="main">)</span> <span class="main">&lt;</span> sint POS_INF"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_bword <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bw</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_le weq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sint_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> boundL<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="skolem">w</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> sint NEG_INF <span class="main">&lt;</span> sint <span class="main">(</span>Rep_bword <span class="skolem">bw</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_bword <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">bw</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_le weq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sint_dist<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> intCase<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> NEG_INF <span class="main">⟹</span> <span class="skolem">w</span> <span class="main">≠</span> POS_INF <span class="main">⟹</span> <span class="var">?thesis</span> <span class="skolem">bw</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">" <span class="main">(</span>real_of_int <span class="main">(</span>sint <span class="main">(</span>Rep_bword <span class="skolem">bw</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> repINT<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> boundU boundL <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">bw</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> POS_INF"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> NEG_INF"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> posInfCase intCase negInfCase <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Every term has a value›</span></span>
<span class="keyword1" id="Interpreter-eval_tot"><span class="command">lemma</span></span> eval_tot<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">θ</span><span class="main">::</span>trm<span class="main">]</span><span class="free">ν'</span> <span class="main">↓</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">θ</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Min_def word_rep bword_neg_one_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interval formula semantics soundly implies real semantics›</span></span>
<span class="keyword1" id="Interpreter-fml_sound"><span class="command">lemma</span></span> fml_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ</span><span class="main">::</span><span class="quoted"><span class="quoted">"formula"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ν</span><span class="main">::</span><span class="quoted"><span class="quoted">"wstate"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>wfsem <span class="free">φ</span> <span class="free">ν</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">ν</span> <span class="keyword1">REP</span> <span class="free">ν'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>rfsem <span class="free">φ</span> <span class="free">ν'</span>  <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ν'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wfsem.induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wGreaterT <span class="skolem">t1</span> <span class="skolem">v</span> <span class="skolem">t2</span> <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> wle<span class="main">:</span><span class="quoted"><span class="quoted">"wgreater <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">REP</span> <span class="skolem">w</span>"</span></span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t1</span><span class="main">]</span><span class="skolem">w</span> <span class="main">↓</span> <span class="skolem">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  eval2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t2</span><span class="main">]</span><span class="skolem">w</span> <span class="main">↓</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rep1 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">r1</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval1 rep<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> rep2 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval2 rep<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Greater <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">]</span><span class="skolem">w</span> <span class="main">⇂</span> True"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rGreaterT<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?r1.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">r1</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?r2.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wgreater_lemma<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w1.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"snd<span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> rep1 rep2 wle repP_def repL_def repU_def  eval1 eval2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if <span class="main"><span class="keyword3">|</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wGreaterF <span class="skolem">t2</span> <span class="skolem">v</span> <span class="skolem">t1</span> <span class="skolem">v'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> wl<span class="main">:</span><span class="quoted"><span class="quoted">"wgeq <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">REP</span> <span class="skolem">v'</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">where</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rtsem <span class="skolem">t1</span> <span class="skolem">v'</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
    eval2<span class="main">:</span><span class="quoted"><span class="quoted">"rtsem <span class="skolem">t2</span> <span class="skolem">v'</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rep1 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r1</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval1 rep<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> rep2 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval2 rep<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Greater <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">]</span><span class="skolem">v'</span> <span class="main">⇂</span> False"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rGreaterF <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eval1<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eval2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wgeq_lemma<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w1.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?w2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"snd<span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> rep1 rep2 repP_def wgeq_lemma wl rep
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wGeqT <span class="skolem">t1</span> <span class="skolem">v</span> <span class="skolem">t2</span> <span class="skolem">v'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"wgeq <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">REP</span> <span class="skolem">v'</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">where</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rtsem <span class="skolem">t1</span> <span class="skolem">v'</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
    eval2<span class="main">:</span><span class="quoted"><span class="quoted">"rtsem <span class="skolem">t2</span> <span class="skolem">v'</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rep1 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r1</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval1 rep<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> rep2 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval2 rep<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Geq <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">]</span><span class="skolem">v'</span> <span class="main">⇂</span> True"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rGeqT<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eval1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eval2<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> wgeq_lemma eval1 eval2 rep1 rep2 <span class="keyword1"><span class="command">unfolding</span></span> repP_def Let_def
  <span class="keyword1"><span class="command">using</span></span> wgreater_lemma prod.case_eq_if a1
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wGeqF <span class="skolem">t2</span> <span class="skolem">v</span> <span class="skolem">t1</span> <span class="skolem">v'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"wgreater <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">REP</span> <span class="skolem">v'</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">where</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rtsem <span class="skolem">t1</span> <span class="skolem">v'</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
    eval2<span class="main">:</span><span class="quoted"><span class="quoted">"rtsem <span class="skolem">t2</span> <span class="skolem">v'</span>  <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rep1 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r1</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval1 rep<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> rep2 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval2 rep<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Geq <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">]</span><span class="skolem">v'</span> <span class="main">⇂</span> False"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rGeqF<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eval1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eval2<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> wgeq_lemma eval1 eval2 rep1 rep2 <span class="keyword1"><span class="command">unfolding</span></span> repP_def Let_def
  <span class="keyword1"><span class="command">using</span></span> wgreater_lemma rGreaterF prod.case_eq_if a1 rGreaterF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wEqualsT <span class="skolem">t2</span> <span class="skolem">v</span> <span class="skolem">t1</span> <span class="skolem">v'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> eq1<span class="main">:</span><span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq3<span class="main">:</span><span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">REP</span> <span class="skolem">v'</span>"</span></span>  
  <span class="keyword3"><span class="command">assume</span></span> neq1<span class="main">:</span><span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span> <span class="main">≠</span> NEG_INF"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq2<span class="main">:</span><span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span> <span class="main">≠</span> POS_INF"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">where</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rtsem <span class="skolem">t1</span> <span class="skolem">v'</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
        eval2<span class="main">:</span><span class="quoted"><span class="quoted">"rtsem <span class="skolem">t2</span> <span class="skolem">v'</span>  <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rep1 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r1</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval1 rep<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> rep2 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval2 rep<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Equals <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">]</span><span class="skolem">v'</span> <span class="main">⇂</span> True"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rEqualsT<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eval1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eval2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eq1 eq2 eq3 eval1 eval2 rep1 rep2
    <span class="keyword1"><span class="command">unfolding</span></span> repP_def Let_def repL_def repU_def repe.simps <span class="keyword1"><span class="command">using</span></span> neq1 neq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wEqualsF1 <span class="skolem">t1</span> <span class="skolem">v</span> <span class="skolem">t2</span> <span class="skolem">v'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> wle<span class="main">:</span><span class="quoted"><span class="quoted">"wgreater <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">REP</span> <span class="skolem">v'</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">where</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rtsem <span class="skolem">t1</span> <span class="skolem">v'</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
    eval2<span class="main">:</span><span class="quoted"><span class="quoted">"rtsem <span class="skolem">t2</span> <span class="skolem">v'</span>  <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rep1 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r1</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval1 rep<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> rep2 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval2 rep<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Equals <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">]</span><span class="skolem">v'</span> <span class="main">⇂</span> False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rEqualsF<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eval1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eval2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> wgeq_lemma eval1 eval2 rep1 rep2 wgreater_lemma rGreaterF  prod.case_eq_if wle
    <span class="keyword1"><span class="command">unfolding</span></span> repP_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_irrefl<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wEqualsF2 <span class="skolem">t2</span> <span class="skolem">v</span> <span class="skolem">t1</span> <span class="skolem">v'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> wle<span class="main">:</span><span class="quoted"><span class="quoted">"wgreater <span class="main">(</span>fst <span class="main">(</span><span class="main">[</span><span class="skolem">t2</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="main">[</span><span class="skolem">t1</span><span class="main">]&lt;&gt;</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">REP</span> <span class="skolem">v'</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">where</span></span> eval1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>rtsem <span class="skolem">t1</span> <span class="skolem">v'</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
    eval2<span class="main">:</span><span class="quoted"><span class="quoted">"rtsem <span class="skolem">t2</span> <span class="skolem">v'</span>  <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> eval_tot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rep1 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r1</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval1 rep<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> rep2 <span class="main">=</span> trm_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ν<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> eval2 rep<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Equals <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">]</span><span class="skolem">v'</span> <span class="main">⇂</span> False"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rEqualsF<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eval1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> eval2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> wgeq_lemma eval1 eval2 rep1 rep2  wgreater_lemma rGreaterF prod.case_eq_if wle
    <span class="keyword1"><span class="command">unfolding</span></span> repP_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_irrefl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  
<span class="keyword1" id="Interpreter-rep_upd"><span class="command">lemma</span></span> rep_upd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ω</span> <span class="main">=</span> <span class="main">(</span><span class="free">ν</span><span class="main">(</span>Inr <span class="free">x</span> <span class="main">:=</span> snd<span class="main">(</span><span class="main">[</span><span class="free">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span>Inl <span class="free">x</span> <span class="main">:=</span> fst<span class="main">(</span><span class="main">[</span><span class="free">θ</span><span class="main">]&lt;&gt;</span><span class="free">ν</span><span class="main">)</span><span class="main">)</span>
<span class="main">⟹</span> <span class="free">ν</span> <span class="keyword1">REP</span> <span class="free">ν'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">θ</span><span class="main">::</span>trm<span class="main">]</span><span class="free">ν'</span> <span class="main">↓</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">ω</span> <span class="keyword1">REP</span> <span class="free">ν'</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> REPI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> repL_def<span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> trm_sound prod.case_eq_if repP_def repstate_simps repL_def 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Inl_Inr_False fun_upd_apply sum.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> repP_def repstate_simps repU_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repU_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> surjective_pairing trm_sound<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interval program semantics soundly contains real semantics existentially›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> interval_program_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">α</span><span class="main">::</span><span class="quoted"><span class="quoted">"prog"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span><span class="free">α</span><span class="main">]]</span> <span class="free">ν</span> <span class="main">↓</span> <span class="free">ω</span><span class="main">)</span>  <span class="main">⟹</span> <span class="free">ν</span> <span class="keyword1">REP</span> <span class="free">ν'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ω'</span><span class="main">.</span> <span class="main">(</span><span class="free">ω</span> <span class="keyword1">REP</span> <span class="bound">ω'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">α</span><span class="main">]</span> <span class="free">ν'</span> <span class="main">⇃</span> <span class="bound">ω'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ν'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wpsem.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wTest <span class="skolem">φ</span> <span class="skolem">ν</span> <span class="skolem">ω</span> <span class="skolem">ν'</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> sem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[[</span><span class="skolem">φ</span><span class="main">]]</span><span class="skolem">ν</span> <span class="main">↓</span> True"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="main">=</span> <span class="skolem">ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ν'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> sem rep <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq fml_sound rep<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wAssign <span class="skolem">ω</span> <span class="skolem">ν</span> <span class="skolem">x</span> <span class="skolem">θ</span> <span class="skolem">ν'</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">=</span> <span class="skolem">ν</span><span class="main">(</span>Inr <span class="skolem">x</span> <span class="main">:=</span> snd <span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="skolem">ν</span><span class="main">)</span><span class="main">,</span> Inl <span class="skolem">x</span> <span class="main">:=</span> fst <span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">]&lt;&gt;</span><span class="skolem">ν</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rep<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ν</span> <span class="keyword1">REP</span> <span class="skolem">ν'</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> eval<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">θ</span><span class="main">::</span>trm<span class="main">]</span><span class="skolem">ν'</span> <span class="main">↓</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eval_tot  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ν'</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">r</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rep_upd<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq rep eval<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wSeq <span class="skolem">α</span> <span class="skolem">ν</span> <span class="skolem">μ</span> <span class="skolem">β</span> <span class="skolem">ω</span> <span class="skolem">ν'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wChoice1 <span class="skolem">a</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="skolem">v'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wChoice2 <span class="skolem">a</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="skolem">v'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>