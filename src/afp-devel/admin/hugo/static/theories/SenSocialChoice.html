<div id="FSext">
<div class="head">
<h1>Theory FSext</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Finite Set lemmas.
 * (C)opyright Peter Gammie, peteg42 at gmail.com, commenced July 2006.
 * License: BSD
 *)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> FSext

<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹General Lemmas›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Extra Finite-Set Lemmas›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Small variant of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] "Finite_Set.finite_subset_induct"<span class="antiquote"><span class="antiquote">}</span></span></span></span>:
also assume <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span> <span class="main"><span class="main">⊆</span></span> <span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the induction hypothesis.›</span></span>

<span class="keyword1" id="FSext-finite_subset_induct'"><span class="command">lemma</span></span> finite_subset_induct' <span class="main">[</span><span class="operator">consumes</span> 2<span class="main">,</span> <span class="operator">case_names</span> empty insert<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">F</span><span class="main">.</span> <span class="main">⟦</span>finite <span class="bound">F</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∉</span> <span class="bound">F</span><span class="main">;</span> <span class="free">P</span> <span class="bound">F</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>insert <span class="bound">a</span> <span class="bound">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">F</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">F</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A slight improvement on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] "List.finite_list"<span class="antiquote"><span class="antiquote">}</span></span></span></span> - add
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"distinct"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="FSext-finite_list"><span class="command">lemma</span></span> finite_list<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">l</span><span class="main">.</span> set <span class="bound">l</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main">∧</span> distinct <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">F</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Extra bijection lemmas›</span></span>

<span class="keyword1" id="FSext-bij_betw_onto"><span class="command">lemma</span></span> bij_betw_onto<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="FSext-inj_on_UnI"><span class="command">lemma</span></span> inj_on_UnI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> inj_on <span class="free">f</span> <span class="free">A</span><span class="main">;</span> inj_on <span class="free">f</span> <span class="free">B</span><span class="main">;</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">∩</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> inj_on <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> inj_on_Un<span class="main">)</span>

<span class="keyword1" id="FSext-card_compose_bij"><span class="command">lemma</span></span> card_compose_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bijf<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> bijf <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">{</span> <span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> bijf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span> <span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_inj_on card_image<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> T <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-card_eq_bij"><span class="command">lemma</span></span> card_eq_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cardAB<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> finiteB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finiteA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g</span> <span class="free">A</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ex_bij_betw_finite_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finiteB <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">h</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="free">B</span><span class="main">}</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ex_bij_betw_nat_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> G H cardAB <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="skolem">h</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> comp_inj_on<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> G H cardAB <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> image_cong image_image<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="skolem">h</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-bij_combine"><span class="command">lemma</span></span> bij_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ABCD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">D</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bijf<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">C</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bijg<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">g</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">D</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">h</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">h</span> <span class="free">B</span> <span class="free">D</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?h</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> inj_on_UnI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> bijf <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?h</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_onD bij_betw_imp_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> bijg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?h</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_onD bij_betw_imp_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> bijf bijg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="var">?h</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bij_betw_onto<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> ABCD <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?h</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> Un_absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ABCD <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> image_Un Un_absorb1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> ABCD bijf bijg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bij_betw_onto<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?h</span> <span class="free">B</span> <span class="free">D</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="var">?h</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟹</span> <span class="var">?h</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-bij_complete"><span class="command">lemma</span></span> bij_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteC<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ABC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bijf<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f'</span> <span class="free">C</span> <span class="free">C</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f'</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finiteC ABC bijf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> inj_on_iff_eq_card <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> finiteC ABC bijf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> finite_subset card_Diff_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> finiteC <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> bijg<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> card_eq_bij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ABC bijf bijg
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> bijf'<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f'</span> <span class="free">C</span> <span class="free">C</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> f'f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> f'g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> bij_combine<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> f'g bijg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">-</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bij_betw_onto<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> bijf' f'f <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-card_greater"><span class="command">lemma</span></span> card_greater<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">}</span> <span class="main">&gt;</span> card <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">C</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">}</span> <span class="main">-</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?PA</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?QA</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> finiteA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">p</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>card <span class="var">?PA</span><span class="main">}</span> <span class="var">?PA</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_bij_betw_nat_finite<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> M<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?PA</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?CN</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>card <span class="var">?QA</span><span class="main">..&lt;</span>card <span class="var">?PA</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">`</span> <span class="var">?CN</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">}</span> <span class="main">-</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?QA</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> nat_add_sub_shuffle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span> <span class="bound">y</span><span class="main">;</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">`</span> <span class="main">{</span>card <span class="var">?QA</span><span class="main">..&lt;</span>card <span class="var">?PA</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?PA</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?PA</span> <span class="main">-</span> card <span class="var">?QA</span> <span class="main">=</span> card <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> card_image subset_inj_on<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?CN</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?PA</span> <span class="main">-</span> card <span class="var">?C</span> <span class="main">=</span> card <span class="var">?QA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_add_sub_shuffle<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> finiteA P T <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?PA</span> <span class="main">-</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?QA</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> finite_subset card_Diff_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> P c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Collections of witnesses: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">hasw</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">has</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹

Given a set of cardinality at least $n$, we can find up to $n$ distinct
witnesses. The built-in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"card"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function unfortunately satisfies:

\begin{center}
 <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] "Finite_Set.card.infinite"<span class="antiquote"><span class="antiquote">}</span></span></span></span>: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Finite_Set.card.infinite"
 <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}

These lemmas handle the infinite case uniformly.

Thanks to Gerwin Klein suggesting this approach.

›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hasw</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hasw</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> distinct <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">has</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> hasw <span class="bound">xs</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> hasw_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1" id="FSext-hasI"><span class="command">lemma</span></span> hasI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="free">xs</span> <span class="free">S</span> <span class="main">⟹</span> has <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> has_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FSext-card_has"><span class="command">lemma</span></span> card_has<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cardS<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has <span class="free">n</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> cardS card_eq_0_iff<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> finiteS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> nhas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> has <span class="free">n</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> distinct_card<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> nxs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> distinct <span class="bound">xs</span> <span class="main">∧</span> card <span class="main">(</span>set <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> finite_list finiteS
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> set <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> cardS nxs <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-card_has_rev"><span class="command">lemma</span></span> card_has_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has <span class="free">n</span> <span class="free">S</span> <span class="main">⟹</span> card <span class="free">S</span> <span class="main">≥</span> <span class="free">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟹</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dxs<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> has_def hasw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> card_mono<span class="main">[</span><span class="operator">OF</span> finiteS<span class="main">]</span> distinct_card<span class="main">[</span><span class="operator">OF</span> dxs<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-has_0"><span class="command">lemma</span></span> has_0<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="main">0</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_def<span class="main">)</span>

<span class="keyword1" id="FSext-has_suc_notempty"><span class="command">lemma</span></span> has_suc_notempty<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">{}</span> <span class="main">≠</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_def<span class="main">)</span>

<span class="keyword1" id="FSext-has_suc_subset"><span class="command">lemma</span></span> has_suc_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">{}</span> <span class="main">⊂</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> psubsetI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_suc_notempty<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="FSext-has_notempty_1"><span class="command">lemma</span></span> has_notempty_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Sne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has <span class="main">1</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Sne <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> distinct <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∧</span> length <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> has_def hasw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-has_le_has"><span class="command">lemma</span></span> has_le_has<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="free">n</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has <span class="free">n'</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"hasw <span class="skolem">xs</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> has_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> nn' set_take_subset<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">xs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hasw <span class="main">(</span>take <span class="free">n'</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>take <span class="free">n'</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> has_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-has_ge_has_not"><span class="command">lemma</span></span> has_ge_has_not<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>has <span class="free">n</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">n'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>has <span class="free">n'</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h nn' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> has_le_has<span class="main">)</span>

<span class="keyword1" id="FSext-has_eq"><span class="command">lemma</span></span> has_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="free">n</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> hn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>has <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="skolem">xs</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lenxs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> has_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> xs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> set <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">S</span> <span class="main">⊆</span> set <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> lenxs xs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hasw <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> hn' <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> has_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> xs lenxs distinct_card <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-has_extend_witness"><span class="command">lemma</span></span> has_extend_witness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="free">n</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">S</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> set <span class="free">xs</span> <span class="main">⊂</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">with</span></span> h has_suc_notempty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> Sxxs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> finiteS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> Sxs'<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs'</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> dlxs'<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs'</span> <span class="main">∧</span> length <span class="skolem">xs'</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> has_def hasw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> distinct_card <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> finiteS Sxs' card_mono <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">≥</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> Sxxs Cons card_length<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-has_extend_witness'"><span class="command">lemma</span></span> has_extend_witness'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> has <span class="free">n</span> <span class="free">S</span><span class="main">;</span> hasw <span class="free">xs</span> <span class="free">S</span><span class="main">;</span> length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> hasw <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> has_extend_witness<span class="main">)</span>

<span class="keyword1" id="FSext-has_witness_two"><span class="command">lemma</span></span> has_witness_two<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hasnS<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="free">n</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> hasw <span class="main">[</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">]</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> has2S<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">2</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_le_has<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hasnS nn'<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> has_extend_witness'<span class="main">[</span><span class="operator">OF</span> has2S<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> has_extend_witness'<span class="main">[</span><span class="operator">OF</span> has2S<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-has_witness_three"><span class="command">lemma</span></span> has_witness_three<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hasnS<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="free">n</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> hasw <span class="main">[</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">]</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> nn' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_witness_two<span class="main">[</span><span class="operator">OF</span> hasnS<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> nn' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> has_extend_witness'<span class="main">[</span><span class="operator">OF</span> hasnS<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSext-finite_set_singleton_contra"><span class="command">lemma</span></span> finite_set_singleton_contra<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Sne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cardS<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> cardS Sne card_0_eq<span class="main">[</span><span class="operator">OF</span> finiteS<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> Scard<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> has_extend_witness<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> card_has<span class="main"><span class="main">[</span></span><span class="operator">OF</span> this<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> card_seteq<span class="main">[</span><span class="operator">OF</span> finiteS this<span class="main">]</span> Scard <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="RPRs">
<div class="head">
<h1>Theory RPRs</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Rational Preference Relations (RPRs).
 * (C)opyright Peter Gammie, peteg42 at gmail.com, commenced July 2006.
 * License: BSD
 *)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> RPRs

<span class="keyword2"><span class="keyword">imports</span></span> <a href="FSext.html">FSext</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

The auxiliary concepts defined here are standard \cite{Routley:79, Sen:70a,
Taylor:2005}. Throughout we make use of a fixed set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of
alternatives, drawn from some arbitrary type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of suitable
size. Taylor \cite{Taylor:2005} terms this set an \emph{agenda}. Similarly
we have a type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'i</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of individuals and a population <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Is</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

›</span></span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Rational Preference Relations (RPRs)›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

Definitions for rational preference relations (RPRs), which represent
indifference or strict preference amongst some set of alternatives.  These
are also called \emph{weak orders} or (ambiguously) \emph{ballots}.

Unfortunately Isabelle's standard ordering operators and lemmas are
typeclass-based, and as introducing new types is painful and we need several
orders per type, we need to repeat some things.

›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> RPR <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rpr_eq_syntax</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> RPR <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⇘</span>_<span class="keyword1">⇙≼</span> _"</span> <span class="main">[</span>50<span class="main">,</span> 1000<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indifferent_pref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> RPR <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⇘</span>_<span class="keyword1">⇙≈</span> _"</span> <span class="main">[</span>50<span class="main">,</span> 1000<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≈ <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="RPRs-indifferent_prefI"><span class="command">lemma</span></span> indifferent_prefI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indifferent_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RPRs-indifferent_prefD"><span class="command">lemma</span></span> indifferent_prefD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> indifferent_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strict_pref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> RPR <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⇘</span>_<span class="keyword1">⇙≺</span> _"</span> <span class="main">[</span>50<span class="main">,</span> 1000<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≺ <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="RPRs-strict_pref_def_irrefl"><span class="command">lemma</span></span> strict_pref_def_irrefl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RPRs-strict_prefI"><span class="command">lemma</span></span> strict_prefI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">;</span> <span class="main">¬</span><span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

Traditionally, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="free">r</span></span></sub><span class="hidden">⇙</span>≼ <span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would be written $x\ R\ y$,
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="free">r</span></span></sub><span class="hidden">⇙</span>≈ <span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as $x\ I\ y$ and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>
<span class="hidden">⇘</span><sub><span class="free"><span class="free">r</span></span></sub><span class="hidden">⇙</span>≺ <span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as $x\ P\ y$, where the relation $r$ is implicit, and
profiles are indexed by subscripting.

›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

\emph{Complete} means that every pair of distinct alternatives is
ranked. The "distinct" part is a matter of taste, as it makes sense to
regard an alternative as as good as itself. Here I take reflexivity
separately.

›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complete</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> RPR <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complete</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">∨</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="RPRs-completeI"><span class="command">lemma</span></span> completeI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">∨</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> complete <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RPRs-completeD"><span class="command">lemma</span></span> completeD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> complete <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RPRs-complete_less_not"><span class="command">lemma</span></span> complete_less_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> complete <span class="free">A</span> <span class="free">r</span><span class="main">;</span> hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span><span class="main">;</span> <span class="main">¬</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complete_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RPRs-complete_indiff_not"><span class="command">lemma</span></span> complete_indiff_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> complete <span class="free">A</span> <span class="free">r</span><span class="main">;</span> hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span><span class="main">;</span> <span class="main">¬</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complete_def indifferent_pref_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RPRs-complete_exh"><span class="command">lemma</span></span> complete_exh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>xPy<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>yPx<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>xIy<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> complete_def strict_pref_def indifferent_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

Use the standard <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"refl"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Also define \emph{irreflexivity}
analogously to how <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"refl"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is defined in the standard library.

›</span></span>

<span class="keyword1"><span class="command">declare</span></span> refl_onI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> refl_onD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span>

<span class="keyword1" id="RPRs-complete_refl_on"><span class="command">lemma</span></span> complete_refl_on<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> complete <span class="free">A</span> <span class="free">r</span><span class="main">;</span> refl_on <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">irrefl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> RPR <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">irrefl</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">×</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="RPRs-irreflI"><span class="command">lemma</span></span> irreflI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span> <span class="main">⟧</span> <span class="main">⟹</span> irrefl <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RPRs-irreflD"><span class="command">lemma</span></span> irreflD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> irrefl <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RPRs-irreflD'"><span class="command">lemma</span></span> irreflD'<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> irrefl <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> hasw <span class="main">[</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">]</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Rational preference relations, also known as weak orders and (I
guess) complete pre-orders.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> RPR <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rpr</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> complete <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> refl_on <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> trans <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1" id="RPRs-rprI"><span class="command">lemma</span></span> rprI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> complete <span class="free">A</span> <span class="free">r</span><span class="main">;</span> refl_on <span class="free">A</span> <span class="free">r</span><span class="main">;</span> trans <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> rpr <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RPRs-rprD"><span class="command">lemma</span></span> rprD<span class="main">:</span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> complete <span class="free">A</span> <span class="free">r</span> <span class="main">∧</span> refl_on <span class="free">A</span> <span class="free">r</span> <span class="main">∧</span> trans <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RPRs-rpr_in_set"><span class="command">lemma</span></span> rpr_in_set<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> rpr <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def refl_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RPRs-rpr_refl"><span class="command">lemma</span></span> rpr_refl<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> rpr <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RPRs-rpr_less_not"><span class="command">lemma</span></span> rpr_less_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> rpr <span class="free">A</span> <span class="free">r</span><span class="main">;</span> hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span><span class="main">;</span> <span class="main">¬</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_less_not<span class="main">)</span>

<span class="keyword1" id="RPRs-rpr_less_imp_le"><span class="command">lemma</span></span> rpr_less_imp_le<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RPRs-rpr_less_imp_neq"><span class="command">lemma</span></span> rpr_less_imp_neq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RPRs-rpr_less_trans"><span class="command">lemma</span></span> rpr_less_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span><span class="main">;</span> rpr <span class="free">A</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def strict_pref_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RPRs-rpr_le_trans"><span class="command">lemma</span></span> rpr_le_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">;</span> rpr <span class="free">A</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RPRs-rpr_le_less_trans"><span class="command">lemma</span></span> rpr_le_less_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span><span class="main">;</span> rpr <span class="free">A</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def strict_pref_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RPRs-rpr_less_le_trans"><span class="command">lemma</span></span> rpr_less_le_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">;</span> rpr <span class="free">A</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def strict_pref_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RPRs-rpr_complete"><span class="command">lemma</span></span> rpr_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> rpr <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> complete_refl_on<span class="main">)</span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Profiles›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A \emph{profile} (also termed a collection of \emph{ballots}) maps
each individual to an RPR for that individual.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> RPR"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">profile</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">profile</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> rpr <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="RPRs-profileI"><span class="command">lemma</span></span> profileI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> rpr <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span><span class="main">;</span> <span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> profile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RPRs-profile_rprD"><span class="command">lemma</span></span> profile_rprD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span><span class="main">;</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟧</span> <span class="main">⟹</span> rpr <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> profile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RPRs-profile_non_empty"><span class="command">lemma</span></span> profile_non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> profile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="SCFs">
<div class="head">
<h1>Theory SCFs</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Social Choice Functions (SCFs).
 * (C)opyright Peter Gammie, peteg42 at gmail.com, commenced July 2006.
 * License: BSD
 *)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> SCFs

<span class="keyword2"><span class="keyword">imports</span></span> <a href="RPRs.html">RPRs</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Choice Sets, Choice Functions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A \emph{choice set} is the subset of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where every element
of that subset is (weakly) preferred to every other element of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
with respect to a given RPR. A \emph{choice function} yields a non-empty
choice set whenever <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is non-empty.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">choiceSet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> RPR <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">choiceSet</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">choiceFn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> RPR <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">choiceFn</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound"><span class="bound">A'</span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">A'</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> choiceSet <span class="bound">A'</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1" id="SCFs-choiceSetI"><span class="command">lemma</span></span> choiceSetI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> choiceSet <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> choiceSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SCFs-choiceFnI"><span class="command">lemma</span></span> choiceFnI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">A'</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">A'</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="bound">A'</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> choiceSet <span class="bound">A'</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> choiceFn <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> choiceFn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If a complete and reflexive relation is also \emph{quasi-transitive}
it will yield a choice function.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quasi_trans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> RPR <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quasi_trans</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≺ <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>≺ <span class="bound">z</span>"</span></span>

<span class="keyword1" id="SCFs-quasi_transI"><span class="command">lemma</span></span> quasi_transI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">;</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="bound">z</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> quasi_trans <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quasi_trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="SCFs-quasi_transD"><span class="command">lemma</span></span> quasi_transD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span><span class="main">;</span> quasi_trans <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quasi_trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="SCFs-trans_imp_quasi_trans"><span class="command">lemma</span></span> trans_imp_quasi_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span> <span class="main">⟹</span> quasi_trans <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quasi_transI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> strict_pref_def trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="SCFs-r_c_qt_imp_cf"><span class="command">lemma</span></span> r_c_qt_imp_cf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> qt<span class="main">:</span> <span class="quoted"><span class="quoted">"quasi_trans <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"choiceFn <span class="free">A</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> finite_subset finiteA <span class="keyword1"><span class="command">have</span></span> finiteB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finiteB B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"choiceSet <span class="skolem">B</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_subset_induct'<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">with</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">B</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> finiteB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> aB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> cF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> choiceSet <span class="skolem">B</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> aA r <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> choiceSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> cF <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> bCF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> choiceSet <span class="skolem">B</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> AB aA bCF complete_refl_on<span class="main">[</span><span class="operator">OF</span> c r<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> choiceSet_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> bCF <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> choiceSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> choiceSet <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">B</span><span class="main">)</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> aCF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> choiceSet <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">B</span><span class="main">)</span> <span class="free">r</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> aB <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> aCF aA AB c r <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> choiceSet_def complete_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> ab qt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> quasi_transD<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> bCF B <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> choiceSet_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SCFs-rpr_choiceFn"><span class="command">lemma</span></span> rpr_choiceFn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">A</span><span class="main">;</span> rpr <span class="free">A</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> choiceFn <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rpr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trans_imp_quasi_trans r_c_qt_imp_cf<span class="main">)</span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Social Choice Functions (SCFs)›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A \emph{social choice function} (SCF), also called a
\emph{collective choice rule} by Sen \cite[p28]{Sen:70a}, is a function that
somehow aggregates society's opinions, expressed as a profile, into a
preference relation.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> <span class="tfree">'a</span> RPR"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The least we require of an SCF is that it be \emph{complete} and
some function of the profile. The latter condition is usually implied by
other conditions, such as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">iia</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">SCF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SCF</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">Pcond</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Pcond</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">⟶</span> <span class="main">(</span>complete <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SCFs-SCFI"><span class="command">lemma</span></span> SCFI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="free">Pcond</span> <span class="free">A</span> <span class="free">Is</span> <span class="bound">P</span> <span class="main">⟹</span> complete <span class="free">A</span> <span class="main">(</span><span class="free">scf</span> <span class="bound">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SCF <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">Pcond</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SCF_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="SCFs-SCF_completeD"><span class="command">lemma</span></span> SCF_completeD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> SCF <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">Pcond</span><span class="main">;</span> <span class="free">Pcond</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> complete <span class="free">A</span> <span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SCF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Social Welfare Functions (SWFs)›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A \emph{Social Welfare Function} (SWF) is an SCF that expresses the
society's opinion as a single RPR.

In some situations it might make sense to restrict the allowable
profiles.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">SWF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SWF</span> <span class="free"><span class="bound"><span class="entity">swf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">Pcond</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Pcond</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">⟶</span> rpr <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">swf</span></span></span> <span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SCFs-SWF_rpr"><span class="command">lemma</span></span> SWF_rpr<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">Pcond</span><span class="main">;</span> <span class="free">Pcond</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> rpr <span class="free">A</span> <span class="main">(</span><span class="free">swf</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SWF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹General Properties of an SCF›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An SCF has a \emph{universal domain} if it works for all profiles.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">universal_domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">universal_domain</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> profile <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> universal_domain_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An SCF is \emph{weakly Pareto-optimal} if, whenever everyone strictly
prefers <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the SCF does too.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">weak_pareto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">weak_pareto</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">Pcond</span></span></span> <span class="main">≡</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Pcond</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SCFs-weak_paretoI"><span class="command">lemma</span></span> weak_paretoI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Pcond</span> <span class="free">A</span> <span class="free">Is</span> <span class="bound">P</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">Is</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">)</span>
  <span class="main">⟹</span> weak_pareto <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">Pcond</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> weak_pareto_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SCFs-weak_paretoD"><span class="command">lemma</span></span> weak_paretoD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> weak_pareto <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">Pcond</span><span class="main">;</span> <span class="free">Pcond</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span>
     <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> weak_pareto_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

An SCF satisfies \emph{independence of irrelevant alternatives} if, for two
preference profiles <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where for all individuals
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">i</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, alternatives <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> drawn from set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="free">S</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> have the same order in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="free"><span class="free">i</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P'</span></span> <span class="free"><span class="free">i</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then
alternatives <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> have the same order in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">scf</span></span>
<span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">scf</span></span> <span class="free"><span class="free">P'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iia</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iia</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">P'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> profile <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">∧</span> profile <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P'</span>
      <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SCFs-iiaI"><span class="command">lemma</span></span> iiaI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">P</span> <span class="bound">P'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
    <span class="main">⟦</span> profile <span class="free">S</span> <span class="free">Is</span> <span class="bound">P</span><span class="main">;</span> profile <span class="free">S</span> <span class="free">Is</span> <span class="bound">P'</span><span class="main">;</span>
      <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="bound">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> iia <span class="free">swf</span> <span class="free">S</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> iia_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SCFs-iiaE"><span class="command">lemma</span></span> iiaE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> iia <span class="free">swf</span> <span class="free">S</span> <span class="free">Is</span><span class="main">;</span>
     <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">S</span><span class="main">;</span>
     <span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span><span class="main">;</span>
     <span class="main">⋀</span><span class="bound">i</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span><span class="main">;</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span><span class="main">;</span>
     profile <span class="free">S</span> <span class="free">Is</span> <span class="free">P</span><span class="main">;</span> profile <span class="free">S</span> <span class="free">Is</span> <span class="free">P'</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="free">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> iia_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Decisiveness and Semi-decisiveness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This notion is the key to Arrow's Theorem, and hinges on the use of
strict preference \cite[p42]{Sen:70a}.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A coalition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of agents is \emph{semi-decisive} for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> over <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if, whenever the coalition prefers <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and all other agents prefer the converse, the coalition
prevails.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">semidecisive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">semidecisive</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>
    <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> profile <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>
      <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SCFs-semidecisiveI"><span class="command">lemma</span></span> semidecisiveI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">Is</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="main">⟦</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="bound">P</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">-</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">⟧</span>
     <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> semidecisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">C</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> semidecisive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SCFs-semidecisive_coalitionD"><span class="command">lemma</span></span> semidecisive_coalitionD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">C</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> semidecisive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SCFs-sd_refl"><span class="command">lemma</span></span> sd_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">Is</span><span class="main">;</span> <span class="free">C</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> semidecisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">C</span> <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> semidecisive_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A coalition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">C</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is \emph{decisive} for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> over
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if, whenever the coalition prefers <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
the coalition prevails.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decisive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">decisive</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>
    <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> profile <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SCFs-decisiveI"><span class="command">lemma</span></span> decisiveI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">Is</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="main">⟦</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="bound">P</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span>
    <span class="main">⟹</span> decisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">C</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> decisive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SCFs-d_imp_sd"><span class="command">lemma</span></span> d_imp_sd<span class="main">:</span> <span class="quoted"><span class="quoted">"decisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">C</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> semidecisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">C</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> decisive_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> semidecisiveI<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="SCFs-decisive_coalitionD"><span class="command">lemma</span></span> decisive_coalitionD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"decisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">C</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> decisive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Anyone is trivially decisive for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> against <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="SCFs-d_refl"><span class="command">lemma</span></span> d_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">Is</span><span class="main">;</span> <span class="free">C</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> decisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">C</span> <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> decisive_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Agent <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">j</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a \emph{dictator} if her preferences always
prevail. This is the same as saying that she is decisive for all <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dictator</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="tfree">'i</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dictator</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> decisive <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">}</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SCFs-dictatorI"><span class="command">lemma</span></span> dictatorI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">j</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> decisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span> dictator <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dictator_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SCFs-dictator_individual"><span class="command">lemma</span></span> dictator_individual<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dictator <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dictator_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Arrow">
<div class="head">
<h1>Theory Arrow</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Arrow's General Possibility Theorem, following Sen.
 * (C)opyright Peter Gammie, peteg42 at gmail.com, commenced July 2006.
 * License: BSD
 *)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Arrow

<span class="keyword2"><span class="keyword">imports</span></span> <a href="SCFs.html">SCFs</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Arrow's General Possibility Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

The proof falls into two parts: showing that a semi-decisive individual is
in fact a dictator, and that a semi-decisive individual exists. I take them
in that order.

It might be good to do some of this in a locale. The complication is
untangling where various witnesses need to be quantified over.

›</span></span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Semi-decisiveness Implies Decisiveness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

I follow \cite[Chapter~3*]{Sen:70a} quite closely here. Formalising his
appeal to the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"iia"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> assumption is the main complication here.

›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The witness for the first lemma: in the profile $P'$, special agent
$j$ strictly prefers $x$ to $y$ to $z$, and doesn't care about the other
alternatives. Everyone else strictly prefers $y$ to each of $x$ to $z$, and
inherits the relative preferences between $x$ and $z$ from profile $P$.

The model has to be specific about ordering all the other alternatives, but
these are immaterial in the proof that uses this witness. Note also that the
following lemma is used with different instantiations of $x$, $y$ and $z$,
so we need to quantify over them here. This happens implicitly, but in a
locale we would have to be more explicit.

This is just tedious.›</span></span>

<span class="keyword1" id="Arrow-decisive1_witness"><span class="command">lemma</span></span> decisive1_witness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> jIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P'</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>
                           <span class="keyword1">else</span> <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>
                               <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="var">?P'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> has3A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> rprI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">from</span></span> iIs profileP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_complete<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ij <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> iIs profileP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rpr_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> has3A ij <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> ij has3A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> profileP <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> profile_non_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> has3A
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The key lemma: in the presence of Arrow's assumptions, an individual
who is semi-decisive for $x$ and $y$ is actually decisive for $x$ over any
other alternative $z$. (This is where the quantification becomes important.) 
›</span></span>

<span class="keyword1" id="Arrow-decisive1"><span class="command">lemma</span></span> decisive1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> sd <span class="keyword3"><span class="command">show</span></span> jIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> jxzP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> has3A profileP jIs
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> profileP'<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> jxyzP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ixyzP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟶</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> decisive1_witness<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> iia <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iiaE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> has3A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> ab iIs ixyzP' profileP profileP' has3A
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> profile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> profileP' jIs jxyzP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True ab iIs jxzP profileP profileP' has3A
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> profile_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> profileP profileP'<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> profileP' sd jxyzP' ixyzP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semidecisive_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> jxyzP' ixyzP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="free">j</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> wp profileP' has3A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> weak_paretoD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> SWF_rpr<span class="main">[</span><span class="operator">OF</span> swf<span class="main">]</span> profileP'
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> universal_domain_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_less_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The witness for the second lemma: special agent $j$ strictly prefers
$z$ to $x$ to $y$, and everyone else strictly prefers $z$ to $x$ and $y$ to
$x$. (In some sense the last part is upside-down with respect to the first
witness.)›</span></span>

<span class="keyword1" id="Arrow-decisive2_witness"><span class="command">lemma</span></span> decisive2_witness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> jIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P'</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">z</span><span class="main">}</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>
                           <span class="keyword1">else</span> <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">z</span><span class="main">}</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>
                               <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="var">?P'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> has3A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> rprI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">from</span></span> iIs profileP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rpr_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ij <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> iIs profileP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rpr_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> has3A ij <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> ij has3A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> profile_non_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> profileP<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> has3A
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow-decisive2"><span class="command">lemma</span></span> decisive2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">z</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> sd <span class="keyword3"><span class="command">show</span></span> jIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> jyzP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> has3A profileP jIs
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> profileP'<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> jxyzP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ixyzP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟶</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> decisive2_witness<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> iia <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iiaE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> has3A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> ab iIs ixyzP' profileP profileP' has3A
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> profile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> profileP' jIs jxyzP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True ab iIs jyzP profileP profileP' has3A
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> profile_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> profileP profileP'<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> profileP' sd jxyzP' ixyzP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semidecisive_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> jxyzP' ixyzP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="free">j</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> wp profileP' has3A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> weak_paretoD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> SWF_rpr<span class="main">[</span><span class="operator">OF</span> swf<span class="main">]</span> profileP'
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> universal_domain_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_less_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following results permute $x$, $y$ and $z$ to show how
decisiveness can be obtained from semi-decisiveness in all cases. Again,
quite tedious.›</span></span>

<span class="keyword1" id="Arrow-decisive3"><span class="command">lemma</span></span> decisive3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has3A decisive2<span class="main">[</span><span class="operator">OF</span> _ iia swf wp sd<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Arrow-decisive4"><span class="command">lemma</span></span> decisive4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has3A decisive1<span class="main">[</span><span class="operator">OF</span> _ iia swf wp sd<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Arrow-decisive5"><span class="command">lemma</span></span> decisive5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sd
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decisive1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has3A iia swf wp<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> d_imp_sd<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decisive3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has3A iia swf wp<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> d_imp_sd<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decisive4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has3A iia swf wp<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow-decisive6"><span class="command">lemma</span></span> decisive6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">z</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> has3A <span class="keyword1"><span class="command">have</span></span> has3A'<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decisive1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has3A' iia swf wp sd<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">z</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decisive2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has3A' iia swf wp sd<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decisive5<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has3A' iia swf wp sd<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow-decisive7"><span class="command">lemma</span></span> decisive7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">z</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sd
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decisive5<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has3A iia swf wp<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> d_imp_sd<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">z</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decisive6<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has3A iia swf wp<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow-j_decisive_xy"><span class="command">lemma</span></span> j_decisive_xy<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">]</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> uv decisive1<span class="main">[</span><span class="operator">OF</span> has3A iia swf wp sd<span class="main">]</span>
           decisive2<span class="main">[</span><span class="operator">OF</span> has3A iia swf wp sd<span class="main">]</span>
           decisive5<span class="main">[</span><span class="operator">OF</span> has3A iia swf wp sd<span class="main">]</span>
           decisive7<span class="main">[</span><span class="operator">OF</span> has3A iia swf wp sd<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Arrow-j_decisive"><span class="command">lemma</span></span> j_decisive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">3</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">]</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> has_extend_witness'<span class="main">[</span><span class="operator">OF</span> has3A xyA<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> xyzA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> xyzA iia swf wp sd <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive_xy<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vNEy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> uv xyA iia swf wp sd <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive_xy<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> xyzA iia swf wp sd <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive_xy<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vNEx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> uv xyA iia swf wp sd <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive_xy<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> uNExy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> uv xyA iia swf wp sd <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive_xy<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> uNExy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> uv xyA iia swf wp sd <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive_xy<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> uNExy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vNExy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> uv xyA iia swf wp sd
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive_xy<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> z<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">u</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> sdxu<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">x</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> d_imp_sd<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> uNExy vNExy uv xyA iia swf wp <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive_xy<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first result: if $j$ is semidecisive for some alternatives $u$
and $v$, then they are actually a dictator.›</span></span>

<span class="keyword1" id="Arrow-sd_imp_dictator"><span class="command">lemma</span></span> sd_imp_dictator<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">3</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dictator <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> sd <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> d_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> x y iia swf wp has3A uv sd <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> j_decisive<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> sd <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Existence of a Semi-decisive Individual›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The second half of the proof establishes the existence of a
semi-decisive individual. The required witness is essentially an encoding of
the Condorcet pardox (aka "the paradox of voting" that shows we get tied up
in knots if a certain agent didn't have dictatorial powers.›</span></span>

<span class="keyword1" id="Arrow-sd_exists_witness"><span class="command">lemma</span></span> sd_exists_witness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">=</span> <span class="free">V1</span> <span class="main">∪</span> <span class="free">V2</span> <span class="main">∪</span> <span class="free">V3</span>
                <span class="main">∧</span> <span class="free">V1</span> <span class="main">∩</span> <span class="free">V2</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">V1</span> <span class="main">∩</span> <span class="free">V3</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">V2</span> <span class="main">∩</span> <span class="free">V3</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">V1</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">V2</span><span class="main">.</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">V3</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span> <span class="main">∧</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">V1</span> <span class="keyword1">then</span>  <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                         <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">}</span>
                         <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">}</span><span class="main">)</span>
                    <span class="keyword1">else</span> 
          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">V2</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                        <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">z</span> <span class="main">}</span>
                        <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">z</span> <span class="main">}</span><span class="main">)</span> 
                   <span class="keyword1">else</span>  <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                        <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">}</span>
                        <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="free">z</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> has3A iIs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> has3A iIs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> Is <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> has3A Vs
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">V1</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">V2</span><span class="main">.</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">V3</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">z</span> <span class="main">∧</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This proof is unfortunately long. Many of the statements rely on a
lot of context, making it difficult to split it up.›</span></span>

<span class="keyword1" id="Arrow-sd_exists"><span class="command">lemma</span></span> sd_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">3</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteIs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> twoIs<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">2</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> hasw <span class="main">[</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">]</span> <span class="free">A</span> <span class="main">∧</span> semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="bound">u</span> <span class="bound">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">Is</span> <span class="main">∧</span> <span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> hasw <span class="main">[</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">]</span> <span class="free">A</span> <span class="main">∧</span> semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="bound">S</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> uvA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">]</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> has_witness_two<span class="main">[</span><span class="operator">OF</span> has3A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹The weak pareto requirement implies that the set of all
      individuals is decisive between any given alternatives.›</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"decisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">Is</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> weak_paretoD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wp<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">Is</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> d_imp_sd<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> uvA twoIs has_suc_notempty<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span><span class="main">]</span> nat_2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹Obtain a minimally-sized semi-decisive set.›</span>
  <span class="keyword1"><span class="command">from</span></span> ex_has_least_nat<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"card"</span></span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> VIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="free">Is</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Vnotempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Vsd<span class="main">:</span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="skolem">V</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Vmin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">V'</span> <span class="main">⟹</span> card <span class="skolem">V</span> <span class="main">≤</span> card <span class="bound">V'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> VIs finiteIs <span class="keyword1"><span class="command">have</span></span> Vfinite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
      <span class="comment1">― ‹Show that minimal set contains a single individual.›</span>
  <span class="keyword1"><span class="command">from</span></span> Vfinite Vnotempty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> finite_set_singleton_contra<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Vcard<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> jV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_extend_witness<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> card_has<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"card <span class="skolem">V</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="comment1">― ‹Split an individual from the "minimal" set.›</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">j</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">-</span> <span class="var">?V1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">-</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> jV card_Diff_singleton<span class="main">[</span><span class="operator">OF</span> Vfinite<span class="main">]</span> Vcard
    <span class="keyword1"><span class="command">have</span></span> V2card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?V2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?V2</span> <span class="main">&lt;</span> card <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> V2notempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">≠</span> <span class="var">?V2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> jV VIs
    <span class="keyword1"><span class="command">have</span></span> jV2V3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">=</span> <span class="var">?V1</span> <span class="main">∪</span> <span class="var">?V2</span> <span class="main">∪</span> <span class="var">?V3</span> <span class="main">∧</span> <span class="var">?V1</span> <span class="main">∩</span> <span class="var">?V2</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?V1</span> <span class="main">∩</span> <span class="var">?V3</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?V2</span> <span class="main">∩</span> <span class="var">?V3</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="comment1">― ‹Show that that individual is semi-decisive for $x$ over $z$.›</span>
    <span class="keyword1"><span class="command">from</span></span> has_extend_witness'<span class="main">[</span><span class="operator">OF</span> has3A xyA<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> threeDist<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> sd_exists_witness<span class="main">[</span><span class="operator">OF</span> threeDist jV2V3<span class="main">]</span> VIs Vnotempty
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> V1xyzP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> V2xyzP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?V2</span><span class="main">.</span> <span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> V3xyzP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?V3</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> xPz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> rpr_less_le_trans<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> y<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> profileP swf <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
        <span class="comment1">― ‹V2 is semi-decisive, and everyone else opposes their choice. Ergo they prevail.›</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> profileP V3xyzP
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?V3</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_less_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> profileP V1xyzP V2xyzP Vsd
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> semidecisive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="comment1">― ‹This result is unfortunately quite tortuous.›</span>
      <span class="keyword1"><span class="command">from</span></span> SWF_rpr<span class="main">[</span><span class="operator">OF</span> swf<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> rpr_less_not<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ notI<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> threeDist <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">y</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> zPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="var">?V2</span> <span class="skolem">z</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword1"><span class="command">from</span></span> VIs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P'</span>
          <span class="keyword3"><span class="command">assume</span></span> profileP'<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P'</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> V2yz'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?V2</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> nV2yz'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">-</span> <span class="var">?V2</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> iia <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iiaE<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> threeDist <span class="keyword3"><span class="command">show</span></span> yzA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> VIs profileP V2xyzP
            <span class="keyword1"><span class="command">have</span></span> V2yzP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?V2</span><span class="main">.</span> <span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_less_trans<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?V2</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">with</span></span> VIs profileP profileP' ab V2yz' V2yzP threeDist
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def profile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">from</span></span> V1xyzP V3xyzP
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">-</span> <span class="var">?V2</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> iIs False VIs jV profileP profileP' ab nV2yz' threeDist
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> profile_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> profileP profileP'<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> zPy <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> VIs Vsd Vmin<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?V2</span>"</span></span><span class="main">]</span> V2card V2notempty threeDist <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> profileP threeDist<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"semidecisive <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="var">?V1</span> <span class="skolem">x</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> jV VIs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="comment1">― ‹Use <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"iia"</span><span class="antiquote">}</span></span> to show the SWF must allow the individual to prevail.›</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P'</span>
      <span class="keyword3"><span class="command">assume</span></span> profileP'<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P'</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> V1yz'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?V1</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> nV1yz'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">-</span> <span class="var">?V1</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> iia <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iiaE<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> threeDist <span class="keyword3"><span class="command">show</span></span> xzA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?V1</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> jV VIs profileP V1xyzP
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?V1</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_less_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> True jV VIs profileP profileP' ab V1yz' threeDist
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def profile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">from</span></span> V2xyzP V3xyzP
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">-</span> <span class="var">?V1</span><span class="main">.</span> <span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> iIs False VIs jV profileP profileP' ab nV1yz' threeDist
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def profile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> profileP profileP'<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> xPz <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">swf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> jV VIs Vsd Vmin<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?V1</span>"</span></span><span class="main">]</span> V2card threeDist <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> xyA Vsd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Arrow's General Possibility Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

Finally we conclude with the celebrated ``possibility'' result. Note that we
assume the set of individuals is finite; \cite{Routley:79} relaxes this with
some fancier set theory. Having an infinite set of alternatives doesn't
matter, though the result is a bit more plausible if we assume finiteness
\cite[p54]{Sen:70a}.

›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ArrowGeneralPossibility<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has3A<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">3</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteIs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> has2Is<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">2</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> iia<span class="main">:</span> <span class="quoted"><span class="quoted">"iia <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> swf<span class="main">:</span> <span class="quoted"><span class="quoted">"SWF <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">j</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"dictator <span class="free">swf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sd_imp_dictator<span class="main">[</span><span class="operator">OF</span> has3A iia swf wp<span class="main">]</span>
        sd_exists<span class="main">[</span><span class="operator">OF</span> has3A finiteIs has2Is iia swf wp<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Sen">
<div class="head">
<h1>Theory Sen</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Sen's SDF results and Liberal Paradox.
 * (C)opyright Peter Gammie, peteg42 at gmail.com, commenced July 2006.
 * License: BSD
 *)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Sen

<span class="keyword2"><span class="keyword">imports</span></span> <a href="SCFs.html">SCFs</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Sen's Liberal Paradox›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Social Decision Functions (SDFs)›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹To make progress in the face of Arrow's Theorem, the demands placed
on the social choice function need to be weakened. One approach is to only
require that the set of alternatives that society ranks highest (and is
otherwise indifferent about) be non-empty.

Following \cite[Chapter~4*]{Sen:70a}, a \emph{Social Decision Function}
(SDF) yields a choice function for every profile.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">SDF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SDF</span> <span class="free"><span class="bound"><span class="entity">sdf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">Pcond</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Pcond</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">⟶</span> choiceFn <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">sdf</span></span></span> <span class="bound">P</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sen-SDFI"><span class="command">lemma</span></span> SDFI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="free">Pcond</span> <span class="free">A</span> <span class="free">Is</span> <span class="bound">P</span> <span class="main">⟹</span> choiceFn <span class="free">A</span> <span class="main">(</span><span class="free">sdf</span> <span class="bound">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> SDF <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="free">Pcond</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SDF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Sen-SWF_SDF"><span class="command">lemma</span></span> SWF_SDF<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SWF <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain <span class="main">⟹</span> SDF <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SDF_def SWF_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_choiceFn<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finiteA<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In contrast to SWFs, there are SDFs satisfying Arrow's (relevant)
requirements. The lemma uses a witness to show the absence of a
dictatorship.›</span></span>

<span class="keyword1" id="Sen-SDF_nodictator_witness"><span class="command">lemma</span></span> SDF_nodictator_witness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has2A<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> has2Is<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">]</span> <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>
                          <span class="keyword1">else</span> <span class="main">(</span><span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> has2A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> rprI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> has2Is <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> has2A has2Is
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sen-SDF_possibility"><span class="command">lemma</span></span> SDF_possibility<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> has2A<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">2</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> has2Is<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">2</span> <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">sdf</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"iia <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> dictator <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"SDF <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sdf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span>
                             <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"weak_pareto <span class="var">?sdf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> profile_non_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iia <span class="var">?sdf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">.</span> dictator <span class="var">?sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> dictator <span class="var">?sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> jIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> jD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> decisive <span class="var">?sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dictator_def decisive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> jIs has_witness_two<span class="main">[</span><span class="operator">OF</span> has2Is<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> ijIs<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">]</span> <span class="free">Is</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> has_witness_two<span class="main">[</span><span class="operator">OF</span> has2A<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> xyA ijIs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> yPix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> yPjx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SDF_nodictator_witness<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> profileP jD jIs xyA yPjx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> decisive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> ijIs xyA yPjx yPix <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SDF <span class="var">?sdf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> ud<span class="main">:</span> <span class="quoted"><span class="quoted">"universal_domain <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"choiceFn <span class="free">A</span> <span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> r_c_qt_imp_cf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finiteA<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"quasi_trans <span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> xy yz <span class="keyword1"><span class="command">have</span></span> xyzA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> xy yz <span class="keyword1"><span class="command">have</span></span> AxRy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> ExPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> AyRz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> AxRy AyRz ud <span class="keyword1"><span class="command">have</span></span> AxRz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">unfold</span> universal_domain_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_le_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> ExPy AyRz ud <span class="keyword1"><span class="command">have</span></span> ExPz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">unfold</span> universal_domain_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_less_le_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> xyzA AxRz ExPz <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sen makes several other stronger statements about SDFs later in the
chapter. I leave these for future work.›</span></span>

<span class="comment1">(* **************************************** *)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Sen's Liberal Paradox›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Having side-stepped Arrow's Theorem, Sen proceeds to other conditions
one may ask of an SCF. His analysis of \emph{liberalism}, mechanised in this
section, has attracted much criticism over the years
\cite{AnalyseKritik:1996}.

Following \cite[Chapter~6*]{Sen:70a}, a \emph{liberal} social choice rule is
one that, for each individual, there is a pair of alternatives that she is
decisive over.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">liberal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">liberal</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>
      <span class="main">∧</span> decisive <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> decisive <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sen-liberalE"><span class="command">lemma</span></span> liberalE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> liberal <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span><span class="main">;</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>
         <span class="main">∧</span> decisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> decisive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">y</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> liberal_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This condition can be weakened to require just two such decisive
individuals; if we required just one, we would allow dictatorships, which
are clearly not liberal.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minimally_liberal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minimally_liberal</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>
         <span class="main">∧</span> decisive <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> decisive <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>
         <span class="main">∧</span> decisive <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> decisive <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sen-liberal_imp_minimally_liberal"><span class="command">lemma</span></span> liberal_imp_minimally_liberal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> has2Is<span class="main">:</span> <span class="quoted"><span class="quoted">"has <span class="numeral">2</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"liberal <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minimally_liberal <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> has_extend_witness<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> has2Is<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> has_extend_witness<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">i</span><span class="main">]</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> has2Is<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> L i j <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> minimally_liberal_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> liberalE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

The key observation is that once we have at least two decisive individuals
we can complete the Condorcet (paradox of voting) cycle using the weak
Pareto assumption. The details of the proof don't give more insight.

Firstly we need three types of profile witnesses (one of which we saw
previously). The main proof proceeds by case distinctions on which
alternatives the two liberal agents are decisive for.

›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> liberal_witness_two <span class="main">=</span> SDF_nodictator_witness

<span class="keyword1" id="Sen-liberal_witness_three"><span class="command">lemma</span></span> liberal_witness_three<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> threeA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">v</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> twoIs<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">]</span> <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>
                  <span class="keyword1">else</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> threeA iis <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> threeA iis <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> twoIs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> threeA twoIs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sen-liberal_witness_four"><span class="command">lemma</span></span> liberal_witness_four<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fourA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> twoIs<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">]</span> <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">{</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">x</span><span class="main">}</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>
                  <span class="keyword1">else</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">|</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">y</span><span class="main">}</span> <span class="main">}</span>
                     <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">,</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fourA iis <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fourA iis <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="var">?P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> twoIs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> fourA twoIs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="free">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The Liberal Paradox: having two decisive individuals, an SDF and the
weak pareto assumption is inconsistent.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LiberalParadox<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> SDF<span class="main">:</span> <span class="quoted"><span class="quoted">"SDF <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ml<span class="main">:</span> <span class="quoted"><span class="quoted">"minimally_liberal <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_pareto <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ml <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dixy<span class="main">:</span> <span class="quoted"><span class="quoted">"decisive <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> diyx<span class="main">:</span> <span class="quoted"><span class="quoted">"decisive <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> djuv<span class="main">:</span> <span class="quoted"><span class="quoted">"decisive <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> djvu<span class="main">:</span> <span class="quoted"><span class="quoted">"decisive <span class="free">sdf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="skolem">v</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> minimally_liberal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> i j ij <span class="keyword1"><span class="command">have</span></span> twoIs<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">]</span> <span class="free">Is</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xy x y <span class="keyword1"><span class="command">have</span></span> twoA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> liberal_witness_two<span class="main">[</span><span class="operator">OF</span> twoA twoIs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> i j dixy djvu xu yv <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> xy uv xu x y v <span class="keyword1"><span class="command">have</span></span> threeA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">v</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> xPiy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> vPjx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> AyPv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> liberal_witness_three<span class="main">[</span><span class="operator">OF</span> threeA twoIs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> vPjx j djvu xu profileP <span class="keyword1"><span class="command">have</span></span> vPx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> xPiy i dixy profileP <span class="keyword1"><span class="command">have</span></span> xPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AyPv weak_paretoD<span class="main">[</span><span class="operator">OF</span> wp _ y v<span class="main">]</span> profileP <span class="keyword1"><span class="command">have</span></span> yPv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> threeA profileP SDF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"choiceSet <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span> <span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SDF_def choiceFn_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> vPx xPy yPv <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> choiceSet_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xy x y <span class="keyword1"><span class="command">have</span></span> twoA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> liberal_witness_two<span class="main">[</span><span class="operator">OF</span> twoA twoIs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> i j dixy djuv xv yu <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> xy uv u x y <span class="keyword1"><span class="command">have</span></span> threeA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">u</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> xPiy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> uPjx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> AyPu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> liberal_witness_three<span class="main">[</span><span class="operator">OF</span> threeA twoIs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> uPjx j djuv xv profileP <span class="keyword1"><span class="command">have</span></span> uPx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> xPiy i dixy profileP <span class="keyword1"><span class="command">have</span></span> xPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AyPu weak_paretoD<span class="main">[</span><span class="operator">OF</span> wp _ y u<span class="main">]</span> profileP <span class="keyword1"><span class="command">have</span></span> yPu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> threeA profileP SDF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"choiceSet <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">u</span><span class="main">}</span> <span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SDF_def choiceFn_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> uPx xPy yPu <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> choiceSet_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> v x y xy uv xu <span class="keyword1"><span class="command">have</span></span> threeA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">v</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> yPix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> vPjy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> AxPv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> liberal_witness_three<span class="main">[</span><span class="operator">OF</span> threeA twoIs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> yPix i diyx profileP <span class="keyword1"><span class="command">have</span></span> yPx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> vPjy j djvu yu profileP <span class="keyword1"><span class="command">have</span></span> vPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AxPv weak_paretoD<span class="main">[</span><span class="operator">OF</span> wp _ x v<span class="main">]</span> profileP <span class="keyword1"><span class="command">have</span></span> xPv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> threeA profileP SDF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"choiceSet <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span> <span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SDF_def choiceFn_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> yPx vPy xPv <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> choiceSet_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> u x y xy uv xu <span class="keyword1"><span class="command">have</span></span> threeA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">u</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> yPix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> uPjy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> AxPu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> liberal_witness_three<span class="main">[</span><span class="operator">OF</span> threeA twoIs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> yPix i diyx profileP <span class="keyword1"><span class="command">have</span></span> yPx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> uPjy j djuv yv profileP <span class="keyword1"><span class="command">have</span></span> uPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AxPu weak_paretoD<span class="main">[</span><span class="operator">OF</span> wp _ x u<span class="main">]</span> profileP <span class="keyword1"><span class="command">have</span></span> xPu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> threeA profileP SDF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"choiceSet <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">u</span><span class="main">}</span> <span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SDF_def choiceFn_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> yPx uPy xPu <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> choiceSet_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> u v x y xy uv xu <span class="keyword1"><span class="command">have</span></span> fourA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">]</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> xPiy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> uPjv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">v</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> AvPxAyPu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> liberal_witness_four<span class="main">[</span><span class="operator">OF</span> fourA twoIs<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> xPiy i dixy profileP <span class="keyword1"><span class="command">have</span></span> xPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> uPjv j djuv profileP <span class="keyword1"><span class="command">have</span></span> uPv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> decisive_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AvPxAyPu weak_paretoD<span class="main">[</span><span class="operator">OF</span> wp<span class="main">]</span> profileP x y u v
    <span class="keyword1"><span class="command">have</span></span> vPx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yPu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> fourA profileP SDF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"choiceSet <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span> <span class="main">(</span><span class="free">sdf</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SDF_def choiceFn_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> xPy uPv vPx yPu <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> choiceSet_def strict_pref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="May">
<div class="head">
<h1>Theory May</h1>
</div>
<pre class="source"><span class="comment1">(*
 * May's Theorem, following Sen.
 * (C)opyright Peter Gammie, peteg42 at gmail.com, commenced October 2008.
 * License: BSD
 *)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> May

<span class="keyword2"><span class="keyword">imports</span></span> <a href="SCFs.html">SCFs</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹May's Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹May's Theorem \cite{May:1952} provides a characterisation of
majority voting in terms of four conditions that appear quite natural for
\emph{a priori} unbiased social choice scenarios. It can be seen as a
refinement of some earlier work by Arrow \cite[Chapter V.1]{Arrow:1963}.

The following is a mechanisation of Sen's generalisation
\cite[Chapter~5*]{Sen:70a}; originally Arrow and May consider only two
alternatives, whereas Sen's model maps profiles of full RPRs to a possibly
intransitive relation that does at least generate a choice set that
satisfies May's conditions.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹May's Conditions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The condition of \emph{anonymity} asserts that the individuals'
identities are not considered by the choice rule. Rather than talk about
permutations we just assert the result of the SCF is the same when the
profile is composed with an arbitrary bijection on the set of
individuals.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">anonymous</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">anonymous</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> profile <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">∧</span> bij_betw <span class="bound">f</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>
      <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="main">(</span><span class="bound">P</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="May-anonymousI"><span class="command">lemma</span></span> anonymousI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">P</span> <span class="bound">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="bound">P</span><span class="main">;</span> bij_betw <span class="bound">f</span> <span class="free">Is</span> <span class="free">Is</span><span class="main">;</span>
                  <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="main">(</span><span class="bound">P</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> anonymous <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> anonymous_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="May-anonymousD"><span class="command">lemma</span></span> anonymousD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> anonymous <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span><span class="main">;</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span><span class="main">;</span> bij_betw <span class="free">f</span> <span class="free">Is</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="main">(</span><span class="free">P</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> anonymous_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Similarly, an SCF is \emph{neutral} if it is insensitive to the
identity of the alternatives. This is Sen's characterisation
\cite[p72]{Sen:70a}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neutral</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neutral</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">P'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="bound">w</span><span class="main">.</span> profile <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">∧</span> profile <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P'</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span> <span class="main">⟷</span> <span class="bound">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">z</span><span class="main">)</span>
   <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span> <span class="main">⟷</span> <span class="bound">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="May-neutralI"><span class="command">lemma</span></span> neutralI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">P</span> <span class="bound">P'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="bound">w</span><span class="main">.</span>
    <span class="main">⟦</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="bound">P</span><span class="main">;</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="bound">P'</span><span class="main">;</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">,</span><span class="bound">w</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">w</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span> <span class="main">⟷</span> <span class="bound">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">z</span> <span class="main">⟧</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span> <span class="main">⟷</span> <span class="bound">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> neutral <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neutral_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="May-neutralD"><span class="command">lemma</span></span> neutralD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> neutral <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span><span class="main">;</span>
     profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span><span class="main">;</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P'</span><span class="main">;</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span>
     <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟷</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">w</span><span class="main">;</span>
     <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span> <span class="main">⟷</span> <span class="free">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟷</span> <span class="free">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span> <span class="main">⟷</span> <span class="free">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neutral_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Neutrality implies independence of irrelevant alternatives.›</span></span>

<span class="keyword1" id="May-neutral_iia"><span class="command">lemma</span></span> neutral_iia<span class="main">:</span> <span class="quoted"><span class="quoted">"neutral <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> <span class="main">⟹</span> iia <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neutral_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\emph{Positive responsiveness} is a bit like non-manipulability: if
one individual improves their opinion of $x$, then the result should shift
in favour of $x$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">positively_responsive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">positively_responsive</span> <span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="bound">P'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> profile <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P</span> <span class="main">∧</span> profile <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="bound">P'</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">scf</span></span></span> <span class="bound">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="May-positively_responsiveI"><span class="command">lemma</span></span> positively_responsiveI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">P'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
    <span class="main">⟦</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="bound">P</span><span class="main">;</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="bound">P'</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">;</span>
      <span class="main">∃</span><span class="bound">k</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">P'</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">y</span> <span class="main">⟧</span>
     <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="bound">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"positively_responsive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> positively_responsive_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> I<span class="main">)</span>

<span class="keyword1" id="May-positively_responsiveD"><span class="command">lemma</span></span> positively_responsiveD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> positively_responsive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span><span class="main">;</span>
     profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span><span class="main">;</span> profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P'</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span>
     <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">;</span>
     <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">;</span>
     <span class="main">∃</span><span class="bound">k</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span><span class="main">;</span>
     <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟧</span>
       <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> positively_responsive_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">P'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Method of Majority Decision satisfies May's conditions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The \emph{method of majority decision} (MMD) says that if the number
of individuals who strictly prefer $x$ to $y$ is larger than or equal to
those who strictly prefer the converse, then $x\ R\ y$. Note that this
definition only makes sense for a finite population.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MMD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MMD</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">.</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">y</span> <span class="main">}</span> <span class="main">≥</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="bound">x</span> <span class="main">}</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first part of May's Theorem establishes that the conditions are
consistent, by showing that they are satisfied by MMD.›</span></span>

<span class="keyword1" id="May-MMD_l2r"><span class="command">lemma</span></span> MMD_l2r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Is</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteIs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SCF <span class="main">(</span>MMD <span class="free">Is</span><span class="main">)</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"anonymous <span class="main">(</span>MMD <span class="free">Is</span><span class="main">)</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"neutral <span class="main">(</span>MMD <span class="free">Is</span><span class="main">)</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"positively_responsive <span class="main">(</span>MMD <span class="free">Is</span><span class="main">)</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SCF <span class="main">(</span>MMD <span class="free">Is</span><span class="main">)</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> MMD_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"anonymous <span class="main">(</span>MMD <span class="free">Is</span><span class="main">)</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> bijf<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="free">Is</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_compose_bij<span class="main">[</span><span class="operator">OF</span> bijf<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span><span class="main">]</span>
            card_compose_bij<span class="main">[</span><span class="operator">OF</span> bijf<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"neutral <span class="main">(</span>MMD <span class="free">Is</span><span class="main">)</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">P'</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> xyzwA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">w</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xyzw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">w</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> yxwz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xyzwA xyzw yxwz
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">w</span> <span class="main">}</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">z</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">w</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"positively_responsive <span class="main">(</span>MMD <span class="free">Is</span><span class="main">)</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">P'</span> <span class="keyword3"><span class="command">assume</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> xIy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="skolem">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">∈</span><span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> xRSCFy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> k <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> kIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> kcond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xPy</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xP'y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yPx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yP'x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> profileP xyA xPy xIy <span class="keyword1"><span class="command">have</span></span> yP'xyPx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?yP'x</span> <span class="main">⊆</span> <span class="var">?yPx</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def indifferent_pref_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_complete<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> finiteIs <span class="keyword1"><span class="command">have</span></span> yP'xyPxC<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?yP'x</span> <span class="main">≤</span> card <span class="var">?yPx</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_mono finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> finiteIs xPy <span class="keyword1"><span class="command">have</span></span> xPyxP'yC<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?xPy</span> <span class="main">≤</span> card <span class="var">?xP'y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_mono finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> xRSCFy xPyxP'yC yP'xyPxC <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> xIky<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xP'ky<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?xPy</span> <span class="main">&lt;</span> card <span class="var">?xP'y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> xIky <span class="keyword1"><span class="command">have</span></span> knP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∉</span> <span class="var">?xPy</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> indifferent_pref_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> kIs xP'ky <span class="keyword1"><span class="command">have</span></span> kP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?xP'y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> finiteIs xPy knP kP' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> psubset_card_mono finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> xRSCFy yP'xyPxC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?yP'x</span> <span class="main">&lt;</span> card <span class="var">?xP'y</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> yPkx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xR'ky<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?yP'x</span> <span class="main">&lt;</span> card <span class="var">?yPx</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> kIs yPkx <span class="keyword1"><span class="command">have</span></span> kP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?yPx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> kIs xR'ky <span class="keyword1"><span class="command">have</span></span> knP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∉</span> <span class="var">?yP'x</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> yP'xyPx kP knP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?yP'x</span> <span class="main">⊂</span> <span class="var">?yPx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> finiteIs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> psubset_card_mono finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> xRSCFy xPyxP'yC <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?yP'x</span> <span class="main">&lt;</span> card <span class="var">?xP'y</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> kcond
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Everything satisfying May's conditions is the Method of Majority Decision›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now show that MMD is the only SCF that satisfies these conditions.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Firstly develop some theory about exchanging alternatives $x$ and
$y$ in profile $P$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">swapAlts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">swapAlts</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1" id="May-swapAlts_in_set_iff"><span class="command">lemma</span></span> swapAlts_in_set_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> swapAlts <span class="free">a</span> <span class="free">b</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> swapAlts_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">swapAltsP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">swapAltsP</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">{</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span>swapAlts <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">u</span><span class="main">,</span> swapAlts <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span> <span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="May-swapAltsP_ab"><span class="command">lemma</span></span> swapAltsP_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">b</span> <span class="main">⟷</span> <span class="free">b</span> <span class="hidden">⇘</span><sub><span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">a</span> <span class="main">⟷</span> <span class="free">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> swapAltsP_def swapAlts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="May-profile_swapAltsP"><span class="command">lemma</span></span> profile_swapAltsP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> profileI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> profileP <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> profile_non_empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> rprI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> profileP iIs abA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> swapAltsP_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> swapAlts_in_set_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> profileP iIs abA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> swapAltsP_def swapAlts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> profileP iIs abA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> swapAltsP_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> completeI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rpr_complete<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> swapAlts_in_set_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> profileP iIs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">a</span> <span class="free">b</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> swapAltsP_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_le_trans <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> transI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="May-profile_bij_profile"><span class="command">lemma</span></span> profile_bij_profile<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bijf<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">Is</span> <span class="free">Is</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="main">(</span><span class="free">P</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_betw_onto<span class="main">[</span><span class="operator">OF</span> bijf<span class="main">]</span> profileP
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> profile_non_empty<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The locale keeps the conditions in scope for the next few
lemmas. Note how weak the constraints on the sets of alternatives and
individuals are; clearly there needs to be at least two alternatives and two
individuals for conflict to occur, but it is pleasant that the proof
uniformly handles the degenerate cases.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> May <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Is</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteIs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Is</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">scf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SCF"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> SCF<span class="main">:</span> <span class="quoted"><span class="quoted">"SCF <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span> universal_domain"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> anonymous<span class="main">:</span> <span class="quoted"><span class="quoted">"anonymous <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> neutral<span class="main">:</span> <span class="quoted"><span class="quoted">"neutral <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> positively_responsive<span class="main">:</span> <span class="quoted"><span class="quoted">"positively_responsive <span class="free">scf</span> <span class="free">A</span> <span class="free">Is</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Anonymity implies that, for any pair of alternatives, the social
choice rule can only depend on the number of individuals who express any
given preference between them. Note we also need <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"iia"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, implied by
neutrality, to restrict attention to alternatives $x$ and $y$.›</span></span>

<span class="keyword1" id="May-anonymous_card"><span class="command">lemma</span></span> anonymous_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> profileP'<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xytally<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> yxtally<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xPy</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xP'y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yPx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yP'x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> disjPxy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?xPy</span> <span class="main">∪</span> <span class="var">?yPx</span><span class="main">)</span> <span class="main">-</span> <span class="var">?xPy</span> <span class="main">=</span> <span class="var">?yPx</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> disjP'xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?xP'y</span> <span class="main">∪</span> <span class="var">?yP'x</span><span class="main">)</span> <span class="main">-</span> <span class="var">?xP'y</span> <span class="main">=</span> <span class="var">?yP'x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> finiteIs xytally
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> bijf<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="var">?xPy</span> <span class="var">?xP'y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> card_eq_bij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finiteIs yxtally
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> bijg<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g</span> <span class="var">?yPx</span> <span class="var">?yP'x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> card_eq_bij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bijf bijg disjPxy disjP'xy
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> bijh<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">h</span> <span class="main">(</span><span class="var">?xPy</span> <span class="main">∪</span> <span class="var">?yPx</span><span class="main">)</span> <span class="main">(</span><span class="var">?xP'y</span> <span class="main">∪</span> <span class="var">?yP'x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="var">?xPy</span> <span class="main">⟹</span> <span class="skolem">h</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">j</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> hg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?xPy</span> <span class="main">∪</span> <span class="var">?yPx</span><span class="main">)</span> <span class="main">-</span> <span class="var">?xPy</span> <span class="main">⟹</span> <span class="skolem">h</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_combine<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> g<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?xPy</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?xPy</span> <span class="main">∪</span> <span class="var">?yPx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> C<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?xP'y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?xP'y</span> <span class="main">∪</span> <span class="var">?yP'x</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> bijh finiteIs
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h'</span></span> <span class="keyword2"><span class="keyword">where</span></span> bijh'<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">h'</span> <span class="free">Is</span> <span class="free">Is</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> hh'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?xPy</span> <span class="main">∪</span> <span class="var">?yPx</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">h'</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">h</span> <span class="bound">j</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> hrest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">-</span> <span class="main">(</span><span class="var">?xPy</span> <span class="main">∪</span> <span class="var">?yPx</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">h'</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">-</span> <span class="main">(</span><span class="var">?xP'y</span> <span class="main">∪</span> <span class="var">?yP'x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> bij_complete<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> neutral_iia<span class="main">[</span><span class="operator">OF</span> neutral<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="main">(</span><span class="free">P'</span> <span class="main">∘</span> <span class="skolem">h'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iiaE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> xyA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> profileP iIs <span class="keyword1"><span class="command">have</span></span> completePi<span class="main">:</span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rprD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> completePi xyA
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="main">(</span><span class="free">P'</span> <span class="main">∘</span> <span class="skolem">h'</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> complete_exh<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> xPy <span class="keyword1"><span class="command">with</span></span> profileP profileP' xyA iIs ab hh' hf bijf <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> yPx <span class="keyword1"><span class="command">with</span></span> profileP profileP' xyA iIs ab hh' hg bijg <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> xIy <span class="keyword1"><span class="command">with</span></span> profileP profileP' xyA iIs ab hrest<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> indifferent_pref_def strict_pref_def bij_betw_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_complete<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> profileP profile_bij_profile<span class="main"><span class="main">[</span></span><span class="operator">OF</span> profileP' bijh'<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> anonymousD<span class="main">[</span><span class="operator">OF</span> anonymous profileP' bijh'<span class="main">]</span> xyA
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="main">(</span><span class="free">P'</span> <span class="main">∘</span> <span class="skolem">h'</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Using the previous result and neutrality, it must be the case that
if the tallies are tied for alternatives $x$ and $y$ then the social choice
function is indifferent between those two alternatives.›</span></span>

<span class="keyword1" id="May-anonymous_neutral_indifference"><span class="command">lemma</span></span> anonymous_neutral_indifference<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tallyP<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="comment1">― ‹Neutrality insists the results for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">P</span>"</span><span class="antiquote">}</span></span> are symmetrical to those for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"swapAltsP <span class="free">P</span>"</span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword1"><span class="command">from</span></span> xyA
  <span class="keyword1"><span class="command">have</span></span> symPP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> neutralD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> neutral profileP profile_swapAltsP<span class="main"><span class="main">[</span></span><span class="operator">OF</span> profileP<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> swapAltsP_ab<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="comment1">― ‹Anonymity and neutrality insist the results for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">P</span>"</span><span class="antiquote">}</span></span> are identical to those for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"swapAltsP <span class="free">P</span>"</span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword1"><span class="command">from</span></span> xyA tallyP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">x</span> <span class="free">y</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span>"</span></span>
                   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">x</span> <span class="free">y</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> swapAltsP_def swapAlts_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> profileP xyA <span class="keyword1"><span class="command">have</span></span> idPP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span>
                            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span> <span class="main">⟷</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="main">(</span>swapAltsP <span class="free">P</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> anonymous_card<span class="main"><span class="main">[</span></span><span class="operator">OF</span> profileP profile_swapAltsP<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> xyA SCF_completeD<span class="main">[</span><span class="operator">OF</span> SCF<span class="main">]</span> profileP symPP' idPP' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finally, if the tallies are not equal then the social choice function
must lean towards the one with the higher count due to positive
responsiveness.›</span></span>

<span class="keyword1" id="May-positively_responsive_prefer_witness"><span class="command">lemma</span></span> positively_responsive_prefer_witness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tallyP<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">&gt;</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P'</span> <span class="free">k</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="free">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="free">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tallyP <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> tallyP'<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="free">Is</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> CxPy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> card_greater<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finiteIs<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="comment1">― ‹Add $(b, a)$ and close under transitivity.›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">C</span>
                   <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">}</span>
                            <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span><span class="bound">u</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">u</span> <span class="main">}</span>
                            <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">}</span>
                            <span class="main">∪</span> <span class="main">{</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">|</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="bound">u</span> <span class="main">∧</span> <span class="bound">v</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">}</span>
                   <span class="keyword1">else</span> <span class="free">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="var">?P'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> iIs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">Is</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rpr <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> profileP iIs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complete <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> complete_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_complete<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> profileP iIs xyA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="var">?P'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> profileP iIs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_le_trans <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> transI<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> profileP iIs C CxPy xyA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> transI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_le_trans rpr_complete<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> C <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Is</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> profileP C xyA
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> indifferent_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> C CxPy <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> kC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xPky<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> C kC xPky <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">-</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">-</span> <span class="skolem">C</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> indifferent_pref_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">-</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">(</span><span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">-</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> tallyP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?lhs</span> <span class="main">=</span> card <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> profileP xyA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rpr_complete<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⊆</span> <span class="var">?lhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> profileP xyA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="var">?P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="May-positively_responsive_prefer"><span class="command">lemma</span></span> positively_responsive_prefer<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tallyP<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">&gt;</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="skolem"><span class="skolem">k</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> profileP'<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="skolem">P'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">Is</span><span class="main">;</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> pivot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">Is</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="skolem">k</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cardP'<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> positively_responsive_prefer_witness<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> profileP' xyA cardP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="skolem">P'</span><span class="main">)</span></sub><span class="hidden">⇙</span>≈ <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> anonymous_neutral_indifference<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> xyA F G pivot <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> positively_responsiveD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> positively_responsive profileP' profileP<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="May-MMD_r2l"><span class="command">lemma</span></span> MMD_r2l<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> profileP<span class="main">:</span> <span class="quoted"><span class="quoted">"profile <span class="free">A</span> <span class="free">Is</span> <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xyA<span class="main">:</span> <span class="quoted"><span class="quoted">"hasw <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">scf</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>MMD <span class="free">Is</span> <span class="free">P</span><span class="main">)</span></sub><span class="hidden">⇙</span>≼ <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">=</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> profileP xyA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> anonymous_neutral_indifference
    <span class="keyword1"><span class="command">unfolding</span></span> indifferent_pref_def MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">&gt;</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> profileP xyA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> positively_responsive_prefer
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">y</span> <span class="main">}</span> <span class="main">&lt;</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> profileP xyA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> positively_responsive_prefer
    <span class="keyword1"><span class="command">unfolding</span></span> strict_pref_def MMD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹May's original paper \cite{May:1952} goes on to show that the
conditions are independent by exhibiting choice rules that differ from
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"MMD"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and satisfy the conditions remaining after any particular one
is removed. I leave this to future work.

May also wrote a later article \cite{May:1953} where he shows that the
conditions are completely independent, i.e. for every partition of the
conditions into two sets, there is a voting rule that satisfies one and not
the other.

There are many later papers that characterise MMD with different sets of
conditions.

›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Plurality Rule›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Goodin and List \cite{GoodinList:2006} show that May's original
result can be generalised to characterise plurality voting. The following
shows that this result is a short step from Sen's much earlier
generalisation.

\emph{Plurality voting} is a choice function that returns the alternative
that receives the most votes, or the set of such alternatives in the case of
a tie. Profiles are restricted to those where each individual casts a vote
in favour of a single alternative.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SVProfile <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">svprofile</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SVProfile <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">svprofile</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">plurality_rule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> SVProfile <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">plurality_rule</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>
     <span class="main">≡</span> <span class="main">{</span> <span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">}</span> <span class="main">≥</span> card <span class="main">{</span> <span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">}</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹By translating single-vote profiles into RPRs in the obvious way, the
choice function arising from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"MMD"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> coincides with traditional
plurality voting.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MMD_plurality_rule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'i</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'i</span><span class="main">)</span> Profile <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MMD_plurality_rule</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> choiceSet <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>MMD <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">single_vote_to_RPR</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> RPR"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">single_vote_to_RPR</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="May-single_vote_to_RPR_iff"><span class="command">lemma</span></span> single_vote_to_RPR_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="hidden">⇘</span><sub><span class="main">(</span>single_vote_to_RPR <span class="free">A</span> <span class="free">b</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> single_vote_to_RPR_def strict_pref_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="May-plurality_rule_equiv"><span class="command">lemma</span></span> plurality_rule_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"plurality_rule <span class="free">A</span> <span class="free">Is</span> <span class="free">F</span> <span class="main">=</span> MMD_plurality_rule <span class="free">A</span> <span class="free">Is</span> <span class="main">(</span>single_vote_to_RPR <span class="free">A</span> <span class="main">∘</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span>card <span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">F</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">}</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="free">F</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>card <span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">y</span> <span class="hidden">⇘</span><sub><span class="main">(</span>single_vote_to_RPR <span class="free">A</span> <span class="main">(</span><span class="free">F</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">x</span><span class="main">}</span>
        <span class="main">≤</span> card <span class="main">{</span><span class="bound"><span class="bound">i</span></span> <span class="main">∈</span> <span class="free">Is</span><span class="main">.</span> <span class="skolem">x</span> <span class="hidden">⇘</span><sub><span class="main">(</span>single_vote_to_RPR <span class="free">A</span> <span class="main">(</span><span class="free">F</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span></sub><span class="hidden">⇙</span>≺ <span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> single_vote_to_RPR_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> plurality_rule_def MMD_plurality_rule_def choiceSet_def MMD_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Thus it is clear that Sen's generalisation of May's result applies to
this case as well.

Their paper goes on to show how strengthening the anonymity condition gives
rise to a characterisation of approval voting that strictly generalises
May's original theorem. As this requires some rearrangement of the proof I
leave it to future work.›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div>