<div id="Misc">
<div class="head">
<h1>Theory Misc</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹General purpose definitions and lemmas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Misc <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A handy abbreviation when working with maps›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">make_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇀</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span> _ <span class="keyword1">|=&gt;</span> _ <span class="keyword1">]</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="main"><span class="free">|=&gt;</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="keyword1">then</span> Some <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">else</span> None"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Projecting the components of a triple›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fst3</span> <span class="main">≡</span> fst"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">snd3</span> <span class="main">≡</span> fst <span class="main">∘</span> snd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">thd3</span> <span class="main">≡</span> snd <span class="main">∘</span> snd"</span></span>

<span class="keyword1" id="Misc-fst3_simp"><span class="command">lemma</span></span> fst3_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fst3 <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst3_def<span class="main">)</span>
<span class="keyword1" id="Misc-snd3_simp"><span class="command">lemma</span></span> snd3_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"snd3 <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd3_def<span class="main">)</span>
<span class="keyword1" id="Misc-thd3_simp"><span class="command">lemma</span></span> thd3_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"thd3 <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> thd3_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KPL_syntax">
<div class="head">
<h1>Theory KPL_syntax</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Syntax of KPL›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KPL_syntax <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Misc.html">Misc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Locations of local variables›</span></span>
<span class="keyword1"><span class="command">typedecl</span></span> V 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹C strings›</span></span>
<span class="keyword1"><span class="command">typedecl</span></span> name

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Procedure names›</span></span>
<span class="keyword1"><span class="command">typedecl</span></span> proc_name

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Local-id, group-id›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> lid <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> gid <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Fully-qualified thread-id›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> tid <span class="main">=</span> <span class="quoted"><span class="quoted">"gid <span class="main">×</span> lid"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Let <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">G</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">T</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> range over threadsets›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> threadset <span class="main">=</span> <span class="quoted"><span class="quoted">"gid set <span class="main">×</span> <span class="main">(</span>gid <span class="main">⇀</span> lid set<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Returns the set of tids in a threadset›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"threadset <span class="main">⇒</span> tid set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tids</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> word <span class="main">=</span> <span class="quoted">nat</span>  <span class="comment1">(* should really be machine words *)</span>

<span class="keyword1"><span class="command">datatype</span></span> loc <span class="main">=</span>
  Name <span class="quoted">name</span>
<span class="main">|</span> Var <span class="quoted">V</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Local expressions›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> local_expr <span class="main">=</span>
  Loc <span class="quoted">loc</span>
<span class="main">|</span> Gid
<span class="main">|</span> Lid
<span class="main">|</span> eTrue
<span class="main">|</span> eConj <span class="quoted">local_expr</span> <span class="quoted">local_expr</span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∧*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 50<span class="main">)</span>
<span class="main">|</span> eNot <span class="quoted">local_expr</span>              <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">¬*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Basic statements›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> basic_stmt <span class="main">=</span>
  Assign <span class="quoted">loc</span> <span class="quoted">local_expr</span>
<span class="main">|</span> Read <span class="quoted">loc</span> <span class="quoted">local_expr</span>
<span class="main">|</span> Write <span class="quoted">local_expr</span> <span class="quoted">local_expr</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Statements›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> stmt <span class="main">=</span>
  Basic <span class="quoted">basic_stmt</span>
<span class="main">|</span> Seq <span class="quoted">stmt</span> <span class="quoted">stmt</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 50<span class="main">)</span>
<span class="main">|</span> Local <span class="quoted">name</span> <span class="quoted">stmt</span>
<span class="main">|</span> If <span class="quoted">local_expr</span> <span class="quoted">stmt</span> <span class="quoted">stmt</span>
<span class="main">|</span> While <span class="quoted">local_expr</span> <span class="quoted">stmt</span>
<span class="main">|</span> WhileDyn <span class="quoted">local_expr</span> <span class="quoted">stmt</span>
<span class="main">|</span> Call <span class="quoted">proc_name</span> <span class="quoted">local_expr</span>
<span class="main">|</span> Barrier
<span class="main">|</span> Break
<span class="main">|</span> Continue
<span class="main">|</span> Return

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Procedures comprise a procedure name, parameter name, and a body statement›</span></span>
<span class="keyword1"><span class="command">record</span></span> proc <span class="main">=</span> 
  proc_name <span class="main">::</span> <span class="quoted">proc_name</span>
  param <span class="main">::</span> <span class="quoted">name</span>
  body <span class="main">::</span> <span class="quoted">stmt</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Kernels›</span></span>
<span class="keyword1"><span class="command">record</span></span> kernel <span class="main">=</span> 
  groups <span class="main">::</span> <span class="quoted">nat</span>
  threads <span class="main">::</span> <span class="quoted">nat</span>
  procs <span class="main">::</span> <span class="quoted"><span class="quoted">"proc list"</span></span>
  main <span class="main">::</span> <span class="quoted">stmt</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KPL_wellformedness">
<div class="head">
<h1>Theory KPL_wellformedness</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Well-formedness of KPL kernels›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KPL_wellformedness <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="KPL_syntax.html">KPL_syntax</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Well-formed local expressions. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">wf_local_expr</span></span> <span class="free"><span class="free">ns</span></span> <span class="free"><span class="free">e</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  means that 
  \begin{itemize} 
  \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not mention any internal locations, and
  \item any name mentioned by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is in the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ns</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  \end{itemize}
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_local_expr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"name set <span class="main">⇒</span> local_expr <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_local_expr</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span>Loc <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_local_expr</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span>Loc <span class="main">(</span>Name <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_local_expr</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">∧*</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">wf_local_expr</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">∧</span> <span class="free">wf_local_expr</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_local_expr</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span><span class="main">¬*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">wf_local_expr</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_local_expr</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Well-formed basic statements. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">wf_basic_stmt</span></span> <span class="free"><span class="free">ns</span></span> <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  means that 
  \begin{itemize}
  \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not mention any internal locations, and
  \item any name mentioned by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is in the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ns</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  \end{itemize}
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_basic_stmt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"name set <span class="main">⇒</span> basic_stmt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_basic_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span>Assign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> wf_local_expr <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_basic_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span>Read <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> wf_local_expr <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_basic_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">(</span>Write <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span>wf_local_expr <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">∧</span> wf_local_expr <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Well-formed statements. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">wf_stmt</span></span> <span class="free"><span class="free">ns</span></span> <span class="free"><span class="free">F</span></span> <span class="free"><span class="free">S</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> means:
  \begin{itemize}
  \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> only calls procedures whose name is in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not contain <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">WhileDyn</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
  \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not mention internal variables, 
  \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> only mentions names in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ns</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and
  \item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not declare the same name twice, e.g. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Local <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">(</span></span>Local <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">foo</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  \end{itemize}
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_stmt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"name set <span class="main">⇒</span> proc_name set <span class="main">⇒</span> stmt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> wf_basic_stmt <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">∧</span> <span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="main">∧</span> <span class="free">wf_stmt</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span>wf_local_expr <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> <span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">∧</span> <span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span>wf_local_expr <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> <span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>WhileDyn <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_stmt</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> wf_local_expr <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_stmt</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">no_return</span></span> <span class="free"><span class="free">S</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not contain a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Return</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> statement›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">no_return</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stmt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">no_return</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">no_return</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">∧</span> <span class="free">no_return</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">no_return</span> <span class="main">(</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">no_return</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">no_return</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">no_return</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">∧</span> <span class="free">no_return</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">no_return</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">no_return</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">no_return</span> Return <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">no_return</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Well-formed kernel›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_kernel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"kernel <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_kernel</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span>
  <span class="keyword1">let</span> <span class="bound">F</span> <span class="main">=</span> set <span class="main">(</span>map proc_name <span class="main">(</span>procs <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
 
  <span class="comment1">― ‹The main statement must not refer to <span class="antiquoted"><span class="operator">∗</span>‹any›</span> variable, except those it locally defines.›</span>
  wf_stmt <span class="main">{}</span> <span class="bound">F</span> <span class="main">(</span>main <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>

  <span class="comment1">― ‹The main statement contains no return statement.›</span>
<span class="main">∧</span> no_return <span class="main">(</span>main <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>
 
  <span class="comment1">― ‹A procedure body may refer only to its argument.›</span>
<span class="main">∧</span> list_all <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> wf_stmt <span class="main">{</span>param <span class="bound">f</span><span class="main">}</span> <span class="bound">F</span> <span class="main">(</span>body <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>procs <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KPL_state">
<div class="head">
<h1>Theory KPL_state</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Thread, group and kernel states›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KPL_state <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="KPL_syntax.html">KPL_syntax</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Thread state›</span></span>
<span class="keyword1"><span class="command">record</span></span> thread_state <span class="main">=</span>
  <span class="comment1">(* We use "V + bool" to indicate that the domain of
     l is extended with two extra values. Let's say
     that "l (Inr True)" returns the gid, and that
     "l (Inr False)" returns the lid. *)</span>
  l <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">+</span> bool <span class="main">⇒</span> word"</span></span> 
  sh <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> word"</span></span>
  R <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  W <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">GID</span> <span class="main">≡</span> Inr True"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">LID</span> <span class="main">≡</span> Inr False"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Group state›</span></span>
<span class="keyword1"><span class="command">record</span></span> group_state <span class="main">=</span> 
  thread_states <span class="main">::</span> <span class="quoted"><span class="quoted">"lid <span class="main">⇀</span> thread_state"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>
  R_group <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lid <span class="main">×</span> nat<span class="main">)</span> set"</span></span>
  W_group <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lid <span class="main">×</span> nat<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Valid group state›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">valid_group_state</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>gid <span class="main">⇀</span> lid set<span class="main">)</span> <span class="main">⇒</span> gid <span class="main">⇒</span> group_state <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_group_state</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">=</span> <span class="main">(</span>
  dom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">=</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span>
  l <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> GID <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span>
  l <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> LID <span class="main">=</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Predicated statements›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> pred_stmt <span class="main">=</span> <span class="quoted"><span class="quoted">"stmt <span class="main">×</span> local_expr"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> pred_basic_stmt <span class="main">=</span> <span class="quoted"><span class="quoted">"basic_stmt <span class="main">×</span> local_expr"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Kernel state›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> kernel_state <span class="main">=</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>gid <span class="main">⇀</span> group_state<span class="main">)</span> <span class="main">×</span> pred_stmt list <span class="main">×</span> V list"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Valid kernel state›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">valid_kernel_state</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"threadset <span class="main">⇒</span> kernel_state <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_kernel_state</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  dom <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> valid_group_state <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="bound">i</span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Valid initial kernel state›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">valid_initial_kernel_state</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stmt <span class="main">⇒</span> threadset <span class="main">⇒</span> kernel_state <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_initial_kernel_state</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> 
  valid_kernel_state <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> eTrue<span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> R_group <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> W_group <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> R <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>
    <span class="main">∧</span> W <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">::</span> V<span class="main">.</span> 
    l <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Inl <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">i'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j'</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="bound">i'</span><span class="main">)</span><span class="main">.</span>
    sh <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    sh <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i'</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KPL_execution_thread">
<div class="head">
<h1>Theory KPL_execution_thread</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Execution rules for threads›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KPL_execution_thread <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="KPL_state.html">KPL_state</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Evaluate a local expression down to a word›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_word</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"local_expr <span class="main">⇒</span> thread_state <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_word</span> <span class="main">(</span>Loc <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> l <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="comment1">(* eval_word (Loc (Name n)) τ = undefined *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_word</span> Lid <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> l <span class="free"><span class="bound"><span class="entity">τ</span></span></span> LID"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_word</span> Gid <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> l <span class="free"><span class="bound"><span class="entity">τ</span></span></span> GID"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_word</span> eTrue <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_word</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">∧*</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">eval_word</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">*</span> <span class="free">eval_word</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_word</span> <span class="main">(</span><span class="main">¬*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">eval_word</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Evaluate a local expression down to a boolean›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_bool</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"local_expr <span class="main">⇒</span> thread_state <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_bool</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">=</span> <span class="main">(</span>eval_word <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Abstraction level: none, equality abstraction, or adversarial abstraction›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> abs_level <span class="main">=</span> No_Abst <span class="main">|</span> Eq_Abst <span class="main">|</span> Adv_Abst

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The rules of Figure 4, plus two additional rules 
  for adversarial abstraction (Fig 7b)›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">step_t</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"abs_level <span class="main">⇒</span> <span class="main">(</span>thread_state <span class="main">×</span> pred_basic_stmt<span class="main">)</span> <span class="main">⇒</span> thread_state <span class="main">⇒</span> bool"</span></span>  
<span class="keyword2"><span class="keyword">where</span></span>
  T_Disabled<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free">step_t</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span>"</span></span>
<span class="main">|</span> T_Assign<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">l'</span></span></span> <span class="main">=</span> <span class="main">(</span>l <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">:=</span> eval_word <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">step_t</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="main">(</span>Assign <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(|</span> l <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">l'</span></span></span> <span class="main">|)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> T_Read<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">l'</span></span></span> <span class="main">=</span> <span class="main">(</span>l <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">:=</span> sh <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span>eval_word <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">R'</span></span></span> <span class="main">=</span> R <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">∪</span> <span class="main">{</span> eval_word <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">}</span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="main">{</span>No_Abst<span class="main">,</span> Eq_Abst<span class="main">}</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">step_t</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="main">(</span>Read <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(|</span> l <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">l'</span></span></span><span class="main">,</span> R <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">R'</span></span></span> <span class="main">|)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> T_Write<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">;</span> 
  <span class="free"><span class="bound"><span class="entity">sh'</span></span></span> <span class="main">=</span> <span class="main">(</span>sh <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>eval_word <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">:=</span> eval_word <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">W'</span></span></span> <span class="main">=</span> W <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">∪</span> <span class="main">{</span> eval_word <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">}</span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="main">{</span>No_Abst<span class="main">,</span> Eq_Abst<span class="main">}</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">step_t</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="main">(</span>Write <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(|</span> sh <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">sh'</span></span></span><span class="main">,</span> W <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">W'</span></span></span> <span class="main">|)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> T_Read_Adv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">l'</span></span></span> <span class="main">=</span> <span class="main">(</span>l <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">asterisk</span></span></span><span class="main">)</span> <span class="main">;</span>
  <span class="free"><span class="bound"><span class="entity">R'</span></span></span> <span class="main">=</span> R <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">∪</span> <span class="main">{</span> eval_word <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">}</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">step_t</span> Adv_Abst <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="main">(</span>Read <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(|</span> l <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">l'</span></span></span><span class="main">,</span> R <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">R'</span></span></span> <span class="main">|)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> T_Write_Adv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">W'</span></span></span> <span class="main">=</span> W <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">∪</span> <span class="main">{</span> eval_word <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">}</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">step_t</span> Adv_Abst <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">,</span> <span class="main">(</span>Write <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(|</span> <span class="comment1">⌦‹sh := sh',›</span> W <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">W'</span></span></span> <span class="main">|)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rephrasing <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>T_Assign›</span></span></span></span> to make it more usable›</span></span>
<span class="keyword1" id="KPL_execution_thread-T_Assign_helper"><span class="command">lemma</span></span> T_Assign_helper<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> eval_bool <span class="free">p</span> <span class="free">τ</span> <span class="main">;</span> <span class="free">l'</span> <span class="main">=</span> <span class="main">(</span>l <span class="free">τ</span><span class="main">)</span> <span class="main">(</span>Inl <span class="free">v</span> <span class="main">:=</span> eval_word <span class="free">e</span> <span class="free">τ</span><span class="main">)</span> <span class="main">;</span> <span class="free">τ'</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">(|</span> l <span class="main">:=</span> <span class="free">l'</span> <span class="main">|)</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> step_t <span class="free">a</span> <span class="main">(</span><span class="free">τ</span><span class="main">,</span> <span class="main">(</span>Assign <span class="main">(</span>Var <span class="free">v</span><span class="main">)</span> <span class="free">e</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">τ'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_t.T_Assign<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rephrasing <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>T_Read›</span></span></span></span> to make it more usable›</span></span>
<span class="keyword1" id="KPL_execution_thread-T_Read_helper"><span class="command">lemma</span></span> T_Read_helper<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> eval_bool <span class="free">p</span> <span class="free">τ</span> <span class="main">;</span> <span class="free">l'</span> <span class="main">=</span> <span class="main">(</span>l <span class="free">τ</span><span class="main">)</span> <span class="main">(</span>Inl <span class="free">v</span> <span class="main">:=</span> sh <span class="free">τ</span> <span class="main">(</span>eval_word <span class="free">e</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
  <span class="free">R'</span> <span class="main">=</span> R <span class="free">τ</span> <span class="main">∪</span> <span class="main">{</span> eval_word <span class="free">e</span> <span class="free">τ</span> <span class="main">}</span> <span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">{</span>No_Abst<span class="main">,</span> Eq_Abst<span class="main">}</span> <span class="main">;</span> 
  <span class="free">τ'</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">(|</span> l <span class="main">:=</span> <span class="free">l'</span><span class="main">,</span> R <span class="main">:=</span> <span class="free">R'</span> <span class="main">|)</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> step_t <span class="free">a</span> <span class="main">(</span><span class="free">τ</span><span class="main">,</span> <span class="main">(</span>Read <span class="main">(</span>Var <span class="free">v</span><span class="main">)</span> <span class="free">e</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">τ'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_t.T_Read<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rephrasing <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>T_Write›</span></span></span></span> to make it more usable›</span></span>
<span class="keyword1" id="KPL_execution_thread-T_Write_helper"><span class="command">lemma</span></span> T_Write_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> eval_bool <span class="free">p</span> <span class="free">τ</span> <span class="main">;</span> 
  <span class="free">sh'</span> <span class="main">=</span> <span class="main">(</span>sh <span class="free">τ</span><span class="main">)</span> <span class="main">(</span>eval_word <span class="free">e1</span> <span class="free">τ</span> <span class="main">:=</span> eval_word <span class="free">e2</span> <span class="free">τ</span><span class="main">)</span> <span class="main">;</span>
  <span class="free">W'</span> <span class="main">=</span> W <span class="free">τ</span> <span class="main">∪</span> <span class="main">{</span> eval_word <span class="free">e1</span> <span class="free">τ</span> <span class="main">}</span> <span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">{</span>No_Abst<span class="main">,</span> Eq_Abst<span class="main">}</span> <span class="main">;</span>
  <span class="free">τ'</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">(|</span> sh <span class="main">:=</span> <span class="free">sh'</span><span class="main">,</span> W <span class="main">:=</span> <span class="free">W'</span> <span class="main">|)</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> step_t <span class="free">a</span> <span class="main">(</span><span class="free">τ</span><span class="main">,</span> <span class="main">(</span>Write <span class="free">e1</span> <span class="free">e2</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">τ'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_t.T_Write<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KPL_execution_group">
<div class="head">
<h1>Theory KPL_execution_group</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Execution rules for groups›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KPL_execution_group <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="KPL_execution_thread.html">KPL_execution_thread</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Intra-group race detection›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">group_race</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"lid set <span class="main">⇒</span> <span class="main">(</span>lid <span class="main">⇀</span> thread_state<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">group_race</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">≡</span> 
  <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">∧</span> 
  W <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>R <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> W <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The constraints for the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">merge</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> map›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">pre_merge</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"lid set <span class="main">⇒</span> <span class="main">(</span>lid <span class="main">⇀</span> thread_state<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> word <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∈</span> W <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> dom <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">pre_merge</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span>sh <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∉</span> W <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> dom <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="free">pre_merge</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span>sh <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> pre_merge_inv <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pre_merge <span class="free">P</span> <span class="free">γ</span> <span class="free">z</span> <span class="free">z'</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">merge</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> map maps each nat to the word that 
   satisfies the above constaints. The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>merge_is_unique›</span></span></span></span>
   lemma shows that there exists exactly one such word 
   per nat, provided there are no group races.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">merge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lid set <span class="main">⇒</span> <span class="main">(</span>lid <span class="main">⇀</span> thread_state<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> word"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">merge</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> The <span class="main">(</span>pre_merge <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="bound">z</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="KPL_execution_group-no_races_imp_no_write_overlap"><span class="command">lemma</span></span> no_races_imp_no_write_overlap<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>group_race <span class="free">T</span> <span class="free">γ</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> 
  <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> W <span class="main">(</span>the <span class="main">(</span><span class="free">γ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> W <span class="main">(</span>the <span class="main">(</span><span class="free">γ</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> group_race_def 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="KPL_execution_group-merge_is_unique"><span class="command">lemma</span></span> merge_is_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">γ</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>group_race <span class="free">T</span> <span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">z'</span><span class="main">.</span> pre_merge <span class="free">T</span> <span class="free">γ</span> <span class="free">z</span> <span class="bound">z'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> no_races_imp_no_write_overlap<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI ex_ex1I<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> pre_merge.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z1</span> <span class="skolem">z2</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>dom <span class="free">γ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>dom <span class="free">γ</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> W <span class="main">(</span>the <span class="main">(</span><span class="free">γ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> W <span class="main">(</span>the <span class="main">(</span><span class="free">γ</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pre_merge <span class="main">(</span>dom <span class="free">γ</span><span class="main">)</span> <span class="free">γ</span> <span class="free">z</span> <span class="skolem">z1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_merge <span class="main">(</span>dom <span class="free">γ</span><span class="main">)</span> <span class="free">γ</span> <span class="free">z</span> <span class="skolem">z2</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span> <span class="main">=</span> <span class="skolem">z2</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> pre_merge_inv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> j1 j2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">j1</span> <span class="main">=</span> <span class="improper">j2</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"W <span class="main">(</span>the <span class="main">(</span><span class="free">γ</span> <span class="improper">j1</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> W <span class="main">(</span>the <span class="main">(</span><span class="free">γ</span> <span class="improper">j2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The rules of Figure 5, plus an additional rule for
  equality abstraction (Fig 7a), plus an additional rule for
  adversarial abstraction (Fig 7b)›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">step_g</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">"abs_level <span class="main">⇒</span> gid <span class="main">⇒</span> <span class="main">(</span>gid <span class="main">⇀</span> lid set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>group_state <span class="main">×</span> pred_stmt<span class="main">)</span> <span class="main">⇒</span> group_state option <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  G_Race<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> step_t <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> 
    group_race <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="main">::</span> group_state<span class="main">)</span><span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">step_g</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">,</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> None"</span></span>
<span class="main">|</span> G_Basic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> step_t <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> 
    <span class="main">¬</span> <span class="main">(</span>group_race <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
    R_group <span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="main">=</span> R_group <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">×</span> R <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
    W_group <span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="main">=</span> W_group <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span><span class="bound">j</span><span class="main">}</span> <span class="main">×</span> W <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">step_g</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">,</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">γ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> G_No_Op<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="free">step_g</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> G_Divergence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">;</span>
   eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> <span class="main">¬</span> <span class="main">(</span>eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">step_g</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> None"</span></span>
<span class="main">|</span> G_Sync<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
    <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(|</span> 
    sh <span class="main">:=</span> merge <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span><span class="main">)</span><span class="main">,</span> R <span class="main">:=</span> <span class="main">{}</span><span class="main">,</span> W <span class="main">:=</span> <span class="main">{}</span> <span class="main">|)</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">step_g</span> No_Abst <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">γ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> G_Sync_Eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
    <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(|</span> 
    sh <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">sh'</span></span></span><span class="main">,</span> R <span class="main">:=</span> <span class="main">{}</span><span class="main">,</span> W <span class="main">:=</span> <span class="main">{}</span> <span class="main">|)</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">step_g</span> Eq_Abst <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">γ'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> G_Sync_Adv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> eval_bool <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
    <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">sh'</span><span class="main">.</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ'</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(|</span> 
    sh <span class="main">:=</span> <span class="bound">sh'</span><span class="main">,</span> R <span class="main">:=</span> <span class="main">{}</span><span class="main">,</span> W <span class="main">:=</span> <span class="main">{}</span> <span class="main">|)</span> <span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">step_g</span> Adv_Abst <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">γ'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rephrasing <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>G_No_Op›</span></span></span></span> to make it more usable›</span></span>
<span class="keyword1" id="KPL_execution_group-G_No_Op_helper"><span class="command">lemma</span></span> G_No_Op_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free">T</span> <span class="free">i</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>eval_bool <span class="free">p</span> <span class="main">(</span>the <span class="main">(</span><span class="free">γ</span> <span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> <span class="free">γ</span> <span class="main">=</span> <span class="free">γ'</span> <span class="main">⟧</span>
  <span class="main">⟹</span> step_g <span class="free">a</span> <span class="free">i</span> <span class="free">T</span> <span class="main">(</span><span class="free">γ</span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="free">γ'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_g.G_No_Op<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KPL_execution_kernel">
<div class="head">
<h1>Theory KPL_execution_kernel</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Execution rules for kernels›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KPL_execution_kernel <span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="KPL_execution_group.html">KPL_execution_group</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Inter-group race detection›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kernel_race</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"gid set <span class="main">⇒</span> <span class="main">(</span>gid <span class="main">⇀</span> group_state<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">kernel_race</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="main">≡</span> 
  <span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">∧</span> 
  <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>W_group <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> 
  <span class="main">(</span>snd <span class="main">`</span> <span class="main">(</span>R_group <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> snd <span class="main">`</span> <span class="main">(</span>W_group <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Replaces top-level <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Break</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v := true›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">belim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stmt <span class="main">⇒</span> V <span class="main">⇒</span> stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">belim</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">belim</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">;;</span> <span class="free">belim</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> <span class="main">(</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">belim</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span><span class="free">belim</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">belim</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span> <span class="comment1">(* only top-level *)</span>
<span class="comment1">(* belim (WhileDyn e S) v = undefined *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> Barrier <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Barrier"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> Break <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Basic <span class="main">(</span>Assign <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> eTrue<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> Continue <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Continue"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">belim</span> Return <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Return"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Replaces top-level <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Continue</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v := true›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">celim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stmt <span class="main">⇒</span> V <span class="main">⇒</span> stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">celim</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">celim</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">;;</span> <span class="free">celim</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> <span class="main">(</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">celim</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span><span class="free">celim</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">celim</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span> <span class="comment1">(* only top-level *)</span>
<span class="comment1">(* celim (WhileDyn e S) v = undefined *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> Barrier <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Barrier"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> Break <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Break"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> Continue <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Basic <span class="main">(</span>Assign <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> eTrue<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">celim</span> Return <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Return"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">subst_basic_stmt</span></span> <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">v</span></span> <span class="free"><span class="free">loc</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> replaces <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> inside <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">loc</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst_loc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"name <span class="main">⇒</span> V <span class="main">⇒</span> loc <span class="main">⇒</span> loc"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst_loc</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> Var <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_loc</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Name <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> Var <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">else</span> Name <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">subst_local_expr</span></span> <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">v</span></span> <span class="free"><span class="free">e</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> replaces <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> inside <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst_local_expr</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"name <span class="main">⇒</span> V <span class="main">⇒</span> local_expr <span class="main">⇒</span> local_expr"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Loc <span class="free"><span class="bound"><span class="entity">loc</span></span></span><span class="main">)</span> <span class="main">=</span> Loc <span class="main">(</span>subst_loc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">loc</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> Gid <span class="main">=</span> Gid"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> Lid <span class="main">=</span> Lid"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> eTrue <span class="main">=</span> eTrue"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">∧*</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">∧*</span> <span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="main">¬*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">¬*</span> <span class="main">(</span><span class="free">subst_local_expr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">subst_basic_stmt</span></span> <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">v</span></span> <span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> replaces <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> inside <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst_basic_stmt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"name <span class="main">⇒</span> V <span class="main">⇒</span> basic_stmt <span class="main">⇒</span> basic_stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">subst_basic_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Assign <span class="free"><span class="bound"><span class="entity">loc</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> 
  Assign <span class="main">(</span>subst_loc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">loc</span></span></span><span class="main">)</span> <span class="main">(</span>subst_local_expr <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_basic_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Read <span class="free"><span class="bound"><span class="entity">loc</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span>
  Read <span class="main">(</span>subst_loc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">loc</span></span></span><span class="main">)</span> <span class="main">(</span>subst_local_expr <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_basic_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Write <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span>
  Write <span class="main">(</span>subst_local_expr <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">(</span>subst_local_expr <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">subst_stmt</span></span> <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">v</span></span> <span class="free"><span class="free">s</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the result 
  of replacing <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> inside <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">subst_stmt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"name <span class="main">⇒</span> V <span class="main">⇒</span> stmt <span class="main">⇒</span> stmt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span>Basic <span class="main">(</span>subst_basic_stmt <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S1'</span></span></span> <span class="main">;</span> <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">S2'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1'</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">S2'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">;</span> <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Local <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">(</span>Local <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S1'</span></span></span> <span class="main">;</span> <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">S2'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S1'</span></span></span> <span class="free"><span class="bound"><span class="entity">S2'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span> <span class="main">⟹</span> <span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span><span class="main">)</span>"</span></span> 
<span class="comment1">(* subst_stmt n v (WhileDyn e S) undefined *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> Barrier Barrier"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> Break Break"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> Continue Continue"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subst_stmt</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> Return Return"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">param_subst</span></span> <span class="free"><span class="free">f</span></span> <span class="free"><span class="free">u</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> replaces <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>'s parameter with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">param_subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proc list <span class="main">⇒</span> proc_name <span class="main">⇒</span> V <span class="main">⇒</span> stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">param_subst</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> 
  <span class="keyword1">let</span> <span class="bound">proc</span> <span class="main">=</span> <span class="keyword1">THE</span> <span class="bound">proc</span><span class="main">.</span> <span class="bound">proc</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">∧</span> proc_name <span class="bound">proc</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">in</span>
  <span class="keyword1">THE</span> <span class="bound">S'</span><span class="main">.</span> subst_stmt <span class="main">(</span>param <span class="bound">proc</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>body <span class="bound">proc</span><span class="main">)</span> <span class="bound">S'</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Replace <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Return"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v := true›</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">relim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"stmt <span class="main">⇒</span> V <span class="main">⇒</span> stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">relim</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="comment1">(* Additional rule for adversarial abstraction (Fig 7b) *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">relim</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">;;</span> <span class="free">relim</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> <span class="main">(</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">relim</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span><span class="free">relim</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">relim</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span><span class="free">relim</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="comment1">(* relim (WhileDyn e S) v = undefined *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> Barrier <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Barrier"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> Break <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Break"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> Continue <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Continue"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">relim</span> Return <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> Basic <span class="main">(</span>Assign <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> eTrue<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Fresh variables›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fresh</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"V <span class="main">⇒</span> V list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fresh</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">vs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The rules of Figure 6›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">step_k</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">"abs_level <span class="main">⇒</span> proc list <span class="main">⇒</span> threadset <span class="main">⇒</span> kernel_state <span class="main">⇒</span> kernel_state option <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  K_Inter_Group_Race<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> step_g <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ'</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
     kernel_race <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">κ'</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> None"</span></span>
<span class="main">|</span> K_Intra_Group_Race<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">;</span> step_g <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> None <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> None"</span></span>
<span class="main">|</span> K_Basic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> step_g <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ'</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
     <span class="main">¬</span> <span class="main">(</span>kernel_race <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">κ'</span></span></span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>Basic <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> K_Divergence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">;</span> step_g <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> None <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> None"</span></span>
<span class="main">|</span> K_Sync<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> step_g <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ'</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">;</span>
     <span class="main">¬</span> <span class="main">(</span>kernel_race <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">κ'</span></span></span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>Barrier<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> K_Seq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> 
  <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> K_Var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fresh <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">⟹</span> 
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>Local <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>  
  <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">S'</span><span class="main">.</span> subst_stmt <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">S'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> K_If<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fresh <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">⟹</span> 
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> 
  <span class="main">(</span>Basic <span class="main">(</span>Assign <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> 
  <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧*</span> Loc <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> 
  <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧*</span> <span class="main">¬*</span> <span class="main">(</span>Loc <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> K_Open<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fresh <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> 
  <span class="main">(</span>WhileDyn <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>belim <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧*</span> <span class="main">¬*</span> <span class="main">(</span>Loc <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> K_Iter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">;</span> 
  eval_bool <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> 
  fresh <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">;</span> fresh <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>WhileDyn <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> 
  <span class="main">(</span>Basic <span class="main">(</span>Assign <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> 
  <span class="main">#</span> <span class="main">(</span>celim <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧*</span> Loc <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">∧*</span> <span class="main">¬*</span> <span class="main">(</span>Loc <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">#</span> <span class="main">(</span>WhileDyn <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> K_Done<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> 
  <span class="main">¬</span> <span class="main">(</span>eval_bool <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>WhileDyn <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span> <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> K_Call<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> fresh <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">;</span> fresh <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> param_subst <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">step_k</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>Call <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">)</span> 
  <span class="main">(</span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">κ</span></span></span><span class="main">,</span> <span class="main">(</span>Basic <span class="main">(</span>Assign <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">;;</span> relim <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> 
  <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧*</span> <span class="main">¬*</span> <span class="main">(</span>Loc <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Kernel_programming_language">
<div class="head">
<h1>Theory Kernel_programming_language</h1>
</div>
<pre class="source"><span class="comment1">(* 
Title:       Kernel_programming_language.thy
Author:      John Wickerson
Date:        2 April 2014
Description: 
  This theory file accompanies the article "The Design and 
  Implementation of a Verification Technique for GPU Kernels" 
  by Adam Betts, Nathan Chong, Alastair F. Donaldson, Jeroen
  Ketema, Shaz Qadeer, Paul Thomson and John Wickerson. It
  formalises all of the definitions provided in Sections 3
  and 4. 
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Kernel_programming_language <span class="keyword2"><span class="keyword">imports</span></span>
<span class="comment1">(* 1. SOME GENERAL PURPOSE STUFF *)</span>
  <a href="Misc.html">Misc</a>
<span class="comment1">(* 2. SYNTAX OF KPL *)</span>
  <a href="KPL_syntax.html">KPL_syntax</a>
<span class="comment1">(* 3. WELL-FORMEDNESS OF KPL KERNELS *)</span>
  <a href="KPL_wellformedness.html">KPL_wellformedness</a>
<span class="comment1">(* 4. THREAD, GROUP, AND KERNEL STATES *)</span>
  <a href="KPL_state.html">KPL_state</a>
<span class="comment1">(* 5. EXECUTION RULES FOR THREADS *)</span>
  <a href="KPL_execution_thread.html">KPL_execution_thread</a>
<span class="comment1">(* 6. EXECUTION RULES FOR GROUPS *)</span>
  <a href="KPL_execution_group.html">KPL_execution_group</a>
<span class="comment1">(* 7. EXECUTION RULES FOR KERNELS *)</span>
  <a href="KPL_execution_kernel.html">KPL_execution_kernel</a>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>